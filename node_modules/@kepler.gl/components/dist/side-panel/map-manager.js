"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _reselect = require("reselect");

var _styledComponents = require("../common/styled-components");

var _mapStyleSelector = _interopRequireDefault(require("./map-style-panel/map-style-selector"));

var _mapLayerSelector = _interopRequireDefault(require("./map-style-panel/map-layer-selector"));

var _panelTitle = _interopRequireDefault(require("../side-panel/panel-title"));

var _icons = require("../common/icons");

var _reactIntl = require("react-intl");

var _localization = require("@kepler.gl/localization");

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

MapManagerFactory.deps = [_mapStyleSelector["default"], _mapLayerSelector["default"], _panelTitle["default"]];

function MapManagerFactory(MapStyleSelector, LayerGroupSelector, PanelTitle) {
  var MapManager = /*#__PURE__*/function (_Component) {
    (0, _inherits2["default"])(MapManager, _Component);

    var _super = _createSuper(MapManager);

    function MapManager() {
      var _this;

      (0, _classCallCheck2["default"])(this, MapManager);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = _super.call.apply(_super, [this].concat(args));
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
        isSelecting: false
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_toggleSelecting", function () {
        _this.setState({
          isSelecting: !_this.state.isSelecting
        });
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_selectStyle", function (val) {
        var mapStyleActions = _this.props.mapStyleActions;
        var mapStyleChange = mapStyleActions.mapStyleChange;
        mapStyleChange(val);

        _this._toggleSelecting();
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getCustomMapStylesActions", (0, _reselect.createSelector)(function (props) {
        return props.mapStyle.mapStyles;
      }, function (props) {
        return props.mapStyleActions;
      }, function (mapStyles, mapStyleActions) {
        var actionsPerCustomStyle = {};
        Object.values(mapStyles).filter(function (mapStyle) {
          return Boolean(mapStyle.custom);
        }).forEach(function (_ref) {
          var id = _ref.id;
          actionsPerCustomStyle[id] = [{
            id: "remove-map-style-".concat(id),
            IconComponent: _icons.Trash,
            tooltip: 'tooltip.removeBaseMapStyle',
            onClick: function onClick() {
              return mapStyleActions.removeCustomMapStyle({
                id: id
              });
            }
          }];
        });
        return actionsPerCustomStyle;
      }));
      return _this;
    }

    (0, _createClass2["default"])(MapManager, [{
      key: "render",
      value: function render() {
        var _this$props = this.props,
            mapStyle = _this$props.mapStyle,
            intl = _this$props.intl,
            mapStyleActions = _this$props.mapStyleActions,
            showAddMapStyleModal = _this$props.showAddMapStyleModal,
            panelMetadata = _this$props.panelMetadata;
        var currentStyle = mapStyle.mapStyles[mapStyle.styleType] || {};
        var editableLayers = currentStyle.layerGroups || [];
        var customMapStylesActions = this.getCustomMapStylesActions(this.props);
        return /*#__PURE__*/_react["default"].createElement("div", {
          className: "map-style-panel"
        }, /*#__PURE__*/_react["default"].createElement(PanelTitle, {
          className: "map-manager-title",
          title: intl.formatMessage({
            id: panelMetadata.label
          })
        }, /*#__PURE__*/_react["default"].createElement(_styledComponents.Button, {
          className: "add-map-style-button",
          onClick: showAddMapStyleModal
        }, /*#__PURE__*/_react["default"].createElement(_icons.Add, {
          height: "12px"
        }), /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
          id: 'mapManager.addMapStyle'
        }))), /*#__PURE__*/_react["default"].createElement("div", null, /*#__PURE__*/_react["default"].createElement(MapStyleSelector, {
          mapStyle: mapStyle,
          isSelecting: this.state.isSelecting,
          onChange: this._selectStyle,
          toggleActive: this._toggleSelecting,
          customMapStylesActions: customMapStylesActions
        }), editableLayers.length ? /*#__PURE__*/_react["default"].createElement(LayerGroupSelector, {
          layers: mapStyle.visibleLayerGroups,
          editableLayers: editableLayers,
          topLayers: mapStyle.topLayerGroups,
          onChange: mapStyleActions.mapConfigChange,
          threeDBuildingColor: mapStyle.threeDBuildingColor,
          on3dBuildingColorChange: mapStyleActions.set3dBuildingColor,
          backgroundColor: mapStyle.backgroundColor,
          onBackgroundColorChange: mapStyleActions.setBackgroundColor
        }) : null));
      }
    }]);
    return MapManager;
  }(_react.Component);

  return (0, _reactIntl.injectIntl)(MapManager);
}

var _default = MapManagerFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zaWRlLXBhbmVsL21hcC1tYW5hZ2VyLnRzeCJdLCJuYW1lcyI6WyJNYXBNYW5hZ2VyRmFjdG9yeSIsImRlcHMiLCJNYXBTdHlsZVNlbGVjdG9yRmFjdG9yeSIsIkxheWVyR3JvdXBTZWxlY3RvckZhY3RvcnkiLCJQYW5lbFRpdGxlRmFjdG9yeSIsIk1hcFN0eWxlU2VsZWN0b3IiLCJMYXllckdyb3VwU2VsZWN0b3IiLCJQYW5lbFRpdGxlIiwiTWFwTWFuYWdlciIsImlzU2VsZWN0aW5nIiwic2V0U3RhdGUiLCJzdGF0ZSIsInZhbCIsIm1hcFN0eWxlQWN0aW9ucyIsInByb3BzIiwibWFwU3R5bGVDaGFuZ2UiLCJfdG9nZ2xlU2VsZWN0aW5nIiwibWFwU3R5bGUiLCJtYXBTdHlsZXMiLCJhY3Rpb25zUGVyQ3VzdG9tU3R5bGUiLCJPYmplY3QiLCJ2YWx1ZXMiLCJmaWx0ZXIiLCJCb29sZWFuIiwiY3VzdG9tIiwiZm9yRWFjaCIsImlkIiwiSWNvbkNvbXBvbmVudCIsIlRyYXNoIiwidG9vbHRpcCIsIm9uQ2xpY2siLCJyZW1vdmVDdXN0b21NYXBTdHlsZSIsImludGwiLCJzaG93QWRkTWFwU3R5bGVNb2RhbCIsInBhbmVsTWV0YWRhdGEiLCJjdXJyZW50U3R5bGUiLCJzdHlsZVR5cGUiLCJlZGl0YWJsZUxheWVycyIsImxheWVyR3JvdXBzIiwiY3VzdG9tTWFwU3R5bGVzQWN0aW9ucyIsImdldEN1c3RvbU1hcFN0eWxlc0FjdGlvbnMiLCJmb3JtYXRNZXNzYWdlIiwibGFiZWwiLCJfc2VsZWN0U3R5bGUiLCJsZW5ndGgiLCJ2aXNpYmxlTGF5ZXJHcm91cHMiLCJ0b3BMYXllckdyb3VwcyIsIm1hcENvbmZpZ0NoYW5nZSIsInRocmVlREJ1aWxkaW5nQ29sb3IiLCJzZXQzZEJ1aWxkaW5nQ29sb3IiLCJiYWNrZ3JvdW5kQ29sb3IiLCJzZXRCYWNrZ3JvdW5kQ29sb3IiLCJDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7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dXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge0NvbXBvbmVudH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtjcmVhdGVTZWxlY3Rvcn0gZnJvbSAncmVzZWxlY3QnO1xuXG5pbXBvcnQge0J1dHRvbn0gZnJvbSAnLi4vY29tbW9uL3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBNYXBTdHlsZVNlbGVjdG9yRmFjdG9yeSBmcm9tICcuL21hcC1zdHlsZS1wYW5lbC9tYXAtc3R5bGUtc2VsZWN0b3InO1xuaW1wb3J0IExheWVyR3JvdXBTZWxlY3RvckZhY3RvcnkgZnJvbSAnLi9tYXAtc3R5bGUtcGFuZWwvbWFwLWxheWVyLXNlbGVjdG9yJztcbmltcG9ydCBQYW5lbFRpdGxlRmFjdG9yeSBmcm9tICcuLi9zaWRlLXBhbmVsL3BhbmVsLXRpdGxlJztcblxuaW1wb3J0IHtBZGQsIFRyYXNofSBmcm9tICcuLi9jb21tb24vaWNvbnMnO1xuaW1wb3J0IHtQYW5lbE1ldGF9IGZyb20gJy4vY29tbW9uL3R5cGVzJztcbmltcG9ydCB7aW5qZWN0SW50bCwgV3JhcHBlZENvbXBvbmVudFByb3BzfSBmcm9tICdyZWFjdC1pbnRsJztcbmltcG9ydCB7Rm9ybWF0dGVkTWVzc2FnZX0gZnJvbSAnQGtlcGxlci5nbC9sb2NhbGl6YXRpb24nO1xuaW1wb3J0IHtNYXBTdHlsZX0gZnJvbSAnQGtlcGxlci5nbC9yZWR1Y2Vycyc7XG5pbXBvcnQge01hcFN0eWxlQWN0aW9uc30gZnJvbSAnQGtlcGxlci5nbC9hY3Rpb25zJztcbmltcG9ydCB7TWFwU3R5bGVzfSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcblxuZXhwb3J0IHR5cGUgTWFwTWFuYWdlclByb3BzID0ge1xuICBtYXBTdHlsZTogTWFwU3R5bGU7XG4gIG1hcFN0eWxlQWN0aW9uczoge1xuICAgIG1hcFN0eWxlQ2hhbmdlOiB0eXBlb2YgTWFwU3R5bGVBY3Rpb25zLm1hcFN0eWxlQ2hhbmdlO1xuICAgIG1hcENvbmZpZ0NoYW5nZTogdHlwZW9mIE1hcFN0eWxlQWN0aW9ucy5tYXBDb25maWdDaGFuZ2U7XG4gICAgc2V0M2RCdWlsZGluZ0NvbG9yOiB0eXBlb2YgTWFwU3R5bGVBY3Rpb25zLnNldDNkQnVpbGRpbmdDb2xvcjtcbiAgICBzZXRCYWNrZ3JvdW5kQ29sb3I6IHR5cGVvZiBNYXBTdHlsZUFjdGlvbnMuc2V0QmFja2dyb3VuZENvbG9yO1xuICAgIHJlbW92ZUN1c3RvbU1hcFN0eWxlOiB0eXBlb2YgTWFwU3R5bGVBY3Rpb25zLnJlbW92ZUN1c3RvbU1hcFN0eWxlO1xuICB9O1xuICBzaG93QWRkTWFwU3R5bGVNb2RhbDogKCkgPT4gdm9pZDtcbiAgcGFuZWxNZXRhZGF0YTogUGFuZWxNZXRhO1xufSAmIFdyYXBwZWRDb21wb25lbnRQcm9wcztcblxuTWFwTWFuYWdlckZhY3RvcnkuZGVwcyA9IFtNYXBTdHlsZVNlbGVjdG9yRmFjdG9yeSwgTGF5ZXJHcm91cFNlbGVjdG9yRmFjdG9yeSwgUGFuZWxUaXRsZUZhY3RvcnldO1xuXG5mdW5jdGlvbiBNYXBNYW5hZ2VyRmFjdG9yeShcbiAgTWFwU3R5bGVTZWxlY3RvcjogUmV0dXJuVHlwZTx0eXBlb2YgTWFwU3R5bGVTZWxlY3RvckZhY3Rvcnk+LFxuICBMYXllckdyb3VwU2VsZWN0b3I6IFJldHVyblR5cGU8dHlwZW9mIExheWVyR3JvdXBTZWxlY3RvckZhY3Rvcnk+LFxuICBQYW5lbFRpdGxlOiBSZXR1cm5UeXBlPHR5cGVvZiBQYW5lbFRpdGxlRmFjdG9yeT5cbikge1xuICBjbGFzcyBNYXBNYW5hZ2VyIGV4dGVuZHMgQ29tcG9uZW50PE1hcE1hbmFnZXJQcm9wcz4ge1xuICAgIHN0YXRlID0ge1xuICAgICAgaXNTZWxlY3Rpbmc6IGZhbHNlXG4gICAgfTtcblxuICAgIF90b2dnbGVTZWxlY3RpbmcgPSAoKSA9PiB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtpc1NlbGVjdGluZzogIXRoaXMuc3RhdGUuaXNTZWxlY3Rpbmd9KTtcbiAgICB9O1xuXG4gICAgX3NlbGVjdFN0eWxlID0gKHZhbDogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCB7bWFwU3R5bGVBY3Rpb25zfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCB7bWFwU3R5bGVDaGFuZ2V9ID0gbWFwU3R5bGVBY3Rpb25zO1xuICAgICAgbWFwU3R5bGVDaGFuZ2UodmFsKTtcbiAgICAgIHRoaXMuX3RvZ2dsZVNlbGVjdGluZygpO1xuICAgIH07XG5cbiAgICBnZXRDdXN0b21NYXBTdHlsZXNBY3Rpb25zID0gY3JlYXRlU2VsZWN0b3IoXG4gICAgICAocHJvcHM6IE1hcE1hbmFnZXJQcm9wcykgPT4gcHJvcHMubWFwU3R5bGUubWFwU3R5bGVzLFxuICAgICAgKHByb3BzOiBNYXBNYW5hZ2VyUHJvcHMpID0+IHByb3BzLm1hcFN0eWxlQWN0aW9ucyxcbiAgICAgIChtYXBTdHlsZXM6IE1hcFN0eWxlcywgbWFwU3R5bGVBY3Rpb25zKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGlvbnNQZXJDdXN0b21TdHlsZSA9IHt9O1xuICAgICAgICBPYmplY3QudmFsdWVzKG1hcFN0eWxlcylcbiAgICAgICAgICAuZmlsdGVyKG1hcFN0eWxlID0+IHtcbiAgICAgICAgICAgIHJldHVybiBCb29sZWFuKG1hcFN0eWxlLmN1c3RvbSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZm9yRWFjaCgoe2lkfSkgPT4ge1xuICAgICAgICAgICAgYWN0aW9uc1BlckN1c3RvbVN0eWxlW2lkXSA9IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBgcmVtb3ZlLW1hcC1zdHlsZS0ke2lkfWAsXG4gICAgICAgICAgICAgICAgSWNvbkNvbXBvbmVudDogVHJhc2gsXG4gICAgICAgICAgICAgICAgdG9vbHRpcDogJ3Rvb2x0aXAucmVtb3ZlQmFzZU1hcFN0eWxlJyxcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiBtYXBTdHlsZUFjdGlvbnMucmVtb3ZlQ3VzdG9tTWFwU3R5bGUoe2lkfSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGFjdGlvbnNQZXJDdXN0b21TdHlsZTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgY29uc3Qge21hcFN0eWxlLCBpbnRsLCBtYXBTdHlsZUFjdGlvbnMsIHNob3dBZGRNYXBTdHlsZU1vZGFsLCBwYW5lbE1ldGFkYXRhfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCBjdXJyZW50U3R5bGUgPSBtYXBTdHlsZS5tYXBTdHlsZXNbbWFwU3R5bGUuc3R5bGVUeXBlXSB8fCB7fTtcbiAgICAgIGNvbnN0IGVkaXRhYmxlTGF5ZXJzID0gY3VycmVudFN0eWxlLmxheWVyR3JvdXBzIHx8IFtdO1xuICAgICAgY29uc3QgY3VzdG9tTWFwU3R5bGVzQWN0aW9ucyA9IHRoaXMuZ2V0Q3VzdG9tTWFwU3R5bGVzQWN0aW9ucyh0aGlzLnByb3BzKTtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtYXAtc3R5bGUtcGFuZWxcIj5cbiAgICAgICAgICA8UGFuZWxUaXRsZVxuICAgICAgICAgICAgY2xhc3NOYW1lPVwibWFwLW1hbmFnZXItdGl0bGVcIlxuICAgICAgICAgICAgdGl0bGU9e2ludGwuZm9ybWF0TWVzc2FnZSh7aWQ6IHBhbmVsTWV0YWRhdGEubGFiZWx9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8QnV0dG9uIGNsYXNzTmFtZT1cImFkZC1tYXAtc3R5bGUtYnV0dG9uXCIgb25DbGljaz17c2hvd0FkZE1hcFN0eWxlTW9kYWx9PlxuICAgICAgICAgICAgICA8QWRkIGhlaWdodD1cIjEycHhcIiAvPlxuICAgICAgICAgICAgICA8Rm9ybWF0dGVkTWVzc2FnZSBpZD17J21hcE1hbmFnZXIuYWRkTWFwU3R5bGUnfSAvPlxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgPC9QYW5lbFRpdGxlPlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8TWFwU3R5bGVTZWxlY3RvclxuICAgICAgICAgICAgICBtYXBTdHlsZT17bWFwU3R5bGV9XG4gICAgICAgICAgICAgIGlzU2VsZWN0aW5nPXt0aGlzLnN0YXRlLmlzU2VsZWN0aW5nfVxuICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5fc2VsZWN0U3R5bGV9XG4gICAgICAgICAgICAgIHRvZ2dsZUFjdGl2ZT17dGhpcy5fdG9nZ2xlU2VsZWN0aW5nfVxuICAgICAgICAgICAgICBjdXN0b21NYXBTdHlsZXNBY3Rpb25zPXtjdXN0b21NYXBTdHlsZXNBY3Rpb25zfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIHtlZGl0YWJsZUxheWVycy5sZW5ndGggPyAoXG4gICAgICAgICAgICAgIDxMYXllckdyb3VwU2VsZWN0b3JcbiAgICAgICAgICAgICAgICBsYXllcnM9e21hcFN0eWxlLnZpc2libGVMYXllckdyb3Vwc31cbiAgICAgICAgICAgICAgICBlZGl0YWJsZUxheWVycz17ZWRpdGFibGVMYXllcnN9XG4gICAgICAgICAgICAgICAgdG9wTGF5ZXJzPXttYXBTdHlsZS50b3BMYXllckdyb3Vwc31cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17bWFwU3R5bGVBY3Rpb25zLm1hcENvbmZpZ0NoYW5nZX1cbiAgICAgICAgICAgICAgICB0aHJlZURCdWlsZGluZ0NvbG9yPXttYXBTdHlsZS50aHJlZURCdWlsZGluZ0NvbG9yfVxuICAgICAgICAgICAgICAgIG9uM2RCdWlsZGluZ0NvbG9yQ2hhbmdlPXttYXBTdHlsZUFjdGlvbnMuc2V0M2RCdWlsZGluZ0NvbG9yfVxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcj17bWFwU3R5bGUuYmFja2dyb3VuZENvbG9yfVxuICAgICAgICAgICAgICAgIG9uQmFja2dyb3VuZENvbG9yQ2hhbmdlPXttYXBTdHlsZUFjdGlvbnMuc2V0QmFja2dyb3VuZENvbG9yfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGluamVjdEludGwoTWFwTWFuYWdlcik7XG59XG5cbmV4cG9ydCBkZWZhdWx0IE1hcE1hbmFnZXJGYWN0b3J5O1xuIl19