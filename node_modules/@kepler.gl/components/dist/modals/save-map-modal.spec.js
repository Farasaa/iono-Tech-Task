"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _react2 = require("@testing-library/react");

var _saveMapModal = _interopRequireDefault(require("./save-map-modal"));

var _componentJestUtils = require("test/helpers/component-jest-utils");

var _useCloudListProvider = require("../hooks/use-cloud-list-provider");

var _src = require("@kepler.gl/constants/src");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var SaveMapModal = (0, _saveMapModal["default"])();
var DEFAULT_PROS = {
  mapInfo: {
    title: 'Test Map',
    description: 'test'
  },
  exportImage: jest.fn(),
  isProviderLoading: false,
  providerError: null,
  onUpdateImageSetting: jest.fn(),
  cleanupExportImage: jest.fn(),
  onSetMapInfo: jest.fn(),
  onCancel: jest.fn(),
  onConfirm: jest.fn()
};

var UNDEFINED_MAP_TITLE_PROPS = _objectSpread(_objectSpread({}, DEFAULT_PROS), {}, {
  mapInfo: {
    description: undefined,
    title: undefined
  }
});

var DEFAULT_PROVIDER = {
  name: 'test provider',
  icon: jest.fn(),
  getManagementUrl: jest.fn().mockImplementation(function () {
    return 'provider.url';
  })
};
jest.mock('../hooks/use-cloud-list-provider', function () {
  return {
    useCloudListProvider: jest.fn().mockImplementation(function () {
      return {
        provider: null,
        setProvider: jest.fn(),
        cloudProviders: []
      };
    })
  };
});
describe('SaveMapModal', function () {
  afterEach(function () {
    jest.clearAllMocks();
  });
  test('renders SaveMapModal component with provider set to null and map title set', function () {
    var _renderWithTheme = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, DEFAULT_PROS)),
        getByText = _renderWithTheme.getByText;

    var confirmButton = getByText('modal.button.save');
    expect(confirmButton).toBeInTheDocument();
    expect(confirmButton).toBeDisabled();
  });
  test('renders SaveMapModal component with provider set to null and map title not set', function () {
    var _renderWithTheme2 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, UNDEFINED_MAP_TITLE_PROPS)),
        getByText = _renderWithTheme2.getByText;

    var confirmButton = getByText('modal.button.save');
    expect(confirmButton).toBeInTheDocument();
    expect(confirmButton).toBeDisabled();
  });
  test('renders SaveMapModal component with provider correctly set and map title not set', function () {
    _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
      return {
        provider: DEFAULT_PROVIDER,
        setProvider: jest.fn(),
        cloudProviders: []
      };
    });

    var _renderWithTheme3 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, UNDEFINED_MAP_TITLE_PROPS)),
        getByText = _renderWithTheme3.getByText;

    var confirmButton = getByText('modal.button.save');
    expect(confirmButton).toBeInTheDocument();
    expect(confirmButton).toBeDisabled();
  });
  test('renders SaveMapModal component with provider correctly set and map title set', function () {
    _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
      return {
        provider: DEFAULT_PROVIDER,
        setProvider: jest.fn(),
        cloudProviders: []
      };
    });

    var _renderWithTheme4 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, DEFAULT_PROS)),
        getByText = _renderWithTheme4.getByText;

    var confirmButton = getByText('modal.button.save');
    expect(confirmButton).toBeInTheDocument();
    expect(confirmButton).toBeEnabled();
  });
  test('calls onCancel when cancel button is clicked', function () {
    var _renderWithTheme5 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, DEFAULT_PROS)),
        getByText = _renderWithTheme5.getByText;

    _react2.fireEvent.click(getByText('modal.button.defaultCancel'));

    expect(DEFAULT_PROS.onCancel).toHaveBeenCalled();
  });
  test('calls onConfirm with provider when confirm button is clicked', function () {
    _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
      return {
        provider: DEFAULT_PROVIDER,
        setProvider: jest.fn(),
        cloudProviders: []
      };
    });

    var _renderWithTheme6 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, DEFAULT_PROS)),
        getByText = _renderWithTheme6.getByText;

    var confirmButton = getByText('modal.button.save');

    _react2.fireEvent.click(confirmButton);

    expect(DEFAULT_PROS.onConfirm).toHaveBeenCalled();
  });
  test('does not render loading animation when isProviderLoading is true', function () {
    var _renderWithTheme7 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, DEFAULT_PROS)),
        queryAllByTestId = _renderWithTheme7.queryAllByTestId;

    expect(queryAllByTestId(_src.dataTestIds.providerLoading)).toHaveLength(0);
  });
  test('renders loading animation when isProviderLoading is true', function () {
    var _renderWithTheme8 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, (0, _extends2["default"])({}, DEFAULT_PROS, {
      isProviderLoading: true
    }))),
        getByTestId = _renderWithTheme8.getByTestId;

    expect(getByTestId(_src.dataTestIds.providerLoading)).toBeInTheDocument();
  });
  test('renders no error if provider error is undefined', function () {
    var _renderWithTheme9 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, DEFAULT_PROS)),
        queryAllByText = _renderWithTheme9.queryAllByText;

    expect(queryAllByText('modal.statusPanel.error')).toHaveLength(0);
  });
  test('displays provider error message when providerError is present', function () {
    var _renderWithTheme10 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, (0, _extends2["default"])({}, DEFAULT_PROS, {
      providerError: {
        message: 'Error message'
      }
    }))),
        getByText = _renderWithTheme10.getByText;

    expect(getByText('modal.statusPanel.error')).toBeInTheDocument();
  });
  test('call onSetMapInfo upon typing map (provider is set)', function () {
    _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
      return {
        provider: DEFAULT_PROVIDER,
        setProvider: jest.fn(),
        cloudProviders: []
      };
    });

    var _renderWithTheme11 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, UNDEFINED_MAP_TITLE_PROPS)),
        getByTestId = _renderWithTheme11.getByTestId,
        getByPlaceholderText = _renderWithTheme11.getByPlaceholderText;

    var mapInfoPanel = getByTestId(_src.dataTestIds.providerMapInfoPanel);
    expect(mapInfoPanel).toBeInTheDocument();
    var titleInput = getByPlaceholderText('Type map title');
    expect(titleInput).toBeInTheDocument();

    _react2.fireEvent.change(titleInput, {
      target: {
        value: 'first kepler map'
      }
    });

    expect(DEFAULT_PROS.onSetMapInfo).toHaveBeenCalledWith({
      title: 'first kepler map'
    });
  });
  test('call onUpdateImageSetting', function () {
    _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
      return {
        provider: DEFAULT_PROVIDER,
        setProvider: jest.fn(),
        cloudProviders: []
      };
    });

    (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(SaveMapModal, UNDEFINED_MAP_TITLE_PROPS)); // first time the component mount

    expect(DEFAULT_PROS.onUpdateImageSetting).toHaveBeenCalledWith({
      exporting: true
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RhbHMvc2F2ZS1tYXAtbW9kYWwuc3BlYy50c3giXSwibmFtZXMiOlsiU2F2ZU1hcE1vZGFsIiwiREVGQVVMVF9QUk9TIiwibWFwSW5mbyIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJleHBvcnRJbWFnZSIsImplc3QiLCJmbiIsImlzUHJvdmlkZXJMb2FkaW5nIiwicHJvdmlkZXJFcnJvciIsIm9uVXBkYXRlSW1hZ2VTZXR0aW5nIiwiY2xlYW51cEV4cG9ydEltYWdlIiwib25TZXRNYXBJbmZvIiwib25DYW5jZWwiLCJvbkNvbmZpcm0iLCJVTkRFRklORURfTUFQX1RJVExFX1BST1BTIiwidW5kZWZpbmVkIiwiREVGQVVMVF9QUk9WSURFUiIsIm5hbWUiLCJpY29uIiwiZ2V0TWFuYWdlbWVudFVybCIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsIm1vY2siLCJ1c2VDbG91ZExpc3RQcm92aWRlciIsInByb3ZpZGVyIiwic2V0UHJvdmlkZXIiLCJjbG91ZFByb3ZpZGVycyIsImRlc2NyaWJlIiwiYWZ0ZXJFYWNoIiwiY2xlYXJBbGxNb2NrcyIsInRlc3QiLCJnZXRCeVRleHQiLCJjb25maXJtQnV0dG9uIiwiZXhwZWN0IiwidG9CZUluVGhlRG9jdW1lbnQiLCJ0b0JlRGlzYWJsZWQiLCJ0b0JlRW5hYmxlZCIsImZpcmVFdmVudCIsImNsaWNrIiwidG9IYXZlQmVlbkNhbGxlZCIsInF1ZXJ5QWxsQnlUZXN0SWQiLCJkYXRhVGVzdElkcyIsInByb3ZpZGVyTG9hZGluZyIsInRvSGF2ZUxlbmd0aCIsImdldEJ5VGVzdElkIiwicXVlcnlBbGxCeVRleHQiLCJtZXNzYWdlIiwiZ2V0QnlQbGFjZWhvbGRlclRleHQiLCJtYXBJbmZvUGFuZWwiLCJwcm92aWRlck1hcEluZm9QYW5lbCIsInRpdGxlSW5wdXQiLCJjaGFuZ2UiLCJ0YXJnZXQiLCJ2YWx1ZSIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwiZXhwb3J0aW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7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RUFBRTtBQURrRCxLQUEvRDtBQUdELEdBYkcsQ0FBSjtBQWNELENBdkhPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG4vLyBAdHMtbm9jaGVja1xuXG4vKipcbiAqIEkgZGVjaWRlZCB0byBtb3ZlIHRoZSBuZXh0IHRvIHRoZSBhY3R1YWwgZmlsZSBiZWNhdXNlIGl0IG1ha2VzIGl0XG4gKiBleHRyZW1lbHkgZWFzaWVyIHRvIG1vY2sgYWRuIHRlc3QgZmVhdHVyZXMuXG4gKiBJdCdzIGVhc2llciB0byBtb2NrIGl0ZW1zIHdpdGggamVzdCB1c2luZyB0aGUgcmVsYXRpdmUgcGF0aFxuICogcmF0aGVyIHRoYW4gdHJ5aW5nIHRvIG1vY2sgaW1wb3J0cyBsaWtlIEBrZXBsZXIuZ2wvY29tcG9uZW50c1xuICogd2hpY2ggY3JlYXRlcyBzZXZlcmFsIHNpZGUgZWZmZWN0cy5cbiAqIENvbG9jYXRpbmcgdGVzdHMgaXMgbXVjaCBlYXNpZXJcbiAqL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtmaXJlRXZlbnR9IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvcmVhY3QnO1xuaW1wb3J0IFNhdmVNYXBNb2RhbEZhY3RvcnkgZnJvbSAnLi9zYXZlLW1hcC1tb2RhbCc7XG5pbXBvcnQge3JlbmRlcldpdGhUaGVtZX0gZnJvbSAndGVzdC9oZWxwZXJzL2NvbXBvbmVudC1qZXN0LXV0aWxzJztcbmltcG9ydCB7dXNlQ2xvdWRMaXN0UHJvdmlkZXJ9IGZyb20gJy4uL2hvb2tzL3VzZS1jbG91ZC1saXN0LXByb3ZpZGVyJztcbmltcG9ydCB7ZGF0YVRlc3RJZHN9IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzL3NyYyc7XG5cbmNvbnN0IFNhdmVNYXBNb2RhbCA9IFNhdmVNYXBNb2RhbEZhY3RvcnkoKTtcblxuY29uc3QgREVGQVVMVF9QUk9TID0ge1xuICBtYXBJbmZvOiB7XG4gICAgdGl0bGU6ICdUZXN0IE1hcCcsXG4gICAgZGVzY3JpcHRpb246ICd0ZXN0J1xuICB9LFxuICBleHBvcnRJbWFnZTogamVzdC5mbigpLFxuICBpc1Byb3ZpZGVyTG9hZGluZzogZmFsc2UsXG4gIHByb3ZpZGVyRXJyb3I6IG51bGwsXG4gIG9uVXBkYXRlSW1hZ2VTZXR0aW5nOiBqZXN0LmZuKCksXG4gIGNsZWFudXBFeHBvcnRJbWFnZTogamVzdC5mbigpLFxuICBvblNldE1hcEluZm86IGplc3QuZm4oKSxcbiAgb25DYW5jZWw6IGplc3QuZm4oKSxcbiAgb25Db25maXJtOiBqZXN0LmZuKClcbn07XG5cbmNvbnN0IFVOREVGSU5FRF9NQVBfVElUTEVfUFJPUFMgPSB7XG4gIC4uLkRFRkFVTFRfUFJPUyxcbiAgbWFwSW5mbzoge1xuICAgIGRlc2NyaXB0aW9uOiB1bmRlZmluZWQsXG4gICAgdGl0bGU6IHVuZGVmaW5lZFxuICB9XG59O1xuXG5jb25zdCBERUZBVUxUX1BST1ZJREVSID0ge1xuICBuYW1lOiAndGVzdCBwcm92aWRlcicsXG4gIGljb246IGplc3QuZm4oKSxcbiAgZ2V0TWFuYWdlbWVudFVybDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAncHJvdmlkZXIudXJsJylcbn07XG5cbmplc3QubW9jaygnLi4vaG9va3MvdXNlLWNsb3VkLWxpc3QtcHJvdmlkZXInLCAoKSA9PiAoe1xuICB1c2VDbG91ZExpc3RQcm92aWRlcjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIHByb3ZpZGVyOiBudWxsLFxuICAgIHNldFByb3ZpZGVyOiBqZXN0LmZuKCksXG4gICAgY2xvdWRQcm92aWRlcnM6IFtdXG4gIH0pKVxufSkpO1xuXG5kZXNjcmliZSgnU2F2ZU1hcE1vZGFsJywgKCkgPT4ge1xuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICB0ZXN0KCdyZW5kZXJzIFNhdmVNYXBNb2RhbCBjb21wb25lbnQgd2l0aCBwcm92aWRlciBzZXQgdG8gbnVsbCBhbmQgbWFwIHRpdGxlIHNldCcsICgpID0+IHtcbiAgICBjb25zdCB7Z2V0QnlUZXh0fSA9IHJlbmRlcldpdGhUaGVtZSg8U2F2ZU1hcE1vZGFsIHsuLi5ERUZBVUxUX1BST1N9IC8+KTtcbiAgICBjb25zdCBjb25maXJtQnV0dG9uID0gZ2V0QnlUZXh0KCdtb2RhbC5idXR0b24uc2F2ZScpO1xuICAgIGV4cGVjdChjb25maXJtQnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgIGV4cGVjdChjb25maXJtQnV0dG9uKS50b0JlRGlzYWJsZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVuZGVycyBTYXZlTWFwTW9kYWwgY29tcG9uZW50IHdpdGggcHJvdmlkZXIgc2V0IHRvIG51bGwgYW5kIG1hcCB0aXRsZSBub3Qgc2V0JywgKCkgPT4ge1xuICAgIGNvbnN0IHtnZXRCeVRleHR9ID0gcmVuZGVyV2l0aFRoZW1lKDxTYXZlTWFwTW9kYWwgey4uLlVOREVGSU5FRF9NQVBfVElUTEVfUFJPUFN9IC8+KTtcbiAgICBjb25zdCBjb25maXJtQnV0dG9uID0gZ2V0QnlUZXh0KCdtb2RhbC5idXR0b24uc2F2ZScpO1xuICAgIGV4cGVjdChjb25maXJtQnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgIGV4cGVjdChjb25maXJtQnV0dG9uKS50b0JlRGlzYWJsZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVuZGVycyBTYXZlTWFwTW9kYWwgY29tcG9uZW50IHdpdGggcHJvdmlkZXIgY29ycmVjdGx5IHNldCBhbmQgbWFwIHRpdGxlIG5vdCBzZXQnLCAoKSA9PiB7XG4gICAgdXNlQ2xvdWRMaXN0UHJvdmlkZXIubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICBwcm92aWRlcjogREVGQVVMVF9QUk9WSURFUixcbiAgICAgIHNldFByb3ZpZGVyOiBqZXN0LmZuKCksXG4gICAgICBjbG91ZFByb3ZpZGVyczogW11cbiAgICB9KSk7XG4gICAgY29uc3Qge2dldEJ5VGV4dH0gPSByZW5kZXJXaXRoVGhlbWUoPFNhdmVNYXBNb2RhbCB7Li4uVU5ERUZJTkVEX01BUF9USVRMRV9QUk9QU30gLz4pO1xuICAgIGNvbnN0IGNvbmZpcm1CdXR0b24gPSBnZXRCeVRleHQoJ21vZGFsLmJ1dHRvbi5zYXZlJyk7XG4gICAgZXhwZWN0KGNvbmZpcm1CdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgZXhwZWN0KGNvbmZpcm1CdXR0b24pLnRvQmVEaXNhYmxlZCgpO1xuICB9KTtcblxuICB0ZXN0KCdyZW5kZXJzIFNhdmVNYXBNb2RhbCBjb21wb25lbnQgd2l0aCBwcm92aWRlciBjb3JyZWN0bHkgc2V0IGFuZCBtYXAgdGl0bGUgc2V0JywgKCkgPT4ge1xuICAgIHVzZUNsb3VkTGlzdFByb3ZpZGVyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgcHJvdmlkZXI6IERFRkFVTFRfUFJPVklERVIsXG4gICAgICBzZXRQcm92aWRlcjogamVzdC5mbigpLFxuICAgICAgY2xvdWRQcm92aWRlcnM6IFtdXG4gICAgfSkpO1xuICAgIGNvbnN0IHtnZXRCeVRleHR9ID0gcmVuZGVyV2l0aFRoZW1lKDxTYXZlTWFwTW9kYWwgey4uLkRFRkFVTFRfUFJPU30gLz4pO1xuICAgIGNvbnN0IGNvbmZpcm1CdXR0b24gPSBnZXRCeVRleHQoJ21vZGFsLmJ1dHRvbi5zYXZlJyk7XG4gICAgZXhwZWN0KGNvbmZpcm1CdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgZXhwZWN0KGNvbmZpcm1CdXR0b24pLnRvQmVFbmFibGVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbGxzIG9uQ2FuY2VsIHdoZW4gY2FuY2VsIGJ1dHRvbiBpcyBjbGlja2VkJywgKCkgPT4ge1xuICAgIGNvbnN0IHtnZXRCeVRleHR9ID0gcmVuZGVyV2l0aFRoZW1lKDxTYXZlTWFwTW9kYWwgey4uLkRFRkFVTFRfUFJPU30gLz4pO1xuICAgIGZpcmVFdmVudC5jbGljayhnZXRCeVRleHQoJ21vZGFsLmJ1dHRvbi5kZWZhdWx0Q2FuY2VsJykpO1xuICAgIGV4cGVjdChERUZBVUxUX1BST1Mub25DYW5jZWwpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FsbHMgb25Db25maXJtIHdpdGggcHJvdmlkZXIgd2hlbiBjb25maXJtIGJ1dHRvbiBpcyBjbGlja2VkJywgKCkgPT4ge1xuICAgIHVzZUNsb3VkTGlzdFByb3ZpZGVyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgcHJvdmlkZXI6IERFRkFVTFRfUFJPVklERVIsXG4gICAgICBzZXRQcm92aWRlcjogamVzdC5mbigpLFxuICAgICAgY2xvdWRQcm92aWRlcnM6IFtdXG4gICAgfSkpO1xuICAgIGNvbnN0IHtnZXRCeVRleHR9ID0gcmVuZGVyV2l0aFRoZW1lKDxTYXZlTWFwTW9kYWwgey4uLkRFRkFVTFRfUFJPU30gLz4pO1xuICAgIGNvbnN0IGNvbmZpcm1CdXR0b24gPSBnZXRCeVRleHQoJ21vZGFsLmJ1dHRvbi5zYXZlJyk7XG4gICAgZmlyZUV2ZW50LmNsaWNrKGNvbmZpcm1CdXR0b24pO1xuICAgIGV4cGVjdChERUZBVUxUX1BST1Mub25Db25maXJtKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2RvZXMgbm90IHJlbmRlciBsb2FkaW5nIGFuaW1hdGlvbiB3aGVuIGlzUHJvdmlkZXJMb2FkaW5nIGlzIHRydWUnLCAoKSA9PiB7XG4gICAgY29uc3Qge3F1ZXJ5QWxsQnlUZXN0SWR9ID0gcmVuZGVyV2l0aFRoZW1lKDxTYXZlTWFwTW9kYWwgey4uLkRFRkFVTFRfUFJPU30gLz4pO1xuICAgIGV4cGVjdChxdWVyeUFsbEJ5VGVzdElkKGRhdGFUZXN0SWRzLnByb3ZpZGVyTG9hZGluZykpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVuZGVycyBsb2FkaW5nIGFuaW1hdGlvbiB3aGVuIGlzUHJvdmlkZXJMb2FkaW5nIGlzIHRydWUnLCAoKSA9PiB7XG4gICAgY29uc3Qge2dldEJ5VGVzdElkfSA9IHJlbmRlcldpdGhUaGVtZShcbiAgICAgIDxTYXZlTWFwTW9kYWwgey4uLkRFRkFVTFRfUFJPU30gaXNQcm92aWRlckxvYWRpbmc9e3RydWV9IC8+XG4gICAgKTtcbiAgICBleHBlY3QoZ2V0QnlUZXN0SWQoZGF0YVRlc3RJZHMucHJvdmlkZXJMb2FkaW5nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVuZGVycyBubyBlcnJvciBpZiBwcm92aWRlciBlcnJvciBpcyB1bmRlZmluZWQnLCAoKSA9PiB7XG4gICAgY29uc3Qge3F1ZXJ5QWxsQnlUZXh0fSA9IHJlbmRlcldpdGhUaGVtZSg8U2F2ZU1hcE1vZGFsIHsuLi5ERUZBVUxUX1BST1N9IC8+KTtcbiAgICBleHBlY3QocXVlcnlBbGxCeVRleHQoJ21vZGFsLnN0YXR1c1BhbmVsLmVycm9yJykpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgfSk7XG5cbiAgdGVzdCgnZGlzcGxheXMgcHJvdmlkZXIgZXJyb3IgbWVzc2FnZSB3aGVuIHByb3ZpZGVyRXJyb3IgaXMgcHJlc2VudCcsICgpID0+IHtcbiAgICBjb25zdCB7Z2V0QnlUZXh0fSA9IHJlbmRlcldpdGhUaGVtZShcbiAgICAgIDxTYXZlTWFwTW9kYWwgey4uLkRFRkFVTFRfUFJPU30gcHJvdmlkZXJFcnJvcj17e21lc3NhZ2U6ICdFcnJvciBtZXNzYWdlJ319IC8+XG4gICAgKTtcbiAgICBleHBlY3QoZ2V0QnlUZXh0KCdtb2RhbC5zdGF0dXNQYW5lbC5lcnJvcicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICB9KTtcblxuICB0ZXN0KCdjYWxsIG9uU2V0TWFwSW5mbyB1cG9uIHR5cGluZyBtYXAgKHByb3ZpZGVyIGlzIHNldCknLCAoKSA9PiB7XG4gICAgdXNlQ2xvdWRMaXN0UHJvdmlkZXIubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICBwcm92aWRlcjogREVGQVVMVF9QUk9WSURFUixcbiAgICAgIHNldFByb3ZpZGVyOiBqZXN0LmZuKCksXG4gICAgICBjbG91ZFByb3ZpZGVyczogW11cbiAgICB9KSk7XG4gICAgY29uc3Qge2dldEJ5VGVzdElkLCBnZXRCeVBsYWNlaG9sZGVyVGV4dH0gPSByZW5kZXJXaXRoVGhlbWUoXG4gICAgICA8U2F2ZU1hcE1vZGFsIHsuLi5VTkRFRklORURfTUFQX1RJVExFX1BST1BTfSAvPlxuICAgICk7XG5cbiAgICBjb25zdCBtYXBJbmZvUGFuZWwgPSBnZXRCeVRlc3RJZChkYXRhVGVzdElkcy5wcm92aWRlck1hcEluZm9QYW5lbCk7XG4gICAgZXhwZWN0KG1hcEluZm9QYW5lbCkudG9CZUluVGhlRG9jdW1lbnQoKTtcblxuICAgIGNvbnN0IHRpdGxlSW5wdXQgPSBnZXRCeVBsYWNlaG9sZGVyVGV4dCgnVHlwZSBtYXAgdGl0bGUnKTtcbiAgICBleHBlY3QodGl0bGVJbnB1dCkudG9CZUluVGhlRG9jdW1lbnQoKTtcblxuICAgIGZpcmVFdmVudC5jaGFuZ2UodGl0bGVJbnB1dCwge3RhcmdldDoge3ZhbHVlOiAnZmlyc3Qga2VwbGVyIG1hcCd9fSk7XG4gICAgZXhwZWN0KERFRkFVTFRfUFJPUy5vblNldE1hcEluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHt0aXRsZTogJ2ZpcnN0IGtlcGxlciBtYXAnfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbGwgb25VcGRhdGVJbWFnZVNldHRpbmcnLCAoKSA9PiB7XG4gICAgdXNlQ2xvdWRMaXN0UHJvdmlkZXIubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICBwcm92aWRlcjogREVGQVVMVF9QUk9WSURFUixcbiAgICAgIHNldFByb3ZpZGVyOiBqZXN0LmZuKCksXG4gICAgICBjbG91ZFByb3ZpZGVyczogW11cbiAgICB9KSk7XG5cbiAgICByZW5kZXJXaXRoVGhlbWUoPFNhdmVNYXBNb2RhbCB7Li4uVU5ERUZJTkVEX01BUF9USVRMRV9QUk9QU30gLz4pO1xuXG4gICAgLy8gZmlyc3QgdGltZSB0aGUgY29tcG9uZW50IG1vdW50XG4gICAgZXhwZWN0KERFRkFVTFRfUFJPUy5vblVwZGF0ZUltYWdlU2V0dGluZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgZXhwb3J0aW5nOiB0cnVlXG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=