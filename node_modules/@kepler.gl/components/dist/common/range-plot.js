"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = RangePlotFactory;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireWildcard(require("styled-components"));

var _rangeBrush = _interopRequireDefault(require("./range-brush"));

var _histogramPlot = _interopRequireDefault(require("./histogram-plot"));

var _lineChart = _interopRequireDefault(require("./line-chart"));

var _utils = require("@kepler.gl/utils");

var _styles = require("@kepler.gl/styles");

var _templateObject;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var StyledRangePlot = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  margin-bottom: ", "px;\n  display: flex;\n  position: 'relative';\n"])), function (props) {
  return props.theme.sliderBarHeight;
});

RangePlotFactory.deps = [_rangeBrush["default"], _histogramPlot["default"], _lineChart["default"]];

function RangePlotFactory(RangeBrush, HistogramPlot, LineChartPlot) {
  var RangePlot = function RangePlot(_ref) {
    var onBrush = _ref.onBrush,
        range = _ref.range,
        value = _ref.value,
        width = _ref.width,
        plotType = _ref.plotType,
        lineChart = _ref.lineChart,
        histogram = _ref.histogram,
        isEnlarged = _ref.isEnlarged,
        isRanged = _ref.isRanged,
        theme = _ref.theme,
        chartProps = (0, _objectWithoutProperties2["default"])(_ref, ["onBrush", "range", "value", "width", "plotType", "lineChart", "histogram", "isEnlarged", "isRanged", "theme"]);

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        brushing = _useState2[0],
        setBrushing = _useState2[1];

    var _useState3 = (0, _react.useState)(null),
        _useState4 = (0, _slicedToArray2["default"])(_useState3, 2),
        hoveredDP = _useState4[0],
        onMouseMove = _useState4[1];

    var _useState5 = (0, _react.useState)(false),
        _useState6 = (0, _slicedToArray2["default"])(_useState5, 2),
        enableChartHover = _useState6[0],
        setEnableChartHover = _useState6[1];

    var height = isEnlarged ? (0, _utils.hasMobileWidth)(_styles.breakPointValues) ? theme.rangePlotHLargePalm : theme.rangePlotHLarge : theme.rangePlotH;
    var onBrushStart = (0, _react.useCallback)(function () {
      setBrushing(true);
      onMouseMove(null);
      setEnableChartHover(false);
    }, [setBrushing, onMouseMove, setEnableChartHover]);
    var onBrushEnd = (0, _react.useCallback)(function () {
      setBrushing(false);
      setEnableChartHover(true);
    }, [setBrushing, setEnableChartHover]);
    var onMouseoverHandle = (0, _react.useCallback)(function () {
      onMouseMove(null);
      setEnableChartHover(false);
    }, [onMouseMove, setEnableChartHover]);
    var onMouseoutHandle = (0, _react.useCallback)(function () {
      setEnableChartHover(true);
    }, [setEnableChartHover]); // JsDom have limited support for SVG, d3 will fail

    var brushComponent = (0, _utils.isTest)() ? null : /*#__PURE__*/_react["default"].createElement(RangeBrush, (0, _extends2["default"])({
      onBrush: onBrush,
      onBrushStart: onBrushStart,
      onBrushEnd: onBrushEnd,
      range: range,
      value: value,
      width: width,
      height: height,
      isRanged: isRanged,
      onMouseoverHandle: onMouseoverHandle,
      onMouseoutHandle: onMouseoutHandle
    }, chartProps));

    var commonProps = _objectSpread({
      width: width,
      value: value,
      height: height,
      margin: isEnlarged ? theme.rangePlotMarginLarge : theme.rangePlotMargin,
      brushComponent: brushComponent,
      brushing: brushing,
      isEnlarged: isEnlarged,
      enableChartHover: enableChartHover,
      onMouseMove: onMouseMove,
      hoveredDP: hoveredDP,
      isRanged: isRanged,
      onBrush: onBrush
    }, chartProps);

    return /*#__PURE__*/_react["default"].createElement(StyledRangePlot, {
      style: {
        height: "".concat(isEnlarged ? (0, _utils.hasMobileWidth)(_styles.breakPointValues) ? theme.rangePlotContainerHLargePalm : theme.rangePlotContainerHLarge : theme.rangePlotContainerH, "px")
      },
      className: "kg-range-slider__plot"
    }, plotType === 'lineChart' && lineChart ? /*#__PURE__*/_react["default"].createElement(LineChartPlot, (0, _extends2["default"])({
      lineChart: lineChart
    }, commonProps)) : /*#__PURE__*/_react["default"].createElement(HistogramPlot, (0, _extends2["default"])({
      histogram: histogram
    }, commonProps)));
  };

  return (0, _styledComponents.withTheme)(RangePlot);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tb24vcmFuZ2UtcGxvdC50c3giXSwibmFtZXMiOlsiU3R5bGVkUmFuZ2VQbG90Iiwic3R5bGVkIiwiZGl2IiwicHJvcHMiLCJ0aGVtZSIsInNsaWRlckJhckhlaWdodCIsIlJhbmdlUGxvdEZhY3RvcnkiLCJkZXBzIiwiUmFuZ2VCcnVzaEZhY3RvcnkiLCJIaXN0b2dyYW1QbG90RmFjdG9yeSIsIkxpbmVDaGFydEZhY3RvcnkiLCJSYW5nZUJydXNoIiwiSGlzdG9ncmFtUGxvdCIsIkxpbmVDaGFydFBsb3QiLCJSYW5nZVBsb3QiLCJvbkJydXNoIiwicmFuZ2UiLCJ2YWx1ZSIsIndpZHRoIiwicGxvdFR5cGUiLCJsaW5lQ2hhcnQiLCJoaXN0b2dyYW0iLCJpc0VubGFyZ2VkIiwiaXNSYW5nZWQiLCJjaGFydFByb3BzIiwiYnJ1c2hpbmciLCJzZXRCcnVzaGluZyIsImhvdmVyZWREUCIsIm9uTW91c2VNb3ZlIiwiZW5hYmxlQ2hhcnRIb3ZlciIsInNldEVuYWJsZUNoYXJ0SG92ZXIiLCJoZWlnaHQiLCJicmVha1BvaW50VmFsdWVzIiwicmFuZ2VQbG90SExhcmdlUGFsbSIsInJhbmdlUGxvdEhMYXJnZSIsInJhbmdlUGxvdEgiLCJvbkJydXNoU3RhcnQiLCJvbkJydXNoRW5kIiwib25Nb3VzZW92ZXJIYW5kbGUiLCJvbk1vdXNlb3V0SGFuZGxlIiwiYnJ1c2hDb21wb25lbnQiLCJjb21tb25Qcm9wcyIsIm1hcmdpbiIsInJhbmdlUGxvdE1hcmdpbkxhcmdlIiwicmFuZ2VQbG90TWFyZ2luIiwicmFuZ2VQbG90Q29udGFpbmVySExhcmdlUGFsbSIsInJhbmdlUGxvdENvbnRhaW5lckhMYXJnZSIsInJhbmdlUGxvdENvbnRhaW5lckgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7OztBQUlBLElBQU1BLGVBQWUsR0FBR0MsNkJBQU9DLEdBQVYsOEpBQ0YsVUFBQUMsS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZQyxlQUFoQjtBQUFBLENBREgsQ0FBckI7O0FBMEJBQyxnQkFBZ0IsQ0FBQ0MsSUFBakIsR0FBd0IsQ0FBQ0Msc0JBQUQsRUFBb0JDLHlCQUFwQixFQUEwQ0MscUJBQTFDLENBQXhCOztBQUVlLFNBQVNKLGdCQUFULENBQ2JLLFVBRGEsRUFFYkMsYUFGYSxFQUdiQyxhQUhhLEVBSWI7QUFDQSxNQUFNQyxTQUFTLEdBQUcsU0FBWkEsU0FBWSxPQVkrQjtBQUFBLFFBWC9DQyxPQVcrQyxRQVgvQ0EsT0FXK0M7QUFBQSxRQVYvQ0MsS0FVK0MsUUFWL0NBLEtBVStDO0FBQUEsUUFUL0NDLEtBUytDLFFBVC9DQSxLQVMrQztBQUFBLFFBUi9DQyxLQVErQyxRQVIvQ0EsS0FRK0M7QUFBQSxRQVAvQ0MsUUFPK0MsUUFQL0NBLFFBTytDO0FBQUEsUUFOL0NDLFNBTStDLFFBTi9DQSxTQU0rQztBQUFBLFFBTC9DQyxTQUsrQyxRQUwvQ0EsU0FLK0M7QUFBQSxRQUovQ0MsVUFJK0MsUUFKL0NBLFVBSStDO0FBQUEsUUFIL0NDLFFBRytDLFFBSC9DQSxRQUcrQztBQUFBLFFBRi9DbkIsS0FFK0MsUUFGL0NBLEtBRStDO0FBQUEsUUFENUNvQixVQUM0Qzs7QUFBQSxvQkFDZixxQkFBUyxLQUFULENBRGU7QUFBQTtBQUFBLFFBQ3hDQyxRQUR3QztBQUFBLFFBQzlCQyxXQUQ4Qjs7QUFBQSxxQkFFZCxxQkFBeUIsSUFBekIsQ0FGYztBQUFBO0FBQUEsUUFFeENDLFNBRndDO0FBQUEsUUFFN0JDLFdBRjZCOztBQUFBLHFCQUdDLHFCQUFTLEtBQVQsQ0FIRDtBQUFBO0FBQUEsUUFHeENDLGdCQUh3QztBQUFBLFFBR3RCQyxtQkFIc0I7O0FBSS9DLFFBQU1DLE1BQU0sR0FBR1QsVUFBVSxHQUNyQiwyQkFBZVUsd0JBQWYsSUFDRTVCLEtBQUssQ0FBQzZCLG1CQURSLEdBRUU3QixLQUFLLENBQUM4QixlQUhhLEdBSXJCOUIsS0FBSyxDQUFDK0IsVUFKVjtBQU1BLFFBQU1DLFlBQVksR0FBRyx3QkFBWSxZQUFNO0FBQ3JDVixNQUFBQSxXQUFXLENBQUMsSUFBRCxDQUFYO0FBQ0FFLE1BQUFBLFdBQVcsQ0FBQyxJQUFELENBQVg7QUFDQUUsTUFBQUEsbUJBQW1CLENBQUMsS0FBRCxDQUFuQjtBQUNELEtBSm9CLEVBSWxCLENBQUNKLFdBQUQsRUFBY0UsV0FBZCxFQUEyQkUsbUJBQTNCLENBSmtCLENBQXJCO0FBTUEsUUFBTU8sVUFBVSxHQUFHLHdCQUFZLFlBQU07QUFDbkNYLE1BQUFBLFdBQVcsQ0FBQyxLQUFELENBQVg7QUFDQUksTUFBQUEsbUJBQW1CLENBQUMsSUFBRCxDQUFuQjtBQUNELEtBSGtCLEVBR2hCLENBQUNKLFdBQUQsRUFBY0ksbUJBQWQsQ0FIZ0IsQ0FBbkI7QUFLQSxRQUFNUSxpQkFBaUIsR0FBRyx3QkFBWSxZQUFNO0FBQzFDVixNQUFBQSxXQUFXLENBQUMsSUFBRCxDQUFYO0FBQ0FFLE1BQUFBLG1CQUFtQixDQUFDLEtBQUQsQ0FBbkI7QUFDRCxLQUh5QixFQUd2QixDQUFDRixXQUFELEVBQWNFLG1CQUFkLENBSHVCLENBQTFCO0FBS0EsUUFBTVMsZ0JBQWdCLEdBQUcsd0JBQVksWUFBTTtBQUN6Q1QsTUFBQUEsbUJBQW1CLENBQUMsSUFBRCxDQUFuQjtBQUNELEtBRndCLEVBRXRCLENBQUNBLG1CQUFELENBRnNCLENBQXpCLENBMUIrQyxDQThCL0M7O0FBQ0EsUUFBTVUsY0FBYyxHQUFHLHVCQUFXLElBQVgsZ0JBQ3JCLGdDQUFDLFVBQUQ7QUFDRSxNQUFBLE9BQU8sRUFBRXpCLE9BRFg7QUFFRSxNQUFBLFlBQVksRUFBRXFCLFlBRmhCO0FBR0UsTUFBQSxVQUFVLEVBQUVDLFVBSGQ7QUFJRSxNQUFBLEtBQUssRUFBRXJCLEtBSlQ7QUFLRSxNQUFBLEtBQUssRUFBRUMsS0FMVDtBQU1FLE1BQUEsS0FBSyxFQUFFQyxLQU5UO0FBT0UsTUFBQSxNQUFNLEVBQUVhLE1BUFY7QUFRRSxNQUFBLFFBQVEsRUFBRVIsUUFSWjtBQVNFLE1BQUEsaUJBQWlCLEVBQUVlLGlCQVRyQjtBQVVFLE1BQUEsZ0JBQWdCLEVBQUVDO0FBVnBCLE9BV01mLFVBWE4sRUFERjs7QUFnQkEsUUFBTWlCLFdBQVc7QUFDZnZCLE1BQUFBLEtBQUssRUFBTEEsS0FEZTtBQUVmRCxNQUFBQSxLQUFLLEVBQUxBLEtBRmU7QUFHZmMsTUFBQUEsTUFBTSxFQUFOQSxNQUhlO0FBSWZXLE1BQUFBLE1BQU0sRUFBRXBCLFVBQVUsR0FBR2xCLEtBQUssQ0FBQ3VDLG9CQUFULEdBQWdDdkMsS0FBSyxDQUFDd0MsZUFKekM7QUFLZkosTUFBQUEsY0FBYyxFQUFkQSxjQUxlO0FBTWZmLE1BQUFBLFFBQVEsRUFBUkEsUUFOZTtBQU9mSCxNQUFBQSxVQUFVLEVBQVZBLFVBUGU7QUFRZk8sTUFBQUEsZ0JBQWdCLEVBQWhCQSxnQkFSZTtBQVNmRCxNQUFBQSxXQUFXLEVBQVhBLFdBVGU7QUFVZkQsTUFBQUEsU0FBUyxFQUFUQSxTQVZlO0FBV2ZKLE1BQUFBLFFBQVEsRUFBUkEsUUFYZTtBQVlmUixNQUFBQSxPQUFPLEVBQVBBO0FBWmUsT0FhWlMsVUFiWSxDQUFqQjs7QUFnQkEsd0JBQ0UsZ0NBQUMsZUFBRDtBQUNFLE1BQUEsS0FBSyxFQUFFO0FBQ0xPLFFBQUFBLE1BQU0sWUFDSlQsVUFBVSxHQUNOLDJCQUFlVSx3QkFBZixJQUNFNUIsS0FBSyxDQUFDeUMsNEJBRFIsR0FFRXpDLEtBQUssQ0FBQzBDLHdCQUhGLEdBSU4xQyxLQUFLLENBQUMyQyxtQkFMTjtBQURELE9BRFQ7QUFVRSxNQUFBLFNBQVMsRUFBQztBQVZaLE9BWUc1QixRQUFRLEtBQUssV0FBYixJQUE0QkMsU0FBNUIsZ0JBQ0MsZ0NBQUMsYUFBRDtBQUFlLE1BQUEsU0FBUyxFQUFFQTtBQUExQixPQUF5Q3FCLFdBQXpDLEVBREQsZ0JBR0MsZ0NBQUMsYUFBRDtBQUFlLE1BQUEsU0FBUyxFQUFFcEI7QUFBMUIsT0FBeUNvQixXQUF6QyxFQWZKLENBREY7QUFvQkQsR0EvRkQ7O0FBaUdBLFNBQU8saUNBQVUzQixTQUFWLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge3VzZVN0YXRlLCB1c2VDYWxsYmFja30gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCwge3dpdGhUaGVtZX0gZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IFJhbmdlQnJ1c2hGYWN0b3J5LCB7T25CcnVzaCwgUmFuZ2VCcnVzaFByb3BzfSBmcm9tICcuL3JhbmdlLWJydXNoJztcbmltcG9ydCBIaXN0b2dyYW1QbG90RmFjdG9yeSBmcm9tICcuL2hpc3RvZ3JhbS1wbG90JztcbmltcG9ydCBMaW5lQ2hhcnRGYWN0b3J5LCB7SG92ZXJEUH0gZnJvbSAnLi9saW5lLWNoYXJ0JztcbmltcG9ydCB7aXNUZXN0LCBoYXNNb2JpbGVXaWR0aH0gZnJvbSAnQGtlcGxlci5nbC91dGlscyc7XG5pbXBvcnQge2JyZWFrUG9pbnRWYWx1ZXN9IGZyb20gJ0BrZXBsZXIuZ2wvc3R5bGVzJztcbmltcG9ydCB7TGluZUNoYXJ0LCBGaWx0ZXJ9IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuaW1wb3J0IHtEYXRhc2V0c30gZnJvbSAnQGtlcGxlci5nbC90YWJsZSc7XG5cbmNvbnN0IFN0eWxlZFJhbmdlUGxvdCA9IHN0eWxlZC5kaXZgXG4gIG1hcmdpbi1ib3R0b206ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuc2xpZGVyQmFySGVpZ2h0fXB4O1xuICBkaXNwbGF5OiBmbGV4O1xuICBwb3NpdGlvbjogJ3JlbGF0aXZlJztcbmA7XG5cbmludGVyZmFjZSBSYW5nZVBsb3RQcm9wcyB7XG4gIG9uQnJ1c2g6IE9uQnJ1c2g7XG4gIHJhbmdlOiBudW1iZXJbXTtcbiAgdmFsdWU6IG51bWJlcltdO1xuICB3aWR0aDogbnVtYmVyO1xuICBwbG90VHlwZT86IHN0cmluZztcbiAgbGluZUNoYXJ0PzogTGluZUNoYXJ0O1xuICBoaXN0b2dyYW0/OiB7eDA6IG51bWJlcjsgeDE6IG51bWJlcn1bXTtcbiAgaXNFbmxhcmdlZD86IGJvb2xlYW47XG4gIGlzUmFuZ2VkPzogYm9vbGVhbjtcbiAgdGhlbWU6IGFueTtcbiAgdGltZUZvcm1hdD86IHN0cmluZztcbiAgdGltZXpvbmU/OiBzdHJpbmcgfCBudWxsO1xuICBwbGF5YmFja0NvbnRyb2xXaWR0aD86IG51bWJlcjtcblxuICBhbmltYXRpb25XaW5kb3c/OiBzdHJpbmc7XG4gIGZpbHRlcj86IEZpbHRlcjtcbiAgZGF0YXNldHM/OiBEYXRhc2V0cztcbn1cblxuUmFuZ2VQbG90RmFjdG9yeS5kZXBzID0gW1JhbmdlQnJ1c2hGYWN0b3J5LCBIaXN0b2dyYW1QbG90RmFjdG9yeSwgTGluZUNoYXJ0RmFjdG9yeV07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFJhbmdlUGxvdEZhY3RvcnkoXG4gIFJhbmdlQnJ1c2g6IFJldHVyblR5cGU8dHlwZW9mIFJhbmdlQnJ1c2hGYWN0b3J5PixcbiAgSGlzdG9ncmFtUGxvdDogUmV0dXJuVHlwZTx0eXBlb2YgSGlzdG9ncmFtUGxvdEZhY3Rvcnk+LFxuICBMaW5lQ2hhcnRQbG90OiBSZXR1cm5UeXBlPHR5cGVvZiBMaW5lQ2hhcnRGYWN0b3J5PlxuKSB7XG4gIGNvbnN0IFJhbmdlUGxvdCA9ICh7XG4gICAgb25CcnVzaCxcbiAgICByYW5nZSxcbiAgICB2YWx1ZSxcbiAgICB3aWR0aCxcbiAgICBwbG90VHlwZSxcbiAgICBsaW5lQ2hhcnQsXG4gICAgaGlzdG9ncmFtLFxuICAgIGlzRW5sYXJnZWQsXG4gICAgaXNSYW5nZWQsXG4gICAgdGhlbWUsXG4gICAgLi4uY2hhcnRQcm9wc1xuICB9OiBSYW5nZVBsb3RQcm9wcyAmIFBhcnRpYWw8UmFuZ2VCcnVzaFByb3BzPikgPT4ge1xuICAgIGNvbnN0IFticnVzaGluZywgc2V0QnJ1c2hpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtob3ZlcmVkRFAsIG9uTW91c2VNb3ZlXSA9IHVzZVN0YXRlPEhvdmVyRFAgfCBudWxsPihudWxsKTtcbiAgICBjb25zdCBbZW5hYmxlQ2hhcnRIb3Zlciwgc2V0RW5hYmxlQ2hhcnRIb3Zlcl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgaGVpZ2h0ID0gaXNFbmxhcmdlZFxuICAgICAgPyBoYXNNb2JpbGVXaWR0aChicmVha1BvaW50VmFsdWVzKVxuICAgICAgICA/IHRoZW1lLnJhbmdlUGxvdEhMYXJnZVBhbG1cbiAgICAgICAgOiB0aGVtZS5yYW5nZVBsb3RITGFyZ2VcbiAgICAgIDogdGhlbWUucmFuZ2VQbG90SDtcblxuICAgIGNvbnN0IG9uQnJ1c2hTdGFydCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHNldEJydXNoaW5nKHRydWUpO1xuICAgICAgb25Nb3VzZU1vdmUobnVsbCk7XG4gICAgICBzZXRFbmFibGVDaGFydEhvdmVyKGZhbHNlKTtcbiAgICB9LCBbc2V0QnJ1c2hpbmcsIG9uTW91c2VNb3ZlLCBzZXRFbmFibGVDaGFydEhvdmVyXSk7XG5cbiAgICBjb25zdCBvbkJydXNoRW5kID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgc2V0QnJ1c2hpbmcoZmFsc2UpO1xuICAgICAgc2V0RW5hYmxlQ2hhcnRIb3Zlcih0cnVlKTtcbiAgICB9LCBbc2V0QnJ1c2hpbmcsIHNldEVuYWJsZUNoYXJ0SG92ZXJdKTtcblxuICAgIGNvbnN0IG9uTW91c2VvdmVySGFuZGxlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgb25Nb3VzZU1vdmUobnVsbCk7XG4gICAgICBzZXRFbmFibGVDaGFydEhvdmVyKGZhbHNlKTtcbiAgICB9LCBbb25Nb3VzZU1vdmUsIHNldEVuYWJsZUNoYXJ0SG92ZXJdKTtcblxuICAgIGNvbnN0IG9uTW91c2VvdXRIYW5kbGUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBzZXRFbmFibGVDaGFydEhvdmVyKHRydWUpO1xuICAgIH0sIFtzZXRFbmFibGVDaGFydEhvdmVyXSk7XG5cbiAgICAvLyBKc0RvbSBoYXZlIGxpbWl0ZWQgc3VwcG9ydCBmb3IgU1ZHLCBkMyB3aWxsIGZhaWxcbiAgICBjb25zdCBicnVzaENvbXBvbmVudCA9IGlzVGVzdCgpID8gbnVsbCA6IChcbiAgICAgIDxSYW5nZUJydXNoXG4gICAgICAgIG9uQnJ1c2g9e29uQnJ1c2h9XG4gICAgICAgIG9uQnJ1c2hTdGFydD17b25CcnVzaFN0YXJ0fVxuICAgICAgICBvbkJydXNoRW5kPXtvbkJydXNoRW5kfVxuICAgICAgICByYW5nZT17cmFuZ2V9XG4gICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgICBoZWlnaHQ9e2hlaWdodH1cbiAgICAgICAgaXNSYW5nZWQ9e2lzUmFuZ2VkfVxuICAgICAgICBvbk1vdXNlb3ZlckhhbmRsZT17b25Nb3VzZW92ZXJIYW5kbGV9XG4gICAgICAgIG9uTW91c2VvdXRIYW5kbGU9e29uTW91c2VvdXRIYW5kbGV9XG4gICAgICAgIHsuLi5jaGFydFByb3BzfVxuICAgICAgLz5cbiAgICApO1xuXG4gICAgY29uc3QgY29tbW9uUHJvcHMgPSB7XG4gICAgICB3aWR0aCxcbiAgICAgIHZhbHVlLFxuICAgICAgaGVpZ2h0LFxuICAgICAgbWFyZ2luOiBpc0VubGFyZ2VkID8gdGhlbWUucmFuZ2VQbG90TWFyZ2luTGFyZ2UgOiB0aGVtZS5yYW5nZVBsb3RNYXJnaW4sXG4gICAgICBicnVzaENvbXBvbmVudCxcbiAgICAgIGJydXNoaW5nLFxuICAgICAgaXNFbmxhcmdlZCxcbiAgICAgIGVuYWJsZUNoYXJ0SG92ZXIsXG4gICAgICBvbk1vdXNlTW92ZSxcbiAgICAgIGhvdmVyZWREUCxcbiAgICAgIGlzUmFuZ2VkLFxuICAgICAgb25CcnVzaCxcbiAgICAgIC4uLmNoYXJ0UHJvcHNcbiAgICB9O1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxTdHlsZWRSYW5nZVBsb3RcbiAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICBoZWlnaHQ6IGAke1xuICAgICAgICAgICAgaXNFbmxhcmdlZFxuICAgICAgICAgICAgICA/IGhhc01vYmlsZVdpZHRoKGJyZWFrUG9pbnRWYWx1ZXMpXG4gICAgICAgICAgICAgICAgPyB0aGVtZS5yYW5nZVBsb3RDb250YWluZXJITGFyZ2VQYWxtXG4gICAgICAgICAgICAgICAgOiB0aGVtZS5yYW5nZVBsb3RDb250YWluZXJITGFyZ2VcbiAgICAgICAgICAgICAgOiB0aGVtZS5yYW5nZVBsb3RDb250YWluZXJIXG4gICAgICAgICAgfXB4YFxuICAgICAgICB9fVxuICAgICAgICBjbGFzc05hbWU9XCJrZy1yYW5nZS1zbGlkZXJfX3Bsb3RcIlxuICAgICAgPlxuICAgICAgICB7cGxvdFR5cGUgPT09ICdsaW5lQ2hhcnQnICYmIGxpbmVDaGFydCA/IChcbiAgICAgICAgICA8TGluZUNoYXJ0UGxvdCBsaW5lQ2hhcnQ9e2xpbmVDaGFydH0gey4uLmNvbW1vblByb3BzfSAvPlxuICAgICAgICApIDogKFxuICAgICAgICAgIDxIaXN0b2dyYW1QbG90IGhpc3RvZ3JhbT17aGlzdG9ncmFtfSB7Li4uY29tbW9uUHJvcHN9IC8+XG4gICAgICAgICl9XG4gICAgICA8L1N0eWxlZFJhbmdlUGxvdD5cbiAgICApO1xuICB9O1xuXG4gIHJldHVybiB3aXRoVGhlbWUoUmFuZ2VQbG90KTtcbn1cbiJdfQ==