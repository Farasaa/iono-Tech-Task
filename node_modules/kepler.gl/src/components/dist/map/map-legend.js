"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LayerLegendHeaderFactory = LayerLegendHeaderFactory;
exports.LayerLegendContentFactory = LayerLegendContentFactory;
exports["default"] = exports.LayerColorLegend = exports.SingleColorLegend = exports.LayerSizeLegend = exports.VisualChannelMetric = exports.StyledMapControlLegend = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireDefault(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _d3Color = require("d3-color");

var _colorLegend = _interopRequireDefault(require("../common/color-legend"));

var _constants = require("@kepler.gl/constants");

var _localization = require("@kepler.gl/localization");

var _templateObject;

var StyledMapControlLegend = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  padding: 10px ", "px 10px\n    ", "px;\n  font-size: 11px;\n  font-family: ", ";\n  border-bottom-color: ", ";\n  border-bottom-style: solid;\n  border-bottom-width: ", ";\n  width: ", "px;\n  box-sizing: border-box;\n\n  .legend--layer_name {\n    font-size: 12px;\n    padding-right: ", "px;\n    color: ", ";\n    font-weight: 500;\n  }\n  .legend--layer_type {\n    color: ", ";\n    font-weight: 500;\n    font-size: 11px;\n    padding-right: ", "px;\n  }\n\n  .legend--layer__title {\n    padding-right: ", "px;\n  }\n\n  .legend--layer_by {\n    color: ", ";\n  }\n\n  .legend--layer_color_field {\n    color: ", ";\n    font-weight: 500;\n  }\n\n  .legend--layer_color-legend {\n    margin-top: 6px;\n  }\n"])), function (props) {
  return props.theme.mapControl.padding;
}, function (props) {
  return props.theme.mapControl.padding;
}, function (props) {
  return props.theme.fontFamily;
}, function (props) {
  return props.theme.panelBorderColor;
}, function (props) {
  return props.last ? 0 : '1px';
}, function (props) {
  return props.width;
}, function (props) {
  return props.theme.mapControl.padding;
}, function (props) {
  return props.theme.textColor;
}, function (props) {
  return props.theme.subtextColor;
}, function (props) {
  return props.theme.mapControl.padding;
}, function (props) {
  return props.theme.mapControl.padding;
}, function (props) {
  return props.theme.subtextColor;
}, function (props) {
  return props.theme.textColorHl;
});

exports.StyledMapControlLegend = StyledMapControlLegend;

var VisualChannelMetric = function VisualChannelMetric(_ref) {
  var name = _ref.name;
  return /*#__PURE__*/_react["default"].createElement("div", {
    className: "legend--layer__title"
  }, /*#__PURE__*/_react["default"].createElement("span", {
    className: "legend--layer_color_field"
  }, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
    id: name
  })));
};

exports.VisualChannelMetric = VisualChannelMetric;

/** @type {typeof import('./map-legend').LayerSizeLegend} */
var LayerSizeLegend = function LayerSizeLegend(_ref2) {
  var label = _ref2.label,
      name = _ref2.name;
  return label ? /*#__PURE__*/_react["default"].createElement("div", {
    className: "legend--layer_size-schema"
  }, /*#__PURE__*/_react["default"].createElement("p", null, /*#__PURE__*/_react["default"].createElement("span", {
    className: "legend--layer_by"
  }, label ? /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
    id: label
  }) : null), /*#__PURE__*/_react["default"].createElement("span", {
    className: "legend--layer_by"
  }, " by ")), name && /*#__PURE__*/_react["default"].createElement(VisualChannelMetric, {
    name: name
  })) : null;
};

exports.LayerSizeLegend = LayerSizeLegend;
var SINGLE_COLOR_DOMAIN = [''];

/** @type {typeof import('./map-legend').SingleColorLegend} */
var SingleColorLegend = /*#__PURE__*/_react["default"].memo(function (_ref3) {
  var width = _ref3.width,
      color = _ref3.color;
  return /*#__PURE__*/_react["default"].createElement(_colorLegend["default"], {
    scaleType: "ordinal",
    displayLabel: false,
    domain: SINGLE_COLOR_DOMAIN,
    fieldType: null,
    range: {
      colors: [_d3Color.rgb.apply(void 0, (0, _toConsumableArray2["default"])(color)).toString()]
    },
    width: width
  });
});

exports.SingleColorLegend = SingleColorLegend;
SingleColorLegend.displayName = 'SingleColorLegend';

/** @type {typeof import('./map-legend').LayerColorLegend} */
var LayerColorLegend = /*#__PURE__*/_react["default"].memo(function (_ref4) {
  var description = _ref4.description,
      config = _ref4.config,
      width = _ref4.width,
      colorChannel = _ref4.colorChannel;
  var enableColorBy = description.measure;
  var scale = colorChannel.scale,
      field = colorChannel.field,
      domain = colorChannel.domain,
      range = colorChannel.range,
      property = colorChannel.property;

  var _map = [scale, field, domain].map(function (k) {
    return config[k];
  }),
      _map2 = (0, _slicedToArray2["default"])(_map, 3),
      colorScale = _map2[0],
      colorField = _map2[1],
      colorDomain = _map2[2];

  var colorRange = config.visConfig[range];
  return /*#__PURE__*/_react["default"].createElement("div", null, /*#__PURE__*/_react["default"].createElement("div", {
    className: "legend--layer_color-schema"
  }, /*#__PURE__*/_react["default"].createElement("div", null, enableColorBy ? /*#__PURE__*/_react["default"].createElement(VisualChannelMetric, {
    name: enableColorBy
  }) : null, /*#__PURE__*/_react["default"].createElement("div", {
    className: "legend--layer_color-legend"
  }, enableColorBy ? /*#__PURE__*/_react["default"].createElement(_colorLegend["default"], {
    scaleType: colorScale,
    displayLabel: true,
    domain: colorDomain,
    fieldType: colorField && colorField.type || 'real',
    range: colorRange,
    width: width
  }) : /*#__PURE__*/_react["default"].createElement(SingleColorLegend, {
    color: config.visConfig[property] || config[property] || config.color,
    width: width
  })))));
}); // eslint-disable-next-line react/display-name


exports.LayerColorLegend = LayerColorLegend;
LayerColorLegend.displayName = 'LayerColorLegend';

var isColorChannel = function isColorChannel(visualChannel) {
  return [_constants.CHANNEL_SCALES.color, _constants.CHANNEL_SCALES.colorAggr].includes(visualChannel.channelScaleType);
};

function LayerLegendHeaderFactory() {
  /** @type {typeof import('./map-legend').LayerLegendHeader }> */
  var LayerLegendHeader = function LayerLegendHeader(_ref5) {
    var options = _ref5.options,
        layer = _ref5.layer;
    return (options === null || options === void 0 ? void 0 : options.showLayerName) !== false ? /*#__PURE__*/_react["default"].createElement("div", {
      className: "legend--layer_name"
    }, layer.config.label) : null;
  };

  return LayerLegendHeader;
}

function LayerLegendContentFactory() {
  /** @type {typeof import('./map-legend').LayerLegendContent }> */
  var LayerLegendContent = function LayerLegendContent(_ref6) {
    var layer = _ref6.layer,
        containerW = _ref6.containerW;
    var colorChannels = Object.values(layer.visualChannels).filter(isColorChannel);
    var nonColorChannels = Object.values(layer.visualChannels).filter(function (vc) {
      return !isColorChannel(vc);
    });
    return /*#__PURE__*/_react["default"].createElement(_react["default"].Fragment, null, colorChannels.map(function (colorChannel) {
      return !colorChannel.condition || colorChannel.condition(layer.config) ? /*#__PURE__*/_react["default"].createElement(LayerColorLegend, {
        key: colorChannel.key,
        description: layer.getVisualChannelDescription(colorChannel.key),
        config: layer.config,
        width: containerW - 2 * _constants.DIMENSIONS.mapControl.padding,
        colorChannel: colorChannel
      }) : null;
    }), nonColorChannels.map(function (visualChannel) {
      var matchCondition = !visualChannel.condition || visualChannel.condition(layer.config);
      var enabled = layer.config[visualChannel.field] || visualChannel.defaultMeasure;
      var description = layer.getVisualChannelDescription(visualChannel.key);
      return matchCondition && enabled ? /*#__PURE__*/_react["default"].createElement(LayerSizeLegend, {
        key: visualChannel.key,
        label: description.label,
        name: description.measure
      }) : null;
    }));
  };

  return LayerLegendContent;
}

MapLegendFactory.deps = [LayerLegendHeaderFactory, LayerLegendContentFactory];

function MapLegendFactory(LayerLegendHeader, LayerLegendContent) {
  /** @type {typeof import('./map-legend').MapLegend }> */
  var MapLegend = function MapLegend(_ref7) {
    var _ref7$layers = _ref7.layers,
        layers = _ref7$layers === void 0 ? [] : _ref7$layers,
        width = _ref7.width,
        mapHeight = _ref7.mapHeight,
        options = _ref7.options;
    return /*#__PURE__*/_react["default"].createElement("div", (0, _extends2["default"])({
      className: "map-legend"
    }, mapHeight && {
      style: {
        /* subtracting rough size of 4 map control buttons and padding */
        maxHeight: mapHeight - 250
      }
    }), layers.map(function (layer, index) {
      if (!layer.isValidToSave() || layer.config.hidden) {
        return null;
      }

      var containerW = width || _constants.DIMENSIONS.mapControl.width;
      return /*#__PURE__*/_react["default"].createElement(StyledMapControlLegend, {
        className: "legend--layer",
        last: index === layers.length - 1,
        key: index,
        width: containerW
      }, /*#__PURE__*/_react["default"].createElement(LayerLegendHeader, {
        options: options,
        layer: layer
      }), /*#__PURE__*/_react["default"].createElement(LayerLegendContent, {
        containerW: containerW,
        layer: layer
      }));
    }));
  };

  MapLegend.displayName = 'MapLegend';
  return MapLegend;
}

var _default = MapLegendFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYXAvbWFwLWxlZ2VuZC50c3giXSwibmFtZXMiOlsiU3R5bGVkTWFwQ29udHJvbExlZ2VuZCIsInN0eWxlZCIsImRpdiIsInByb3BzIiwidGhlbWUiLCJtYXBDb250cm9sIiwicGFkZGluZyIsImZvbnRGYW1pbHkiLCJwYW5lbEJvcmRlckNvbG9yIiwibGFzdCIsIndpZHRoIiwidGV4dENvbG9yIiwic3VidGV4dENvbG9yIiwidGV4dENvbG9ySGwiLCJWaXN1YWxDaGFubmVsTWV0cmljIiwibmFtZSIsIkxheWVyU2l6ZUxlZ2VuZCIsImxhYmVsIiwiU0lOR0xFX0NPTE9SX0RPTUFJTiIsIlNpbmdsZUNvbG9yTGVnZW5kIiwiUmVhY3QiLCJtZW1vIiwiY29sb3IiLCJjb2xvcnMiLCJyZ2IiLCJ0b1N0cmluZyIsImRpc3BsYXlOYW1lIiwiTGF5ZXJDb2xvckxlZ2VuZCIsImRlc2NyaXB0aW9uIiwiY29uZmlnIiwiY29sb3JDaGFubmVsIiwiZW5hYmxlQ29sb3JCeSIsIm1lYXN1cmUiLCJzY2FsZSIsImZpZWxkIiwiZG9tYWluIiwicmFuZ2UiLCJwcm9wZXJ0eSIsIm1hcCIsImsiLCJjb2xvclNjYWxlIiwiY29sb3JGaWVsZCIsImNvbG9yRG9tYWluIiwiY29sb3JSYW5nZSIsInZpc0NvbmZpZyIsInR5cGUiLCJpc0NvbG9yQ2hhbm5lbCIsInZpc3VhbENoYW5uZWwiLCJDSEFOTkVMX1NDQUxFUyIsImNvbG9yQWdnciIsImluY2x1ZGVzIiwiY2hhbm5lbFNjYWxlVHlwZSIsIkxheWVyTGVnZW5kSGVhZGVyRmFjdG9yeSIsIkxheWVyTGVnZW5kSGVhZGVyIiwib3B0aW9ucyIsImxheWVyIiwic2hvd0xheWVyTmFtZSIsIkxheWVyTGVnZW5kQ29udGVudEZhY3RvcnkiLCJMYXllckxlZ2VuZENvbnRlbnQiLCJjb250YWluZXJXIiwiY29sb3JDaGFubmVscyIsIk9iamVjdCIsInZhbHVlcyIsInZpc3VhbENoYW5uZWxzIiwiZmlsdGVyIiwibm9uQ29sb3JDaGFubmVscyIsInZjIiwiY29uZGl0aW9uIiwia2V5IiwiZ2V0VmlzdWFsQ2hhbm5lbERlc2NyaXB0aW9uIiwiRElNRU5TSU9OUyIsIm1hdGNoQ29uZGl0aW9uIiwiZW5hYmxlZCIsImRlZmF1bHRNZWFzdXJlIiwiTWFwTGVnZW5kRmFjdG9yeSIsImRlcHMiLCJNYXBMZWdlbmQiLCJsYXllcnMiLCJtYXBIZWlnaHQiLCJzdHlsZSIsIm1heEhlaWdodCIsImluZGV4IiwiaXNWYWxpZFRvU2F2ZSIsImhpZGRlbiIsImxlbmd0aCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBUU8sSUFBTUEsc0JBQXNCLEdBQUdDLDZCQUFPQyxHQUFWLHF5QkFDakIsVUFBQUMsS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZQyxVQUFaLENBQXVCQyxPQUEzQjtBQUFBLENBRFksRUFFN0IsVUFBQUgsS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZQyxVQUFaLENBQXVCQyxPQUEzQjtBQUFBLENBRndCLEVBSWxCLFVBQUFILEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUcsVUFBaEI7QUFBQSxDQUphLEVBS1YsVUFBQUosS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZSSxnQkFBaEI7QUFBQSxDQUxLLEVBT1YsVUFBQUwsS0FBSztBQUFBLFNBQUtBLEtBQUssQ0FBQ00sSUFBTixHQUFhLENBQWIsR0FBaUIsS0FBdEI7QUFBQSxDQVBLLEVBUXhCLFVBQUFOLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNPLEtBQVY7QUFBQSxDQVJtQixFQWFkLFVBQUFQLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUMsVUFBWixDQUF1QkMsT0FBM0I7QUFBQSxDQWJTLEVBY3RCLFVBQUFILEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWU8s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LFFBQUEsT0FBTyxFQUFFTCxPQUE1QjtBQUFxQyxRQUFBLEtBQUssRUFBRUM7QUFBNUMsUUFORixlQU9FLGdDQUFDLGtCQUFEO0FBQW9CLFFBQUEsVUFBVSxFQUFFSSxVQUFoQztBQUE0QyxRQUFBLEtBQUssRUFBRUo7QUFBbkQsUUFQRixDQURGO0FBV0QsS0FqQkEsQ0FUSCxDQUQwQztBQUFBLEdBQTVDOztBQStCQXFCLEVBQUFBLFNBQVMsQ0FBQ2xELFdBQVYsR0FBd0IsV0FBeEI7QUFFQSxTQUFPa0QsU0FBUDtBQUNEOztlQUVjRixnQiIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCB7cmdifSBmcm9tICdkMy1jb2xvcic7XG5pbXBvcnQgQ29sb3JMZWdlbmQgZnJvbSAnLi4vY29tbW9uL2NvbG9yLWxlZ2VuZCc7XG5pbXBvcnQge0NIQU5ORUxfU0NBTEVTLCBESU1FTlNJT05TfSBmcm9tICdAa2VwbGVyLmdsL2NvbnN0YW50cyc7XG5pbXBvcnQge0Zvcm1hdHRlZE1lc3NhZ2V9IGZyb20gJ0BrZXBsZXIuZ2wvbG9jYWxpemF0aW9uJztcbmltcG9ydCB7TGF5ZXIsIExheWVyQmFzZUNvbmZpZywgVmlzdWFsQ2hhbm5lbCwgVmlzdWFsQ2hhbm5lbERlc2NyaXB0aW9ufSBmcm9tICdAa2VwbGVyLmdsL2xheWVycyc7XG5cbmludGVyZmFjZSBTdHlsZWRNYXBDb250cm9sTGVnZW5kUHJvcHMge1xuICB3aWR0aD86IG51bWJlcjtcbiAgbGFzdD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjb25zdCBTdHlsZWRNYXBDb250cm9sTGVnZW5kID0gc3R5bGVkLmRpdjxTdHlsZWRNYXBDb250cm9sTGVnZW5kUHJvcHM+YFxuICBwYWRkaW5nOiAxMHB4ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUubWFwQ29udHJvbC5wYWRkaW5nfXB4IDEwcHhcbiAgICAke3Byb3BzID0+IHByb3BzLnRoZW1lLm1hcENvbnRyb2wucGFkZGluZ31weDtcbiAgZm9udC1zaXplOiAxMXB4O1xuICBmb250LWZhbWlseTogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5mb250RmFtaWx5fTtcbiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5wYW5lbEJvcmRlckNvbG9yfTtcbiAgYm9yZGVyLWJvdHRvbS1zdHlsZTogc29saWQ7XG4gIGJvcmRlci1ib3R0b20td2lkdGg6ICR7cHJvcHMgPT4gKHByb3BzLmxhc3QgPyAwIDogJzFweCcpfTtcbiAgd2lkdGg6ICR7cHJvcHMgPT4gcHJvcHMud2lkdGh9cHg7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG5cbiAgLmxlZ2VuZC0tbGF5ZXJfbmFtZSB7XG4gICAgZm9udC1zaXplOiAxMnB4O1xuICAgIHBhZGRpbmctcmlnaHQ6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUubWFwQ29udHJvbC5wYWRkaW5nfXB4O1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRleHRDb2xvcn07XG4gICAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgfVxuICAubGVnZW5kLS1sYXllcl90eXBlIHtcbiAgICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5zdWJ0ZXh0Q29sb3J9O1xuICAgIGZvbnQtd2VpZ2h0OiA1MDA7XG4gICAgZm9udC1zaXplOiAxMXB4O1xuICAgIHBhZGRpbmctcmlnaHQ6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUubWFwQ29udHJvbC5wYWRkaW5nfXB4O1xuICB9XG5cbiAgLmxlZ2VuZC0tbGF5ZXJfX3RpdGxlIHtcbiAgICBwYWRkaW5nLXJpZ2h0OiAke3Byb3BzID0+IHByb3BzLnRoZW1lLm1hcENvbnRyb2wucGFkZGluZ31weDtcbiAgfVxuXG4gIC5sZWdlbmQtLWxheWVyX2J5IHtcbiAgICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5zdWJ0ZXh0Q29sb3J9O1xuICB9XG5cbiAgLmxlZ2VuZC0tbGF5ZXJfY29sb3JfZmllbGQge1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRleHRDb2xvckhsfTtcbiAgICBmb250LXdlaWdodDogNTAwO1xuICB9XG5cbiAgLmxlZ2VuZC0tbGF5ZXJfY29sb3ItbGVnZW5kIHtcbiAgICBtYXJnaW4tdG9wOiA2cHg7XG4gIH1cbmA7XG5cbmV4cG9ydCBjb25zdCBWaXN1YWxDaGFubmVsTWV0cmljID0gKHtuYW1lfSkgPT4ge1xuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwibGVnZW5kLS1sYXllcl9fdGl0bGVcIj5cbiAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxlZ2VuZC0tbGF5ZXJfY29sb3JfZmllbGRcIj5cbiAgICAgICAgPEZvcm1hdHRlZE1lc3NhZ2UgaWQ9e25hbWV9IC8+XG4gICAgICA8L3NwYW4+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5leHBvcnQgdHlwZSBMYXllclNpemVMZWdlbmRQcm9wcyA9IHtcbiAgbGFiZWw6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xufTtcblxuLyoqIEB0eXBlIHt0eXBlb2YgaW1wb3J0KCcuL21hcC1sZWdlbmQnKS5MYXllclNpemVMZWdlbmR9ICovXG5leHBvcnQgY29uc3QgTGF5ZXJTaXplTGVnZW5kOiBSZWFjdC5GQzxMYXllclNpemVMZWdlbmRQcm9wcz4gPSAoe2xhYmVsLCBuYW1lfSkgPT5cbiAgbGFiZWwgPyAoXG4gICAgPGRpdiBjbGFzc05hbWU9XCJsZWdlbmQtLWxheWVyX3NpemUtc2NoZW1hXCI+XG4gICAgICA8cD5cbiAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibGVnZW5kLS1sYXllcl9ieVwiPntsYWJlbCA/IDxGb3JtYXR0ZWRNZXNzYWdlIGlkPXtsYWJlbH0gLz4gOiBudWxsfTwvc3Bhbj5cbiAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibGVnZW5kLS1sYXllcl9ieVwiPiBieSA8L3NwYW4+XG4gICAgICA8L3A+XG4gICAgICB7bmFtZSAmJiA8VmlzdWFsQ2hhbm5lbE1ldHJpYyBuYW1lPXtuYW1lfSAvPn1cbiAgICA8L2Rpdj5cbiAgKSA6IG51bGw7XG5cbmNvbnN0IFNJTkdMRV9DT0xPUl9ET01BSU4gPSBbJyddO1xuXG5leHBvcnQgdHlwZSBTaW5nbGVDb2xvckxlZ2VuZFByb3BzID0ge1xuICB3aWR0aDogbnVtYmVyO1xuICBjb2xvcjogc3RyaW5nO1xufTtcblxuLyoqIEB0eXBlIHt0eXBlb2YgaW1wb3J0KCcuL21hcC1sZWdlbmQnKS5TaW5nbGVDb2xvckxlZ2VuZH0gKi9cbmV4cG9ydCBjb25zdCBTaW5nbGVDb2xvckxlZ2VuZDogUmVhY3QuRkM8U2luZ2xlQ29sb3JMZWdlbmRQcm9wcz4gPSBSZWFjdC5tZW1vKCh7d2lkdGgsIGNvbG9yfSkgPT4gKFxuICA8Q29sb3JMZWdlbmRcbiAgICBzY2FsZVR5cGU9XCJvcmRpbmFsXCJcbiAgICBkaXNwbGF5TGFiZWw9e2ZhbHNlfVxuICAgIGRvbWFpbj17U0lOR0xFX0NPTE9SX0RPTUFJTn1cbiAgICBmaWVsZFR5cGU9e251bGx9XG4gICAgcmFuZ2U9e3tjb2xvcnM6IFtyZ2IoLi4uY29sb3IpLnRvU3RyaW5nKCldfX1cbiAgICB3aWR0aD17d2lkdGh9XG4gIC8+XG4pKTtcblxuU2luZ2xlQ29sb3JMZWdlbmQuZGlzcGxheU5hbWUgPSAnU2luZ2xlQ29sb3JMZWdlbmQnO1xuXG5leHBvcnQgdHlwZSBMYXllckNvbG9yTGVnZW5kUHJvcHMgPSB7XG4gIGRlc2NyaXB0aW9uOiBWaXN1YWxDaGFubmVsRGVzY3JpcHRpb247XG4gIGNvbmZpZzogTGF5ZXJCYXNlQ29uZmlnO1xuICB3aWR0aDogbnVtYmVyO1xuICBjb2xvckNoYW5uZWw6IFZpc3VhbENoYW5uZWw7XG59O1xuXG4vKiogQHR5cGUge3R5cGVvZiBpbXBvcnQoJy4vbWFwLWxlZ2VuZCcpLkxheWVyQ29sb3JMZWdlbmR9ICovXG5leHBvcnQgY29uc3QgTGF5ZXJDb2xvckxlZ2VuZDogUmVhY3QuRkM8TGF5ZXJDb2xvckxlZ2VuZFByb3BzPiA9IFJlYWN0Lm1lbW8oXG4gICh7ZGVzY3JpcHRpb24sIGNvbmZpZywgd2lkdGgsIGNvbG9yQ2hhbm5lbH0pID0+IHtcbiAgICBjb25zdCBlbmFibGVDb2xvckJ5ID0gZGVzY3JpcHRpb24ubWVhc3VyZTtcbiAgICBjb25zdCB7c2NhbGUsIGZpZWxkLCBkb21haW4sIHJhbmdlLCBwcm9wZXJ0eX0gPSBjb2xvckNoYW5uZWw7XG4gICAgY29uc3QgW2NvbG9yU2NhbGUsIGNvbG9yRmllbGQsIGNvbG9yRG9tYWluXSA9IFtzY2FsZSwgZmllbGQsIGRvbWFpbl0ubWFwKGsgPT4gY29uZmlnW2tdKTtcbiAgICBjb25zdCBjb2xvclJhbmdlID0gY29uZmlnLnZpc0NvbmZpZ1tyYW5nZV07XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsZWdlbmQtLWxheWVyX2NvbG9yLXNjaGVtYVwiPlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICB7ZW5hYmxlQ29sb3JCeSA/IDxWaXN1YWxDaGFubmVsTWV0cmljIG5hbWU9e2VuYWJsZUNvbG9yQnl9IC8+IDogbnVsbH1cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGVnZW5kLS1sYXllcl9jb2xvci1sZWdlbmRcIj5cbiAgICAgICAgICAgICAge2VuYWJsZUNvbG9yQnkgPyAoXG4gICAgICAgICAgICAgICAgPENvbG9yTGVnZW5kXG4gICAgICAgICAgICAgICAgICBzY2FsZVR5cGU9e2NvbG9yU2NhbGV9XG4gICAgICAgICAgICAgICAgICBkaXNwbGF5TGFiZWxcbiAgICAgICAgICAgICAgICAgIGRvbWFpbj17Y29sb3JEb21haW59XG4gICAgICAgICAgICAgICAgICBmaWVsZFR5cGU9eyhjb2xvckZpZWxkICYmIGNvbG9yRmllbGQudHlwZSkgfHwgJ3JlYWwnfVxuICAgICAgICAgICAgICAgICAgcmFuZ2U9e2NvbG9yUmFuZ2V9XG4gICAgICAgICAgICAgICAgICB3aWR0aD17d2lkdGh9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgICA8U2luZ2xlQ29sb3JMZWdlbmRcbiAgICAgICAgICAgICAgICAgIGNvbG9yPXtjb25maWcudmlzQ29uZmlnW3Byb3BlcnR5XSB8fCBjb25maWdbcHJvcGVydHldIHx8IGNvbmZpZy5jb2xvcn1cbiAgICAgICAgICAgICAgICAgIHdpZHRoPXt3aWR0aH1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuKTtcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2Rpc3BsYXktbmFtZVxuTGF5ZXJDb2xvckxlZ2VuZC5kaXNwbGF5TmFtZSA9ICdMYXllckNvbG9yTGVnZW5kJztcblxuY29uc3QgaXNDb2xvckNoYW5uZWwgPSB2aXN1YWxDaGFubmVsID0+XG4gIFtDSEFOTkVMX1NDQUxFUy5jb2xvciwgQ0hBTk5FTF9TQ0FMRVMuY29sb3JBZ2dyXS5pbmNsdWRlcyh2aXN1YWxDaGFubmVsLmNoYW5uZWxTY2FsZVR5cGUpO1xuXG5leHBvcnQgdHlwZSBMYXllckxlZ2VuZEhlYWRlclByb3BzID0ge1xuICBsYXllcjogTGF5ZXI7XG4gIG9wdGlvbnM/OiB7XG4gICAgc2hvd0xheWVyTmFtZT86IGJvb2xlYW47XG4gIH07XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gTGF5ZXJMZWdlbmRIZWFkZXJGYWN0b3J5KCkge1xuICAvKiogQHR5cGUge3R5cGVvZiBpbXBvcnQoJy4vbWFwLWxlZ2VuZCcpLkxheWVyTGVnZW5kSGVhZGVyIH0+ICovXG4gIGNvbnN0IExheWVyTGVnZW5kSGVhZGVyOiBSZWFjdC5GQzxMYXllckxlZ2VuZEhlYWRlclByb3BzPiA9ICh7b3B0aW9ucywgbGF5ZXJ9KSA9PiB7XG4gICAgcmV0dXJuIG9wdGlvbnM/LnNob3dMYXllck5hbWUgIT09IGZhbHNlID8gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJsZWdlbmQtLWxheWVyX25hbWVcIj57bGF5ZXIuY29uZmlnLmxhYmVsfTwvZGl2PlxuICAgICkgOiBudWxsO1xuICB9O1xuICByZXR1cm4gTGF5ZXJMZWdlbmRIZWFkZXI7XG59XG5cbmV4cG9ydCB0eXBlIExheWVyTGVnZW5kQ29udGVudFByb3BzID0ge1xuICBsYXllcjogTGF5ZXI7XG4gIGNvbnRhaW5lclc6IG51bWJlcjtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBMYXllckxlZ2VuZENvbnRlbnRGYWN0b3J5KCkge1xuICAvKiogQHR5cGUge3R5cGVvZiBpbXBvcnQoJy4vbWFwLWxlZ2VuZCcpLkxheWVyTGVnZW5kQ29udGVudCB9PiAqL1xuICBjb25zdCBMYXllckxlZ2VuZENvbnRlbnQ6IFJlYWN0LkZDPExheWVyTGVnZW5kQ29udGVudFByb3BzPiA9ICh7bGF5ZXIsIGNvbnRhaW5lcld9KSA9PiB7XG4gICAgY29uc3QgY29sb3JDaGFubmVscyA9IE9iamVjdC52YWx1ZXMobGF5ZXIudmlzdWFsQ2hhbm5lbHMpLmZpbHRlcihpc0NvbG9yQ2hhbm5lbCk7XG4gICAgY29uc3Qgbm9uQ29sb3JDaGFubmVscyA9IE9iamVjdC52YWx1ZXMobGF5ZXIudmlzdWFsQ2hhbm5lbHMpLmZpbHRlcih2YyA9PiAhaXNDb2xvckNoYW5uZWwodmMpKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8PlxuICAgICAgICB7Y29sb3JDaGFubmVscy5tYXAoY29sb3JDaGFubmVsID0+XG4gICAgICAgICAgIWNvbG9yQ2hhbm5lbC5jb25kaXRpb24gfHwgY29sb3JDaGFubmVsLmNvbmRpdGlvbihsYXllci5jb25maWcpID8gKFxuICAgICAgICAgICAgPExheWVyQ29sb3JMZWdlbmRcbiAgICAgICAgICAgICAga2V5PXtjb2xvckNoYW5uZWwua2V5fVxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbj17bGF5ZXIuZ2V0VmlzdWFsQ2hhbm5lbERlc2NyaXB0aW9uKGNvbG9yQ2hhbm5lbC5rZXkpfVxuICAgICAgICAgICAgICBjb25maWc9e2xheWVyLmNvbmZpZ31cbiAgICAgICAgICAgICAgd2lkdGg9e2NvbnRhaW5lclcgLSAyICogRElNRU5TSU9OUy5tYXBDb250cm9sLnBhZGRpbmd9XG4gICAgICAgICAgICAgIGNvbG9yQ2hhbm5lbD17Y29sb3JDaGFubmVsfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApIDogbnVsbFxuICAgICAgICApfVxuICAgICAgICB7bm9uQ29sb3JDaGFubmVscy5tYXAodmlzdWFsQ2hhbm5lbCA9PiB7XG4gICAgICAgICAgY29uc3QgbWF0Y2hDb25kaXRpb24gPSAhdmlzdWFsQ2hhbm5lbC5jb25kaXRpb24gfHwgdmlzdWFsQ2hhbm5lbC5jb25kaXRpb24obGF5ZXIuY29uZmlnKTtcbiAgICAgICAgICBjb25zdCBlbmFibGVkID0gbGF5ZXIuY29uZmlnW3Zpc3VhbENoYW5uZWwuZmllbGRdIHx8IHZpc3VhbENoYW5uZWwuZGVmYXVsdE1lYXN1cmU7XG5cbiAgICAgICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGxheWVyLmdldFZpc3VhbENoYW5uZWxEZXNjcmlwdGlvbih2aXN1YWxDaGFubmVsLmtleSk7XG5cbiAgICAgICAgICByZXR1cm4gbWF0Y2hDb25kaXRpb24gJiYgZW5hYmxlZCA/IChcbiAgICAgICAgICAgIDxMYXllclNpemVMZWdlbmRcbiAgICAgICAgICAgICAga2V5PXt2aXN1YWxDaGFubmVsLmtleX1cbiAgICAgICAgICAgICAgbGFiZWw9e2Rlc2NyaXB0aW9uLmxhYmVsfVxuICAgICAgICAgICAgICBuYW1lPXtkZXNjcmlwdGlvbi5tZWFzdXJlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApIDogbnVsbDtcbiAgICAgICAgfSl9XG4gICAgICA8Lz5cbiAgICApO1xuICB9O1xuXG4gIHJldHVybiBMYXllckxlZ2VuZENvbnRlbnQ7XG59XG5cbmV4cG9ydCB0eXBlIE1hcExlZ2VuZFByb3BzID0ge1xuICBsYXllcnM/OiBSZWFkb25seUFycmF5PExheWVyPjtcbiAgd2lkdGg/OiBudW1iZXI7XG4gIG1hcEhlaWdodD86IG51bWJlcjtcbiAgb3B0aW9ucz86IHtcbiAgICBzaG93TGF5ZXJOYW1lPzogYm9vbGVhbjtcbiAgfTtcbn07XG5cbk1hcExlZ2VuZEZhY3RvcnkuZGVwcyA9IFtMYXllckxlZ2VuZEhlYWRlckZhY3RvcnksIExheWVyTGVnZW5kQ29udGVudEZhY3RvcnldO1xuZnVuY3Rpb24gTWFwTGVnZW5kRmFjdG9yeShMYXllckxlZ2VuZEhlYWRlciwgTGF5ZXJMZWdlbmRDb250ZW50KSB7XG4gIC8qKiBAdHlwZSB7dHlwZW9mIGltcG9ydCgnLi9tYXAtbGVnZW5kJykuTWFwTGVnZW5kIH0+ICovXG4gIGNvbnN0IE1hcExlZ2VuZDogUmVhY3QuRkM8TWFwTGVnZW5kUHJvcHM+ID0gKHtsYXllcnMgPSBbXSwgd2lkdGgsIG1hcEhlaWdodCwgb3B0aW9uc30pID0+IChcbiAgICA8ZGl2XG4gICAgICBjbGFzc05hbWU9XCJtYXAtbGVnZW5kXCJcbiAgICAgIHsuLi4obWFwSGVpZ2h0ICYmIHtcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAvKiBzdWJ0cmFjdGluZyByb3VnaCBzaXplIG9mIDQgbWFwIGNvbnRyb2wgYnV0dG9ucyBhbmQgcGFkZGluZyAqL1xuICAgICAgICAgIG1heEhlaWdodDogbWFwSGVpZ2h0IC0gMjUwXG4gICAgICAgIH1cbiAgICAgIH0pfVxuICAgID5cbiAgICAgIHtsYXllcnMubWFwKChsYXllciwgaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKCFsYXllci5pc1ZhbGlkVG9TYXZlKCkgfHwgbGF5ZXIuY29uZmlnLmhpZGRlbikge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lclcgPSB3aWR0aCB8fCBESU1FTlNJT05TLm1hcENvbnRyb2wud2lkdGg7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8U3R5bGVkTWFwQ29udHJvbExlZ2VuZFxuICAgICAgICAgICAgY2xhc3NOYW1lPVwibGVnZW5kLS1sYXllclwiXG4gICAgICAgICAgICBsYXN0PXtpbmRleCA9PT0gbGF5ZXJzLmxlbmd0aCAtIDF9XG4gICAgICAgICAgICBrZXk9e2luZGV4fVxuICAgICAgICAgICAgd2lkdGg9e2NvbnRhaW5lcld9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgPExheWVyTGVnZW5kSGVhZGVyIG9wdGlvbnM9e29wdGlvbnN9IGxheWVyPXtsYXllcn0gLz5cbiAgICAgICAgICAgIDxMYXllckxlZ2VuZENvbnRlbnQgY29udGFpbmVyVz17Y29udGFpbmVyV30gbGF5ZXI9e2xheWVyfSAvPlxuICAgICAgICAgIDwvU3R5bGVkTWFwQ29udHJvbExlZ2VuZD5cbiAgICAgICAgKTtcbiAgICAgIH0pfVxuICAgIDwvZGl2PlxuICApO1xuXG4gIE1hcExlZ2VuZC5kaXNwbGF5TmFtZSA9ICdNYXBMZWdlbmQnO1xuXG4gIHJldHVybiBNYXBMZWdlbmQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IE1hcExlZ2VuZEZhY3Rvcnk7XG4iXX0=