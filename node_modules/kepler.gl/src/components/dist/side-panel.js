"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = SidePanelFactory;
exports.StyledSidePanelContent = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _constants = require("@kepler.gl/constants");

var _icons = require("./common/icons");

var _sideBar = _interopRequireDefault(require("./side-panel/side-bar"));

var _panelHeader = _interopRequireDefault(require("./side-panel/panel-header"));

var _panelToggle = _interopRequireDefault(require("./side-panel/panel-toggle"));

var _layerManager = _interopRequireDefault(require("./side-panel/layer-manager"));

var _filterManager = _interopRequireDefault(require("./side-panel/filter-manager"));

var _interactionManager = _interopRequireDefault(require("./side-panel/interaction-manager"));

var _mapManager = _interopRequireDefault(require("./side-panel/map-manager"));

var _customPanel = _interopRequireDefault(require("./side-panel/custom-panel"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _lodash = _interopRequireDefault(require("lodash.get"));

var _templateObject;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var StyledSidePanelContent = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  ", ";\n  flex-grow: 1;\n  padding: ", "px;\n  overflow-y: scroll;\n  overflow-x: hidden;\n\n  .side-panel__content__inner {\n    display: flex;\n    height: 100%;\n    flex-direction: column;\n  }\n"])), function (props) {
  return props.theme.sidePanelScrollBar;
}, function (props) {
  return props.theme.sidePanelInnerPadding;
});

exports.StyledSidePanelContent = StyledSidePanelContent;
SidePanelFactory.deps = [_sideBar["default"], _panelHeader["default"], _panelToggle["default"], _layerManager["default"], _filterManager["default"], _interactionManager["default"], _mapManager["default"], _customPanel["default"]];
/**
 * Vertical sidebar containing input components for the rendering layers
 */

function SidePanelFactory(Sidebar, PanelHeader, PanelToggle, LayerManager, FilterManager, InteractionManager, MapManager, CustomPanels) {
  // inject components
  var SIDEBAR_COMPONENTS = {
    layer: LayerManager,
    filter: FilterManager,
    interaction: InteractionManager,
    map: MapManager
  };
  var SIDEBAR_ICONS = {
    layer: _icons.Layers,
    filter: _icons.FilterFunnel,
    interaction: _icons.Settings,
    map: _icons.CursorClick
  }; // We should defined sidebar panels here but keeping them for backward compatible

  var fullPanels = _constants.SIDEBAR_PANELS.map(function (component) {
    return _objectSpread(_objectSpread({}, component), {}, {
      component: SIDEBAR_COMPONENTS[component.id],
      iconComponent: SIDEBAR_ICONS[component.id]
    });
  });

  var getCustomPanelProps = (0, _lodash["default"])(CustomPanels, ['defaultProps', 'getProps']) || function () {
    return {};
  }; // eslint-disable-next-line max-statements


  var SidePanel = function SidePanel(props) {
    var appName = props.appName,
        appWebsite = props.appWebsite,
        _props$availableProvi = props.availableProviders,
        availableProviders = _props$availableProvi === void 0 ? {} : _props$availableProvi,
        datasets = props.datasets,
        filters = props.filters,
        layers = props.layers,
        layerBlending = props.layerBlending,
        overlayBlending = props.overlayBlending,
        layerClasses = props.layerClasses,
        layerOrder = props.layerOrder,
        interactionConfig = props.interactionConfig,
        _props$panels = props.panels,
        panels = _props$panels === void 0 ? fullPanels : _props$panels,
        mapInfo = props.mapInfo,
        mapSaved = props.mapSaved,
        mapStateActions = props.mapStateActions,
        mapStyle = props.mapStyle,
        mapStyleActions = props.mapStyleActions,
        onSaveMap = props.onSaveMap,
        uiState = props.uiState,
        uiStateActions = props.uiStateActions,
        visStateActions = props.visStateActions,
        version = props.version,
        width = props.width;
    var openDeleteModal = uiStateActions.openDeleteModal,
        toggleModal = uiStateActions.toggleModal,
        toggleSidePanel = uiStateActions.toggleSidePanel;
    var activeSidePanel = uiState.activeSidePanel;
    var setMapInfo = visStateActions.setMapInfo,
        showDatasetTable = visStateActions.showDatasetTable,
        updateTableColor = visStateActions.updateTableColor;
    var hasShare = availableProviders.hasShare,
        hasStorage = availableProviders.hasStorage;
    var title = mapInfo.title;
    var isOpen = Boolean(activeSidePanel);

    var _onOpenOrClose = (0, _react.useCallback)(function () {
      return toggleSidePanel(activeSidePanel ? '' : 'layer');
    }, [activeSidePanel, toggleSidePanel]);

    var onClickExportImage = (0, _react.useCallback)(function () {
      return toggleModal(_constants.EXPORT_IMAGE_ID);
    }, [toggleModal]);
    var onClickExportData = (0, _react.useCallback)(function () {
      return toggleModal(_constants.EXPORT_DATA_ID);
    }, [toggleModal]);
    var onClickExportMap = (0, _react.useCallback)(function () {
      return toggleModal(_constants.EXPORT_MAP_ID);
    }, [toggleModal]);
    var onClickSaveToStorage = (0, _react.useCallback)(function () {
      return toggleModal(mapSaved ? _constants.OVERWRITE_MAP_ID : _constants.SAVE_MAP_ID);
    }, [mapSaved, toggleModal]);
    var onClickSaveAsToStorage = (0, _react.useCallback)(function () {
      setMapInfo({
        title: "".concat(title || 'Kepler.gl', " (Copy)")
      });
      toggleModal(_constants.SAVE_MAP_ID);
    }, [title, setMapInfo, toggleModal]);
    var onClickShareMap = (0, _react.useCallback)(function () {
      return toggleModal(_constants.SHARE_MAP_ID);
    }, [toggleModal]);
    var onShowDatasetTable = (0, _react.useCallback)(function (dataId) {
      return showDatasetTable(dataId);
    }, [showDatasetTable]);
    var onUpdateTableColor = (0, _react.useCallback)(function (dataId, newColor) {
      return updateTableColor(dataId, newColor);
    }, [updateTableColor]);
    var onShowAddDataModal = (0, _react.useCallback)(function () {
      return toggleModal(_constants.ADD_DATA_ID);
    }, [toggleModal]);
    var onShowAddMapStyleModal = (0, _react.useCallback)(function () {
      return toggleModal(_constants.ADD_MAP_STYLE_ID);
    }, [toggleModal]);
    var onRemoveDataset = (0, _react.useCallback)(function (dataId) {
      return openDeleteModal(dataId);
    }, [openDeleteModal]);
    var currentPanel = (0, _react.useMemo)(function () {
      return panels.find(function (_ref) {
        var id = _ref.id;
        return id === activeSidePanel;
      }) || null;
    }, [activeSidePanel, panels]);
    var customPanelProps = (0, _react.useMemo)(function () {
      return getCustomPanelProps(props);
    }, [props]);
    var PanelComponent = currentPanel === null || currentPanel === void 0 ? void 0 : currentPanel.component;
    return /*#__PURE__*/_react["default"].createElement(Sidebar, {
      width: width,
      isOpen: isOpen,
      shouldShowCollapseButton: uiState.isSidePanelCloseButtonVisible,
      minifiedWidth: 0,
      onOpenOrClose: _onOpenOrClose
    }, /*#__PURE__*/_react["default"].createElement(PanelHeader, {
      appName: appName,
      version: version,
      appWebsite: appWebsite,
      visibleDropdown: uiState.visibleDropdown,
      showExportDropdown: uiStateActions.showExportDropdown,
      hideExportDropdown: uiStateActions.hideExportDropdown,
      onExportImage: onClickExportImage,
      onExportData: onClickExportData,
      onExportMap: onClickExportMap,
      onSaveMap: hasStorage ? onSaveMap : undefined,
      onSaveToStorage: hasStorage ? onClickSaveToStorage : null,
      onSaveAsToStorage: hasStorage && mapSaved ? onClickSaveAsToStorage : null,
      onShareMap: hasShare ? onClickShareMap : null
    }), /*#__PURE__*/_react["default"].createElement(PanelToggle, {
      panels: panels,
      activePanel: activeSidePanel,
      togglePanel: uiStateActions.toggleSidePanel
    }), /*#__PURE__*/_react["default"].createElement(StyledSidePanelContent, {
      className: "side-panel__content"
    }, /*#__PURE__*/_react["default"].createElement("div", {
      className: "side-panel__content__inner"
    }, PanelComponent ? /*#__PURE__*/_react["default"].createElement(PanelComponent, {
      datasets: datasets,
      filters: filters,
      layers: layers,
      layerClasses: layerClasses,
      layerOrder: layerOrder,
      layerBlending: layerBlending,
      overlayBlending: overlayBlending,
      mapStyle: mapStyle,
      mapStyleActions: mapStyleActions,
      mapStateActions: mapStateActions,
      interactionConfig: interactionConfig,
      removeDataset: onRemoveDataset,
      showDatasetTable: onShowDatasetTable,
      updateTableColor: onUpdateTableColor,
      showAddDataModal: onShowAddDataModal,
      showAddMapStyleModal: onShowAddMapStyleModal,
      uiStateActions: uiStateActions,
      visStateActions: visStateActions,
      panelMetadata: currentPanel,
      panelListView: (currentPanel === null || currentPanel === void 0 ? void 0 : currentPanel.id) === 'layer' ? uiState.layerPanelListView : (currentPanel === null || currentPanel === void 0 ? void 0 : currentPanel.id) === 'filter' ? uiState.filterPanelListView : null
    }) : null, /*#__PURE__*/_react["default"].createElement(CustomPanels, (0, _extends2["default"])({}, customPanelProps, {
      activeSidePanel: activeSidePanel,
      updateTableColor: onUpdateTableColor
    })))));
  };

  SidePanel.defaultProps = {
    panels: fullPanels,
    mapInfo: {}
  };
  return SidePanel;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zaWRlLXBhbmVsLnRzeCJdLCJuYW1lcyI6WyJTdHlsZWRTaWRlUGFuZWxDb250ZW50Iiwic3R5bGVkIiwiZGl2IiwicHJvcHMiLCJ0aGVtZSIsInNpZGVQYW5lbFNjcm9sbEJhciIsInNpZGVQYW5lbElubmVyUGFkZGluZyIsIlNpZGVQYW5lbEZhY3RvcnkiLCJkZXBzIiwiU2lkZWJhckZhY3RvcnkiLCJQYW5lbEhlYWRlckZhY3RvcnkiLCJQYW5lbFRvZ2dsZUZhY3RvcnkiLCJMYXllck1hbmFnZXJGYWN0b3J5IiwiRmlsdGVyTWFuYWdlckZhY3RvcnkiLCJJbnRlcmFjdGlvbk1hbmFnZXJGYWN0b3J5IiwiTWFwTWFuYWdlckZhY3RvcnkiLCJDdXN0b21QYW5lbHNGYWN0b3J5IiwiU2lkZWJhciIsIlBhbmVsSGVhZGVyIiwiUGFuZWxUb2dnbGUiLCJMYXllck1hbmFnZXIiLCJGaWx0ZXJNYW5hZ2VyIiwiSW50ZXJhY3Rpb25NYW5hZ2VyIiwiTWFwTWFuYWdlciIsIkN1c3RvbVBhbmVscyIsIlNJREVCQVJfQ09NUE9ORU5UUyIsImxheWVyIiwiZmlsdGVyIiwiaW50ZXJhY3Rpb24iLCJtYXAiLCJTSURFQkFSX0lDT05TIiwiTGF5ZXJzIiwiRmlsdGVyRnVubmVsIiwiU2V0dGluZ3MiLCJDdXJzb3JDbGljayIsImZ1bGxQYW5lbHMiLCJTSURFQkFSX1BBTkVMUyIsImNvbXBvbmVudCIsImlkIiwiaWNvbkNvbXBvbmVudCIsImdldEN1c3RvbVBhbmVsUHJvcHMiLCJTaWRlUGFuZWwiLCJhcHBOYW1lIiwiYXBwV2Vic2l0ZSIsImF2YWlsYWJsZVByb3ZpZGVycyIsImRhdGFzZXRzIiwiZmlsdGVycyIsImxheWVycyIsImxheWVyQmxlbmRpbmciLCJvdmVybGF5QmxlbmRpbmciLCJsYXllckNsYXNzZXMiLCJsYXllck9yZGVyIiwiaW50ZXJhY3Rpb25Db25maWciLCJwYW5lbHMiLCJtYXBJbmZvIiwibWFwU2F2ZWQiLCJtYXBTdGF0ZUFjdGlvbnMiLCJtYXBTdHlsZSIsIm1hcFN0eWxlQWN0aW9ucyIsIm9uU2F2ZU1hcCIsInVpU3RhdGUiLCJ1aVN0YXRlQWN0aW9ucyIsInZpc1N0YXRlQWN0aW9ucyIsInZlcnNpb24iLCJ3aWR0aCIsIm9wZW5EZWxldGVNb2RhbCIsInRvZ2dsZU1vZGFsIiwidG9nZ2xlU2lkZVBhbmVsIiwiYWN0aXZlU2lkZVBhbmVsIiwic2V0TWFwSW5mbyIsInNob3dEYXRhc2V0VGFibGUiLCJ1cGRhdGVUYWJsZUNvbG9yIiwiaGFzU2hhcmUiLCJoYXNTdG9yYWdlIiwidGl0bGUiLCJpc09wZW4iLCJCb29sZWFuIiwiX29uT3Blbk9yQ2xvc2UiLCJvbkNsaWNrRXhwb3J0SW1hZ2UiLCJFWFBPUlRfSU1BR0VfSUQiLCJvbkNsaWNrRXhwb3J0RGF0YSIsIkVYUE9SVF9EQVRBX0lEIiwib25DbGlja0V4cG9ydE1hcCIsIkVYUE9SVF9NQVBfSUQiLCJvbkNsaWNrU2F2ZVRvU3RvcmFnZSIsIk9WRVJXUklURV9NQVBfSUQiLCJTQVZFX01BUF9JRCIsIm9uQ2xpY2tTYXZlQXNUb1N0b3JhZ2UiLCJvbkNsaWNrU2hhcmVNYXAiLCJTSEFSRV9NQVBfSUQiLCJvblNob3dEYXRhc2V0VGFibGUiLCJkYXRhSWQiLCJvblVwZGF0ZVRhYmxlQ29sb3IiLCJuZXdDb2xvciIsIm9uU2hvd0FkZERhdGFNb2RhbCIsIkFERF9EQVRBX0lEIiwib25TaG93QWRkTWFwU3R5bGVNb2RhbCIsIkFERF9NQVBfU1RZTEVfSUQiLCJvblJlbW92ZURhdGFzZXQiLCJjdXJyZW50UGFuZWwiLCJmaW5kIiwiY3VzdG9tUGFuZWxQcm9wcyIsIlBhbmVsQ29tcG9uZW50IiwiaXNTaWRlUGFuZWxDbG9zZUJ1dHRvblZpc2libGUiLCJ2aXNpYmxlRHJvcGRvd24iLCJzaG93RXhwb3J0RHJvcGRvd24iLCJoaWRlRXhwb3J0RHJvcGRvd24iLCJ1bmRlZmluZWQiLCJsYXllclBhbmVsTGlzdFZpZXciLCJmaWx0ZXJQYW5lbExpc3RWaWV3IiwiZGVmYXVsdFByb3BzIl0sIm1h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akI7QUFvQkUsTUFBQSxhQUFhLEVBQ1gsQ0FBQUEsWUFBWSxTQUFaLElBQUFBLFlBQVksV0FBWixZQUFBQSxZQUFZLENBQUU3RCxFQUFkLE1BQXFCLE9BQXJCLEdBQ0lzQixPQUFPLENBQUNnRCxrQkFEWixHQUVJLENBQUFULFlBQVksU0FBWixJQUFBQSxZQUFZLFdBQVosWUFBQUEsWUFBWSxDQUFFN0QsRUFBZCxNQUFxQixRQUFyQixHQUNBc0IsT0FBTyxDQUFDaUQsbUJBRFIsR0FFQTtBQXpCUixNQURhLEdBNkJYLElBOUJOLGVBK0JFLGdDQUFDLFlBQUQsZ0NBQ01SLGdCQUROO0FBRUUsTUFBQSxlQUFlLEVBQUVqQyxlQUZuQjtBQUdFLE1BQUEsZ0JBQWdCLEVBQUV3QjtBQUhwQixPQS9CRixDQURGLENBN0JGLENBREY7QUF1RUQsR0EvSUQ7O0FBaUpBbkQsRUFBQUEsU0FBUyxDQUFDcUUsWUFBVixHQUF5QjtBQUN2QnpELElBQUFBLE1BQU0sRUFBRWxCLFVBRGU7QUFFdkJtQixJQUFBQSxPQUFPLEVBQUU7QUFGYyxHQUF6QjtBQUtBLFNBQU9iLFNBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge3VzZUNhbGxiYWNrLCB1c2VNZW1vfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7XG4gIEVYUE9SVF9EQVRBX0lELFxuICBFWFBPUlRfTUFQX0lELFxuICBTSEFSRV9NQVBfSUQsXG4gIFNJREVCQVJfUEFORUxTLFxuICBPVkVSV1JJVEVfTUFQX0lELFxuICBTQVZFX01BUF9JRCxcbiAgRVhQT1JUX0lNQUdFX0lELFxuICBBRERfREFUQV9JRCxcbiAgQUREX01BUF9TVFlMRV9JRFxufSBmcm9tICdAa2VwbGVyLmdsL2NvbnN0YW50cyc7XG5cbmltcG9ydCB7Q3Vyc29yQ2xpY2ssIExheWVycywgRmlsdGVyRnVubmVsLCBTZXR0aW5nc30gZnJvbSAnLi9jb21tb24vaWNvbnMnO1xuXG5pbXBvcnQgU2lkZWJhckZhY3RvcnkgZnJvbSAnLi9zaWRlLXBhbmVsL3NpZGUtYmFyJztcbmltcG9ydCBQYW5lbEhlYWRlckZhY3RvcnkgZnJvbSAnLi9zaWRlLXBhbmVsL3BhbmVsLWhlYWRlcic7XG5pbXBvcnQgUGFuZWxUb2dnbGVGYWN0b3J5IGZyb20gJy4vc2lkZS1wYW5lbC9wYW5lbC10b2dnbGUnO1xuaW1wb3J0IExheWVyTWFuYWdlckZhY3RvcnkgZnJvbSAnLi9zaWRlLXBhbmVsL2xheWVyLW1hbmFnZXInO1xuaW1wb3J0IEZpbHRlck1hbmFnZXJGYWN0b3J5IGZyb20gJy4vc2lkZS1wYW5lbC9maWx0ZXItbWFuYWdlcic7XG5pbXBvcnQgSW50ZXJhY3Rpb25NYW5hZ2VyRmFjdG9yeSBmcm9tICcuL3NpZGUtcGFuZWwvaW50ZXJhY3Rpb24tbWFuYWdlcic7XG5pbXBvcnQgTWFwTWFuYWdlckZhY3RvcnkgZnJvbSAnLi9zaWRlLXBhbmVsL21hcC1tYW5hZ2VyJztcbmltcG9ydCBDdXN0b21QYW5lbHNGYWN0b3J5IGZyb20gJy4vc2lkZS1wYW5lbC9jdXN0b20tcGFuZWwnO1xuXG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBnZXQgZnJvbSAnbG9kYXNoLmdldCc7XG5pbXBvcnQge1NpZGVQYW5lbFByb3BzLCBTaWRlUGFuZWxJdGVtfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGNvbnN0IFN0eWxlZFNpZGVQYW5lbENvbnRlbnQgPSBzdHlsZWQuZGl2YFxuICAke3Byb3BzID0+IHByb3BzLnRoZW1lLnNpZGVQYW5lbFNjcm9sbEJhcn07XG4gIGZsZXgtZ3JvdzogMTtcbiAgcGFkZGluZzogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5zaWRlUGFuZWxJbm5lclBhZGRpbmd9cHg7XG4gIG92ZXJmbG93LXk6IHNjcm9sbDtcbiAgb3ZlcmZsb3cteDogaGlkZGVuO1xuXG4gIC5zaWRlLXBhbmVsX19jb250ZW50X19pbm5lciB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBoZWlnaHQ6IDEwMCU7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgfVxuYDtcblxuU2lkZVBhbmVsRmFjdG9yeS5kZXBzID0gW1xuICBTaWRlYmFyRmFjdG9yeSxcbiAgUGFuZWxIZWFkZXJGYWN0b3J5LFxuICBQYW5lbFRvZ2dsZUZhY3RvcnksXG4gIExheWVyTWFuYWdlckZhY3RvcnksXG4gIEZpbHRlck1hbmFnZXJGYWN0b3J5LFxuICBJbnRlcmFjdGlvbk1hbmFnZXJGYWN0b3J5LFxuICBNYXBNYW5hZ2VyRmFjdG9yeSxcbiAgQ3VzdG9tUGFuZWxzRmFjdG9yeVxuXTtcblxuLyoqXG4gKiBWZXJ0aWNhbCBzaWRlYmFyIGNvbnRhaW5pbmcgaW5wdXQgY29tcG9uZW50cyBmb3IgdGhlIHJlbmRlcmluZyBsYXllcnNcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gU2lkZVBhbmVsRmFjdG9yeShcbiAgU2lkZWJhcjogUmV0dXJuVHlwZTx0eXBlb2YgU2lkZWJhckZhY3Rvcnk+LFxuICBQYW5lbEhlYWRlcjogUmV0dXJuVHlwZTx0eXBlb2YgUGFuZWxIZWFkZXJGYWN0b3J5PixcbiAgUGFuZWxUb2dnbGU6IFJldHVyblR5cGU8dHlwZW9mIFBhbmVsVG9nZ2xlRmFjdG9yeT4sXG4gIExheWVyTWFuYWdlcjogUmV0dXJuVHlwZTx0eXBlb2YgTGF5ZXJNYW5hZ2VyRmFjdG9yeT4sXG4gIEZpbHRlck1hbmFnZXI6IFJldHVyblR5cGU8dHlwZW9mIEZpbHRlck1hbmFnZXJGYWN0b3J5PixcbiAgSW50ZXJhY3Rpb25NYW5hZ2VyOiBSZXR1cm5UeXBlPHR5cGVvZiBJbnRlcmFjdGlvbk1hbmFnZXJGYWN0b3J5PixcbiAgTWFwTWFuYWdlcjogUmV0dXJuVHlwZTx0eXBlb2YgTWFwTWFuYWdlckZhY3Rvcnk+LFxuICBDdXN0b21QYW5lbHM6IFJldHVyblR5cGU8dHlwZW9mIEN1c3RvbVBhbmVsc0ZhY3Rvcnk+XG4pIHtcbiAgLy8gaW5qZWN0IGNvbXBvbmVudHNcbiAgY29uc3QgU0lERUJBUl9DT01QT05FTlRTID0ge1xuICAgIGxheWVyOiBMYXllck1hbmFnZXIsXG4gICAgZmlsdGVyOiBGaWx0ZXJNYW5hZ2VyLFxuICAgIGludGVyYWN0aW9uOiBJbnRlcmFjdGlvbk1hbmFnZXIsXG4gICAgbWFwOiBNYXBNYW5hZ2VyXG4gIH07XG5cbiAgY29uc3QgU0lERUJBUl9JQ09OUyA9IHtcbiAgICBsYXllcjogTGF5ZXJzLFxuICAgIGZpbHRlcjogRmlsdGVyRnVubmVsLFxuICAgIGludGVyYWN0aW9uOiBTZXR0aW5ncyxcbiAgICBtYXA6IEN1cnNvckNsaWNrXG4gIH07XG5cbiAgLy8gV2Ugc2hvdWxkIGRlZmluZWQgc2lkZWJhciBwYW5lbHMgaGVyZSBidXQga2VlcGluZyB0aGVtIGZvciBiYWNrd2FyZCBjb21wYXRpYmxlXG4gIGNvbnN0IGZ1bGxQYW5lbHM6IFNpZGVQYW5lbEl0ZW1bXSA9IFNJREVCQVJfUEFORUxTLm1hcChjb21wb25lbnQgPT4gKHtcbiAgICAuLi5jb21wb25lbnQsXG4gICAgY29tcG9uZW50OiBTSURFQkFSX0NPTVBPTkVOVFNbY29tcG9uZW50LmlkXSxcbiAgICBpY29uQ29tcG9uZW50OiBTSURFQkFSX0lDT05TW2NvbXBvbmVudC5pZF1cbiAgfSkpO1xuXG4gIGNvbnN0IGdldEN1c3RvbVBhbmVsUHJvcHMgPSBnZXQoQ3VzdG9tUGFuZWxzLCBbJ2RlZmF1bHRQcm9wcycsICdnZXRQcm9wcyddKSB8fCAoKCkgPT4gKHt9KSk7XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1zdGF0ZW1lbnRzXG4gIGNvbnN0IFNpZGVQYW5lbDogUmVhY3QuRkM8U2lkZVBhbmVsUHJvcHM+ID0gKHByb3BzOiBTaWRlUGFuZWxQcm9wcykgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIGFwcE5hbWUsXG4gICAgICBhcHBXZWJzaXRlLFxuICAgICAgYXZhaWxhYmxlUHJvdmlkZXJzID0ge30sXG4gICAgICBkYXRhc2V0cyxcbiAgICAgIGZpbHRlcnMsXG4gICAgICBsYXllcnMsXG4gICAgICBsYXllckJsZW5kaW5nLFxuICAgICAgb3ZlcmxheUJsZW5kaW5nLFxuICAgICAgbGF5ZXJDbGFzc2VzLFxuICAgICAgbGF5ZXJPcmRlcixcbiAgICAgIGludGVyYWN0aW9uQ29uZmlnLFxuICAgICAgcGFuZWxzID0gZnVsbFBhbmVscyxcbiAgICAgIG1hcEluZm8sXG4gICAgICBtYXBTYXZlZCxcbiAgICAgIG1hcFN0YXRlQWN0aW9ucyxcbiAgICAgIG1hcFN0eWxlLFxuICAgICAgbWFwU3R5bGVBY3Rpb25zLFxuICAgICAgb25TYXZlTWFwLFxuICAgICAgdWlTdGF0ZSxcbiAgICAgIHVpU3RhdGVBY3Rpb25zLFxuICAgICAgdmlzU3RhdGVBY3Rpb25zLFxuICAgICAgdmVyc2lvbixcbiAgICAgIHdpZHRoXG4gICAgfSA9IHByb3BzO1xuICAgIGNvbnN0IHtvcGVuRGVsZXRlTW9kYWwsIHRvZ2dsZU1vZGFsLCB0b2dnbGVTaWRlUGFuZWx9ID0gdWlTdGF0ZUFjdGlvbnM7XG4gICAgY29uc3Qge2FjdGl2ZVNpZGVQYW5lbH0gPSB1aVN0YXRlO1xuICAgIGNvbnN0IHtzZXRNYXBJbmZvLCBzaG93RGF0YXNldFRhYmxlLCB1cGRhdGVUYWJsZUNvbG9yfSA9IHZpc1N0YXRlQWN0aW9ucztcbiAgICBjb25zdCB7aGFzU2hhcmUsIGhhc1N0b3JhZ2V9ID0gYXZhaWxhYmxlUHJvdmlkZXJzO1xuXG4gICAgY29uc3Qge3RpdGxlfSA9IG1hcEluZm87XG5cbiAgICBjb25zdCBpc09wZW4gPSBCb29sZWFuKGFjdGl2ZVNpZGVQYW5lbCk7XG5cbiAgICBjb25zdCBfb25PcGVuT3JDbG9zZSA9IHVzZUNhbGxiYWNrKCgpID0+IHRvZ2dsZVNpZGVQYW5lbChhY3RpdmVTaWRlUGFuZWwgPyAnJyA6ICdsYXllcicpLCBbXG4gICAgICBhY3RpdmVTaWRlUGFuZWwsXG4gICAgICB0b2dnbGVTaWRlUGFuZWxcbiAgICBdKTtcblxuICAgIGNvbnN0IG9uQ2xpY2tFeHBvcnRJbWFnZSA9IHVzZUNhbGxiYWNrKCgpID0+IHRvZ2dsZU1vZGFsKEVYUE9SVF9JTUFHRV9JRCksIFt0b2dnbGVNb2RhbF0pO1xuICAgIGNvbnN0IG9uQ2xpY2tFeHBvcnREYXRhID0gdXNlQ2FsbGJhY2soKCkgPT4gdG9nZ2xlTW9kYWwoRVhQT1JUX0RBVEFfSUQpLCBbdG9nZ2xlTW9kYWxdKTtcbiAgICBjb25zdCBvbkNsaWNrRXhwb3J0TWFwID0gdXNlQ2FsbGJhY2soKCkgPT4gdG9nZ2xlTW9kYWwoRVhQT1JUX01BUF9JRCksIFt0b2dnbGVNb2RhbF0pO1xuICAgIGNvbnN0IG9uQ2xpY2tTYXZlVG9TdG9yYWdlID0gdXNlQ2FsbGJhY2soXG4gICAgICAoKSA9PiB0b2dnbGVNb2RhbChtYXBTYXZlZCA/IE9WRVJXUklURV9NQVBfSUQgOiBTQVZFX01BUF9JRCksXG4gICAgICBbbWFwU2F2ZWQsIHRvZ2dsZU1vZGFsXVxuICAgICk7XG4gICAgY29uc3Qgb25DbGlja1NhdmVBc1RvU3RvcmFnZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHNldE1hcEluZm8oe1xuICAgICAgICB0aXRsZTogYCR7dGl0bGUgfHwgJ0tlcGxlci5nbCd9IChDb3B5KWBcbiAgICAgIH0pO1xuXG4gICAgICB0b2dnbGVNb2RhbChTQVZFX01BUF9JRCk7XG4gICAgfSwgW3RpdGxlLCBzZXRNYXBJbmZvLCB0b2dnbGVNb2RhbF0pO1xuICAgIGNvbnN0IG9uQ2xpY2tTaGFyZU1hcCA9IHVzZUNhbGxiYWNrKCgpID0+IHRvZ2dsZU1vZGFsKFNIQVJFX01BUF9JRCksIFt0b2dnbGVNb2RhbF0pO1xuICAgIGNvbnN0IG9uU2hvd0RhdGFzZXRUYWJsZSA9IHVzZUNhbGxiYWNrKGRhdGFJZCA9PiBzaG93RGF0YXNldFRhYmxlKGRhdGFJZCksIFtzaG93RGF0YXNldFRhYmxlXSk7XG4gICAgY29uc3Qgb25VcGRhdGVUYWJsZUNvbG9yID0gdXNlQ2FsbGJhY2soXG4gICAgICAoZGF0YUlkLCBuZXdDb2xvcikgPT4gdXBkYXRlVGFibGVDb2xvcihkYXRhSWQsIG5ld0NvbG9yKSxcbiAgICAgIFt1cGRhdGVUYWJsZUNvbG9yXVxuICAgICk7XG4gICAgY29uc3Qgb25TaG93QWRkRGF0YU1vZGFsID0gdXNlQ2FsbGJhY2soKCkgPT4gdG9nZ2xlTW9kYWwoQUREX0RBVEFfSUQpLCBbdG9nZ2xlTW9kYWxdKTtcbiAgICBjb25zdCBvblNob3dBZGRNYXBTdHlsZU1vZGFsID0gdXNlQ2FsbGJhY2soKCkgPT4gdG9nZ2xlTW9kYWwoQUREX01BUF9TVFlMRV9JRCksIFt0b2dnbGVNb2RhbF0pO1xuICAgIGNvbnN0IG9uUmVtb3ZlRGF0YXNldCA9IHVzZUNhbGxiYWNrKGRhdGFJZCA9PiBvcGVuRGVsZXRlTW9kYWwoZGF0YUlkKSwgW29wZW5EZWxldGVNb2RhbF0pO1xuXG4gICAgY29uc3QgY3VycmVudFBhbmVsID0gdXNlTWVtbygoKSA9PiBwYW5lbHMuZmluZCgoe2lkfSkgPT4gaWQgPT09IGFjdGl2ZVNpZGVQYW5lbCkgfHwgbnVsbCwgW1xuICAgICAgYWN0aXZlU2lkZVBhbmVsLFxuICAgICAgcGFuZWxzXG4gICAgXSk7XG5cbiAgICBjb25zdCBjdXN0b21QYW5lbFByb3BzID0gdXNlTWVtbygoKSA9PiBnZXRDdXN0b21QYW5lbFByb3BzKHByb3BzKSwgW3Byb3BzXSk7XG4gICAgY29uc3QgUGFuZWxDb21wb25lbnQgPSBjdXJyZW50UGFuZWw/LmNvbXBvbmVudDtcblxuICAgIHJldHVybiAoXG4gICAgICA8U2lkZWJhclxuICAgICAgICB3aWR0aD17d2lkdGh9XG4gICAgICAgIGlzT3Blbj17aXNPcGVufVxuICAgICAgICBzaG91bGRTaG93Q29sbGFwc2VCdXR0b249e3VpU3RhdGUuaXNTaWRlUGFuZWxDbG9zZUJ1dHRvblZpc2libGV9XG4gICAgICAgIG1pbmlmaWVkV2lkdGg9ezB9XG4gICAgICAgIG9uT3Blbk9yQ2xvc2U9e19vbk9wZW5PckNsb3NlfVxuICAgICAgPlxuICAgICAgICA8UGFuZWxIZWFkZXJcbiAgICAgICAgICBhcHBOYW1lPXthcHBOYW1lfVxuICAgICAgICAgIHZlcnNpb249e3ZlcnNpb259XG4gICAgICAgICAgYXBwV2Vic2l0ZT17YXBwV2Vic2l0ZX1cbiAgICAgICAgICB2aXNpYmxlRHJvcGRvd249e3VpU3RhdGUudmlzaWJsZURyb3Bkb3dufVxuICAgICAgICAgIHNob3dFeHBvcnREcm9wZG93bj17dWlTdGF0ZUFjdGlvbnMuc2hvd0V4cG9ydERyb3Bkb3dufVxuICAgICAgICAgIGhpZGVFeHBvcnREcm9wZG93bj17dWlTdGF0ZUFjdGlvbnMuaGlkZUV4cG9ydERyb3Bkb3dufVxuICAgICAgICAgIG9uRXhwb3J0SW1hZ2U9e29uQ2xpY2tFeHBvcnRJbWFnZX1cbiAgICAgICAgICBvbkV4cG9ydERhdGE9e29uQ2xpY2tFeHBvcnREYXRhfVxuICAgICAgICAgIG9uRXhwb3J0TWFwPXtvbkNsaWNrRXhwb3J0TWFwfVxuICAgICAgICAgIG9uU2F2ZU1hcD17aGFzU3RvcmFnZSA/IG9uU2F2ZU1hcCA6IHVuZGVmaW5lZH1cbiAgICAgICAgICBvblNhdmVUb1N0b3JhZ2U9e2hhc1N0b3JhZ2UgPyBvbkNsaWNrU2F2ZVRvU3RvcmFnZSA6IG51bGx9XG4gICAgICAgICAgb25TYXZlQXNUb1N0b3JhZ2U9e2hhc1N0b3JhZ2UgJiYgbWFwU2F2ZWQgPyBvbkNsaWNrU2F2ZUFzVG9TdG9yYWdlIDogbnVsbH1cbiAgICAgICAgICBvblNoYXJlTWFwPXtoYXNTaGFyZSA/IG9uQ2xpY2tTaGFyZU1hcCA6IG51bGx9XG4gICAgICAgIC8+XG4gICAgICAgIHsvKiB0aGUgbmV4dCB0d28gY29tcG9uZW50cyBzaG91bGQgYmUgbW92ZWQgaW50byBvbmUgKi99XG4gICAgICAgIHsvKiBidXQgaSBhbSBrZWVwaW5nIHRoZW0gYmVjYXVzZSBvZiBiYWNrd2FyZCBjb21wYXRpYmlsaXR5ICovfVxuICAgICAgICA8UGFuZWxUb2dnbGVcbiAgICAgICAgICBwYW5lbHM9e3BhbmVsc31cbiAgICAgICAgICBhY3RpdmVQYW5lbD17YWN0aXZlU2lkZVBhbmVsfVxuICAgICAgICAgIHRvZ2dsZVBhbmVsPXt1aVN0YXRlQWN0aW9ucy50b2dnbGVTaWRlUGFuZWx9XG4gICAgICAgIC8+XG4gICAgICAgIDxTdHlsZWRTaWRlUGFuZWxDb250ZW50IGNsYXNzTmFtZT1cInNpZGUtcGFuZWxfX2NvbnRlbnRcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInNpZGUtcGFuZWxfX2NvbnRlbnRfX2lubmVyXCI+XG4gICAgICAgICAgICB7UGFuZWxDb21wb25lbnQgPyAoXG4gICAgICAgICAgICAgIDxQYW5lbENvbXBvbmVudFxuICAgICAgICAgICAgICAgIGRhdGFzZXRzPXtkYXRhc2V0c31cbiAgICAgICAgICAgICAgICBmaWx0ZXJzPXtmaWx0ZXJzfVxuICAgICAgICAgICAgICAgIGxheWVycz17bGF5ZXJzfVxuICAgICAgICAgICAgICAgIGxheWVyQ2xhc3Nlcz17bGF5ZXJDbGFzc2VzfVxuICAgICAgICAgICAgICAgIGxheWVyT3JkZXI9e2xheWVyT3JkZXJ9XG4gICAgICAgICAgICAgICAgbGF5ZXJCbGVuZGluZz17bGF5ZXJCbGVuZGluZ31cbiAgICAgICAgICAgICAgICBvdmVybGF5QmxlbmRpbmc9e292ZXJsYXlCbGVuZGluZ31cbiAgICAgICAgICAgICAgICBtYXBTdHlsZT17bWFwU3R5bGV9XG4gICAgICAgICAgICAgICAgbWFwU3R5bGVBY3Rpb25zPXttYXBTdHlsZUFjdGlvbnN9XG4gICAgICAgICAgICAgICAgbWFwU3RhdGVBY3Rpb25zPXttYXBTdGF0ZUFjdGlvbnN9XG4gICAgICAgICAgICAgICAgaW50ZXJhY3Rpb25Db25maWc9e2ludGVyYWN0aW9uQ29uZmlnfVxuICAgICAgICAgICAgICAgIHJlbW92ZURhdGFzZXQ9e29uUmVtb3ZlRGF0YXNldH1cbiAgICAgICAgICAgICAgICBzaG93RGF0YXNldFRhYmxlPXtvblNob3dEYXRhc2V0VGFibGV9XG4gICAgICAgICAgICAgICAgdXBkYXRlVGFibGVDb2xvcj17b25VcGRhdGVUYWJsZUNvbG9yfVxuICAgICAgICAgICAgICAgIHNob3dBZGREYXRhTW9kYWw9e29uU2hvd0FkZERhdGFNb2RhbH1cbiAgICAgICAgICAgICAgICBzaG93QWRkTWFwU3R5bGVNb2RhbD17b25TaG93QWRkTWFwU3R5bGVNb2RhbH1cbiAgICAgICAgICAgICAgICB1aVN0YXRlQWN0aW9ucz17dWlTdGF0ZUFjdGlvbnN9XG4gICAgICAgICAgICAgICAgdmlzU3RhdGVBY3Rpb25zPXt2aXNTdGF0ZUFjdGlvbnN9XG4gICAgICAgICAgICAgICAgcGFuZWxNZXRhZGF0YT17Y3VycmVudFBhbmVsfVxuICAgICAgICAgICAgICAgIHBhbmVsTGlzdFZpZXc9e1xuICAgICAgICAgICAgICAgICAgY3VycmVudFBhbmVsPy5pZCA9PT0gJ2xheWVyJ1xuICAgICAgICAgICAgICAgICAgICA/IHVpU3RhdGUubGF5ZXJQYW5lbExpc3RWaWV3XG4gICAgICAgICAgICAgICAgICAgIDogY3VycmVudFBhbmVsPy5pZCA9PT0gJ2ZpbHRlcidcbiAgICAgICAgICAgICAgICAgICAgPyB1aVN0YXRlLmZpbHRlclBhbmVsTGlzdFZpZXdcbiAgICAgICAgICAgICAgICAgICAgOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAgICA8Q3VzdG9tUGFuZWxzXG4gICAgICAgICAgICAgIHsuLi5jdXN0b21QYW5lbFByb3BzfVxuICAgICAgICAgICAgICBhY3RpdmVTaWRlUGFuZWw9e2FjdGl2ZVNpZGVQYW5lbH1cbiAgICAgICAgICAgICAgdXBkYXRlVGFibGVDb2xvcj17b25VcGRhdGVUYWJsZUNvbG9yfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9TdHlsZWRTaWRlUGFuZWxDb250ZW50PlxuICAgICAgPC9TaWRlYmFyPlxuICAgICk7XG4gIH07XG5cbiAgU2lkZVBhbmVsLmRlZmF1bHRQcm9wcyA9IHtcbiAgICBwYW5lbHM6IGZ1bGxQYW5lbHMsXG4gICAgbWFwSW5mbzoge31cbiAgfTtcblxuICByZXR1cm4gU2lkZVBhbmVsO1xufVxuIl19