"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = DatasetTitleFactory;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _localization = require("@kepler.gl/localization");

var _layers = require("@kepler.gl/layers");

var _styledComponents2 = require("../../common/styled-components");

var _icons = require("../../common/icons");

var _datasetTag = _interopRequireDefault(require("./dataset-tag"));

var _customPicker = _interopRequireDefault(require("../layer-panel/custom-picker"));

var _ = require("../..");

var _utils = require("@kepler.gl/utils");

var _templateObject, _templateObject2;

var StyledDatasetTitle = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n  display: flex;\n  align-items: flex-start;\n\n  .source-data-arrow {\n    height: 16px;\n  }\n  :hover {\n    cursor: ", ";\n\n    .dataset-name {\n      color: ", ";\n    }\n\n    .dataset-action {\n      color: ", ";\n      opacity: 1;\n    }\n\n    .dataset-action:hover {\n      color: ", ";\n    }\n  }\n"])), function (props) {
  return props.theme.textColor;
}, function (props) {
  return props.clickable ? 'pointer' : 'auto';
}, function (props) {
  return props.clickable ? props.theme.textColorHl : props.theme.textColor;
}, function (props) {
  return props.theme.textColor;
}, function (props) {
  return props.theme.textColorHl;
});

var DataTagAction = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  margin-left: 12px;\n  height: 16px;\n  opacity: 0;\n"])));

var ShowDataTable = function ShowDataTable(_ref) {
  var id = _ref.id,
      showDatasetTable = _ref.showDatasetTable;
  return /*#__PURE__*/_react["default"].createElement(DataTagAction, {
    className: "dataset-action show-data-table",
    "data-tip": true,
    "data-for": "data-table-".concat(id)
  }, /*#__PURE__*/_react["default"].createElement(_layers.Table, {
    height: "16px",
    onClick: function onClick(e) {
      e.stopPropagation();
      showDatasetTable === null || showDatasetTable === void 0 ? void 0 : showDatasetTable(id);
    }
  }), /*#__PURE__*/_react["default"].createElement(_styledComponents2.Tooltip, {
    id: "data-table-".concat(id),
    effect: "solid"
  }, /*#__PURE__*/_react["default"].createElement("span", null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
    id: 'datasetTitle.showDataTable'
  }))));
};

var RemoveDataset = function RemoveDataset(_ref2) {
  var datasetKey = _ref2.datasetKey,
      removeDataset = _ref2.removeDataset;
  return /*#__PURE__*/_react["default"].createElement(DataTagAction, {
    className: "dataset-action remove-dataset",
    "data-tip": true,
    "data-for": "delete-".concat(datasetKey)
  }, /*#__PURE__*/_react["default"].createElement(_icons.Trash, {
    height: "16px",
    onClick: function onClick(e) {
      e.stopPropagation();
      removeDataset === null || removeDataset === void 0 ? void 0 : removeDataset(datasetKey);
    }
  }), /*#__PURE__*/_react["default"].createElement(_styledComponents2.Tooltip, {
    id: "delete-".concat(datasetKey),
    effect: "solid",
    type: "error"
  }, /*#__PURE__*/_react["default"].createElement("span", null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
    id: 'datasetTitle.removeDataset'
  }))));
};

DatasetTitleFactory.deps = [_datasetTag["default"]];

function DatasetTitleFactory(DatasetTag) {
  var DatasetTitle = function DatasetTitle(_ref3) {
    var showDatasetTable = _ref3.showDatasetTable,
        showDeleteDataset = _ref3.showDeleteDataset,
        onTitleClick = _ref3.onTitleClick,
        removeDataset = _ref3.removeDataset,
        dataset = _ref3.dataset,
        updateTableColor = _ref3.updateTableColor;

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        displayColorPicker = _useState2[0],
        setDisplayColorPicker = _useState2[1];

    var root = (0, _react.useRef)(null);
    var datasetId = dataset.id;

    var _handleClick = (0, _react.useCallback)(function () {
      setDisplayColorPicker(!displayColorPicker);
    }, [setDisplayColorPicker, displayColorPicker]);

    var _handleClosePicker = (0, _react.useCallback)(function () {
      setDisplayColorPicker(false);
    }, [setDisplayColorPicker]);

    var _handleCustomPicker = (0, _react.useCallback)(function (color) {
      updateTableColor(datasetId, [color.rgb.r, color.rgb.g, color.rgb.b]);
    }, [updateTableColor, datasetId]);

    var _onClickTitle = (0, _react.useCallback)(function (e) {
      e.stopPropagation();

      if (typeof onTitleClick === 'function') {
        onTitleClick();
      } else if (typeof showDatasetTable === 'function') {
        showDatasetTable(datasetId);
      }
    }, [onTitleClick, showDatasetTable, datasetId]);

    return /*#__PURE__*/_react["default"].createElement("div", {
      className: "custom-palette-panel",
      ref: root
    }, /*#__PURE__*/_react["default"].createElement(StyledDatasetTitle, {
      className: "source-data-title",
      clickable: Boolean(showDatasetTable || onTitleClick)
    }, /*#__PURE__*/_react["default"].createElement(DatasetTag, {
      dataset: dataset,
      onClick: _onClickTitle,
      updateTableColor: updateTableColor,
      onClickSquare: _handleClick
    }), /*#__PURE__*/_react["default"].createElement(_.Portaled, {
      isOpened: displayColorPicker !== false,
      left: 110,
      top: -50,
      onClose: _handleClosePicker
    }, /*#__PURE__*/_react["default"].createElement(_customPicker["default"], {
      color: (0, _utils.rgbToHex)(dataset.color),
      onChange: _handleCustomPicker,
      onSwatchClose: _handleClosePicker
    })), showDatasetTable ? /*#__PURE__*/_react["default"].createElement(_styledComponents2.CenterFlexbox, {
      className: "source-data-arrow"
    }, /*#__PURE__*/_react["default"].createElement(_icons.ArrowRight, {
      height: "12px"
    })) : null, showDatasetTable ? /*#__PURE__*/_react["default"].createElement(ShowDataTable, {
      id: datasetId,
      showDatasetTable: showDatasetTable
    }) : null, showDeleteDataset ? /*#__PURE__*/_react["default"].createElement(RemoveDataset, {
      datasetKey: datasetId,
      removeDataset: removeDataset
    }) : null));
  };

  return DatasetTitle;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zaWRlLXBhbmVsL2NvbW1vbi9kYXRhc2V0LXRpdGxlLnRzeCJdLCJuYW1lcyI6WyJTdHlsZWREYXRhc2V0VGl0bGUiLCJzdHlsZWQiLCJkaXYiLCJwcm9wcyIsInRoZW1lIiwidGV4dENvbG9yIiwiY2xpY2thYmxlIiwidGV4dENvbG9ySGwiLCJEYXRhVGFnQWN0aW9uIiwiU2hvd0RhdGFUYWJsZSIsImlkIiwic2hvd0RhdGFzZXRUYWJsZSIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJSZW1vdmVEYXRhc2V0IiwiZGF0YXNldEtleSIsInJlbW92ZURhdGFzZXQiLCJEYXRhc2V0VGl0bGVGYWN0b3J5IiwiZGVwcyIsIkRhdGFzZXRUYWdGYWN0b3J5IiwiRGF0YXNldFRhZyIsIkRhdGFzZXRUaXRsZSIsInNob3dEZWxldGVEYXRhc2V0Iiwib25UaXRsZUNsaWNrIiwiZGF0YXNldCIsInVwZGF0ZVRhYmxlQ29sb3IiLCJkaXNwbGF5Q29sb3JQaWNrZXIiLCJzZXREaXNwbGF5Q29sb3JQaWNrZXIiLCJyb290IiwiZGF0YXNldElkIiwiX2hhbmRsZUNsaWNrIiwiX2hhbmRsZUNsb3NlUGlja2VyIiwiX2hhbmRsZUN1c3RvbVBpY2tlciIsImNvbG9yIiwicmdiIiwiciIsImciLCJiIiwiX29uQ2xpY2tUaXRsZSIsIkJvb2xlYW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBS0EsSUFBTUEsa0JBQWtCLEdBQUdDLDZCQUFPQyxHQUFWLGdhQUNiLFVBQUFDLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUMsU0FBaEI7QUFBQSxDQURRLEVBU1YsVUFBQUYsS0FBSztBQUFBLFNBQUtBLEtBQUssQ0FBQ0csU0FBTixHQUFrQixTQUFsQixHQUE4QixNQUFuQztBQUFBLENBVEssRUFZVCxVQUFBSCxLQUFLO0FB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VFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IFJlYWN0LCB7dXNlQ2FsbGJhY2ssIHVzZVJlZiwgdXNlU3RhdGV9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHtGb3JtYXR0ZWRNZXNzYWdlfSBmcm9tICdAa2VwbGVyLmdsL2xvY2FsaXphdGlvbic7XG5cbmltcG9ydCB7VGFibGV9IGZyb20gJ0BrZXBsZXIuZ2wvbGF5ZXJzJztcbmltcG9ydCB7Q2VudGVyRmxleGJveCwgVG9vbHRpcH0gZnJvbSAnLi4vLi4vY29tbW9uL3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCB7QXJyb3dSaWdodCwgVHJhc2h9IGZyb20gJy4uLy4uL2NvbW1vbi9pY29ucyc7XG5pbXBvcnQgRGF0YXNldFRhZ0ZhY3RvcnkgZnJvbSAnLi9kYXRhc2V0LXRhZyc7XG5pbXBvcnQgQ3VzdG9tUGlja2VyIGZyb20gJy4uL2xheWVyLXBhbmVsL2N1c3RvbS1waWNrZXInO1xuaW1wb3J0IHtQb3J0YWxlZH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IHtyZ2JUb0hleH0gZnJvbSAnQGtlcGxlci5nbC91dGlscyc7XG5pbXBvcnQge29wZW5EZWxldGVNb2RhbCwgVmlzU3RhdGVBY3Rpb25zLCBBY3Rpb25IYW5kbGVyfSBmcm9tICdAa2VwbGVyLmdsL2FjdGlvbnMnO1xuaW1wb3J0IHtSR0JDb2xvcn0gZnJvbSAnQGtlcGxlci5nbC90eXBlcyc7XG5pbXBvcnQge1N0eWxlZERhdGFzZXRUaXRsZVByb3BzLCBSZW1vdmVEYXRhc2V0UHJvcHMsIFNob3dEYXRhVGFibGVQcm9wc30gZnJvbSAnLi90eXBlcyc7XG5cbmNvbnN0IFN0eWxlZERhdGFzZXRUaXRsZSA9IHN0eWxlZC5kaXY8U3R5bGVkRGF0YXNldFRpdGxlUHJvcHM+YFxuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS50ZXh0Q29sb3J9O1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogZmxleC1zdGFydDtcblxuICAuc291cmNlLWRhdGEtYXJyb3cge1xuICAgIGhlaWdodDogMTZweDtcbiAgfVxuICA6aG92ZXIge1xuICAgIGN1cnNvcjogJHtwcm9wcyA9PiAocHJvcHMuY2xpY2thYmxlID8gJ3BvaW50ZXInIDogJ2F1dG8nKX07XG5cbiAgICAuZGF0YXNldC1uYW1lIHtcbiAgICAgIGNvbG9yOiAke3Byb3BzID0+IChwcm9wcy5jbGlja2FibGUgPyBwcm9wcy50aGVtZS50ZXh0Q29sb3JIbCA6IHByb3BzLnRoZW1lLnRleHRDb2xvcil9O1xuICAgIH1cblxuICAgIC5kYXRhc2V0LWFjdGlvbiB7XG4gICAgICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS50ZXh0Q29sb3J9O1xuICAgICAgb3BhY2l0eTogMTtcbiAgICB9XG5cbiAgICAuZGF0YXNldC1hY3Rpb246aG92ZXIge1xuICAgICAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudGV4dENvbG9ySGx9O1xuICAgIH1cbiAgfVxuYDtcblxuY29uc3QgRGF0YVRhZ0FjdGlvbiA9IHN0eWxlZC5kaXZgXG4gIG1hcmdpbi1sZWZ0OiAxMnB4O1xuICBoZWlnaHQ6IDE2cHg7XG4gIG9wYWNpdHk6IDA7XG5gO1xuXG50eXBlIE1pbmlEYXRhc2V0ID0ge1xuICBpZDogc3RyaW5nO1xuICBjb2xvcjogUkdCQ29sb3I7XG4gIGxhYmVsPzogc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgRGF0YXNldFRpdGxlUHJvcHMgPSB7XG4gIGRhdGFzZXQ6IE1pbmlEYXRhc2V0O1xuICBzaG93RGVsZXRlRGF0YXNldDogYm9vbGVhbjtcbiAgb25UaXRsZUNsaWNrPzogKCkgPT4gdm9pZDtcbiAgc2hvd0RhdGFzZXRUYWJsZT86IEFjdGlvbkhhbmRsZXI8dHlwZW9mIFZpc1N0YXRlQWN0aW9ucy5zaG93RGF0YXNldFRhYmxlPjtcbiAgdXBkYXRlVGFibGVDb2xvcjogQWN0aW9uSGFuZGxlcjx0eXBlb2YgVmlzU3RhdGVBY3Rpb25zLnVwZGF0ZVRhYmxlQ29sb3I+O1xuICByZW1vdmVEYXRhc2V0PzogQWN0aW9uSGFuZGxlcjx0eXBlb2Ygb3BlbkRlbGV0ZU1vZGFsPjtcbn07XG5cbmNvbnN0IFNob3dEYXRhVGFibGUgPSAoe2lkLCBzaG93RGF0YXNldFRhYmxlfTogU2hvd0RhdGFUYWJsZVByb3BzKSA9PiAoXG4gIDxEYXRhVGFnQWN0aW9uIGNsYXNzTmFtZT1cImRhdGFzZXQtYWN0aW9uIHNob3ctZGF0YS10YWJsZVwiIGRhdGEtdGlwIGRhdGEtZm9yPXtgZGF0YS10YWJsZS0ke2lkfWB9PlxuICAgIDxUYWJsZVxuICAgICAgaGVpZ2h0PVwiMTZweFwiXG4gICAgICBvbkNsaWNrPXtlID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgc2hvd0RhdGFzZXRUYWJsZT8uKGlkKTtcbiAgICAgIH19XG4gICAgLz5cbiAgICA8VG9vbHRpcCBpZD17YGRhdGEtdGFibGUtJHtpZH1gfSBlZmZlY3Q9XCJzb2xpZFwiPlxuICAgICAgPHNwYW4+XG4gICAgICAgIDxGb3JtYXR0ZWRNZXNzYWdlIGlkPXsnZGF0YXNldFRpdGxlLnNob3dEYXRhVGFibGUnfSAvPlxuICAgICAgPC9zcGFuPlxuICAgIDwvVG9vbHRpcD5cbiAgPC9EYXRhVGFnQWN0aW9uPlxuKTtcblxuY29uc3QgUmVtb3ZlRGF0YXNldCA9ICh7ZGF0YXNldEtleSwgcmVtb3ZlRGF0YXNldH06IFJlbW92ZURhdGFzZXRQcm9wcykgPT4gKFxuICA8RGF0YVRhZ0FjdGlvblxuICAgIGNsYXNzTmFtZT1cImRhdGFzZXQtYWN0aW9uIHJlbW92ZS1kYXRhc2V0XCJcbiAgICBkYXRhLXRpcFxuICAgIGRhdGEtZm9yPXtgZGVsZXRlLSR7ZGF0YXNldEtleX1gfVxuICA+XG4gICAgPFRyYXNoXG4gICAgICBoZWlnaHQ9XCIxNnB4XCJcbiAgICAgIG9uQ2xpY2s9e2UgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICByZW1vdmVEYXRhc2V0Py4oZGF0YXNldEtleSk7XG4gICAgICB9fVxuICAgIC8+XG4gICAgPFRvb2x0aXAgaWQ9e2BkZWxldGUtJHtkYXRhc2V0S2V5fWB9IGVmZmVjdD1cInNvbGlkXCIgdHlwZT1cImVycm9yXCI+XG4gICAgICA8c3Bhbj5cbiAgICAgICAgPEZvcm1hdHRlZE1lc3NhZ2UgaWQ9eydkYXRhc2V0VGl0bGUucmVtb3ZlRGF0YXNldCd9IC8+XG4gICAgICA8L3NwYW4+XG4gICAgPC9Ub29sdGlwPlxuICA8L0RhdGFUYWdBY3Rpb24+XG4pO1xuXG5EYXRhc2V0VGl0bGVGYWN0b3J5LmRlcHMgPSBbRGF0YXNldFRhZ0ZhY3RvcnldO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBEYXRhc2V0VGl0bGVGYWN0b3J5KFxuICBEYXRhc2V0VGFnOiBSZXR1cm5UeXBlPHR5cGVvZiBEYXRhc2V0VGFnRmFjdG9yeT5cbik6IFJlYWN0LkZDPERhdGFzZXRUaXRsZVByb3BzPiB7XG4gIGNvbnN0IERhdGFzZXRUaXRsZTogUmVhY3QuRkM8RGF0YXNldFRpdGxlUHJvcHM+ID0gKHtcbiAgICBzaG93RGF0YXNldFRhYmxlLFxuICAgIHNob3dEZWxldGVEYXRhc2V0LFxuICAgIG9uVGl0bGVDbGljayxcbiAgICByZW1vdmVEYXRhc2V0LFxuICAgIGRhdGFzZXQsXG4gICAgdXBkYXRlVGFibGVDb2xvclxuICB9KSA9PiB7XG4gICAgY29uc3QgW2Rpc3BsYXlDb2xvclBpY2tlciwgc2V0RGlzcGxheUNvbG9yUGlja2VyXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCByb290ID0gdXNlUmVmKG51bGwpO1xuICAgIGNvbnN0IGRhdGFzZXRJZCA9IGRhdGFzZXQuaWQ7XG4gICAgY29uc3QgX2hhbmRsZUNsaWNrID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgc2V0RGlzcGxheUNvbG9yUGlja2VyKCFkaXNwbGF5Q29sb3JQaWNrZXIpO1xuICAgIH0sIFtzZXREaXNwbGF5Q29sb3JQaWNrZXIsIGRpc3BsYXlDb2xvclBpY2tlcl0pO1xuXG4gICAgY29uc3QgX2hhbmRsZUNsb3NlUGlja2VyID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgc2V0RGlzcGxheUNvbG9yUGlja2VyKGZhbHNlKTtcbiAgICB9LCBbc2V0RGlzcGxheUNvbG9yUGlja2VyXSk7XG4gICAgY29uc3QgX2hhbmRsZUN1c3RvbVBpY2tlciA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGNvbG9yOiB7cmdiOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+fSkgPT4ge1xuICAgICAgICB1cGRhdGVUYWJsZUNvbG9yKGRhdGFzZXRJZCwgW2NvbG9yLnJnYi5yLCBjb2xvci5yZ2IuZywgY29sb3IucmdiLmJdKTtcbiAgICAgIH0sXG4gICAgICBbdXBkYXRlVGFibGVDb2xvciwgZGF0YXNldElkXVxuICAgICk7XG5cbiAgICBjb25zdCBfb25DbGlja1RpdGxlID0gdXNlQ2FsbGJhY2soXG4gICAgICAoZTogUmVhY3QuTW91c2VFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvblRpdGxlQ2xpY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBvblRpdGxlQ2xpY2soKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2hvd0RhdGFzZXRUYWJsZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHNob3dEYXRhc2V0VGFibGUoZGF0YXNldElkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtvblRpdGxlQ2xpY2ssIHNob3dEYXRhc2V0VGFibGUsIGRhdGFzZXRJZF1cbiAgICApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY3VzdG9tLXBhbGV0dGUtcGFuZWxcIiByZWY9e3Jvb3R9PlxuICAgICAgICA8U3R5bGVkRGF0YXNldFRpdGxlXG4gICAgICAgICAgY2xhc3NOYW1lPVwic291cmNlLWRhdGEtdGl0bGVcIlxuICAgICAgICAgIGNsaWNrYWJsZT17Qm9vbGVhbihzaG93RGF0YXNldFRhYmxlIHx8IG9uVGl0bGVDbGljayl9XG4gICAgICAgID5cbiAgICAgICAgICA8RGF0YXNldFRhZ1xuICAgICAgICAgICAgZGF0YXNldD17ZGF0YXNldH1cbiAgICAgICAgICAgIG9uQ2xpY2s9e19vbkNsaWNrVGl0bGV9XG4gICAgICAgICAgICB1cGRhdGVUYWJsZUNvbG9yPXt1cGRhdGVUYWJsZUNvbG9yfVxuICAgICAgICAgICAgb25DbGlja1NxdWFyZT17X2hhbmRsZUNsaWNrfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPFBvcnRhbGVkXG4gICAgICAgICAgICBpc09wZW5lZD17ZGlzcGxheUNvbG9yUGlja2VyICE9PSBmYWxzZX1cbiAgICAgICAgICAgIGxlZnQ9ezExMH1cbiAgICAgICAgICAgIHRvcD17LTUwfVxuICAgICAgICAgICAgb25DbG9zZT17X2hhbmRsZUNsb3NlUGlja2VyfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxDdXN0b21QaWNrZXJcbiAgICAgICAgICAgICAgY29sb3I9e3JnYlRvSGV4KGRhdGFzZXQuY29sb3IpfVxuICAgICAgICAgICAgICBvbkNoYW5nZT17X2hhbmRsZUN1c3RvbVBpY2tlcn1cbiAgICAgICAgICAgICAgb25Td2F0Y2hDbG9zZT17X2hhbmRsZUNsb3NlUGlja2VyfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L1BvcnRhbGVkPlxuICAgICAgICAgIHtzaG93RGF0YXNldFRhYmxlID8gKFxuICAgICAgICAgICAgPENlbnRlckZsZXhib3ggY2xhc3NOYW1lPVwic291cmNlLWRhdGEtYXJyb3dcIj5cbiAgICAgICAgICAgICAgPEFycm93UmlnaHQgaGVpZ2h0PVwiMTJweFwiIC8+XG4gICAgICAgICAgICA8L0NlbnRlckZsZXhib3g+XG4gICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAge3Nob3dEYXRhc2V0VGFibGUgPyAoXG4gICAgICAgICAgICA8U2hvd0RhdGFUYWJsZSBpZD17ZGF0YXNldElkfSBzaG93RGF0YXNldFRhYmxlPXtzaG93RGF0YXNldFRhYmxlfSAvPlxuICAgICAgICAgICkgOiBudWxsfVxuICAgICAgICAgIHtzaG93RGVsZXRlRGF0YXNldCA/IChcbiAgICAgICAgICAgIDxSZW1vdmVEYXRhc2V0IGRhdGFzZXRLZXk9e2RhdGFzZXRJZH0gcmVtb3ZlRGF0YXNldD17cmVtb3ZlRGF0YXNldH0gLz5cbiAgICAgICAgICApIDogbnVsbH1cbiAgICAgICAgPC9TdHlsZWREYXRhc2V0VGl0bGU+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9O1xuXG4gIHJldHVybiBEYXRhc2V0VGl0bGU7XG59XG4iXX0=