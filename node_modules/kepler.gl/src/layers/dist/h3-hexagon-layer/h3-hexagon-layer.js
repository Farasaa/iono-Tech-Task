"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.HexagonIdVisConfigs = exports.defaultCoverage = exports.defaultElevation = exports.hexIdAccessor = exports.hexIdRequiredColumns = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _baseLayer = _interopRequireDefault(require("../base-layer"));

var _extensions = require("@deck.gl/extensions");

var _layers = require("@deck.gl/layers");

var _geoLayers = require("@deck.gl/geo-layers");

var _deckglLayers = require("@kepler.gl/deckgl-layers");

var _utils = require("@kepler.gl/utils");

var _h3HexagonLayerIcon = _interopRequireDefault(require("./h3-hexagon-layer-icon"));

var _constants = require("@kepler.gl/constants");

var _layerTextLabel = require("../layer-text-label");

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var DEFAULT_LINE_SCALE_VALUE = 8;
var hexIdRequiredColumns = ['hex_id'];
exports.hexIdRequiredColumns = hexIdRequiredColumns;

var hexIdAccessor = function hexIdAccessor(_ref) {
  var hex_id = _ref.hex_id;
  return function (dc) {
    return function (d) {
      return dc.valueAt(d.index, hex_id.fieldIdx);
    };
  };
};

exports.hexIdAccessor = hexIdAccessor;
var defaultElevation = 500;
exports.defaultElevation = defaultElevation;
var defaultCoverage = 1;
exports.defaultCoverage = defaultCoverage;
var HexagonIdVisConfigs = {
  colorRange: 'colorRange',
  filled: _objectSpread(_objectSpread({}, _constants.LAYER_VIS_CONFIGS.filled), {}, {
    defaultValue: true
  }),
  opacity: _objectSpread(_objectSpread({}, _constants.LAYER_VIS_CONFIGS.opacity), {}, {
    label: 'Fill Opacity',
    range: [0, 1],
    property: 'opacity'
  }),
  outline: 'outline',
  strokeColor: 'strokeColor',
  strokeColorRange: 'strokeColorRange',
  strokeOpacity: _objectSpread(_objectSpread({}, _constants.LAYER_VIS_CONFIGS.opacity), {}, {
    label: 'Stroke Opacity',
    range: [0, 1],
    property: 'strokeOpacity'
  }),
  thickness: 'thickness',
  coverage: 'coverage',
  enable3d: 'enable3d',
  sizeRange: 'elevationRange',
  coverageRange: 'coverageRange',
  elevationScale: 'elevationScale',
  enableElevationZoomFactor: 'enableElevationZoomFactor'
};
exports.HexagonIdVisConfigs = HexagonIdVisConfigs;
var brushingExtension = new _extensions.BrushingExtension();

var HexagonIdLayer = /*#__PURE__*/function (_Layer) {
  (0, _inherits2["default"])(HexagonIdLayer, _Layer);

  var _super = _createSuper(HexagonIdLayer);

  function HexagonIdLayer(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, HexagonIdLayer);
    _this = _super.call(this, props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "dataToFeature", void 0);
    _this.dataToFeature = {
      centroids: []
    };

    _this.registerVisConfig(HexagonIdVisConfigs);

    _this.getPositionAccessor = function (dataContainer) {
      return hexIdAccessor(_this.config.columns)(dataContainer);
    };

    return _this;
  }

  (0, _createClass2["default"])(HexagonIdLayer, [{
    key: "type",
    get: function get() {
      return 'hexagonId';
    }
  }, {
    key: "name",
    get: function get() {
      return 'H3';
    }
  }, {
    key: "requiredLayerColumns",
    get: function get() {
      return hexIdRequiredColumns;
    }
  }, {
    key: "layerIcon",
    get: function get() {
      // use hexagon layer icon for now
      return _h3HexagonLayerIcon["default"];
    }
  }, {
    key: "visualChannels",
    get: function get() {
      var visualChannels = (0, _get2["default"])((0, _getPrototypeOf2["default"])(HexagonIdLayer.prototype), "visualChannels", this);
      return {
        color: _objectSpread(_objectSpread({}, visualChannels.color), {}, {
          accessor: 'getFillColor',
          condition: function condition(config) {
            return config.visConfig.filled;
          }
        }),
        strokeColor: {
          property: 'strokeColor',
          key: 'strokeColor',
          field: 'strokeColorField',
          scale: 'strokeColorScale',
          domain: 'strokeColorDomain',
          range: 'strokeColorRange',
          channelScaleType: _constants.CHANNEL_SCALES.color,
          accessor: 'getLineColor',
          condition: function condition(config) {
            return config.visConfig.outline;
          },
          defaultValue: function defaultValue(config) {
            return config.visConfig.strokeColor || config.color;
          }
        },
        size: _objectSpread(_objectSpread({}, visualChannels.size), {}, {
          property: 'height',
          accessor: 'getElevation',
          nullValue: 0,
          condition: function condition(config) {
            return config.visConfig.enable3d;
          },
          defaultValue: defaultElevation
        }),
        coverage: {
          property: 'coverage',
          field: 'coverageField',
          scale: 'coverageScale',
          domain: 'coverageDomain',
          range: 'coverageRange',
          key: 'coverage',
          channelScaleType: _constants.CHANNEL_SCALES.radius,
          accessor: 'getCoverage',
          nullValue: 0,
          defaultValue: defaultCoverage
        }
      };
    }
  }, {
    key: "setInitialLayerConfig",
    value: function setInitialLayerConfig(dataset) {
      if (!dataset.dataContainer.numRows()) {
        return this;
      }

      var defaultColorField = (0, _utils.findDefaultColorField)(dataset);

      if (defaultColorField) {
        this.updateLayerConfig({
          colorField: defaultColorField
        });
        this.updateLayerVisualChannel(dataset, 'color');
      }

      return this;
    }
  }, {
    key: "getDefaultLayerConfig",
    value: function getDefaultLayerConfig(props) {
      var defaultLayerConfig = (0, _get2["default"])((0, _getPrototypeOf2["default"])(HexagonIdLayer.prototype), "getDefaultLayerConfig", this).call(this, props);
      return _objectSpread(_objectSpread({}, defaultLayerConfig), {}, {
        // add stroke color visual channel
        strokeColorField: null,
        strokeColorDomain: [0, 1],
        strokeColorScale: 'quantile',
        colorUI: _objectSpread(_objectSpread({}, defaultLayerConfig.colorUI), {}, {
          strokeColorRange: _constants.DEFAULT_COLOR_UI
        }),
        // add radius visual channel
        coverageField: null,
        coverageDomain: [0, 1],
        coverageScale: 'linear',
        // modify default textLabel anchor position to be appropriate for a hexagon shape
        textLabel: [_objectSpread(_objectSpread({}, _constants.DEFAULT_TEXT_LABEL), {}, {
          anchor: 'middle'
        })]
      });
    }
  }, {
    key: "calculateDataAttribute",
    value: function calculateDataAttribute(_ref2, getHexId) {
      var dataContainer = _ref2.dataContainer,
          filteredIndex = _ref2.filteredIndex;
      var data = [];

      for (var i = 0; i < filteredIndex.length; i++) {
        var index = filteredIndex[i];
        var id = getHexId({
          index: index
        });
        var centroid = this.dataToFeature.centroids[index];

        if (centroid) {
          data.push({
            index: index,
            id: id,
            centroid: centroid
          });
        }
      }

      return data;
    } // TODO: fix complexity

    /* eslint-disable complexity */

  }, {
    key: "formatLayerData",
    value: function formatLayerData(datasets, oldLayerData) {
      var opt = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

      if (this.config.dataId === null) {
        return {};
      }

      var _datasets$this$config = datasets[this.config.dataId],
          gpuFilter = _datasets$this$config.gpuFilter,
          dataContainer = _datasets$this$config.dataContainer;
      var getHexId = this.getPositionAccessor(dataContainer);

      var _this$updateData = this.updateData(datasets, oldLayerData),
          data = _this$updateData.data,
          triggerChanged = _this$updateData.triggerChanged;

      var accessors = this.getAttributeAccessors({
        dataContainer: dataContainer
      });
      var textLabel = this.config.textLabel; // get all distinct characters in the text labels

      var textLabels = (0, _layerTextLabel.formatTextLabelData)({
        textLabel: textLabel,
        triggerChanged: triggerChanged,
        oldLayerData: oldLayerData,
        data: data,
        dataContainer: dataContainer
      });
      return _objectSpread({
        data: data,
        getHexId: getHexId,
        getFilterValue: gpuFilter.filterValueAccessor(dataContainer)(),
        textLabels: textLabels,
        getPosition: function getPosition(d) {
          return d.centroid;
        }
      }, accessors);
    }
    /* eslint-enable complexity */

  }, {
    key: "updateLayerMeta",
    value: function updateLayerMeta(dataContainer, getHexId) {
      var centroids = dataContainer.map(function (d, index) {
        var id = getHexId({
          index: index
        });

        if (!(0, _utils.h3IsValid)(id)) {
          return null;
        } // save a reference of centroids to dataToFeature
        // so we don't have to re calculate it again


        return (0, _utils.getCentroid)({
          id: id
        });
      }, true);
      var centroidsDataContainer = (0, _utils.createDataContainer)(centroids);
      var bounds = this.getPointsBounds(centroidsDataContainer, function (d, dc) {
        return [dc.valueAt(d.index, 0), dc.valueAt(d.index, 1)];
      });
      this.dataToFeature = {
        centroids: centroids
      };
      this.updateMeta({
        bounds: bounds
      });
    }
  }, {
    key: "renderLayer",
    value: function renderLayer(opts) {
      var data = opts.data,
          gpuFilter = opts.gpuFilter,
          objectHovered = opts.objectHovered,
          mapState = opts.mapState,
          interactionConfig = opts.interactionConfig;
      var zoomFactor = this.getZoomFactor(mapState);
      var eleZoomFactor = this.getElevationZoomFactor(mapState);
      var config = this.config;
      var visConfig = config.visConfig;
      var updateTriggers = this.getVisualChannelUpdateTriggers();
      var h3HexagonLayerTriggers = {
        getHexagon: this.config.columns,
        getFillColor: updateTriggers.getFillColor,
        getLineColor: updateTriggers.getLineColor,
        getElevation: updateTriggers.getElevation,
        getFilterValue: gpuFilter.filterValueUpdateTriggers
      };
      var columnLayerTriggers = {
        getCoverage: updateTriggers.getCoverage
      };
      var defaultLayerProps = this.getDefaultDeckLayerProps(opts);
      var hoveredObject = this.hasHoveredObject(objectHovered); // getPixelOffset with no radius

      var radiusScale = 1.0;
      var getRaidus = null;
      var getPixelOffset = (0, _layerTextLabel.getTextOffsetByRadius)(radiusScale, getRaidus, mapState);
      var brushingProps = this.getBrushingExtensionProps(interactionConfig);
      var extensions = [].concat((0, _toConsumableArray2["default"])(defaultLayerProps.extensions), [brushingExtension]);

      var sharedProps = _objectSpread({
        getFilterValue: data.getFilterValue,
        extensions: extensions,
        filterRange: defaultLayerProps.filterRange,
        visible: defaultLayerProps.visible
      }, brushingProps);

      return [new _geoLayers.H3HexagonLayer(_objectSpread(_objectSpread(_objectSpread(_objectSpread({}, defaultLayerProps), data), brushingProps), {}, {
        extensions: extensions,
        wrapLongitude: false,
        filled: visConfig.filled,
        stroked: visConfig.outline,
        lineWidthScale: visConfig.thickness,
        getHexagon: function getHexagon(x) {
          return x.id;
        },
        // coverage
        coverage: config.coverageField ? 1 : visConfig.coverage,
        // highlight
        autoHighlight: visConfig.enable3d,
        highlightColor: _constants.HIGHLIGH_COLOR_3D,
        // elevation
        extruded: visConfig.enable3d,
        elevationScale: visConfig.elevationScale * eleZoomFactor,
        // render
        updateTriggers: h3HexagonLayerTriggers,
        _subLayerProps: {
          'hexagon-cell': {
            type: _deckglLayers.EnhancedColumnLayer,
            getCoverage: data.getCoverage,
            updateTriggers: columnLayerTriggers,
            strokeOpacity: visConfig.strokeOpacity
          }
        }
      }))].concat((0, _toConsumableArray2["default"])(hoveredObject && !config.sizeField ? [new _layers.GeoJsonLayer(_objectSpread(_objectSpread({}, this.getDefaultHoverLayerProps()), {}, {
        visible: defaultLayerProps.visible,
        data: [(0, _utils.idToPolygonGeo)(hoveredObject)],
        getLineColor: config.highlightColor,
        lineWidthScale: DEFAULT_LINE_SCALE_VALUE * zoomFactor,
        wrapLongitude: false
      }))] : []), (0, _toConsumableArray2["default"])(this.renderTextLabelLayer({
        getPosition: data.getPosition,
        sharedProps: sharedProps,
        getPixelOffset: getPixelOffset,
        updateTriggers: updateTriggers
      }, opts)));
    }
  }], [{
    key: "findDefaultLayerProps",
    value: function findDefaultLayerProps(_ref3) {
      var _ref3$fields = _ref3.fields,
          fields = _ref3$fields === void 0 ? [] : _ref3$fields,
          dataContainer = _ref3.dataContainer,
          label = _ref3.label;
      var hexFields = (0, _utils.getHexFields)(fields, dataContainer);

      if (!hexFields.length) {
        return {
          props: []
        };
      }

      return {
        props: hexFields.map(function (f) {
          return {
            isVisible: true,
            // default layer name should be dataset name
            label: label,
            columns: {
              hex_id: {
                value: f.name,
                fieldIdx: fields.findIndex(function (fid) {
                  return fid.name === f.name;
                })
              }
            }
          };
        })
      };
    }
  }]);
  return HexagonIdLayer;
}(_baseLayer["default"]);

exports["default"] = HexagonIdLayer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oMy1oZXhhZ29uLWxheWVyL2gzLWhleGFnb24tbGF5ZXIudHMiXSwibmFtZXMiOlsiREVGQVVMVF9MSU5FX1NDQUxFX1ZBTFVFIiwiaGV4SWRSZXF1aXJlZENvbHVtbnMiLCJoZXhJZEFjY2Vzc29yIiwiaGV4X2lkIiwiZGMiLCJkIiwidmFsdWVBdCIsImluZGV4IiwiZmllbGRJZHgiLCJkZWZhdWx0RWxldmF0aW9uIiwiZGVmYXVsdENvdmVyYWdlIiwiSGV4YWdvbklkVmlzQ29uZmlncyIsImNvbG9yUmFuZ2UiLCJmaWxsZWQiLCJMQVlFUl9WSVNfQ09ORklHUyIsImRlZmF1bHRWYWx1ZSIsIm9wYWNpdHkiLCJsYWJlbCIsInJhbmdlIiwicHJvcGVydHkiLCJvdXRsaW5lIiwic3Ryb2tlQ29sb3IiLCJzdHJva2VDb2xvclJhbmdlIiwic3Ryb2tlT3BhY2l0eSIsInRoaWNrbmVzcyIsImNvdmVyYWdlIiwiZW5hYmxlM2QiLCJzaXplUmFuZ2UiLCJjb3ZlcmFnZVJhbmdlIiwiZWxldmF0aW9uU2NhbGUiLCJlbmFibGVFbGV2YXRpb25ab29tRmFjdG9yIiwiYnJ1c2hpbmdFeHRlbnNpb24iLCJCcnVzaGluZ0V4dGVuc2lvbiIsIkhleGFnb25JZExheWVyIiwicHJvcHMiLCJkYXRhVG9GZWF0dXJlIiwiY2VudHJvaWRzIiwicmVnaXN0ZXJWaXNDb25maWciLCJnZXRQb3NpdGlvbkFjY2Vzc29yIiwiZGF0YUNvbnRhaW5lciIsImNvbmZpZyIsImNvbHVtbnMiLCJIM0hleGFnb25MYXllckljb24iLCJ2aXN1YWxDaGFubmVscyIsImNvbG9yIiwiYWNjZXNzb3IiLCJjb25kaXRpb24iLCJ2aXNDb25maWciLCJrZXkiLCJmaWVsZCIsInNjYWxlIiwiZG9tYWluIiwiY2hhbm5lbFNjYWxlVHlwZSIsIkNIQU5ORUxfU0NBTEVTIiwic2l6ZSIsIm51bGxWYWx1ZSIsInJhZGl1cyIsImRhdGFzZXQiLCJudW1Sb3dzIiwiZGVmYXVsdENvbG9yRmllbGQiLCJ1cGRhdGVMYXllckNvbmZpZyIsImNvbG9yRmllbGQiLCJ1cGRhdGVMYXllclZpc3VhbENoYW5uZWwiLCJkZWZhdWx0TGF5ZXJDb25maWciLCJzdHJva2VDb2xvckZpZWxkIiwic3Ryb2tlQ29sb3JEb21haW4iLCJzdHJva2VDb2xvclNjYWxlIiwiY29sb3JVSSIsIkRFRkFVTFRfQ09MT1JfVUkiLCJjb3ZlcmFnZUZpZWxkIiwiY292ZXJhZ2VEb21haW4iLCJjb3ZlcmFnZVNjYWxlIiwidGV4dExhYmVsIiwiREVGQVVMVF9URVhUX0xBQkVMIiwiYW5jaG9yIiwiZ2V0SGV4SWQiLCJmaWx0ZXJlZEluZGV4IiwiZGF0YSIsImkiLCJsZW5ndGgiLCJpZCIsImNlbnRyb2lkIiwicHVzaCIsImRhdGFzZXRzIiwib2xkTGF5ZXJEYXRhIiwib3B0IiwiZGF0YUlkIiwiZ3B1RmlsdGVyIiwidXBkYXRlRGF0YSIsInRyaWdnZXJDaGFuZ2VkIiwiYWNjZXNzb3JzIiwiZ2V0QXR0cmlidXRlQWNjZXNzb3JzIiwidGV4dExhYmVscyIsImdldEZpbHRlclZhbHVlIiwiZmlsdGVyVmFsdWVBY2Nlc3NvciIsImdldFBvc2l0aW9uIiwibWFwIiwiY2VudHJvaWRzRGF0YUNvbnRhaW5lciIsImJvdW5kcyIsImdldFBvaW50c0JvdW5kcyIsInVwZGF0ZU1ldGEiLCJvcHRzIiwib2JqZWN0SG92ZXJlZCIsIm1hcFN0YXRlIiwiaW50ZXJhY3Rpb25Db25maWciLCJ6b29tRmFjdG9yIiwiZ2V0Wm9vbUZhY3RvciIsImVsZVpvb21GYWN0b3IiLCJnZXRFbGV2YXRpb25ab29tRmFjdG9yIiwidXBkYXRlVHJpZ2dlcnMiLCJnZXRWaXN1YWxDaGFubmVsVXBkYXRlVHJpZ2dlcnMiLCJoM0hleGFnb25MYXllclRyaWdnZXJzIiwiZ2V0SGV4YWdvbiIsImdldEZpbGxDb2xvciIsImdldExpbmVDb2xvciIsImdldEVsZXZhdGlvbiIsImZpbHRlclZhbHVlVXBkYXRlVHJpZ2dlcnMiLCJjb2x1bW5MYXllclRyaWdnZXJzIiwiZ2V0Q292ZXJhZ2UiLCJkZWZhdWx0TGF5ZXJQcm9wcyIsImdldERlZmF1bHREZWNrTGF5ZXJQcm9wcyIsImhvdmVyZWRPYmplY3QiLCJoYXNIb3ZlcmVkT2JqZWN0IiwicmFkaXVzU2NhbGUiLCJnZXRSYWlkdXMiLCJnZXRQaXhlbE9mZnNldCIsImJydXNoaW5nUHJvcHMiLCJnZXRCcnVzaGluZ0V4dGVuc2lvblByb3BzIiwiZXh0ZW5zaW9ucyIsInNoYXJlZFByb3BzIiwiZmlsdGVyUmFuZ2UiLCJ2aXNpYmxlIiwiSDNIZXhhZ29uTGF5ZXIiLCJ3cmFwTG9uZ2l0dWRlIiwic3Ryb2tlZCIsImxpbmVXaWR0aFNjYWxlIiwieCIsImF1dG9IaWdobGlnaHQiLCJoaWdobGlnaHRDb2xvciIsIkhJR0hMSUdIX0NPTE9SXzNEIiwiZXh0cnVkZWQiLCJfc3ViTGF5ZXJQcm9wcyIsInR5cGUiLCJFbmhhbmNlZENvbHVtbkxheWVyIiwic2l6ZUZpZWxkIiwiR2VvSnNvbkxheWVyIiwiZ2V0RGVmYXVsdEhvdmVyTGF5ZXJQcm9wcyIsInJlbmRlclRleHRMYWJlbExheWVyIiwiZmllbGRzIiwiaGV4RmllbGRzIiwiZiIsImlzVmlzaWJsZSIsInZhbHVlIiwibmFtZSIsImZpbmRJbmRleCIsImZpZCIsIkxheWVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFHQTs7QUFRQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFVQTs7QUFDQTs7QUFrQkE7Ozs7Ozs7Ozs7QUErQ0EsSUFBTUEsd0JBQXdCLEdBQUcsQ0FBakM7QUFFTyxJQUFNQyxvQkFBZ0MsR0FBRyxDQUFDLFFBQUQsQ0FBekM7OztBQUNBLElBQU1DLGFBQWEsR0FBRyxTQUFoQkEsYUFBZ0I7QUFBQSxNQUFFQyxNQUFGLFFBQUVBLE1BQUY7QUFBQSxTQUEyQyxVQUN0RUMsRUFEc0U7QUFBQSxXQUVuRSxVQUFBQyxDQUFDO0FBQUEsYUFBSUQsRUFBRSxDQUFDRSxPQUFILENBQVdELENBQUMsQ0FBQ0UsS0FBYixFQUFvQkosTUFBTSxD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Q0cscUIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG5pbXBvcnQgTGF5ZXIsIHtcbiAgTGF5ZXJCYXNlQ29uZmlnLFxuICBMYXllckJhc2VDb25maWdQYXJ0aWFsLFxuICBMYXllckNvbG9yQ29uZmlnLFxuICBMYXllckNvbHVtbixcbiAgTGF5ZXJDb3ZlcmFnZUNvbmZpZyxcbiAgTGF5ZXJTaXplQ29uZmlnXG59IGZyb20gJy4uL2Jhc2UtbGF5ZXInO1xuaW1wb3J0IHtCcnVzaGluZ0V4dGVuc2lvbn0gZnJvbSAnQGRlY2suZ2wvZXh0ZW5zaW9ucyc7XG5pbXBvcnQge0dlb0pzb25MYXllcn0gZnJvbSAnQGRlY2suZ2wvbGF5ZXJzJztcbmltcG9ydCB7SDNIZXhhZ29uTGF5ZXJ9IGZyb20gJ0BkZWNrLmdsL2dlby1sYXllcnMnO1xuaW1wb3J0IHtFbmhhbmNlZENvbHVtbkxheWVyfSBmcm9tICdAa2VwbGVyLmdsL2RlY2tnbC1sYXllcnMnO1xuaW1wb3J0IHtcbiAgZ2V0Q2VudHJvaWQsXG4gIGlkVG9Qb2x5Z29uR2VvLFxuICBoM0lzVmFsaWQsXG4gIGdldEhleEZpZWxkcyxcbiAgQ2VudHJvaWQsXG4gIGZpbmREZWZhdWx0Q29sb3JGaWVsZCxcbiAgRGF0YUNvbnRhaW5lckludGVyZmFjZSxcbiAgY3JlYXRlRGF0YUNvbnRhaW5lclxufSBmcm9tICdAa2VwbGVyLmdsL3V0aWxzJztcbmltcG9ydCBIM0hleGFnb25MYXllckljb24gZnJvbSAnLi9oMy1oZXhhZ29uLWxheWVyLWljb24nO1xuaW1wb3J0IHtcbiAgQ0hBTk5FTF9TQ0FMRVMsXG4gIEhJR0hMSUdIX0NPTE9SXzNELFxuICBERUZBVUxUX0NPTE9SX1VJLFxuICBERUZBVUxUX1RFWFRfTEFCRUwsXG4gIExBWUVSX1ZJU19DT05GSUdTLFxuICBDb2xvclJhbmdlXG59IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcblxuaW1wb3J0IHtcbiAgVmlzQ29uZmlnQm9vbGVhbixcbiAgVmlzQ29uZmlnQ29sb3JSYW5nZSxcbiAgVmlzQ29uZmlnTnVtYmVyLFxuICBWaXNDb25maWdSYW5nZSxcbiAgTWVyZ2Vcbn0gZnJvbSAnQGtlcGxlci5nbC90eXBlcyc7XG5pbXBvcnQge0tlcGxlclRhYmxlfSBmcm9tICdAa2VwbGVyLmdsL3RhYmxlJztcblxuaW1wb3J0IHtnZXRUZXh0T2Zmc2V0QnlSYWRpdXMsIGZvcm1hdFRleHRMYWJlbERhdGF9IGZyb20gJy4uL2xheWVyLXRleHQtbGFiZWwnO1xuXG5leHBvcnQgdHlwZSBIZXhhZ29uSWRMYXllckNvbHVtbnNDb25maWcgPSB7XG4gIGhleF9pZDogTGF5ZXJDb2x1bW47XG59O1xuXG5leHBvcnQgdHlwZSBIZXhhZ29uSWRMYXllclZpc0NvbmZpZ1NldHRpbmdzID0ge1xuICBvcGFjaXR5OiBWaXNDb25maWdOdW1iZXI7XG4gIHN0cm9rZU9wYWNpdHk6IFZpc0NvbmZpZ051bWJlcjtcbiAgY29sb3JSYW5nZTogVmlzQ29uZmlnQ29sb3JSYW5nZTtcbiAgY292ZXJhZ2U6IFZpc0NvbmZpZ051bWJlcjtcbiAgZW5hYmxlM2Q6IFZpc0NvbmZpZ0Jvb2xlYW47XG4gIHNpemVSYW5nZTogVmlzQ29uZmlnUmFuZ2U7XG4gIGNvdmVyYWdlUmFuZ2U6IFZpc0NvbmZpZ1JhbmdlO1xuICBlbGV2YXRpb25TY2FsZTogVmlzQ29uZmlnTnVtYmVyO1xuICBlbmFibGVFbGV2YXRpb25ab29tRmFjdG9yOiBWaXNDb25maWdCb29sZWFuO1xuICBmaWxsZWQ6IFZpc0NvbmZpZ0Jvb2xlYW47XG4gIG91dGxpbmU6IFZpc0NvbmZpZ0Jvb2xlYW47XG4gIHRoaWNrbmVzczogVmlzQ29uZmlnTnVtYmVyO1xufTtcblxuZXhwb3J0IHR5cGUgSGV4YWdvbklkTGF5ZXJWaXNDb25maWcgPSB7XG4gIG9wYWNpdHk6IG51bWJlcjtcbiAgc3Ryb2tlT3BhY2l0eTogbnVtYmVyO1xuICBjb2xvclJhbmdlOiBDb2xvclJhbmdlO1xuICBjb3ZlcmFnZTogbnVtYmVyO1xuICBlbmFibGUzZDogYm9vbGVhbjtcbiAgc2l6ZVJhbmdlOiBbbnVtYmVyLCBudW1iZXJdO1xuICBjb3ZlcmFnZVJhbmdlOiBbbnVtYmVyLCBudW1iZXJdO1xuICBlbGV2YXRpb25TY2FsZTogbnVtYmVyO1xuICBlbmFibGVFbGV2YXRpb25ab29tRmFjdG9yOiBib29sZWFuO1xuICBmaWxsZWQ6IGJvb2xlYW47XG4gIG91dGxpbmU6IGJvb2xlYW47XG4gIHRoaWNrbmVzczogbnVtYmVyO1xufTtcblxuZXhwb3J0IHR5cGUgSGV4YWdvbklkTGF5ZXJWaXN1YWxDaGFubmVsQ29uZmlnID0gTGF5ZXJDb2xvckNvbmZpZyAmXG4gIExheWVyU2l6ZUNvbmZpZyAmXG4gIExheWVyQ292ZXJhZ2VDb25maWc7XG5leHBvcnQgdHlwZSBIZXhhZ29uSWRMYXllckNvbmZpZyA9IE1lcmdlPFxuICBMYXllckJhc2VDb25maWcsXG4gIHtjb2x1bW5zOiBIZXhhZ29uSWRMYXllckNvbHVtbnNDb25maWc7IHZpc0NvbmZpZzogSGV4YWdvbklkTGF5ZXJWaXNDb25maWd9XG4+ICZcbiAgSGV4YWdvbklkTGF5ZXJWaXN1YWxDaGFubmVsQ29uZmlnO1xuXG5leHBvcnQgdHlwZSBIZXhhZ29uSWRMYXllckRhdGEgPSB7aW5kZXg6IG51bWJlcjsgaWQ7IGNlbnRyb2lkOiBDZW50cm9pZH07XG5cbmNvbnN0IERFRkFVTFRfTElORV9TQ0FMRV9WQUxVRSA9IDg7XG5cbmV4cG9ydCBjb25zdCBoZXhJZFJlcXVpcmVkQ29sdW1uczogWydoZXhfaWQnXSA9IFsnaGV4X2lkJ107XG5leHBvcnQgY29uc3QgaGV4SWRBY2Nlc3NvciA9ICh7aGV4X2lkfTogSGV4YWdvbklkTGF5ZXJDb2x1bW5zQ29uZmlnKSA9PiAoXG4gIGRjOiBEYXRhQ29udGFpbmVySW50ZXJmYWNlXG4pID0+IGQgPT4gZGMudmFsdWVBdChkLmluZGV4LCBoZXhfaWQuZmllbGRJZHgpO1xuXG5leHBvcnQgY29uc3QgZGVmYXVsdEVsZXZhdGlvbiA9IDUwMDtcbmV4cG9ydCBjb25zdCBkZWZhdWx0Q292ZXJhZ2UgPSAxO1xuXG5leHBvcnQgY29uc3QgSGV4YWdvbklkVmlzQ29uZmlnczoge1xuICBvcGFjaXR5OiBWaXNDb25maWdOdW1iZXI7XG4gIHN0cm9rZU9wYWNpdHk6IFZpc0NvbmZpZ051bWJlcjtcbiAgY29sb3JSYW5nZTogJ2NvbG9yUmFuZ2UnO1xuICBmaWxsZWQ6IFZpc0NvbmZpZ0Jvb2xlYW47XG4gIG91dGxpbmU6ICdvdXRsaW5lJztcbiAgc3Ryb2tlQ29sb3I6ICdzdHJva2VDb2xvcic7XG4gIHN0cm9rZUNvbG9yUmFuZ2U6ICdzdHJva2VDb2xvclJhbmdlJztcbiAgdGhpY2tuZXNzOiAndGhpY2tuZXNzJztcbiAgY292ZXJhZ2U6ICdjb3ZlcmFnZSc7XG4gIGVuYWJsZTNkOiAnZW5hYmxlM2QnO1xuICBzaXplUmFuZ2U6ICdlbGV2YXRpb25SYW5nZSc7XG4gIGNvdmVyYWdlUmFuZ2U6ICdjb3ZlcmFnZVJhbmdlJztcbiAgZWxldmF0aW9uU2NhbGU6ICdlbGV2YXRpb25TY2FsZSc7XG4gIGVuYWJsZUVsZXZhdGlvblpvb21GYWN0b3I6ICdlbmFibGVFbGV2YXRpb25ab29tRmFjdG9yJztcbn0gPSB7XG4gIGNvbG9yUmFuZ2U6ICdjb2xvclJhbmdlJyxcbiAgZmlsbGVkOiB7XG4gICAgLi4uTEFZRVJfVklTX0NPTkZJR1MuZmlsbGVkLFxuICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZVxuICB9LFxuICBvcGFjaXR5OiB7XG4gICAgLi4uTEFZRVJfVklTX0NPTkZJR1Mub3BhY2l0eSxcbiAgICBsYWJlbDogJ0ZpbGwgT3BhY2l0eScsXG4gICAgcmFuZ2U6IFswLCAxXSxcbiAgICBwcm9wZXJ0eTogJ29wYWNpdHknXG4gIH0sXG4gIG91dGxpbmU6ICdvdXRsaW5lJyxcbiAgc3Ryb2tlQ29sb3I6ICdzdHJva2VDb2xvcicsXG4gIHN0cm9rZUNvbG9yUmFuZ2U6ICdzdHJva2VDb2xvclJhbmdlJyxcbiAgc3Ryb2tlT3BhY2l0eToge1xuICAgIC4uLkxBWUVSX1ZJU19DT05GSUdTLm9wYWNpdHksXG4gICAgbGFiZWw6ICdTdHJva2UgT3BhY2l0eScsXG4gICAgcmFuZ2U6IFswLCAxXSxcbiAgICBwcm9wZXJ0eTogJ3N0cm9rZU9wYWNpdHknXG4gIH0sXG4gIHRoaWNrbmVzczogJ3RoaWNrbmVzcycsXG4gIGNvdmVyYWdlOiAnY292ZXJhZ2UnLFxuICBlbmFibGUzZDogJ2VuYWJsZTNkJyxcbiAgc2l6ZVJhbmdlOiAnZWxldmF0aW9uUmFuZ2UnLFxuICBjb3ZlcmFnZVJhbmdlOiAnY292ZXJhZ2VSYW5nZScsXG4gIGVsZXZhdGlvblNjYWxlOiAnZWxldmF0aW9uU2NhbGUnLFxuICBlbmFibGVFbGV2YXRpb25ab29tRmFjdG9yOiAnZW5hYmxlRWxldmF0aW9uWm9vbUZhY3Rvcidcbn07XG5cbmNvbnN0IGJydXNoaW5nRXh0ZW5zaW9uID0gbmV3IEJydXNoaW5nRXh0ZW5zaW9uKCk7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIZXhhZ29uSWRMYXllciBleHRlbmRzIExheWVyIHtcbiAgZGF0YVRvRmVhdHVyZToge2NlbnRyb2lkczogQ2VudHJvaWRbXX07XG5cbiAgZGVjbGFyZSBjb25maWc6IEhleGFnb25JZExheWVyQ29uZmlnO1xuICBkZWNsYXJlIHZpc0NvbmZpZ1NldHRpbmdzOiBIZXhhZ29uSWRMYXllclZpc0NvbmZpZ1NldHRpbmdzO1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICB0aGlzLmRhdGFUb0ZlYXR1cmUgPSB7Y2VudHJvaWRzOiBbXX07XG4gICAgdGhpcy5yZWdpc3RlclZpc0NvbmZpZyhIZXhhZ29uSWRWaXNDb25maWdzKTtcbiAgICB0aGlzLmdldFBvc2l0aW9uQWNjZXNzb3IgPSAoZGF0YUNvbnRhaW5lcjogRGF0YUNvbnRhaW5lckludGVyZmFjZSkgPT5cbiAgICAgIGhleElkQWNjZXNzb3IodGhpcy5jb25maWcuY29sdW1ucykoZGF0YUNvbnRhaW5lcik7XG4gIH1cblxuICBnZXQgdHlwZSgpOiAnaGV4YWdvbklkJyB7XG4gICAgcmV0dXJuICdoZXhhZ29uSWQnO1xuICB9XG5cbiAgZ2V0IG5hbWUoKTogJ0gzJyB7XG4gICAgcmV0dXJuICdIMyc7XG4gIH1cblxuICBnZXQgcmVxdWlyZWRMYXllckNvbHVtbnMoKSB7XG4gICAgcmV0dXJuIGhleElkUmVxdWlyZWRDb2x1bW5zO1xuICB9XG5cbiAgZ2V0IGxheWVySWNvbigpIHtcbiAgICAvLyB1c2UgaGV4YWdvbiBsYXllciBpY29uIGZvciBub3dcbiAgICByZXR1cm4gSDNIZXhhZ29uTGF5ZXJJY29uO1xuICB9XG5cbiAgZ2V0IHZpc3VhbENoYW5uZWxzKCkge1xuICAgIGNvbnN0IHZpc3VhbENoYW5uZWxzID0gc3VwZXIudmlzdWFsQ2hhbm5lbHM7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbG9yOiB7XG4gICAgICAgIC4uLnZpc3VhbENoYW5uZWxzLmNvbG9yLFxuICAgICAgICBhY2Nlc3NvcjogJ2dldEZpbGxDb2xvcicsXG4gICAgICAgIGNvbmRpdGlvbjogY29uZmlnID0+IGNvbmZpZy52aXNDb25maWcuZmlsbGVkXG4gICAgICB9LFxuICAgICAgc3Ryb2tlQ29sb3I6IHtcbiAgICAgICAgcHJvcGVydHk6ICdzdHJva2VDb2xvcicsXG4gICAgICAgIGtleTogJ3N0cm9rZUNvbG9yJyxcbiAgICAgICAgZmllbGQ6ICdzdHJva2VDb2xvckZpZWxkJyxcbiAgICAgICAgc2NhbGU6ICdzdHJva2VDb2xvclNjYWxlJyxcbiAgICAgICAgZG9tYWluOiAnc3Ryb2tlQ29sb3JEb21haW4nLFxuICAgICAgICByYW5nZTogJ3N0cm9rZUNvbG9yUmFuZ2UnLFxuICAgICAgICBjaGFubmVsU2NhbGVUeXBlOiBDSEFOTkVMX1NDQUxFUy5jb2xvcixcbiAgICAgICAgYWNjZXNzb3I6ICdnZXRMaW5lQ29sb3InLFxuICAgICAgICBjb25kaXRpb246IGNvbmZpZyA9PiBjb25maWcudmlzQ29uZmlnLm91dGxpbmUsXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogY29uZmlnID0+IGNvbmZpZy52aXNDb25maWcuc3Ryb2tlQ29sb3IgfHwgY29uZmlnLmNvbG9yXG4gICAgICB9LFxuICAgICAgc2l6ZToge1xuICAgICAgICAuLi52aXN1YWxDaGFubmVscy5zaXplLFxuICAgICAgICBwcm9wZXJ0eTogJ2hlaWdodCcsXG4gICAgICAgIGFjY2Vzc29yOiAnZ2V0RWxldmF0aW9uJyxcbiAgICAgICAgbnVsbFZhbHVlOiAwLFxuICAgICAgICBjb25kaXRpb246IGNvbmZpZyA9PiBjb25maWcudmlzQ29uZmlnLmVuYWJsZTNkLFxuICAgICAgICBkZWZhdWx0VmFsdWU6IGRlZmF1bHRFbGV2YXRpb25cbiAgICAgIH0sXG4gICAgICBjb3ZlcmFnZToge1xuICAgICAgICBwcm9wZXJ0eTogJ2NvdmVyYWdlJyxcbiAgICAgICAgZmllbGQ6ICdjb3ZlcmFnZUZpZWxkJyxcbiAgICAgICAgc2NhbGU6ICdjb3ZlcmFnZVNjYWxlJyxcbiAgICAgICAgZG9tYWluOiAnY292ZXJhZ2VEb21haW4nLFxuICAgICAgICByYW5nZTogJ2NvdmVyYWdlUmFuZ2UnLFxuICAgICAgICBrZXk6ICdjb3ZlcmFnZScsXG4gICAgICAgIGNoYW5uZWxTY2FsZVR5cGU6IENIQU5ORUxfU0NBTEVTLnJhZGl1cyxcbiAgICAgICAgYWNjZXNzb3I6ICdnZXRDb3ZlcmFnZScsXG4gICAgICAgIG51bGxWYWx1ZTogMCxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiBkZWZhdWx0Q292ZXJhZ2VcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgc2V0SW5pdGlhbExheWVyQ29uZmlnKGRhdGFzZXQpIHtcbiAgICBpZiAoIWRhdGFzZXQuZGF0YUNvbnRhaW5lci5udW1Sb3dzKCkpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBjb25zdCBkZWZhdWx0Q29sb3JGaWVsZCA9IGZpbmREZWZhdWx0Q29sb3JGaWVsZChkYXRhc2V0KTtcblxuICAgIGlmIChkZWZhdWx0Q29sb3JGaWVsZCkge1xuICAgICAgdGhpcy51cGRhdGVMYXllckNvbmZpZzxIZXhhZ29uSWRMYXllckNvbmZpZz4oe1xuICAgICAgICBjb2xvckZpZWxkOiBkZWZhdWx0Q29sb3JGaWVsZFxuICAgICAgfSk7XG4gICAgICB0aGlzLnVwZGF0ZUxheWVyVmlzdWFsQ2hhbm5lbChkYXRhc2V0LCAnY29sb3InKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHN0YXRpYyBmaW5kRGVmYXVsdExheWVyUHJvcHMoe2ZpZWxkcyA9IFtdLCBkYXRhQ29udGFpbmVyLCBsYWJlbH06IEtlcGxlclRhYmxlKSB7XG4gICAgY29uc3QgaGV4RmllbGRzID0gZ2V0SGV4RmllbGRzKGZpZWxkcywgZGF0YUNvbnRhaW5lcik7XG4gICAgaWYgKCFoZXhGaWVsZHMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4ge3Byb3BzOiBbXX07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb3BzOiBoZXhGaWVsZHMubWFwKGYgPT4gKHtcbiAgICAgICAgaXNWaXNpYmxlOiB0cnVlLFxuICAgICAgICAvLyBkZWZhdWx0IGxheWVyIG5hbWUgc2hvdWxkIGJlIGRhdGFzZXQgbmFtZVxuICAgICAgICBsYWJlbCxcbiAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgIGhleF9pZDoge1xuICAgICAgICAgICAgdmFsdWU6IGYubmFtZSxcbiAgICAgICAgICAgIGZpZWxkSWR4OiBmaWVsZHMuZmluZEluZGV4KGZpZCA9PiBmaWQubmFtZSA9PT0gZi5uYW1lKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSkpXG4gICAgfTtcbiAgfVxuXG4gIGdldERlZmF1bHRMYXllckNvbmZpZyhwcm9wczogTGF5ZXJCYXNlQ29uZmlnUGFydGlhbCkge1xuICAgIGNvbnN0IGRlZmF1bHRMYXllckNvbmZpZyA9IHN1cGVyLmdldERlZmF1bHRMYXllckNvbmZpZyhwcm9wcyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uZGVmYXVsdExheWVyQ29uZmlnLFxuXG4gICAgICAvLyBhZGQgc3Ryb2tlIGNvbG9yIHZpc3VhbCBjaGFubmVsXG4gICAgICBzdHJva2VDb2xvckZpZWxkOiBudWxsLFxuICAgICAgc3Ryb2tlQ29sb3JEb21haW46IFswLCAxXSxcbiAgICAgIHN0cm9rZUNvbG9yU2NhbGU6ICdxdWFudGlsZScsXG4gICAgICBjb2xvclVJOiB7XG4gICAgICAgIC4uLmRlZmF1bHRMYXllckNvbmZpZy5jb2xvclVJLFxuICAgICAgICBzdHJva2VDb2xvclJhbmdlOiBERUZBVUxUX0NPTE9SX1VJXG4gICAgICB9LFxuXG4gICAgICAvLyBhZGQgcmFkaXVzIHZpc3VhbCBjaGFubmVsXG4gICAgICBjb3ZlcmFnZUZpZWxkOiBudWxsLFxuICAgICAgY292ZXJhZ2VEb21haW46IFswLCAxXSxcbiAgICAgIGNvdmVyYWdlU2NhbGU6ICdsaW5lYXInLFxuXG4gICAgICAvLyBtb2RpZnkgZGVmYXVsdCB0ZXh0TGFiZWwgYW5jaG9yIHBvc2l0aW9uIHRvIGJlIGFwcHJvcHJpYXRlIGZvciBhIGhleGFnb24gc2hhcGVcbiAgICAgIHRleHRMYWJlbDogW1xuICAgICAgICB7XG4gICAgICAgICAgLi4uREVGQVVMVF9URVhUX0xBQkVMLFxuICAgICAgICAgIGFuY2hvcjogJ21pZGRsZSdcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH07XG4gIH1cblxuICBjYWxjdWxhdGVEYXRhQXR0cmlidXRlKHtkYXRhQ29udGFpbmVyLCBmaWx0ZXJlZEluZGV4fTogS2VwbGVyVGFibGUsIGdldEhleElkKSB7XG4gICAgY29uc3QgZGF0YTogSGV4YWdvbklkTGF5ZXJEYXRhW10gPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsdGVyZWRJbmRleC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgaW5kZXggPSBmaWx0ZXJlZEluZGV4W2ldO1xuICAgICAgY29uc3QgaWQgPSBnZXRIZXhJZCh7aW5kZXh9KTtcbiAgICAgIGNvbnN0IGNlbnRyb2lkID0gdGhpcy5kYXRhVG9GZWF0dXJlLmNlbnRyb2lkc1tpbmRleF07XG5cbiAgICAgIGlmIChjZW50cm9pZCkge1xuICAgICAgICBkYXRhLnB1c2goe1xuICAgICAgICAgIGluZGV4LFxuICAgICAgICAgIGlkLFxuICAgICAgICAgIGNlbnRyb2lkXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIC8vIFRPRE86IGZpeCBjb21wbGV4aXR5XG4gIC8qIGVzbGludC1kaXNhYmxlIGNvbXBsZXhpdHkgKi9cbiAgZm9ybWF0TGF5ZXJEYXRhKGRhdGFzZXRzLCBvbGRMYXllckRhdGEsIG9wdCA9IHt9KSB7XG4gICAgaWYgKHRoaXMuY29uZmlnLmRhdGFJZCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICBjb25zdCB7Z3B1RmlsdGVyLCBkYXRhQ29udGFpbmVyfSA9IGRhdGFzZXRzW3RoaXMuY29uZmlnLmRhdGFJZF07XG4gICAgY29uc3QgZ2V0SGV4SWQgPSB0aGlzLmdldFBvc2l0aW9uQWNjZXNzb3IoZGF0YUNvbnRhaW5lcik7XG4gICAgY29uc3Qge2RhdGEsIHRyaWdnZXJDaGFuZ2VkfSA9IHRoaXMudXBkYXRlRGF0YShkYXRhc2V0cywgb2xkTGF5ZXJEYXRhKTtcbiAgICBjb25zdCBhY2Nlc3NvcnMgPSB0aGlzLmdldEF0dHJpYnV0ZUFjY2Vzc29ycyh7ZGF0YUNvbnRhaW5lcn0pO1xuICAgIGNvbnN0IHt0ZXh0TGFiZWx9ID0gdGhpcy5jb25maWc7XG5cbiAgICAvLyBnZXQgYWxsIGRpc3RpbmN0IGNoYXJhY3RlcnMgaW4gdGhlIHRleHQgbGFiZWxzXG4gICAgY29uc3QgdGV4dExhYmVscyA9IGZvcm1hdFRleHRMYWJlbERhdGEoe1xuICAgICAgdGV4dExhYmVsLFxuICAgICAgdHJpZ2dlckNoYW5nZWQsXG4gICAgICBvbGRMYXllckRhdGEsXG4gICAgICBkYXRhLFxuICAgICAgZGF0YUNvbnRhaW5lclxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGEsXG4gICAgICBnZXRIZXhJZCxcbiAgICAgIGdldEZpbHRlclZhbHVlOiBncHVGaWx0ZXIuZmlsdGVyVmFsdWVBY2Nlc3NvcihkYXRhQ29udGFpbmVyKSgpLFxuICAgICAgdGV4dExhYmVscyxcbiAgICAgIGdldFBvc2l0aW9uOiBkID0+IGQuY2VudHJvaWQsXG4gICAgICAuLi5hY2Nlc3NvcnNcbiAgICB9O1xuICB9XG4gIC8qIGVzbGludC1lbmFibGUgY29tcGxleGl0eSAqL1xuXG4gIHVwZGF0ZUxheWVyTWV0YShkYXRhQ29udGFpbmVyLCBnZXRIZXhJZCkge1xuICAgIGNvbnN0IGNlbnRyb2lkcyA9IGRhdGFDb250YWluZXIubWFwKChkLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgaWQgPSBnZXRIZXhJZCh7aW5kZXh9KTtcbiAgICAgIGlmICghaDNJc1ZhbGlkKGlkKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIC8vIHNhdmUgYSByZWZlcmVuY2Ugb2YgY2VudHJvaWRzIHRvIGRhdGFUb0ZlYXR1cmVcbiAgICAgIC8vIHNvIHdlIGRvbid0IGhhdmUgdG8gcmUgY2FsY3VsYXRlIGl0IGFnYWluXG4gICAgICByZXR1cm4gZ2V0Q2VudHJvaWQoe2lkfSk7XG4gICAgfSwgdHJ1ZSk7XG5cbiAgICBjb25zdCBjZW50cm9pZHNEYXRhQ29udGFpbmVyID0gY3JlYXRlRGF0YUNvbnRhaW5lcihjZW50cm9pZHMpO1xuXG4gICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRQb2ludHNCb3VuZHMoXG4gICAgICBjZW50cm9pZHNEYXRhQ29udGFpbmVyLFxuICAgICAgKGQ6IGFueSwgZGM6IERhdGFDb250YWluZXJJbnRlcmZhY2UpID0+IHtcbiAgICAgICAgcmV0dXJuIFtkYy52YWx1ZUF0KGQuaW5kZXgsIDApLCBkYy52YWx1ZUF0KGQuaW5kZXgsIDEpXTtcbiAgICAgIH1cbiAgICApO1xuICAgIHRoaXMuZGF0YVRvRmVhdHVyZSA9IHtjZW50cm9pZHN9O1xuICAgIHRoaXMudXBkYXRlTWV0YSh7Ym91bmRzfSk7XG4gIH1cblxuICByZW5kZXJMYXllcihvcHRzKSB7XG4gICAgY29uc3Qge2RhdGEsIGdwdUZpbHRlciwgb2JqZWN0SG92ZXJlZCwgbWFwU3RhdGUsIGludGVyYWN0aW9uQ29uZmlnfSA9IG9wdHM7XG5cbiAgICBjb25zdCB6b29tRmFjdG9yID0gdGhpcy5nZXRab29tRmFjdG9yKG1hcFN0YXRlKTtcbiAgICBjb25zdCBlbGVab29tRmFjdG9yID0gdGhpcy5nZXRFbGV2YXRpb25ab29tRmFjdG9yKG1hcFN0YXRlKTtcbiAgICBjb25zdCB7Y29uZmlnfSA9IHRoaXM7XG4gICAgY29uc3Qge3Zpc0NvbmZpZ30gPSBjb25maWc7XG4gICAgY29uc3QgdXBkYXRlVHJpZ2dlcnMgPSB0aGlzLmdldFZpc3VhbENoYW5uZWxVcGRhdGVUcmlnZ2VycygpO1xuXG4gICAgY29uc3QgaDNIZXhhZ29uTGF5ZXJUcmlnZ2VycyA9IHtcbiAgICAgIGdldEhleGFnb246IHRoaXMuY29uZmlnLmNvbHVtbnMsXG4gICAgICBnZXRGaWxsQ29sb3I6IHVwZGF0ZVRyaWdnZXJzLmdldEZpbGxDb2xvcixcbiAgICAgIGdldExpbmVDb2xvcjogdXBkYXRlVHJpZ2dlcnMuZ2V0TGluZUNvbG9yLFxuICAgICAgZ2V0RWxldmF0aW9uOiB1cGRhdGVUcmlnZ2Vycy5nZXRFbGV2YXRpb24sXG4gICAgICBnZXRGaWx0ZXJWYWx1ZTogZ3B1RmlsdGVyLmZpbHRlclZhbHVlVXBkYXRlVHJpZ2dlcnNcbiAgICB9O1xuXG4gICAgY29uc3QgY29sdW1uTGF5ZXJUcmlnZ2VycyA9IHtcbiAgICAgIGdldENvdmVyYWdlOiB1cGRhdGVUcmlnZ2Vycy5nZXRDb3ZlcmFnZVxuICAgIH07XG5cbiAgICBjb25zdCBkZWZhdWx0TGF5ZXJQcm9wcyA9IHRoaXMuZ2V0RGVmYXVsdERlY2tMYXllclByb3BzKG9wdHMpO1xuICAgIGNvbnN0IGhvdmVyZWRPYmplY3QgPSB0aGlzLmhhc0hvdmVyZWRPYmplY3Qob2JqZWN0SG92ZXJlZCk7XG5cbiAgICAvLyBnZXRQaXhlbE9mZnNldCB3aXRoIG5vIHJhZGl1c1xuICAgIGNvbnN0IHJhZGl1c1NjYWxlID0gMS4wO1xuICAgIGNvbnN0IGdldFJhaWR1cyA9IG51bGw7XG4gICAgY29uc3QgZ2V0UGl4ZWxPZmZzZXQgPSBnZXRUZXh0T2Zmc2V0QnlSYWRpdXMocmFkaXVzU2NhbGUsIGdldFJhaWR1cywgbWFwU3RhdGUpO1xuXG4gICAgY29uc3QgYnJ1c2hpbmdQcm9wcyA9IHRoaXMuZ2V0QnJ1c2hpbmdFeHRlbnNpb25Qcm9wcyhpbnRlcmFjdGlvbkNvbmZpZyk7XG4gICAgY29uc3QgZXh0ZW5zaW9ucyA9IFsuLi5kZWZhdWx0TGF5ZXJQcm9wcy5leHRlbnNpb25zLCBicnVzaGluZ0V4dGVuc2lvbl07XG4gICAgY29uc3Qgc2hhcmVkUHJvcHMgPSB7XG4gICAgICBnZXRGaWx0ZXJWYWx1ZTogZGF0YS5nZXRGaWx0ZXJWYWx1ZSxcbiAgICAgIGV4dGVuc2lvbnMsXG4gICAgICBmaWx0ZXJSYW5nZTogZGVmYXVsdExheWVyUHJvcHMuZmlsdGVyUmFuZ2UsXG4gICAgICB2aXNpYmxlOiBkZWZhdWx0TGF5ZXJQcm9wcy52aXNpYmxlLFxuICAgICAgLi4uYnJ1c2hpbmdQcm9wc1xuICAgIH07XG5cbiAgICByZXR1cm4gW1xuICAgICAgbmV3IEgzSGV4YWdvbkxheWVyKHtcbiAgICAgICAgLi4uZGVmYXVsdExheWVyUHJvcHMsXG4gICAgICAgIC4uLmRhdGEsXG4gICAgICAgIC4uLmJydXNoaW5nUHJvcHMsXG4gICAgICAgIGV4dGVuc2lvbnMsXG4gICAgICAgIHdyYXBMb25naXR1ZGU6IGZhbHNlLFxuXG4gICAgICAgIGZpbGxlZDogdmlzQ29uZmlnLmZpbGxlZCxcbiAgICAgICAgc3Ryb2tlZDogdmlzQ29uZmlnLm91dGxpbmUsXG4gICAgICAgIGxpbmVXaWR0aFNjYWxlOiB2aXNDb25maWcudGhpY2tuZXNzLFxuXG4gICAgICAgIGdldEhleGFnb246ICh4OiBhbnkpID0+IHguaWQsXG5cbiAgICAgICAgLy8gY292ZXJhZ2VcbiAgICAgICAgY292ZXJhZ2U6IGNvbmZpZy5jb3ZlcmFnZUZpZWxkID8gMSA6IHZpc0NvbmZpZy5jb3ZlcmFnZSxcblxuICAgICAgICAvLyBoaWdobGlnaHRcbiAgICAgICAgYXV0b0hpZ2hsaWdodDogdmlzQ29uZmlnLmVuYWJsZTNkLFxuICAgICAgICBoaWdobGlnaHRDb2xvcjogSElHSExJR0hfQ09MT1JfM0QsXG5cbiAgICAgICAgLy8gZWxldmF0aW9uXG4gICAgICAgIGV4dHJ1ZGVkOiB2aXNDb25maWcuZW5hYmxlM2QsXG4gICAgICAgIGVsZXZhdGlvblNjYWxlOiB2aXNDb25maWcuZWxldmF0aW9uU2NhbGUgKiBlbGVab29tRmFjdG9yLFxuXG4gICAgICAgIC8vIHJlbmRlclxuICAgICAgICB1cGRhdGVUcmlnZ2VyczogaDNIZXhhZ29uTGF5ZXJUcmlnZ2VycyxcbiAgICAgICAgX3N1YkxheWVyUHJvcHM6IHtcbiAgICAgICAgICAnaGV4YWdvbi1jZWxsJzoge1xuICAgICAgICAgICAgdHlwZTogRW5oYW5jZWRDb2x1bW5MYXllcixcbiAgICAgICAgICAgIGdldENvdmVyYWdlOiBkYXRhLmdldENvdmVyYWdlLFxuICAgICAgICAgICAgdXBkYXRlVHJpZ2dlcnM6IGNvbHVtbkxheWVyVHJpZ2dlcnMsXG4gICAgICAgICAgICBzdHJva2VPcGFjaXR5OiB2aXNDb25maWcuc3Ryb2tlT3BhY2l0eVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSksXG4gICAgICAvLyBob3ZlciBsYXllclxuICAgICAgLi4uKGhvdmVyZWRPYmplY3QgJiYgIWNvbmZpZy5zaXplRmllbGRcbiAgICAgICAgPyBbXG4gICAgICAgICAgICBuZXcgR2VvSnNvbkxheWVyKHtcbiAgICAgICAgICAgICAgLi4udGhpcy5nZXREZWZhdWx0SG92ZXJMYXllclByb3BzKCksXG4gICAgICAgICAgICAgIHZpc2libGU6IGRlZmF1bHRMYXllclByb3BzLnZpc2libGUsXG4gICAgICAgICAgICAgIGRhdGE6IFtpZFRvUG9seWdvbkdlbyhob3ZlcmVkT2JqZWN0KV0sXG4gICAgICAgICAgICAgIGdldExpbmVDb2xvcjogY29uZmlnLmhpZ2hsaWdodENvbG9yLFxuICAgICAgICAgICAgICBsaW5lV2lkdGhTY2FsZTogREVGQVVMVF9MSU5FX1NDQUxFX1ZBTFVFICogem9vbUZhY3RvcixcbiAgICAgICAgICAgICAgd3JhcExvbmdpdHVkZTogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgXVxuICAgICAgICA6IFtdKSxcbiAgICAgIC8vIHRleHQgbGFiZWwgbGF5ZXJcbiAgICAgIC4uLnRoaXMucmVuZGVyVGV4dExhYmVsTGF5ZXIoXG4gICAgICAgIHtcbiAgICAgICAgICBnZXRQb3NpdGlvbjogZGF0YS5nZXRQb3NpdGlvbixcbiAgICAgICAgICBzaGFyZWRQcm9wcyxcbiAgICAgICAgICBnZXRQaXhlbE9mZnNldCxcbiAgICAgICAgICB1cGRhdGVUcmlnZ2Vyc1xuICAgICAgICB9LFxuICAgICAgICBvcHRzXG4gICAgICApXG4gICAgXTtcbiAgfVxufVxuIl19