"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireWildcard(require("styled-components"));

var _classnames = _interopRequireDefault(require("classnames"));

var _momentTimezone = _interopRequireDefault(require("moment-timezone"));

var _itemSelector = _interopRequireDefault(require("../common/item-selector/item-selector"));

var _styledComponents2 = require("../common/styled-components");

var _dropdownList = require("../common/item-selector/dropdown-list");

var _templateObject, _templateObject2, _templateObject3, _templateObject4;

var HEADER_ITEM_ID = 'HEADER_ITEM_ID';

var StyledEffectTimeSelector = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  .item-selector {\n    background-color: transparent;\n  }\n  .item-selector .item-selector__dropdown {\n    padding: 0px;\n    width: 110px;\n    height: 30px;\n  }\n  border: 1px solid ", ";\n  border-radius: 4px;\n  :hover {\n    border: 1px solid ", ";\n  }\n  .active {\n    border: 1px solid ", ";\n    border-radius: 4px 4px 0px 0px;\n  }\n"])), function (props) {
  return props.theme.inputBgd;
}, function (props) {
  return props.theme.inputBgdHover;
}, function (props) {
  return props.theme.activeColor;
});

var StyledLabel = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n  font-size: ", ";\n  height: 13px;\n  display: flex;\n  align-items: center;\n"])), function (props) {
  return props.theme.effectPanelTextMain;
}, function (props) {
  return props.theme.inputFontSize;
});

var DropdownListWrapper = _styledComponents["default"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  ", ";\n  background-color: ", ";\n  display: flex;\n  flex-wrap: wrap;\n  padding: 0px;\n  max-height: 160px;\n  border-radius: 0px 0px 4px 4px;\n"])), function (props) {
  return props.theme.dropdownList;
}, function (props) {
  return props.theme.inputBgdHover;
});

var StyledDropdownListItem = _styledComponents["default"].div(_templateObject4 || (_templateObject4 = (0, _taggedTemplateLiteral2["default"])(["\n  padding: 10px 5px 9px 10px;\n  width: 100%;\n  :hover {\n    background-color: ", ";\n    cursor: pointer;\n  }\n"])), function (props) {
  return props.theme.effectPanelElementColorSelected;
}); // Generate time options for the dropdown with 30 min intervals.


var timeOptions = function () {
  var m = (0, _momentTimezone["default"])().utcOffset(0);
  m.set({
    hour: 12,
    minute: 0,
    second: 0,
    millisecond: 0
  });
  var out = [];

  for (var i = 0; i < 48; i++) {
    out.push({
      name: m.format('hh:mm A'),
      id: m.format('HH:mm')
    });
    m.add(30, 'minutes');
  }

  return out;
}();

var getDisplayOption = function getDisplayOption(op) {
  return op.name;
};

var getOptionValue = function getOptionValue(op) {
  return op.id;
};
/**
 * A component to render TimePicker as the header for the dropdown component.
 */


var EffectTimeListItem = function EffectTimeListItem(_ref) {
  var value = _ref.value;

  if ((value === null || value === void 0 ? void 0 : value.id) === HEADER_ITEM_ID) {
    return /*#__PURE__*/_react["default"].createElement(_styledComponents2.StyledTimePicker, {
      value: value.value,
      onChange: value.onChange,
      onClick: value.onClick,
      disableClock: true,
      format: 'hh:mm a'
    });
  }

  return /*#__PURE__*/_react["default"].createElement(StyledLabel, null, value.name);
};

var EffectTimeDropdownList = function EffectTimeDropdownList(_ref2) {
  var onOptionSelected = _ref2.onOptionSelected,
      options = _ref2.options,
      selectionIndex = _ref2.selectionIndex,
      customListItemComponent = _ref2.customListItemComponent;
  var onSelectOption = (0, _react.useCallback)(function (e, value) {
    e.preventDefault();
    onOptionSelected(value);
  }, [onOptionSelected]);
  var ListItemComponent = customListItemComponent;
  return /*#__PURE__*/_react["default"].createElement(DropdownListWrapper, {
    className: _dropdownList.classList.list
  }, options.map(function (value, i) {
    return /*#__PURE__*/_react["default"].createElement(StyledDropdownListItem, {
      className: (0, _classnames["default"])('effect-type-selector__item', {
        hover: selectionIndex === i
      }),
      key: "".concat(value.id, "_").concat(i),
      onMouseDown: function onMouseDown(e) {
        return onSelectOption(e, value);
      },
      onClick: function onClick(e) {
        return onSelectOption(e, value);
      }
    }, /*#__PURE__*/_react["default"].createElement(ListItemComponent, {
      value: value
    }));
  }));
};

EffectTimeSelectorFactory.deps = [];

function EffectTimeSelectorFactory() {
  var EffectTimeSelector = function EffectTimeSelector(_ref3) {
    var value = _ref3.value,
        onChange = _ref3.onChange;
    // Selected item is rendered as TimePicker in EffectTimeListItem
    var selectedItems = (0, _react.useMemo)(function () {
      return [{
        id: HEADER_ITEM_ID,
        value: value,
        onChange: onChange,
        onClick: function onClick(e) {
          var _e$target;

          // DatePicker is used as custom header.
          // Don't open the dropdown when the user is editing time values directly.
          var name = e === null || e === void 0 ? void 0 : (_e$target = e.target) === null || _e$target === void 0 ? void 0 : _e$target.name;

          if (name === 'hour12' || name === 'minute' || name === 'amPm') {
            e.stopPropagation();
          }
        }
      }];
    }, [value, onChange]);
    return /*#__PURE__*/_react["default"].createElement(StyledEffectTimeSelector, null, /*#__PURE__*/_react["default"].createElement(_itemSelector["default"], {
      selectedItems: selectedItems,
      options: timeOptions,
      multiSelect: false,
      searchable: false,
      placeholder: "",
      filterOption: "name",
      onChange: onChange,
      getOptionValue: getOptionValue,
      displayOption: getDisplayOption,
      DropDownLineItemRenderComponent: EffectTimeListItem,
      DropDownRenderComponent: EffectTimeDropdownList
    }));
  };

  return (0, _styledComponents.withTheme)(EffectTimeSelector);
}

var _default = EffectTimeSelectorFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lZmZlY3RzL2VmZmVjdC10aW1lLXNlbGVjdG9yLnRzeCJdLCJuYW1lcyI6WyJIRUFERVJfSVRFTV9JRCIsIlN0eWxlZEVmZmVjdFRpbWVTZWxlY3RvciIsInN0eWxlZCIsImRpdiIsInByb3BzIiwidGhlbWUiLCJpbnB1dEJnZCIsImlucHV0QmdkSG92ZXIiLCJhY3RpdmVDb2xvciIsIlN0eWxlZExhYmVsIiwiZWZmZWN0UGFuZWxUZXh0TWFpbiIsImlucHV0Rm9udFNpemUiLCJEcm9wZG93bkxpc3RXcmFwcGVyIiwiZHJvcGRvd25MaXN0IiwiU3R5bGVkRHJvcGRvd25MaXN0SXRlbSIsImVmZmVjdFBhbmVsRWxlbWVudENvbG9yU2VsZWN0ZWQiLCJ0aW1lT3B0aW9ucyIsIm0iLCJ1dGNPZmZzZXQiLCJzZXQiLCJob3VyIiwibWludXRlIiwic2Vjb25kIiwibWlsbGlzZWNvbmQiLCJvdXQiLCJpIiwicHVzaCIsIm5hbWUiLCJmb3JtYXQiLCJpZCIsImFkZCIsImdldERpc3BsYXlPcHRpb24iLCJvcCIsImdldE9wdGlvblZhbHVlIiwiRWZmZWN0VGltZUxpc3RJdGVtIiwidmFsdWUiLCJvbkNoYW5nZSIsIm9uQ2xpY2siLCJFZmZlY3RUaW1lRHJvcGRvd25MaXN0Iiwib25PcHRpb25TZWxlY3RlZCIsIm9wdGlvbnMiLCJzZWxlY3Rpb25JbmRleCIsImN1c3RvbUxpc3RJdGVtQ29tcG9uZW50Iiwib25TZWxlY3RPcHRpb24iLCJlIiwicHJldmVudERlZmF1bHQiLCJMaXN0SXRlbUNvbXBvbmVudCIsImNsYXNzTGlzdCIsImxpc3QiLCJtYXAiLCJob3ZlciIsIkVmZmVjdFRpbWVTZWxlY3RvckZhY3RvcnkiLCJkZXBzIiwiRWZmZWN0VGltZVNlbGVjdG9yIiwic2VsZWN0ZWRJdGVtcyIsInRhcmdldCIsInN0b3BQcm9wYWdhdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNB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QSxXQUFXLEVBQUMsRUFMZDtBQU1FLE1BQUEsWUFBWSxFQUFDLE1BTmY7QUFPRSxNQUFBLFFBQVEsRUFBRW9CLFFBUFo7QUFRRSxNQUFBLGNBQWMsRUFBRUgsY0FSbEI7QUFTRSxNQUFBLGFBQWEsRUFBRUYsZ0JBVGpCO0FBVUUsTUFBQSwrQkFBK0IsRUFBRUcsa0JBVm5DO0FBV0UsTUFBQSx1QkFBdUIsRUFBRUk7QUFYM0IsTUFERixDQURGO0FBaUJELEdBeENEOztBQTBDQSxTQUFPLGlDQUFVZSxrQkFBVixDQUFQO0FBQ0Q7O2VBRWNGLHlCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IFJlYWN0LCB7dXNlTWVtbywgdXNlQ2FsbGJhY2t9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHt3aXRoVGhlbWV9IGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQtdGltZXpvbmUnO1xuXG5pbXBvcnQgSXRlbVNlbGVjdG9yIGZyb20gJy4uL2NvbW1vbi9pdGVtLXNlbGVjdG9yL2l0ZW0tc2VsZWN0b3InO1xuaW1wb3J0IHtTdHlsZWRUaW1lUGlja2VyfSBmcm9tICcuLi9jb21tb24vc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHtjbGFzc0xpc3R9IGZyb20gJy4uL2NvbW1vbi9pdGVtLXNlbGVjdG9yL2Ryb3Bkb3duLWxpc3QnO1xuXG5jb25zdCBIRUFERVJfSVRFTV9JRCA9ICdIRUFERVJfSVRFTV9JRCc7XG5cbmV4cG9ydCB0eXBlIEVmZmVjdFRpbWVTZWxlY3RvclByb3BzID0ge1xuICB2YWx1ZTogc3RyaW5nO1xuICBvbkNoYW5nZTogKHN0cmluZykgPT4gdm9pZDtcbiAgdGhlbWU/OiBhbnk7XG59O1xuXG5jb25zdCBTdHlsZWRFZmZlY3RUaW1lU2VsZWN0b3IgPSBzdHlsZWQuZGl2YFxuICAuaXRlbS1zZWxlY3RvciB7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XG4gIH1cbiAgLml0ZW0tc2VsZWN0b3IgLml0ZW0tc2VsZWN0b3JfX2Ryb3Bkb3duIHtcbiAgICBwYWRkaW5nOiAwcHg7XG4gICAgd2lkdGg6IDExMHB4O1xuICAgIGhlaWdodDogMzBweDtcbiAgfVxuICBib3JkZXI6IDFweCBzb2xpZCAke3Byb3BzID0+IHByb3BzLnRoZW1lLmlucHV0QmdkfTtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICA6aG92ZXIge1xuICAgIGJvcmRlcjogMXB4IHNvbGlkICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuaW5wdXRCZ2RIb3Zlcn07XG4gIH1cbiAgLmFjdGl2ZSB7XG4gICAgYm9yZGVyOiAxcHggc29saWQgJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5hY3RpdmVDb2xvcn07XG4gICAgYm9yZGVyLXJhZGl1czogNHB4IDRweCAwcHggMHB4O1xuICB9XG5gO1xuXG5jb25zdCBTdHlsZWRMYWJlbCA9IHN0eWxlZC5kaXZgXG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmVmZmVjdFBhbmVsVGV4dE1haW59O1xuICBmb250LXNpemU6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuaW5wdXRGb250U2l6ZX07XG4gIGhlaWdodDogMTNweDtcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbmA7XG5cbmNvbnN0IERyb3Bkb3duTGlzdFdyYXBwZXIgPSBzdHlsZWQuZGl2YFxuICAke3Byb3BzID0+IHByb3BzLnRoZW1lLmRyb3Bkb3duTGlzdH07XG4gIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuaW5wdXRCZ2RIb3Zlcn07XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtd3JhcDogd3JhcDtcbiAgcGFkZGluZzogMHB4O1xuICBtYXgtaGVpZ2h0OiAxNjBweDtcbiAgYm9yZGVyLXJhZGl1czogMHB4IDBweCA0cHggNHB4O1xuYDtcblxuY29uc3QgU3R5bGVkRHJvcGRvd25MaXN0SXRlbSA9IHN0eWxlZC5kaXZgXG4gIHBhZGRpbmc6IDEwcHggNXB4IDlweCAxMHB4O1xuICB3aWR0aDogMTAwJTtcbiAgOmhvdmVyIHtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmVmZmVjdFBhbmVsRWxlbWVudENvbG9yU2VsZWN0ZWR9O1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgfVxuYDtcblxuLy8gR2VuZXJhdGUgdGltZSBvcHRpb25zIGZvciB0aGUgZHJvcGRvd24gd2l0aCAzMCBtaW4gaW50ZXJ2YWxzLlxuY29uc3QgdGltZU9wdGlvbnMgPSAoKCkgPT4ge1xuICBjb25zdCBtID0gbW9tZW50KCkudXRjT2Zmc2V0KDApO1xuICBtLnNldCh7aG91cjogMTIsIG1pbnV0ZTogMCwgc2Vjb25kOiAwLCBtaWxsaXNlY29uZDogMH0pO1xuXG4gIGNvbnN0IG91dDoge25hbWU6IHN0cmluZzsgaWQ6IHN0cmluZ31bXSA9IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IDQ4OyBpKyspIHtcbiAgICBvdXQucHVzaCh7bmFtZTogbS5mb3JtYXQoJ2hoOm1tIEEnKSwgaWQ6IG0uZm9ybWF0KCdISDptbScpfSk7XG4gICAgbS5hZGQoMzAsICdtaW51dGVzJyk7XG4gIH1cbiAgcmV0dXJuIG91dDtcbn0pKCk7XG5cbmNvbnN0IGdldERpc3BsYXlPcHRpb24gPSBvcCA9PiBvcC5uYW1lO1xuY29uc3QgZ2V0T3B0aW9uVmFsdWUgPSBvcCA9PiBvcC5pZDtcblxuLyoqXG4gKiBBIGNvbXBvbmVudCB0byByZW5kZXIgVGltZVBpY2tlciBhcyB0aGUgaGVhZGVyIGZvciB0aGUgZHJvcGRvd24gY29tcG9uZW50LlxuICovXG5jb25zdCBFZmZlY3RUaW1lTGlzdEl0ZW0gPSAoe3ZhbHVlfSkgPT4ge1xuICBpZiAodmFsdWU/LmlkID09PSBIRUFERVJfSVRFTV9JRCkge1xuICAgIHJldHVybiAoXG4gICAgICA8U3R5bGVkVGltZVBpY2tlclxuICAgICAgICB2YWx1ZT17dmFsdWUudmFsdWV9XG4gICAgICAgIG9uQ2hhbmdlPXt2YWx1ZS5vbkNoYW5nZX1cbiAgICAgICAgb25DbGljaz17dmFsdWUub25DbGlja31cbiAgICAgICAgZGlzYWJsZUNsb2NrPXt0cnVlfVxuICAgICAgICBmb3JtYXQ9eydoaDptbSBhJ31cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiA8U3R5bGVkTGFiZWw+e3ZhbHVlLm5hbWV9PC9TdHlsZWRMYWJlbD47XG59O1xuXG5jb25zdCBFZmZlY3RUaW1lRHJvcGRvd25MaXN0ID0gKHtcbiAgb25PcHRpb25TZWxlY3RlZCxcbiAgb3B0aW9ucyxcbiAgc2VsZWN0aW9uSW5kZXgsXG4gIGN1c3RvbUxpc3RJdGVtQ29tcG9uZW50XG59KSA9PiB7XG4gIGNvbnN0IG9uU2VsZWN0T3B0aW9uID0gdXNlQ2FsbGJhY2soXG4gICAgKGUsIHZhbHVlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBvbk9wdGlvblNlbGVjdGVkKHZhbHVlKTtcbiAgICB9LFxuICAgIFtvbk9wdGlvblNlbGVjdGVkXVxuICApO1xuXG4gIGNvbnN0IExpc3RJdGVtQ29tcG9uZW50ID0gY3VzdG9tTGlzdEl0ZW1Db21wb25lbnQ7XG5cbiAgcmV0dXJuIChcbiAgICA8RHJvcGRvd25MaXN0V3JhcHBlciBjbGFzc05hbWU9e2NsYXNzTGlzdC5saXN0fT5cbiAgICAgIHtvcHRpb25zLm1hcCgodmFsdWUsIGkpID0+IChcbiAgICAgICAgPFN0eWxlZERyb3Bkb3duTGlzdEl0ZW1cbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoJ2VmZmVjdC10eXBlLXNlbGVjdG9yX19pdGVtJywge1xuICAgICAgICAgICAgaG92ZXI6IHNlbGVjdGlvbkluZGV4ID09PSBpXG4gICAgICAgICAgfSl9XG4gICAgICAgICAga2V5PXtgJHt2YWx1ZS5pZH1fJHtpfWB9XG4gICAgICAgICAgb25Nb3VzZURvd249e2UgPT4gb25TZWxlY3RPcHRpb24oZSwgdmFsdWUpfVxuICAgICAgICAgIG9uQ2xpY2s9e2UgPT4gb25TZWxlY3RPcHRpb24oZSwgdmFsdWUpfVxuICAgICAgICA+XG4gICAgICAgICAgPExpc3RJdGVtQ29tcG9uZW50IHZhbHVlPXt2YWx1ZX0gLz5cbiAgICAgICAgPC9TdHlsZWREcm9wZG93bkxpc3RJdGVtPlxuICAgICAgKSl9XG4gICAgPC9Ecm9wZG93bkxpc3RXcmFwcGVyPlxuICApO1xufTtcblxuRWZmZWN0VGltZVNlbGVjdG9yRmFjdG9yeS5kZXBzID0gW107XG5cbmZ1bmN0aW9uIEVmZmVjdFRpbWVTZWxlY3RvckZhY3RvcnkoKSB7XG4gIGNvbnN0IEVmZmVjdFRpbWVTZWxlY3RvcjogUmVhY3QuRkM8RWZmZWN0VGltZVNlbGVjdG9yUHJvcHM+ID0gKHtcbiAgICB2YWx1ZSxcbiAgICBvbkNoYW5nZVxuICB9OiBFZmZlY3RUaW1lU2VsZWN0b3JQcm9wcykgPT4ge1xuICAgIC8vIFNlbGVjdGVkIGl0ZW0gaXMgcmVuZGVyZWQgYXMgVGltZVBpY2tlciBpbiBFZmZlY3RUaW1lTGlzdEl0ZW1cbiAgICBjb25zdCBzZWxlY3RlZEl0ZW1zID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6IEhFQURFUl9JVEVNX0lELFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIG9uQ2hhbmdlLFxuICAgICAgICAgIG9uQ2xpY2s6IGUgPT4ge1xuICAgICAgICAgICAgLy8gRGF0ZVBpY2tlciBpcyB1c2VkIGFzIGN1c3RvbSBoZWFkZXIuXG4gICAgICAgICAgICAvLyBEb24ndCBvcGVuIHRoZSBkcm9wZG93biB3aGVuIHRoZSB1c2VyIGlzIGVkaXRpbmcgdGltZSB2YWx1ZXMgZGlyZWN0bHkuXG4gICAgICAgICAgICBjb25zdCBuYW1lID0gZT8udGFyZ2V0Py5uYW1lO1xuICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdob3VyMTInIHx8IG5hbWUgPT09ICdtaW51dGUnIHx8IG5hbWUgPT09ICdhbVBtJykge1xuICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXTtcbiAgICB9LCBbdmFsdWUsIG9uQ2hhbmdlXSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFN0eWxlZEVmZmVjdFRpbWVTZWxlY3Rvcj5cbiAgICAgICAgPEl0ZW1TZWxlY3RvclxuICAgICAgICAgIHNlbGVjdGVkSXRlbXM9e3NlbGVjdGVkSXRlbXN9XG4gICAgICAgICAgb3B0aW9ucz17dGltZU9wdGlvbnN9XG4gICAgICAgICAgbXVsdGlTZWxlY3Q9e2ZhbHNlfVxuICAgICAgICAgIHNlYXJjaGFibGU9e2ZhbHNlfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiXCJcbiAgICAgICAgICBmaWx0ZXJPcHRpb249XCJuYW1lXCJcbiAgICAgICAgICBvbkNoYW5nZT17b25DaGFuZ2V9XG4gICAgICAgICAgZ2V0T3B0aW9uVmFsdWU9e2dldE9wdGlvblZhbHVlfVxuICAgICAgICAgIGRpc3BsYXlPcHRpb249e2dldERpc3BsYXlPcHRpb259XG4gICAgICAgICAgRHJvcERvd25MaW5lSXRlbVJlbmRlckNvbXBvbmVudD17RWZmZWN0VGltZUxpc3RJdGVtfVxuICAgICAgICAgIERyb3BEb3duUmVuZGVyQ29tcG9uZW50PXtFZmZlY3RUaW1lRHJvcGRvd25MaXN0fVxuICAgICAgICAvPlxuICAgICAgPC9TdHlsZWRFZmZlY3RUaW1lU2VsZWN0b3I+XG4gICAgKTtcbiAgfTtcblxuICByZXR1cm4gd2l0aFRoZW1lKEVmZmVjdFRpbWVTZWxlY3Rvcik7XG59XG5cbmV4cG9ydCBkZWZhdWx0IEVmZmVjdFRpbWVTZWxlY3RvckZhY3Rvcnk7XG4iXX0=