"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _switch = _interopRequireDefault(require("../../common/switch"));

var _panelTitle = _interopRequireDefault(require("../panel-title"));

var _brushConfig = _interopRequireDefault(require("./brush-config"));

var _tooltipConfig = _interopRequireDefault(require("./tooltip-config"));

var _styledComponents2 = require("../../common/styled-components");

var _icons = require("../../common/icons");

var _localization = require("@kepler.gl/localization");

var _templateObject;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var StyledInteractionPanel = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  padding-bottom: 6px;\n"])));

InteractionPanelFactory.deps = [_tooltipConfig["default"], _brushConfig["default"], _panelTitle["default"]];
var INTERACTION_CONFIG_ICONS = {
  tooltip: _icons.Messages,
  geocoder: _icons.Pin,
  brush: _icons.Crosshairs,
  coordinate: _icons.CursorClick
};

function InteractionPanelFactory(TooltipConfig, BrushConfig, PanelTitle) {
  var InteractionPanel = function InteractionPanel(_ref) {
    var config = _ref.config,
        onConfigChange = _ref.onConfigChange,
        datasets = _ref.datasets,
        setColumnDisplayFormat = _ref.setColumnDisplayFormat,
        _ref$interactionConfi = _ref.interactionConfigIcons,
        interactionConfigIcons = _ref$interactionConfi === void 0 ? INTERACTION_CONFIG_ICONS : _ref$interactionConfi;

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        isConfigActive = _useState2[0],
        setIsConfigAction = _useState2[1];

    var _updateConfig = (0, _react.useCallback)(function (newProp) {
      onConfigChange(_objectSpread(_objectSpread({}, config), newProp));
    }, [onConfigChange, config]);

    var onDisplayFormatChange = (0, _react.useCallback)(function (dataId, column, displayFormat) {
      setColumnDisplayFormat(dataId, (0, _defineProperty2["default"])({}, column, displayFormat));
    }, [setColumnDisplayFormat]);
    var togglePanelActive = (0, _react.useCallback)(function () {
      setIsConfigAction(!isConfigActive);
    }, [setIsConfigAction, isConfigActive]);
    var enabled = config.enabled;
    var toggleEnableConfig = (0, _react.useCallback)(function () {
      _updateConfig({
        enabled: !enabled
      });
    }, [_updateConfig, enabled]);
    var onChange = (0, _react.useCallback)(function (newConfig) {
      return _updateConfig({
        config: newConfig
      });
    }, [_updateConfig]);
    var IconComponent = interactionConfigIcons[config.id];
    var template = null;

    switch (config.id) {
      case 'tooltip':
        template = /*#__PURE__*/_react["default"].createElement(TooltipConfig, {
          datasets: datasets,
          config: config.config,
          onChange: onChange,
          onDisplayFormatChange: onDisplayFormatChange
        });
        break;

      case 'brush':
        template = /*#__PURE__*/_react["default"].createElement(BrushConfig, {
          config: config.config,
          onChange: onChange
        });
        break;

      default:
        break;
    }

    return /*#__PURE__*/_react["default"].createElement(StyledInteractionPanel, {
      className: "interaction-panel"
    }, /*#__PURE__*/_react["default"].createElement(_styledComponents2.StyledPanelHeader, {
      className: "interaction-panel__header",
      onClick: togglePanelActive
    }, /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelHeaderContent, {
      className: "interaction-panel__header__content"
    }, /*#__PURE__*/_react["default"].createElement("div", {
      className: "interaction-panel__header__icon icon"
    }, IconComponent ? /*#__PURE__*/_react["default"].createElement(IconComponent, {
      height: "16px"
    }) : null), /*#__PURE__*/_react["default"].createElement("div", {
      className: "interaction-panel__header__title"
    }, /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelHeaderTitle, null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
      id: config.label
    })))), /*#__PURE__*/_react["default"].createElement("div", {
      className: "interaction-panel__header__actions"
    }, /*#__PURE__*/_react["default"].createElement(_switch["default"], {
      checked: config.enabled,
      id: "".concat(config.id, "-toggle"),
      onChange: toggleEnableConfig,
      secondary: true
    }))), config.enabled && template && /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelContent, {
      className: "interaction-panel__content"
    }, template));
  };

  return InteractionPanel;
}

var _default = InteractionPanelFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zaWRlLXBhbmVsL2ludGVyYWN0aW9uLXBhbmVsL2ludGVyYWN0aW9uLXBhbmVsLnRzeCJdLCJuYW1lcyI6WyJTdHlsZWRJbnRlcmFjdGlvblBhbmVsIiwic3R5bGVkIiwiZGl2IiwiSW50ZXJhY3Rpb25QYW5lbEZhY3RvcnkiLCJkZXBzIiwiVG9vbHRpcENvbmZpZ0ZhY3RvcnkiLCJCcnVzaENvbmZpZ0ZhY3RvcnkiLCJQYW5lbFRpdGxlRmFjdG9yeSIsIklOVEVSQUNUSU9OX0NPTkZJR19JQ09OUyIsInRvb2x0aXAiLCJNZXNzYWdlcyIsImdlb2NvZGVyIiwiUGluIiwiYnJ1c2giLCJDcm9zc2hhaXJzIiwiY29vcmRpbmF0ZSIsIkN1cnNvckNsaWNrIiwiVG9vbHRpcENvbmZpZyIsIkJydXNoQ29uZmlnIiwiUGFuZWxUaXRsZSIsIkludGVyYWN0aW9uUGFuZWwiLCJjb25maWciLCJvbkNvbmZpZ0NoYW5nZSIsImRhdGFzZXRzIiwic2V0Q29sdW1uRGlzcGxheUZvcm1hdCIsImludGVyYWN0aW9uQ29uZmlnSWNvbnMiLCJpc0NvbmZpZ0FjdGl2ZSIsInNldElzQ29uZmlnQWN0aW9uIiwiX3VwZGF0ZUNvbmZpZyIsIm5ld1Byb3AiLCJvbkRpc3BsYXlGb3JtYXRDaGFuZ2UiLCJkYXRhSWQiLCJjb2x1bW4iLCJkaXNwbGF5Rm9ybWF0IiwidG9nZ2xlUGFuZWxBY3RpdmUiLCJlbmFibGVkIiwidG9nZ2xlRW5hYmxlQ29uZmlnIiwib25DaGFuZ2UiLCJuZXdDb25maWciLCJJY29uQ29tcG9uZW50IiwiaWQiLCJ0ZW1wbGF0ZSIsImxhYmVsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQVFBOztBQU1BOztBQUVBOzs7Ozs7OztBQVlBLElBQU1BLHNCQUFzQixHQUFHQyw2QkFBT0MsR0FBVixnSEFBNUI7O0FBSUFDLHVCQUF1QixDQUFDQyxJQUF4QixHQUErQixDQUFDQyx5QkFBRCxFQUF1QkMsdUJBQXZCLEVBQTJDQyxzQkFBM0MsQ0FBL0I7QUFFQSxJQUFNQyx3QkFBNEQsR0FBRztBQUNuRUMsRUFBQUEsT0FBTyxFQUFFQyxlQUQwRDtBQUVuRUMsRUFBQUEsUUFBUSxFQUFFQyxVQUZ5RDtBQUduRUMsRUFBQUEsS0FBSyxFQUFFQyxpQkFINEQ7QUFJbkVDLEVBQUFBLFVBQVUsRUFBRUM7QUFKdUQsQ0FBckU7O0FBT0EsU0FBU2IsdUJBQVQsQ0FDRWMsYUFERixFQUVFQyxXQUZGLEVBR0VDLFVBSEYsRUFJd0M7QUFDdEMsTUFBTUMsZ0JBQWlELEdBQUcsU0FBcERBLGdCQUFvRCxPQU1wRDtBQUFBLFFBTEpDLE1BS0ksUUFMSkEsTUFLSTtBQUFBLFFBSkpDLGNBSUksUUFKSkEsY0FJSTtBQUFBLFFBSEpDLFFBR0ksUUFISkEsUUFHSTtBQUFBLFFBRkpDLHNCQUVJLFFBRkpBLHNCQUVJO0FBQUEscUNBREpDLHNCQUNJO0FBQUEsUUFESkEsc0JBQ0ksc0NBRHFCakIsd0JBQ3JCOztBQUFBLG9CQUN3QyxxQkFBUyxLQUFULENBRHhDO0FBQUE7QUFBQSxRQUNHa0IsY0FESDtBQUFBLFFBQ21CQyxpQkFEbkI7O0FBR0osUUFBTUMsYUFBYSxHQUFHLHdCQUNwQixVQUFBQyxPQUFPLEVBQUk7QUFDVFAsTUFBQUEsY0FBYyxpQ0FDVEQsTUFEUyxHQUVUUSxPQUZTLEVBQWQ7QUFJRCxLQU5tQixFQU9wQixDQUFDUCxjQUFELEVBQWlCRCxNQUFqQixDQVBvQixDQUF0Qjs7QUFVQSxRQUFNUyxxQkFBcUIsR0FBRyx3QkFDNUIsVUFBQ0MsTUFBRCxFQUFTQyxNQUFULEVBQWlCQyxhQUFqQixFQUFtQztBQUNqQ1QsTUFBQUEsc0JBQXNCLENBQUNPLE1BQUQsdUNBQVdDLE1BQVgsRUFBb0JDLGFBQXBCLEVBQXRCO0FBQ0QsS0FIMkIsRUFJNUIsQ0FBQ1Qsc0JBQUQsQ0FKNEIsQ0FBOUI7QUFPQSxRQUFNVSxpQkFBaUIsR0FBRyx3QkFBWSxZQUFNO0FBQzFDUCxNQUFBQSxpQkFBaUIsQ0FBQyxDQUFDRCxjQUFGLENBQWpCO0FBQ0QsS0FGeUIsRUFFdkIsQ0FBQ0MsaUJBQUQsRUFBb0JELGNBQXBCLENBRnVCLENBQTFCO0FBcEJJLFFBd0JHUyxPQXhCSCxHQXdCY2QsTUF4QmQsQ0F3QkdjLE9BeEJIO0FBeUJKLFFBQU1DLGtCQUFrQixHQUFHLHdCQUFZLFlBQU07QUFDM0NSLE1BQUFBLGFBQWEsQ0FBQztBQUFDTyxRQUFBQSxPQUFPLEVBQUUsQ0FBQ0E7QUFBWCxPQUFELENBQWI7QUFDRCxLQUYwQixFQUV4QixDQUFDUCxhQUFELEVBQWdCTyxPQUFoQixDQUZ3QixDQUEzQjtBQUlBLFFBQU1FLFFBQVEsR0FBRyx3QkFBWSxVQUFBQyxTQUFTO0FBQUEsYUFBSVYsYUFBYSxDQUFDO0FBQUNQLFFBQUFBLE1BQU0sRUFBRWlCO0FBQVQsT0FBRCxDQUFqQjtBQUFBLEtBQXJCLEVBQTZELENBQUNWLGFBQUQsQ0FBN0QsQ0FBakI7QUFFQSxRQUFNVyxhQUFhLEdBQUdkLHNCQUFzQixDQUFDSixNQUFNLENBQUNtQixFQUFSLENBQTVDO0FBRUEsUUFBSUMsUUFBNkIsR0FBRyxJQUFwQzs7QUFFQSxZQUFRcEIsTUFBTSxDQUFDbUIsRUFBZjtBQUNFLFdBQUssU0FBTDtBQUNFQyxRQUFBQSxRQUFRLGdCQUNOLGdDQUFDLGFBQUQ7QUFDRSxVQUFBLFFBQVEsRUFBRWxCLFFBRFo7QUFFRSxVQUFBLE1BQU0sRUFBRUYsTUFBTSxDQUFDQSxNQUZqQjtBQUdFLFVBQUEsUUFBUSxFQUFFZ0IsUUFIWjtBQUlFLFVBQUEscUJBQXFCLEVBQUVQO0FBSnpCLFVBREY7QUFRQTs7QUFDRixXQUFLLE9BQUw7QUFDRVcsUUFBQUEsUUFBUSxnQkFBRyxnQ0FBQyxXQUFEO0FBQWEsVUFBQSxNQUFNLEVBQUVwQixNQUFNLENBQUNBLE1BQTVCO0FBQW9DLFVBQUEsUUFBUSxFQUFFZ0I7QUFBOUMsVUFBWDtBQUNBOztBQUVGO0FBQ0U7QUFoQko7O0FBa0JBLHdCQUNFLGdDQUFDLHNCQUFEO0FBQXdCLE1BQUEsU0FBUyxFQUFDO0FBQWxDLG9CQUNFLGdDQUFDLG9DQUFEO0FBQW1CLE1BQUEsU0FBUyxFQUFDLDJCQUE3QjtBQUF5RCxNQUFBLE9BQU8sRUFBRUg7QUFBbEUsb0JBQ0UsZ0NBQUMscUNBQUQ7QUFBb0IsTUFBQSxTQUFTLEVBQUM7QUFBOUIsb0JBQ0U7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQ0dLLGFBQWEsZ0JBQUcsZ0NBQUMsYUFBRDtBQUFlLE1BQUEsTUFBTSxFQUFDO0FBQXRCLE1BQUgsR0FBcUMsSUFEckQsQ0FERixlQUlFO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDRSxnQ0FBQyxtQ0FBRCxxQkFDRSxnQ0FBQyw4QkFBRDtBQUFrQixNQUFBLEVBQUUsRUFBRWxCLE1BQU0sQ0FBQ3FCO0FBQTdCLE1BREYsQ0FERixDQUpGLENBREYsZUFXRTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsb0JBQ0UsZ0NBQUMsa0JBQUQ7QUFDRSxNQUFBLE9BQU8sRUFBRXJCLE1BQU0sQ0FBQ2MsT0FEbEI7QUFFRSxNQUFBLEVBQUUsWUFBS2QsTUFBTSxDQUFDbUIsRUFBWixZQUZKO0FBR0UsTUFBQSxRQUFRLEVBQUVKLGtCQUhaO0FBSUUsTUFBQSxTQUFTO0FBSlgsTUFERixDQVhGLENBREYsRUFxQkdmLE1BQU0sQ0FBQ2MsT0FBUCxJQUFrQk0sUUFBbEIsaUJBQ0MsZ0NBQUMsK0JBQUQ7QUFBYyxNQUFBLFNBQVMsRUFBQztBQUF4QixPQUFzREEsUUFBdEQsQ0F0QkosQ0FERjtBQTJCRCxHQXRGRDs7QUF3RkEsU0FBT3JCLGdCQUFQO0FBQ0Q7O2VBRWNqQix1QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge3VzZVN0YXRlLCBDb21wb25lbnRUeXBlLCBSZWFjdEVsZW1lbnQsIHVzZUNhbGxiYWNrfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBTd2l0Y2ggZnJvbSAnLi4vLi4vY29tbW9uL3N3aXRjaCc7XG5pbXBvcnQgUGFuZWxUaXRsZUZhY3RvcnkgZnJvbSAnLi4vcGFuZWwtdGl0bGUnO1xuaW1wb3J0IEJydXNoQ29uZmlnRmFjdG9yeSBmcm9tICcuL2JydXNoLWNvbmZpZyc7XG5pbXBvcnQgVG9vbHRpcENvbmZpZ0ZhY3RvcnkgZnJvbSAnLi90b29sdGlwLWNvbmZpZyc7XG5pbXBvcnQge0RhdGFzZXRzfSBmcm9tICdAa2VwbGVyLmdsL3RhYmxlJztcbmltcG9ydCB7SW50ZXJhY3Rpb25Db25maWcsIFZhbHVlT2Z9IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuaW1wb3J0IHtcbiAgc2V0Q29sdW1uRGlzcGxheUZvcm1hdCBhcyBzZXRDb2x1bW5EaXNwbGF5Rm9ybWF0QWN0aW9uLFxuICBBY3Rpb25IYW5kbGVyXG59IGZyb20gJ0BrZXBsZXIuZ2wvYWN0aW9ucyc7XG5cbmltcG9ydCB7XG4gIFN0eWxlZFBhbmVsSGVhZGVyLFxuICBQYW5lbEhlYWRlclRpdGxlLFxuICBQYW5lbEhlYWRlckNvbnRlbnQsXG4gIFBhbmVsQ29udGVudFxufSBmcm9tICcuLi8uLi9jb21tb24vc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHtNZXNzYWdlcywgQ3Jvc3NoYWlycywgQ3Vyc29yQ2xpY2ssIFBpbn0gZnJvbSAnLi4vLi4vY29tbW9uL2ljb25zJztcblxuaW1wb3J0IHtGb3JtYXR0ZWRNZXNzYWdlfSBmcm9tICdAa2VwbGVyLmdsL2xvY2FsaXphdGlvbic7XG5cbmludGVyZmFjZSBJbnRlcmFjdGlvblBhbmVsUHJvcHMge1xuICBkYXRhc2V0czogRGF0YXNldHM7XG4gIGNvbmZpZzogVmFsdWVPZjxJbnRlcmFjdGlvbkNvbmZpZz47XG4gIG9uQ29uZmlnQ2hhbmdlOiBhbnk7XG4gIGludGVyYWN0aW9uQ29uZmlnSWNvbnM/OiB7XG4gICAgW2tleTogc3RyaW5nXTogUmVhY3QuRWxlbWVudFR5cGU7XG4gIH07XG4gIHNldENvbHVtbkRpc3BsYXlGb3JtYXQ6IEFjdGlvbkhhbmRsZXI8dHlwZW9mIHNldENvbHVtbkRpc3BsYXlGb3JtYXRBY3Rpb24+O1xufVxuXG5jb25zdCBTdHlsZWRJbnRlcmFjdGlvblBhbmVsID0gc3R5bGVkLmRpdmBcbiAgcGFkZGluZy1ib3R0b206IDZweDtcbmA7XG5cbkludGVyYWN0aW9uUGFuZWxGYWN0b3J5LmRlcHMgPSBbVG9vbHRpcENvbmZpZ0ZhY3RvcnksIEJydXNoQ29uZmlnRmFjdG9yeSwgUGFuZWxUaXRsZUZhY3RvcnldO1xuXG5jb25zdCBJTlRFUkFDVElPTl9DT05GSUdfSUNPTlM6IHtba2V5OiBzdHJpbmddOiBSZWFjdC5FbGVtZW50VHlwZX0gPSB7XG4gIHRvb2x0aXA6IE1lc3NhZ2VzLFxuICBnZW9jb2RlcjogUGluLFxuICBicnVzaDogQ3Jvc3NoYWlycyxcbiAgY29vcmRpbmF0ZTogQ3Vyc29yQ2xpY2tcbn07XG5cbmZ1bmN0aW9uIEludGVyYWN0aW9uUGFuZWxGYWN0b3J5KFxuICBUb29sdGlwQ29uZmlnOiBSZXR1cm5UeXBlPHR5cGVvZiBUb29sdGlwQ29uZmlnRmFjdG9yeT4sXG4gIEJydXNoQ29uZmlnOiBSZXR1cm5UeXBlPHR5cGVvZiBCcnVzaENvbmZpZ0ZhY3Rvcnk+LFxuICBQYW5lbFRpdGxlOiBSZXR1cm5UeXBlPHR5cGVvZiBQYW5lbFRpdGxlRmFjdG9yeT5cbik6IENvbXBvbmVudFR5cGU8SW50ZXJhY3Rpb25QYW5lbFByb3BzPiB7XG4gIGNvbnN0IEludGVyYWN0aW9uUGFuZWw6IFJlYWN0LkZDPEludGVyYWN0aW9uUGFuZWxQcm9wcz4gPSAoe1xuICAgIGNvbmZpZyxcbiAgICBvbkNvbmZpZ0NoYW5nZSxcbiAgICBkYXRhc2V0cyxcbiAgICBzZXRDb2x1bW5EaXNwbGF5Rm9ybWF0LFxuICAgIGludGVyYWN0aW9uQ29uZmlnSWNvbnMgPSBJTlRFUkFDVElPTl9DT05GSUdfSUNPTlNcbiAgfSkgPT4ge1xuICAgIGNvbnN0IFtpc0NvbmZpZ0FjdGl2ZSwgc2V0SXNDb25maWdBY3Rpb25dID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gICAgY29uc3QgX3VwZGF0ZUNvbmZpZyA9IHVzZUNhbGxiYWNrKFxuICAgICAgbmV3UHJvcCA9PiB7XG4gICAgICAgIG9uQ29uZmlnQ2hhbmdlKHtcbiAgICAgICAgICAuLi5jb25maWcsXG4gICAgICAgICAgLi4ubmV3UHJvcFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBbb25Db25maWdDaGFuZ2UsIGNvbmZpZ11cbiAgICApO1xuXG4gICAgY29uc3Qgb25EaXNwbGF5Rm9ybWF0Q2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgICAoZGF0YUlkLCBjb2x1bW4sIGRpc3BsYXlGb3JtYXQpID0+IHtcbiAgICAgICAgc2V0Q29sdW1uRGlzcGxheUZvcm1hdChkYXRhSWQsIHtbY29sdW1uXTogZGlzcGxheUZvcm1hdH0pO1xuICAgICAgfSxcbiAgICAgIFtzZXRDb2x1bW5EaXNwbGF5Rm9ybWF0XVxuICAgICk7XG5cbiAgICBjb25zdCB0b2dnbGVQYW5lbEFjdGl2ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHNldElzQ29uZmlnQWN0aW9uKCFpc0NvbmZpZ0FjdGl2ZSk7XG4gICAgfSwgW3NldElzQ29uZmlnQWN0aW9uLCBpc0NvbmZpZ0FjdGl2ZV0pO1xuXG4gICAgY29uc3Qge2VuYWJsZWR9ID0gY29uZmlnO1xuICAgIGNvbnN0IHRvZ2dsZUVuYWJsZUNvbmZpZyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIF91cGRhdGVDb25maWcoe2VuYWJsZWQ6ICFlbmFibGVkfSk7XG4gICAgfSwgW191cGRhdGVDb25maWcsIGVuYWJsZWRdKTtcblxuICAgIGNvbnN0IG9uQ2hhbmdlID0gdXNlQ2FsbGJhY2sobmV3Q29uZmlnID0+IF91cGRhdGVDb25maWcoe2NvbmZpZzogbmV3Q29uZmlnfSksIFtfdXBkYXRlQ29uZmlnXSk7XG5cbiAgICBjb25zdCBJY29uQ29tcG9uZW50ID0gaW50ZXJhY3Rpb25Db25maWdJY29uc1tjb25maWcuaWRdO1xuXG4gICAgbGV0IHRlbXBsYXRlOiBSZWFjdEVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICAgIHN3aXRjaCAoY29uZmlnLmlkKSB7XG4gICAgICBjYXNlICd0b29sdGlwJzpcbiAgICAgICAgdGVtcGxhdGUgPSAoXG4gICAgICAgICAgPFRvb2x0aXBDb25maWdcbiAgICAgICAgICAgIGRhdGFzZXRzPXtkYXRhc2V0c31cbiAgICAgICAgICAgIGNvbmZpZz17Y29uZmlnLmNvbmZpZ31cbiAgICAgICAgICAgIG9uQ2hhbmdlPXtvbkNoYW5nZX1cbiAgICAgICAgICAgIG9uRGlzcGxheUZvcm1hdENoYW5nZT17b25EaXNwbGF5Rm9ybWF0Q2hhbmdlfVxuICAgICAgICAgIC8+XG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnYnJ1c2gnOlxuICAgICAgICB0ZW1wbGF0ZSA9IDxCcnVzaENvbmZpZyBjb25maWc9e2NvbmZpZy5jb25maWd9IG9uQ2hhbmdlPXtvbkNoYW5nZX0gLz47XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIDxTdHlsZWRJbnRlcmFjdGlvblBhbmVsIGNsYXNzTmFtZT1cImludGVyYWN0aW9uLXBhbmVsXCI+XG4gICAgICAgIDxTdHlsZWRQYW5lbEhlYWRlciBjbGFzc05hbWU9XCJpbnRlcmFjdGlvbi1wYW5lbF9faGVhZGVyXCIgb25DbGljaz17dG9nZ2xlUGFuZWxBY3RpdmV9PlxuICAgICAgICAgIDxQYW5lbEhlYWRlckNvbnRlbnQgY2xhc3NOYW1lPVwiaW50ZXJhY3Rpb24tcGFuZWxfX2hlYWRlcl9fY29udGVudFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJpbnRlcmFjdGlvbi1wYW5lbF9faGVhZGVyX19pY29uIGljb25cIj5cbiAgICAgICAgICAgICAge0ljb25Db21wb25lbnQgPyA8SWNvbkNvbXBvbmVudCBoZWlnaHQ9XCIxNnB4XCIgLz4gOiBudWxsfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImludGVyYWN0aW9uLXBhbmVsX19oZWFkZXJfX3RpdGxlXCI+XG4gICAgICAgICAgICAgIDxQYW5lbEhlYWRlclRpdGxlPlxuICAgICAgICAgICAgICAgIDxGb3JtYXR0ZWRNZXNzYWdlIGlkPXtjb25maWcubGFiZWx9IC8+XG4gICAgICAgICAgICAgIDwvUGFuZWxIZWFkZXJUaXRsZT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvUGFuZWxIZWFkZXJDb250ZW50PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaW50ZXJhY3Rpb24tcGFuZWxfX2hlYWRlcl9fYWN0aW9uc1wiPlxuICAgICAgICAgICAgPFN3aXRjaFxuICAgICAgICAgICAgICBjaGVja2VkPXtjb25maWcuZW5hYmxlZH1cbiAgICAgICAgICAgICAgaWQ9e2Ake2NvbmZpZy5pZH0tdG9nZ2xlYH1cbiAgICAgICAgICAgICAgb25DaGFuZ2U9e3RvZ2dsZUVuYWJsZUNvbmZpZ31cbiAgICAgICAgICAgICAgc2Vjb25kYXJ5XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L1N0eWxlZFBhbmVsSGVhZGVyPlxuICAgICAgICB7Y29uZmlnLmVuYWJsZWQgJiYgdGVtcGxhdGUgJiYgKFxuICAgICAgICAgIDxQYW5lbENvbnRlbnQgY2xhc3NOYW1lPVwiaW50ZXJhY3Rpb24tcGFuZWxfX2NvbnRlbnRcIj57dGVtcGxhdGV9PC9QYW5lbENvbnRlbnQ+XG4gICAgICAgICl9XG4gICAgICA8L1N0eWxlZEludGVyYWN0aW9uUGFuZWw+XG4gICAgKTtcbiAgfTtcblxuICByZXR1cm4gSW50ZXJhY3Rpb25QYW5lbDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgSW50ZXJhY3Rpb25QYW5lbEZhY3Rvcnk7XG4iXX0=