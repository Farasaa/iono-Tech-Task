"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _reactIntl = require("react-intl");

var _actions = require("@kepler.gl/actions");

var _constants = require("@kepler.gl/constants");

var _injector = require("../injector");

var _sidePanelTitle = _interopRequireDefault(require("./side-panel-title"));

var _effectList = _interopRequireDefault(require("./effect-list"));

var _effectTypeSelector = _interopRequireDefault(require("./effect-type-selector"));

var _templateObject, _templateObject2, _templateObject3, _templateObject4;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var StyledEffectPanelContainer = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  flex-direction: column;\n  pointer-events: none !important; /* prevent padding from blocking input */\n  flex-grow: 1;\n  justify-content: space-between;\n  overflow: hidden;\n\n  & > * {\n    /* all children should allow input */\n    pointer-events: all;\n  }\n"]))); // top right position absolute


var StyledEffectPanel = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  top: 0;\n  background-color: ", ";\n  display: flex;\n  flex-direction: column;\n  flex-grow: 1;\n  overflow: hidden;\n"])), function (props) {
  return props.theme.sidePanelBg;
});

var StyledEffectPanelHeader = _styledComponents["default"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  padding: ", ";\n  border-bottom: 1px solid ", ";\n  min-width: ", "px;\n"])), function (_ref) {
  var theme = _ref.theme;
  return "".concat(theme.effectPanelPaddingTop, "px ").concat(theme.effectPanelPaddingSide, "px 4px ").concat(theme.effectPanelPaddingSide, "px}");
}, function (props) {
  return props.theme.borderColor;
}, function (_ref2) {
  var theme = _ref2.theme;
  return theme.effectPanelWidth;
});

var StyledEffectPanelContent = _styledComponents["default"].div(_templateObject4 || (_templateObject4 = (0, _taggedTemplateLiteral2["default"])(["\n  ", ";\n  padding: ", ";\n  overflow: overlay;\n  display: flex;\n  flex-direction: column;\n"])), function (props) {
  return props.theme.sidePanelScrollBar;
}, function (props) {
  return props.extended ? '32px' : '10px 0px 10px 0px';
});

EffectManagerFactory.deps = [_effectList["default"], _sidePanelTitle["default"], _effectTypeSelector["default"]];

function EffectManagerFactory(EffectList, SidePanelTitle, EffectTypeSelector) {
  var EffectManager = function EffectManager(props) {
    var intl = props.intl,
        visStateActions = props.visStateActions,
        effects = props.effects,
        effectOrder = props.effectOrder,
        children = props.children;

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        typeSelectorOpened = _useState2[0],
        setTypeSelectorOpened = _useState2[1]; // Prevent shadow effect from being added multiple times


    var effectOptions = (0, _react.useMemo)(function () {
      var hasShadow = effects.some(function (effect) {
        return effect.type === _constants.LIGHT_AND_SHADOW_EFFECT.type;
      });
      return _constants.EFFECT_DESCRIPTIONS.map(function (desc) {
        return _objectSpread(_objectSpread({}, desc), {}, {
          disabled: Boolean(hasShadow && desc.type === _constants.LIGHT_AND_SHADOW_EFFECT.type)
        });
      });
    }, [effects]);
    var onAddEffect = (0, _react.useCallback)(function (type) {
      visStateActions.addEffect({
        type: type
      });
    }, []);
    var onTypeSelectOpen = (0, _react.useCallback)(function () {
      setTypeSelectorOpened(true);
    }, []);
    var onTypeSelectClose = (0, _react.useCallback)(function () {
      setTypeSelectorOpened(false);
    }, []);
    return /*#__PURE__*/_react["default"].createElement(StyledEffectPanelContainer, {
      className: "effect-manager"
    }, /*#__PURE__*/_react["default"].createElement(StyledEffectPanel, null, /*#__PURE__*/_react["default"].createElement(StyledEffectPanelHeader, null, /*#__PURE__*/_react["default"].createElement(SidePanelTitle, {
      className: "effect-manager-title",
      title: intl.formatMessage({
        id: 'effectManager.effects'
      })
    }, /*#__PURE__*/_react["default"].createElement(EffectTypeSelector, {
      options: effectOptions,
      onSelect: onAddEffect,
      onOpen: onTypeSelectOpen,
      onBlur: onTypeSelectClose
    }))), /*#__PURE__*/_react["default"].createElement(StyledEffectPanelContent, {
      extended: typeSelectorOpened && effects.length === 0
    }, /*#__PURE__*/_react["default"].createElement(EffectList, {
      effects: effects,
      effectOrder: effectOrder,
      visStateActions: visStateActions,
      isSortable: true
    }))), children);
  };

  return (0, _injector.withState)([], function (state) {
    var visState = state.demo.keplerGl.map.visState;
    return {
      effects: visState.effects,
      effectOrder: visState.effectOrder
    };
  }, {
    visStateActions: {
      addEffect: _actions.addEffect,
      updateEffect: _actions.updateEffect,
      removeEffect: _actions.removeEffect,
      reorderEffect: _actions.reorderEffect
    }
  })((0, _reactIntl.injectIntl)(EffectManager));
}

var _default = EffectManagerFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lZmZlY3RzL2VmZmVjdC1tYW5hZ2VyLnRzeCJdLCJuYW1lcyI6WyJTdHlsZWRFZmZlY3RQYW5lbENvbnRhaW5lciIsInN0eWxlZCIsImRpdiIsIlN0eWxlZEVmZmVjdFBhbmVsIiwicHJvcHMiLCJ0aGVtZSIsInNpZGVQYW5lbEJnIiwiU3R5bGVkRWZmZWN0UGFuZWxIZWFkZXIiLCJlZmZlY3RQYW5lbFBhZGRpbmdUb3AiLCJlZmZlY3RQYW5lbFBhZGRpbmdTaWRlIiwiYm9yZGVyQ29sb3IiLCJlZmZlY3RQYW5lbFdpZHRoIiwiU3R5bGVkRWZmZWN0UGFuZWxDb250ZW50Iiwic2lkZVBhbmVsU2Nyb2xsQmFyIiwiZXh0ZW5kZWQiLCJFZmZlY3RNYW5hZ2VyRmFjdG9yeSIsImRlcHMiLCJFZmZlY3RMaXN0RmFjdG9yeSIsIlNpZGVQYW5lbFRpdGxlRmFjdG9yeSIsIkVmZmVjdFR5cGVTZWxlY3RvckZhY3RvcnkiLCJFZmZlY3RMaXN0IiwiU2lkZVBhbmVsVGl0bGUiLCJFZmZlY3RUeXBlU2VsZWN0b3IiLCJFZmZlY3RNYW5hZ2VyIiwiaW50bCIsInZpc1N0YXRlQWN0aW9ucyIsImVmZmVjdHMiLCJlZmZlY3RPcmRlciIsImNoaWxkcmVuIiwidHlwZVNlbGVjdG9yT3BlbmVkIiwic2V0VHlwZVNlbGVjdG9yT3BlbmVkIiwiZWZmZWN0T3B0aW9ucyIsImhhc1NoYWRvdyIsInNvbWUiLCJlZmZlY3QiLCJ0eXBlIiwiTElHSFRfQU5EX1NIQURPV19FRkZFQ1QiLCJFRkZFQ1RfREVTQ1JJUFRJT05TIiwibWFwIiwiZGVzYyIsImRpc2FibGVkIiwiQm9vbGVhbiIsIm9uQWRkRWZmZWN0IiwiYWRkRWZmZWN0Iiwib25UeXBlU2VsZWN0T3BlbiIsIm9uVHlwZVNlbGVjdENsb3NlIiwiZm9ybWF0TWVzc2FnZSIsImlkIiwibGVuZ3RoIiwic3RhdGUiLCJ2aXNTdGF0ZSIsImRlbW8iLCJrZXBsZXJHbCIsInVwZGF0ZUVmZmVjdCIsInJlbW92ZUVmZmVj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TUFBQUEsT0FBTyxFQUFFd0IsUUFBUSxDQUFDeEIsT0FEYjtBQUVMQyxNQUFBQSxXQUFXLEVBQUV1QixRQUFRLENBQUN2QjtBQUZqQixLQUFQO0FBSUQsR0FSSSxFQVNMO0FBQ0VGLElBQUFBLGVBQWUsRUFBRTtBQUFDa0IsTUFBQUEsU0FBUyxFQUFUQSxrQkFBRDtBQUFZVSxNQUFBQSxZQUFZLEVBQVpBLHFCQUFaO0FBQTBCQyxNQUFBQSxZQUFZLEVBQVpBLHFCQUExQjtBQUF3Q0MsTUFBQUEsYUFBYSxFQUFiQTtBQUF4QztBQURuQixHQVRLLEVBWUwsMkJBQVdoQyxhQUFYLENBWkssQ0FBUDtBQWFEOztlQUVjUixvQiIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge3VzZU1lbW8sIHVzZVN0YXRlLCB1c2VDYWxsYmFja30gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQge2luamVjdEludGwsIEludGxTaGFwZX0gZnJvbSAncmVhY3QtaW50bCc7XG5cbmltcG9ydCB7YWRkRWZmZWN0LCB1cGRhdGVFZmZlY3QsIHJlbW92ZUVmZmVjdCwgcmVvcmRlckVmZmVjdH0gZnJvbSAnQGtlcGxlci5nbC9hY3Rpb25zJztcbmltcG9ydCB7TElHSFRfQU5EX1NIQURPV19FRkZFQ1QsIEVGRkVDVF9ERVNDUklQVElPTlN9IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcbmltcG9ydCB7VmlzU3RhdGVBY3Rpb25zfSBmcm9tICdAa2VwbGVyLmdsL2FjdGlvbnMnO1xuaW1wb3J0IHtFZmZlY3R9IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuXG5pbXBvcnQge3dpdGhTdGF0ZX0gZnJvbSAnLi4vaW5qZWN0b3InO1xuaW1wb3J0IFNpZGVQYW5lbFRpdGxlRmFjdG9yeSBmcm9tICcuL3NpZGUtcGFuZWwtdGl0bGUnO1xuaW1wb3J0IEVmZmVjdExpc3RGYWN0b3J5IGZyb20gJy4vZWZmZWN0LWxpc3QnO1xuaW1wb3J0IEVmZmVjdFR5cGVTZWxlY3RvckZhY3RvcnkgZnJvbSAnLi9lZmZlY3QtdHlwZS1zZWxlY3Rvcic7XG5cbmV4cG9ydCB0eXBlIEVmZmVjdE1hbmFnZXJTdGF0ZSA9IHtcbiAgdmlzU3RhdGVBY3Rpb25zOiB0eXBlb2YgVmlzU3RhdGVBY3Rpb25zO1xuICBlZmZlY3RzOiBFZmZlY3RbXTtcbiAgZWZmZWN0T3JkZXI6IHN0cmluZ1tdO1xuICBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlO1xufTtcbmV4cG9ydCB0eXBlIEVmZmVjdE1hbmFnZXJQcm9wcyA9IHt9O1xuZXhwb3J0IHR5cGUgRWZmZWN0TWFuYWdlcldpdGhJbnRsUHJvcCA9IHtpbnRsOiBJbnRsU2hhcGV9O1xuXG5jb25zdCBTdHlsZWRFZmZlY3RQYW5lbENvbnRhaW5lciA9IHN0eWxlZC5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIHBvaW50ZXItZXZlbnRzOiBub25lICFpbXBvcnRhbnQ7IC8qIHByZXZlbnQgcGFkZGluZyBmcm9tIGJsb2NraW5nIGlucHV0ICovXG4gIGZsZXgtZ3JvdzogMTtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuXG4gICYgPiAqIHtcbiAgICAvKiBhbGwgY2hpbGRyZW4gc2hvdWxkIGFsbG93IGlucHV0ICovXG4gICAgcG9pbnRlci1ldmVudHM6IGFsbDtcbiAgfVxuYDtcblxuLy8gdG9wIHJpZ2h0IHBvc2l0aW9uIGFic29sdXRlXG5jb25zdCBTdHlsZWRFZmZlY3RQYW5lbCA9IHN0eWxlZC5kaXZgXG4gIHRvcDogMDtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5zaWRlUGFuZWxCZ307XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIGZsZXgtZ3JvdzogMTtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbmA7XG5cbmNvbnN0IFN0eWxlZEVmZmVjdFBhbmVsSGVhZGVyID0gc3R5bGVkLmRpdmBcbiAgcGFkZGluZzogJHsoe3RoZW1lfSkgPT5cbiAgICBgJHt0aGVtZS5lZmZlY3RQYW5lbFBhZGRpbmdUb3B9cHggJHt0aGVtZS5lZmZlY3RQYW5lbFBhZGRpbmdTaWRlfXB4IDRweCAke3RoZW1lLmVmZmVjdFBhbmVsUGFkZGluZ1NpZGV9cHh9YH07XG4gIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAke3Byb3BzID0+IHByb3BzLnRoZW1lLmJvcmRlckNvbG9yfTtcbiAgbWluLXdpZHRoOiAkeyh7dGhlbWV9KSA9PiB0aGVtZS5lZmZlY3RQYW5lbFdpZHRofXB4O1xuYDtcblxudHlwZSBTdHlsZWRFZmZlY3RQYW5lbENvbnRlbnRQcm9wcyA9IHtcbiAgZXh0ZW5kZWQ/OiBib29sZWFuO1xufTtcbmNvbnN0IFN0eWxlZEVmZmVjdFBhbmVsQ29udGVudCA9IHN0eWxlZC5kaXY8U3R5bGVkRWZmZWN0UGFuZWxDb250ZW50UHJvcHM+YFxuICAke3Byb3BzID0+IHByb3BzLnRoZW1lLnNpZGVQYW5lbFNjcm9sbEJhcn07XG4gIHBhZGRpbmc6ICR7cHJvcHMgPT4gKHByb3BzLmV4dGVuZGVkID8gJzMycHgnIDogJzEwcHggMHB4IDEwcHggMHB4Jyl9O1xuICBvdmVyZmxvdzogb3ZlcmxheTtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbmA7XG5cbkVmZmVjdE1hbmFnZXJGYWN0b3J5LmRlcHMgPSBbRWZmZWN0TGlzdEZhY3RvcnksIFNpZGVQYW5lbFRpdGxlRmFjdG9yeSwgRWZmZWN0VHlwZVNlbGVjdG9yRmFjdG9yeV07XG5cbmZ1bmN0aW9uIEVmZmVjdE1hbmFnZXJGYWN0b3J5KFxuICBFZmZlY3RMaXN0OiBSZXR1cm5UeXBlPHR5cGVvZiBFZmZlY3RMaXN0RmFjdG9yeT4sXG4gIFNpZGVQYW5lbFRpdGxlOiBSZXR1cm5UeXBlPHR5cGVvZiBTaWRlUGFuZWxUaXRsZUZhY3Rvcnk+LFxuICBFZmZlY3RUeXBlU2VsZWN0b3I6IFJldHVyblR5cGU8dHlwZW9mIEVmZmVjdFR5cGVTZWxlY3RvckZhY3Rvcnk+XG4pOiBSZWFjdC5GQzxFZmZlY3RNYW5hZ2VyUHJvcHM+IHtcbiAgY29uc3QgRWZmZWN0TWFuYWdlciA9IChwcm9wczogRWZmZWN0TWFuYWdlcldpdGhJbnRsUHJvcCAmIEVmZmVjdE1hbmFnZXJTdGF0ZSkgPT4ge1xuICAgIGNvbnN0IHtpbnRsLCB2aXNTdGF0ZUFjdGlvbnMsIGVmZmVjdHMsIGVmZmVjdE9yZGVyLCBjaGlsZHJlbn0gPSBwcm9wcztcblxuICAgIGNvbnN0IFt0eXBlU2VsZWN0b3JPcGVuZWQsIHNldFR5cGVTZWxlY3Rvck9wZW5lZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG5cbiAgICAvLyBQcmV2ZW50IHNoYWRvdyBlZmZlY3QgZnJvbSBiZWluZyBhZGRlZCBtdWx0aXBsZSB0aW1lc1xuICAgIGNvbnN0IGVmZmVjdE9wdGlvbnMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIGNvbnN0IGhhc1NoYWRvdyA9IGVmZmVjdHMuc29tZShlZmZlY3QgPT4ge1xuICAgICAgICByZXR1cm4gZWZmZWN0LnR5cGUgPT09IExJR0hUX0FORF9TSEFET1dfRUZGRUNULnR5cGU7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIEVGRkVDVF9ERVNDUklQVElPTlMubWFwKGRlc2MgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLmRlc2MsXG4gICAgICAgICAgZGlzYWJsZWQ6IEJvb2xlYW4oaGFzU2hhZG93ICYmIGRlc2MudHlwZSA9PT0gTElHSFRfQU5EX1NIQURPV19FRkZFQ1QudHlwZSlcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0sIFtlZmZlY3RzXSk7XG5cbiAgICBjb25zdCBvbkFkZEVmZmVjdCA9IHVzZUNhbGxiYWNrKHR5cGUgPT4ge1xuICAgICAgdmlzU3RhdGVBY3Rpb25zLmFkZEVmZmVjdCh7dHlwZX0pO1xuICAgIH0sIFtdKTtcblxuICAgIGNvbnN0IG9uVHlwZVNlbGVjdE9wZW4gPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBzZXRUeXBlU2VsZWN0b3JPcGVuZWQodHJ1ZSk7XG4gICAgfSwgW10pO1xuXG4gICAgY29uc3Qgb25UeXBlU2VsZWN0Q2xvc2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBzZXRUeXBlU2VsZWN0b3JPcGVuZWQoZmFsc2UpO1xuICAgIH0sIFtdKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U3R5bGVkRWZmZWN0UGFuZWxDb250YWluZXIgY2xhc3NOYW1lPVwiZWZmZWN0LW1hbmFnZXJcIj5cbiAgICAgICAgPFN0eWxlZEVmZmVjdFBhbmVsPlxuICAgICAgICAgIDxTdHlsZWRFZmZlY3RQYW5lbEhlYWRlcj5cbiAgICAgICAgICAgIDxTaWRlUGFuZWxUaXRsZVxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJlZmZlY3QtbWFuYWdlci10aXRsZVwiXG4gICAgICAgICAgICAgIHRpdGxlPXtpbnRsLmZvcm1hdE1lc3NhZ2Uoe2lkOiAnZWZmZWN0TWFuYWdlci5lZmZlY3RzJ30pfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8RWZmZWN0VHlwZVNlbGVjdG9yXG4gICAgICAgICAgICAgICAgb3B0aW9ucz17ZWZmZWN0T3B0aW9uc31cbiAgICAgICAgICAgICAgICBvblNlbGVjdD17b25BZGRFZmZlY3R9XG4gICAgICAgICAgICAgICAgb25PcGVuPXtvblR5cGVTZWxlY3RPcGVufVxuICAgICAgICAgICAgICAgIG9uQmx1cj17b25UeXBlU2VsZWN0Q2xvc2V9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L1NpZGVQYW5lbFRpdGxlPlxuICAgICAgICAgIDwvU3R5bGVkRWZmZWN0UGFuZWxIZWFkZXI+XG5cbiAgICAgICAgICA8U3R5bGVkRWZmZWN0UGFuZWxDb250ZW50IGV4dGVuZGVkPXt0eXBlU2VsZWN0b3JPcGVuZWQgJiYgZWZmZWN0cy5sZW5ndGggPT09IDB9PlxuICAgICAgICAgICAgPEVmZmVjdExpc3RcbiAgICAgICAgICAgICAgZWZmZWN0cz17ZWZmZWN0c31cbiAgICAgICAgICAgICAgZWZmZWN0T3JkZXI9e2VmZmVjdE9yZGVyfVxuICAgICAgICAgICAgICB2aXNTdGF0ZUFjdGlvbnM9e3Zpc1N0YXRlQWN0aW9uc31cbiAgICAgICAgICAgICAgaXNTb3J0YWJsZT17dHJ1ZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9TdHlsZWRFZmZlY3RQYW5lbENvbnRlbnQ+XG4gICAgICAgIDwvU3R5bGVkRWZmZWN0UGFuZWw+XG4gICAgICAgIHtjaGlsZHJlbn1cbiAgICAgIDwvU3R5bGVkRWZmZWN0UGFuZWxDb250YWluZXI+XG4gICAgKTtcbiAgfTtcblxuICByZXR1cm4gd2l0aFN0YXRlKFxuICAgIFtdLFxuICAgIHN0YXRlID0+IHtcbiAgICAgIGNvbnN0IHZpc1N0YXRlID0gc3RhdGUuZGVtby5rZXBsZXJHbC5tYXAudmlzU3RhdGU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlZmZlY3RzOiB2aXNTdGF0ZS5lZmZlY3RzLFxuICAgICAgICBlZmZlY3RPcmRlcjogdmlzU3RhdGUuZWZmZWN0T3JkZXJcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICB2aXNTdGF0ZUFjdGlvbnM6IHthZGRFZmZlY3QsIHVwZGF0ZUVmZmVjdCwgcmVtb3ZlRWZmZWN0LCByZW9yZGVyRWZmZWN0fVxuICAgIH1cbiAgKShpbmplY3RJbnRsKEVmZmVjdE1hbmFnZXIpKSBhcyBSZWFjdC5GQzx7fT47XG59XG5cbmV4cG9ydCBkZWZhdWx0IEVmZmVjdE1hbmFnZXJGYWN0b3J5O1xuIl19