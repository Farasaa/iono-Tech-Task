{"version":3,"file":"camera-keyframes.js","names":["LINEARLY_INTERPOLATED_PROPS","DEFAULT_OPTS","speed","curve","flyToInterpolator","start","end","factor","options","viewport","flyToViewport","ease","key","lerp","CameraKeyFrames","timings","keyframes","easings","interpolators","width","height","features","getStartData","getEndData","interpolate","Error","maxDuration","getEndTime","getStartTime","Keyframes"],"sources":["../../../src/keyframes/camera-keyframes.js"],"sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport Keyframes from './keyframes';\nimport {flyToViewport} from '@math.gl/web-mercator';\nimport {lerp} from '@math.gl/core';\n\nconst LINEARLY_INTERPOLATED_PROPS = ['bearing', 'pitch'];\nconst DEFAULT_OPTS = {\n  speed: 1.2,\n  curve: 1.414\n  // screenSpeed and maxDuration are used only if specified\n};\n\nexport function flyToInterpolator(start, end, factor, options) {\n  const viewport = flyToViewport(start, end, end.ease(factor), {\n    ...DEFAULT_OPTS,\n    ...options\n  });\n\n  // Linearly interpolate 'bearing' and 'pitch'.\n  // If pitch/bearing are not supplied, they are interpreted as zeros in viewport calculation\n  // (fallback defined in WebMercatorViewport)\n  // Because there is no guarantee that the current controller's ViewState normalizes\n  // these props, safe guard is needed to avoid generating NaNs\n  for (const key of LINEARLY_INTERPOLATED_PROPS) {\n    viewport[key] = lerp(start[key] || 0, end[key] || 0, end.ease(factor));\n  }\n\n  return viewport;\n}\n\nexport default class CameraKeyFrames extends Keyframes {\n  constructor({timings, keyframes, easings, interpolators, width, height}) {\n    super({\n      timings,\n      keyframes,\n      easings,\n      interpolators,\n      features: ['latitude', 'longitude', 'zoom', 'pitch', 'bearing']\n    });\n\n    this.width = width;\n    this.height = height;\n  }\n\n  getFrame() {\n    const factor = this.factor;\n    const start = this.getStartData();\n    const end = this.getEndData();\n\n    if (end.interpolate === 'flyTo') {\n      if (!this.width || !this.height) {\n        throw new Error('width and height must be defined to use flyTo interpolator');\n      }\n      const maxDuration = this.getEndTime() - this.getStartTime();\n      return flyToInterpolator({...start, width: this.width, height: this.height}, end, factor, {\n        maxDuration\n      });\n    }\n\n    return super.getFrame();\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAmBA;;AACA;;AACA;;;;;;;;;;;;;;;;AAEA,IAAMA,2BAA2B,GAAG,CAAC,SAAD,EAAY,OAAZ,CAApC;AACA,IAAMC,YAAY,GAAG;EACnBC,KAAK,EAAE,GADY;EAEnBC,KAAK,EAAE;AAFY,CAArB;;AAMO,SAASC,iBAAT,CAA2BC,KAA3B,EAAkCC,GAAlC,EAAuCC,MAAvC,EAA+CC,OAA/C,EAAwD;EAC7D,IAAMC,QAAQ,GAAG,IAAAC,0BAAA,EAAcL,KAAd,EAAqBC,GAArB,EAA0BA,GAAG,CAACK,IAAJ,CAASJ,MAAT,CAA1B,kCACZN,YADY,GAEZO,OAFY,EAAjB;;EAD6D,2CAW3CR,2BAX2C;EAAA;;EAAA;IAW7D,oDAA+C;MAAA,IAApCY,GAAoC;MAC7CH,QAAQ,CAACG,GAAD,CAAR,GAAgB,IAAAC,UAAA,EAAKR,KAAK,CAACO,GAAD,CAAL,IAAc,CAAnB,EAAsBN,GAAG,CAACM,GAAD,CAAH,IAAY,CAAlC,EAAqCN,GAAG,CAACK,IAAJ,CAASJ,MAAT,CAArC,CAAhB;IACD;EAb4D;IAAA;EAAA;IAAA;EAAA;;EAe7D,OAAOE,QAAP;AACD;;IAEoBK,e;;;;;EACnB,+BAAyE;IAAA;;IAAA,IAA5DC,OAA4D,QAA5DA,OAA4D;IAAA,IAAnDC,SAAmD,QAAnDA,SAAmD;IAAA,IAAxCC,OAAwC,QAAxCA,OAAwC;IAAA,IAA/BC,aAA+B,QAA/BA,aAA+B;IAAA,IAAhBC,KAAgB,QAAhBA,KAAgB;IAAA,IAATC,MAAS,QAATA,MAAS;IAAA;IACvE,0BAAM;MACJL,OAAO,EAAPA,OADI;MAEJC,SAAS,EAATA,SAFI;MAGJC,OAAO,EAAPA,OAHI;MAIJC,aAAa,EAAbA,aAJI;MAKJG,QAAQ,EAAE,CAAC,UAAD,EAAa,WAAb,EAA0B,MAA1B,EAAkC,OAAlC,EAA2C,SAA3C;IALN,CAAN;IAQA,MAAKF,KAAL,GAAaA,KAAb;IACA,MAAKC,MAAL,GAAcA,MAAd;IAVuE;EAWxE;;;;WAED,oBAAW;MACT,IAAMb,MAAM,GAAG,KAAKA,MAApB;MACA,IAAMF,KAAK,GAAG,KAAKiB,YAAL,EAAd;MACA,IAAMhB,GAAG,GAAG,KAAKiB,UAAL,EAAZ;;MAEA,IAAIjB,GAAG,CAACkB,WAAJ,KAAoB,OAAxB,EAAiC;QAC/B,IAAI,CAAC,KAAKL,KAAN,IAAe,CAAC,KAAKC,MAAzB,EAAiC;UAC/B,MAAM,IAAIK,KAAJ,CAAU,4DAAV,CAAN;QACD;;QACD,IAAMC,WAAW,GAAG,KAAKC,UAAL,KAAoB,KAAKC,YAAL,EAAxC;QACA,OAAOxB,iBAAiB,iCAAKC,KAAL;UAAYc,KAAK,EAAE,KAAKA,KAAxB;UAA+BC,MAAM,EAAE,KAAKA;QAA5C,IAAqDd,GAArD,EAA0DC,MAA1D,EAAkE;UACxFmB,WAAW,EAAXA;QADwF,CAAlE,CAAxB;MAGD;;MAED;IACD;;;EA9B0CG,kB"}