{"version":3,"file":"deck-animation.js","names":["CameraKeyframes","DeckLayerKeyframes","Animation","noop","DeckAnimation","constructor","id","cameraKeyframe","undefined","getLayers","_","layerKeyframes","onLayersUpdate","onCameraUpdate","setKeyframes","draw","setOnLayersUpdate","setOnCameraUpdate","setGetLayers","timeline","set","unattachedKeyframes","push","length","reduce","acc","value","attachKeyframes","getKeyframes","animator","animation","getFrame","Object","values","applyLayerKeyframes","layers","map","layer","frame","clone","updateTriggers"],"sources":["../../../src/animations/deck-animation.js"],"sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {CameraKeyframes, DeckLayerKeyframes} from '../keyframes';\nimport Animation from './animation';\n\nfunction noop() {}\n\nexport default class DeckAnimation extends Animation {\n  cameraKeyframe;\n  layerKeyframes = {};\n\n  constructor({\n    id = 'deck',\n    cameraKeyframe = undefined,\n    getLayers = _ => [],\n    layerKeyframes = [],\n    onLayersUpdate = noop,\n    onCameraUpdate = noop\n  }) {\n    super({id});\n    this.layerKeyframes = {};\n    this.onLayersUpdate = onLayersUpdate;\n    this.onCameraUpdate = onCameraUpdate;\n    this.getLayers = getLayers;\n    this.setKeyframes({cameraKeyframe, layerKeyframes});\n    this.draw();\n  }\n\n  setOnLayersUpdate(onLayersUpdate) {\n    this.onLayersUpdate = onLayersUpdate;\n  }\n\n  setOnCameraUpdate(onCameraUpdate) {\n    this.onCameraUpdate = onCameraUpdate;\n  }\n\n  setGetLayers(getLayers) {\n    this.getLayers = getLayers;\n    this.draw();\n  }\n\n  setKeyframes({layerKeyframes = [], cameraKeyframe = undefined, timeline = undefined}) {\n    if (this.cameraKeyframe && cameraKeyframe) {\n      this.cameraKeyframe.set(cameraKeyframe);\n    } else if (cameraKeyframe) {\n      this.cameraKeyframe = new CameraKeyframes(cameraKeyframe);\n      this.unattachedKeyframes.push(this.cameraKeyframe);\n    }\n\n    if (layerKeyframes && layerKeyframes.length > 0) {\n      this.layerKeyframes = layerKeyframes.reduce((acc, value) => {\n        if (acc[value.id]) {\n          acc[value.id].set(value);\n        } else {\n          acc[value.id] = new DeckLayerKeyframes(value);\n          this.unattachedKeyframes.push(acc[value.id]);\n        }\n        return acc;\n      }, this.layerKeyframes);\n    }\n\n    if (timeline) {\n      this.attachKeyframes(timeline);\n    }\n  }\n\n  getKeyframes() {\n    return {\n      cameraKeyframe: this.cameraKeyframe,\n      layerKeyframes: this.layerKeyframes\n    };\n  }\n\n  animator(animation) {\n    if (animation.cameraKeyframe) {\n      animation.onCameraUpdate(animation.cameraKeyframe.getFrame());\n    }\n\n    if (Object.values(animation.layerKeyframes).length > 0) {\n      animation.onLayersUpdate(this.getLayers(animation));\n    }\n  }\n\n  applyLayerKeyframes(layers) {\n    return layers.map(layer => {\n      if (this.layerKeyframes[layer.id]) {\n        const frame = this.layerKeyframes[layer.id].getFrame();\n        return layer.clone({\n          ...frame,\n          updateTriggers: frame\n        });\n      }\n      return layer;\n    });\n  }\n}\n"],"mappings":";AAmBA,SAAQA,eAAR,EAAyBC,kBAAzB,QAAkD,cAAlD;AACA,OAAOC,SAAP,MAAsB,aAAtB;;AAEA,SAASC,IAAT,GAAgB,CAAE;;AAElB,eAAe,MAAMC,aAAN,SAA4BF,SAA5B,CAAsC;EAInDG,WAAW,OAOR;IAAA,IAPS;MACVC,EAAE,GAAG,MADK;MAEVC,cAAc,GAAGC,SAFP;MAGVC,SAAS,GAAGC,CAAC,IAAI,EAHP;MAIVC,cAAc,GAAG,EAJP;MAKVC,cAAc,GAAGT,IALP;MAMVU,cAAc,GAAGV;IANP,CAOT;IACD,MAAM;MAACG;IAAD,CAAN;;IADC;;IAAA,wCATc,EASd;;IAED,KAAKK,cAAL,GAAsB,EAAtB;IACA,KAAKC,cAAL,GAAsBA,cAAtB;IACA,KAAKC,cAAL,GAAsBA,cAAtB;IACA,KAAKJ,SAAL,GAAiBA,SAAjB;IACA,KAAKK,YAAL,CAAkB;MAACP,cAAD;MAAiBI;IAAjB,CAAlB;IACA,KAAKI,IAAL;EACD;;EAEDC,iBAAiB,CAACJ,cAAD,EAAiB;IAChC,KAAKA,cAAL,GAAsBA,cAAtB;EACD;;EAEDK,iBAAiB,CAACJ,cAAD,EAAiB;IAChC,KAAKA,cAAL,GAAsBA,cAAtB;EACD;;EAEDK,YAAY,CAACT,SAAD,EAAY;IACtB,KAAKA,SAAL,GAAiBA,SAAjB;IACA,KAAKM,IAAL;EACD;;EAEDD,YAAY,QAA0E;IAAA,IAAzE;MAACH,cAAc,GAAG,EAAlB;MAAsBJ,cAAc,GAAGC,SAAvC;MAAkDW,QAAQ,GAAGX;IAA7D,CAAyE;;IACpF,IAAI,KAAKD,cAAL,IAAuBA,cAA3B,EAA2C;MACzC,KAAKA,cAAL,CAAoBa,GAApB,CAAwBb,cAAxB;IACD,CAFD,MAEO,IAAIA,cAAJ,EAAoB;MACzB,KAAKA,cAAL,GAAsB,IAAIP,eAAJ,CAAoBO,cAApB,CAAtB;MACA,KAAKc,mBAAL,CAAyBC,IAAzB,CAA8B,KAAKf,cAAnC;IACD;;IAED,IAAII,cAAc,IAAIA,cAAc,CAACY,MAAf,GAAwB,CAA9C,EAAiD;MAC/C,KAAKZ,cAAL,GAAsBA,cAAc,CAACa,MAAf,CAAsB,CAACC,GAAD,EAAMC,KAAN,KAAgB;QAC1D,IAAID,GAAG,CAACC,KAAK,CAACpB,EAAP,CAAP,EAAmB;UACjBmB,GAAG,CAACC,KAAK,CAACpB,EAAP,CAAH,CAAcc,GAAd,CAAkBM,KAAlB;QACD,CAFD,MAEO;UACLD,GAAG,CAACC,KAAK,CAACpB,EAAP,CAAH,GAAgB,IAAIL,kBAAJ,CAAuByB,KAAvB,CAAhB;UACA,KAAKL,mBAAL,CAAyBC,IAAzB,CAA8BG,GAAG,CAACC,KAAK,CAACpB,EAAP,CAAjC;QACD;;QACD,OAAOmB,GAAP;MACD,CARqB,EAQnB,KAAKd,cARc,CAAtB;IASD;;IAED,IAAIQ,QAAJ,EAAc;MACZ,KAAKQ,eAAL,CAAqBR,QAArB;IACD;EACF;;EAEDS,YAAY,GAAG;IACb,OAAO;MACLrB,cAAc,EAAE,KAAKA,cADhB;MAELI,cAAc,EAAE,KAAKA;IAFhB,CAAP;EAID;;EAEDkB,QAAQ,CAACC,SAAD,EAAY;IAClB,IAAIA,SAAS,CAACvB,cAAd,EAA8B;MAC5BuB,SAAS,CAACjB,cAAV,CAAyBiB,SAAS,CAACvB,cAAV,CAAyBwB,QAAzB,EAAzB;IACD;;IAED,IAAIC,MAAM,CAACC,MAAP,CAAcH,SAAS,CAACnB,cAAxB,EAAwCY,MAAxC,GAAiD,CAArD,EAAwD;MACtDO,SAAS,CAAClB,cAAV,CAAyB,KAAKH,SAAL,CAAeqB,SAAf,CAAzB;IACD;EACF;;EAEDI,mBAAmB,CAACC,MAAD,EAAS;IAC1B,OAAOA,MAAM,CAACC,GAAP,CAAWC,KAAK,IAAI;MACzB,IAAI,KAAK1B,cAAL,CAAoB0B,KAAK,CAAC/B,EAA1B,CAAJ,EAAmC;QACjC,MAAMgC,KAAK,GAAG,KAAK3B,cAAL,CAAoB0B,KAAK,CAAC/B,EAA1B,EAA8ByB,QAA9B,EAAd;QACA,OAAOM,KAAK,CAACE,KAAN,CAAY,EACjB,GAAGD,KADc;UAEjBE,cAAc,EAAEF;QAFC,CAAZ,CAAP;MAID;;MACD,OAAOD,KAAP;IACD,CATM,CAAP;EAUD;;AAvFkD"}