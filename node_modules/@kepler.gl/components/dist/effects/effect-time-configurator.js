"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = EffectTimeConfiguratorFactory;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _reactIntl = require("react-intl");

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _momentTimezone = _interopRequireDefault(require("moment-timezone"));

var _suncalc = _interopRequireDefault(require("suncalc"));

var _localization = require("@kepler.gl/localization");

var _utils = require("@kepler.gl/utils");

var _constants = require("@kepler.gl/constants");

var _reducers = require("@kepler.gl/reducers");

var _injector = require("../injector");

var _styledComponents2 = require("../common/styled-components");

var _checkbox = _interopRequireDefault(require("../common/checkbox"));

var _button = _interopRequireDefault(require("../common/data-table/button"));

var _icons = require("../common/icons");

var _timezoneSelector = _interopRequireDefault(require("./timezone-selector"));

var _effectTimeSlider = _interopRequireDefault(require("./effect-time-slider"));

var _effectTimeSelector = _interopRequireDefault(require("./effect-time-selector"));

var _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9;

var DAY_MILISECONDS = 1000 * 60 * 60 * 24;

var StyledWrapper = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: ", "px;\n  ", "\n"])), function (props) {
  var _props$marginBottom;

  return (_props$marginBottom = props.marginBottom) !== null && _props$marginBottom !== void 0 ? _props$marginBottom : 9;
}, function (props) {
  return props.hidden ? 'display: none;' : '';
});

var SliderWrapper = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  margin-top: 13px;\n  margin-bottom: 12px;\n  ", "\n"])), function (props) {
  return props.hidden ? 'display: none;' : '';
});

var StyledButton = (0, _styledComponents["default"])(_button["default"])(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n  background-color: ", ";\n  height: 32px;\n  width: 32px;\n  padding: 5px;\n  border-radius: 4px;\n  justify-content: center;\n  :hover {\n    color: ", ";\n    background-color: ", ";\n  }\n"])), function (props) {
  return props.theme.effectPanelTextSecondary2;
}, function (props) {
  return props.theme.inputBgd;
}, function (props) {
  return props.theme.effectPanelTextMain;
}, function (props) {
  return props.theme.inputBgdHover;
});
var StyledRadio = (0, _styledComponents["default"])(_checkbox["default"])(_templateObject4 || (_templateObject4 = (0, _taggedTemplateLiteral2["default"])(["\n  .kg-checkbox__label {\n    font-family: ", ";\n    font-size: ", ";\n  }\n  .kg-checkbox__label:before {\n    background: transparent;\n    border-color: ", ";\n  }\n  input:checked + .kg-checkbox__label:before {\n    border-color: ", ";\n  }\n  .kg-checkbox__label:after {\n    background-color: ", ";\n  }\n"])), function (props) {
  return props.theme.fontFamily;
}, function (props) {
  return props.theme.inputFontSize;
}, function (props) {
  return props.theme.effectPanelTextSecondary2;
}, function (props) {
  return props.theme.activeColor;
}, function (props) {
  return props.theme.activeColor;
});

var StyledEffectTimeConfigurator = _styledComponents["default"].div(_templateObject5 || (_templateObject5 = (0, _taggedTemplateLiteral2["default"])(["\n  margin-bottom: 8px;\n  margin-top: 3px;\n"])));

var StyledDatePicker = _styledComponents["default"].div(_templateObject6 || (_templateObject6 = (0, _taggedTemplateLiteral2["default"])(["\n  .react-date-picker--open .react-date-picker__wrapper .react-date-picker__inputGroup {\n    border: 1px solid ", ";\n    border-radius: 4px 4px 0px 0px !important;\n  }\n  .react-calendar__navigation__prev2-button,\n  .react-calendar__navigation__next2-button {\n    display: none;\n  }\n  .react-calendar__navigation__label {\n    position: absolute;\n    top: 20px;\n  }\n  .react-calendar__navigation__arrow {\n    position: absolute;\n    top: 18px;\n    font-size: 16px;\n  }\n  .react-calendar__navigation__prev-button {\n    right: 36px;\n  }\n  .react-calendar__navigation__next-button {\n    right: 12px;\n  }\n"])), function (props) {
  return props.theme.activeColor;
});

var WithIconWrapper = _styledComponents["default"].div(_templateObject7 || (_templateObject7 = (0, _taggedTemplateLiteral2["default"])(["\n  position: relative;\n  ", "\n"])), function (props) {
  return props.width ? 'width: ' + props.width : '';
});

var StyledExtraIcon = _styledComponents["default"].div(_templateObject8 || (_templateObject8 = (0, _taggedTemplateLiteral2["default"])(["\n  position: absolute;\n  top: 0px;\n  left: 8px;\n  width: 0px;\n  height: 32px;\n  color: ", ";\n  pointer-events: none;\n"])), function (props) {
  return props.theme.effectPanelTextSecondary2;
});

var TextBlock = _styledComponents["default"].div(_templateObject9 || (_templateObject9 = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n  width: ", ";\n  font-size: ", ";\n"])), function (props) {
  return props.theme.effectPanelTextSecondary2;
}, function (props) {
  return props.width;
}, function (props) {
  return props.theme.inputFontSize;
});
/**
 * Converts date, time and timezone into a UTC timestamp.
 * @param dateStr Date string in YYYY-MM-DD format.
 * @param timeStr Time string in HH:MM format.
 * @param timezone Timezone name.
 * @returns Timestamp or null if case of bad inputs.
 */


var getTimestamp = function getTimestamp(dateStr, timeStr, timezone) {
  var timestamp = null;

  var curr = _momentTimezone["default"].tz("".concat(dateStr, "T").concat(timeStr, ":00"), timezone);

  if (curr.isValid()) {
    timestamp = curr.utc().valueOf();
  }

  return timestamp;
};
/**
 * Converts time of the day into [0, 1] range
 * @param date
 * @returns
 */


var getDayRatio = function getDayRatio(date) {
  return (date.hours() * 60 + date.minutes()) * 60 * 1000 / DAY_MILISECONDS;
};

EffectTimeConfiguratorFactory.deps = [_timezoneSelector["default"], _effectTimeSlider["default"], _effectTimeSelector["default"]];

function EffectTimeConfiguratorFactory(TimezoneSelector, EffectTimeSlider, EffectTimeSelector) {
  var EffectTimeConfigurator = function EffectTimeConfigurator(_ref) {
    var timestamp = _ref.timestamp,
        _timezone = _ref.timezone,
        timeMode = _ref.timeMode,
        onTimeParametersChanged = _ref.onChange,
        mapState = _ref.mapState,
        intl = _ref.intl;
    var timezone = (0, _react.useMemo)(function () {
      return _momentTimezone["default"].tz.names().includes(_timezone) ? _timezone : _constants.DEFAULT_TIMEZONE;
    }, [_timezone]);

    var _useMemo = (0, _react.useMemo)(function () {
      var currentMoment = _momentTimezone["default"].tz(timestamp, timezone); // Slider value from 0 to 1


      var dayProgress = getDayRatio(currentMoment); // Date picker always renders Date in local timezone

      var date = new Date();
      date.setFullYear(currentMoment.year(), currentMoment.month(), currentMoment.date());
      date.setHours(0, 0, 0, 0);
      return [date, currentMoment.toDate(), currentMoment.format('HH:mm'), currentMoment.format('YYYY-MM-DD'), dayProgress];
    }, [timestamp, timezone]),
        _useMemo2 = (0, _slicedToArray2["default"])(_useMemo, 5),
        datePickerDate = _useMemo2[0],
        fullDate = _useMemo2[1],
        formattedTime = _useMemo2[2],
        formattedDate = _useMemo2[3],
        dayTimeProgress = _useMemo2[4];

    var timeSliderConfig = (0, _react.useMemo)(function () {
      var times = _suncalc["default"].getTimes(fullDate, mapState.latitude, mapState.longitude);

      var dawn = times.dawn,
          sunrise = times.sunrise,
          sunset = times.sunset,
          dusk = times.dusk;
      return {
        dawn: getDayRatio(_momentTimezone["default"].tz(dawn.valueOf(), timezone)),
        sunrise: getDayRatio(_momentTimezone["default"].tz(sunrise.valueOf(), timezone)),
        sunset: getDayRatio(_momentTimezone["default"].tz(sunset.valueOf(), timezone)),
        dusk: getDayRatio(_momentTimezone["default"].tz(dusk.valueOf(), timezone)),
        sunriseTime: _momentTimezone["default"].tz(sunrise.valueOf(), timezone).format('hh:mm A'),
        sunsetTime: _momentTimezone["default"].tz(sunset.valueOf(), timezone).format('hh:mm A')
      };
    }, [fullDate, timezone, mapState.latitude, mapState.longitude]);
    var onTimeSliderChange = (0, _react.useCallback)(function (value) {
      var hours = (0, _utils.clamp)([0, 23], Math.floor(value[1] * 24));
      var minutes = (0, _utils.clamp)([0, 59], Math.floor((value[1] * 24 - hours) * 60));
      var newFormattedTime = "".concat(hours < 10 ? '0' + hours : hours, ":").concat(minutes < 10 ? '0' + minutes : minutes);
      var newTimestamp = getTimestamp(formattedDate, newFormattedTime, timezone);
      onTimeParametersChanged({
        timestamp: newTimestamp
      });
    }, [formattedDate, timezone, onTimeParametersChanged]);
    var setDate = (0, _react.useCallback)(function (newDate) {
      if (!newDate) return;
      var newFormattedDate = (0, _momentTimezone["default"])(newDate).format('YYYY-MM-DD');
      var newTimestamp = getTimestamp(newFormattedDate, formattedTime, timezone);
      onTimeParametersChanged({
        timestamp: newTimestamp
      });
    }, [formattedTime, timezone, onTimeParametersChanged]);
    var setTime = (0, _react.useCallback)(function (newTime) {
      if (!newTime) return;
      var newTimestamp = getTimestamp(formattedDate, newTime, timezone);
      onTimeParametersChanged({
        timestamp: newTimestamp
      });
    }, [formattedDate, timezone, onTimeParametersChanged]);
    var setTimezone = (0, _react.useCallback)(function (newTimezone) {
      if (!newTimezone) return;
      var newTimestamp = getTimestamp(formattedDate, formattedTime, newTimezone); // date and time are adjusted to have the same value but in the new timezone

      onTimeParametersChanged({
        timestamp: newTimestamp,
        timezone: newTimezone
      });
    }, [formattedDate, formattedTime, onTimeParametersChanged]);
    var setCurrentDateTime = (0, _react.useCallback)(function () {
      onTimeParametersChanged({
        timestamp: new Date().valueOf()
      });
    }, [onTimeParametersChanged]);
    var formatShortWeekday = (0, _react.useCallback)(function (locale, date) {
      return ['S', 'M', 'T', 'W', 'T', 'F', 'S'][date.getDay()];
    }, []);
    var disableDateTimePick = timeMode !== _constants.LIGHT_AND_SHADOW_EFFECT_TIME_MODES.pick;
    return /*#__PURE__*/_react["default"].createElement(StyledEffectTimeConfigurator, null, /*#__PURE__*/_react["default"].createElement(StyledWrapper, {
      marginBottom: 16
    }, /*#__PURE__*/_react["default"].createElement(StyledRadio, {
      type: "radio",
      checked: timeMode === _constants.LIGHT_AND_SHADOW_EFFECT_TIME_MODES.pick,
      id: "effect-time-toggle-use-pick-time",
      label: intl.formatMessage({
        id: 'effectManager.pickDateTime'
      }),
      onChange: function onChange() {
        onTimeParametersChanged({
          timeMode: _constants.LIGHT_AND_SHADOW_EFFECT_TIME_MODES.pick
        });
      }
    })), /*#__PURE__*/_react["default"].createElement(SliderWrapper, {
      hidden: disableDateTimePick
    }, /*#__PURE__*/_react["default"].createElement(EffectTimeSlider, {
      value: dayTimeProgress,
      onChange: onTimeSliderChange,
      config: timeSliderConfig
    })), /*#__PURE__*/_react["default"].createElement(StyledWrapper, {
      hidden: disableDateTimePick,
      marginBottom: 2
    }, /*#__PURE__*/_react["default"].createElement(TextBlock, {
      width: "32px"
    }), /*#__PURE__*/_react["default"].createElement(TextBlock, {
      width: "110px"
    }, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
      id: 'effectManager.date'
    })), /*#__PURE__*/_react["default"].createElement(TextBlock, {
      width: "110px"
    }, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
      id: 'effectManager.time'
    }))), /*#__PURE__*/_react["default"].createElement(StyledWrapper, {
      hidden: disableDateTimePick,
      marginBottom: 16
    }, /*#__PURE__*/_react["default"].createElement(StyledButton, {
      onClick: setCurrentDateTime,
      "data-for": "pick-time-button",
      "data-tip": true
    }, /*#__PURE__*/_react["default"].createElement(_icons.LocationMarker, {
      height: "16px"
    }), /*#__PURE__*/_react["default"].createElement(_styledComponents2.Tooltip, {
      id: "pick-time-button",
      effect: "solid",
      place: "top",
      delayShow: 500
    }, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
      id: 'effectManager.pickCurrrentTime'
    }))), /*#__PURE__*/_react["default"].createElement(WithIconWrapper, null, /*#__PURE__*/_react["default"].createElement(StyledDatePicker, null, /*#__PURE__*/_react["default"].createElement(_styledComponents2.StyledDatePicker, {
      value: datePickerDate,
      onChange: setDate,
      minDetail: 'month',
      formatShortWeekday: formatShortWeekday
    })), /*#__PURE__*/_react["default"].createElement(StyledExtraIcon, null, /*#__PURE__*/_react["default"].createElement(_icons.Calendar, {
      width: "16px",
      height: "32px"
    }))), /*#__PURE__*/_react["default"].createElement(WithIconWrapper, null, /*#__PURE__*/_react["default"].createElement(EffectTimeSelector, {
      value: formattedTime,
      onChange: setTime
    }), /*#__PURE__*/_react["default"].createElement(StyledExtraIcon, null, /*#__PURE__*/_react["default"].createElement(_icons.Clock, {
      width: "16px",
      height: "32px"
    })))), /*#__PURE__*/_react["default"].createElement(StyledWrapper, {
      hidden: disableDateTimePick,
      marginBottom: 2
    }, /*#__PURE__*/_react["default"].createElement(TextBlock, null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
      id: 'effectManager.timezone'
    }))), /*#__PURE__*/_react["default"].createElement(StyledWrapper, {
      hidden: disableDateTimePick,
      marginBottom: 24
    }, /*#__PURE__*/_react["default"].createElement(WithIconWrapper, {
      width: '100%'
    }, /*#__PURE__*/_react["default"].createElement(TimezoneSelector, {
      selected: timezone,
      onSelect: setTimezone
    }), /*#__PURE__*/_react["default"].createElement(StyledExtraIcon, null, /*#__PURE__*/_react["default"].createElement(_icons.Globe, {
      width: "16px",
      height: "32px"
    })))), /*#__PURE__*/_react["default"].createElement(StyledWrapper, {
      marginBottom: 16
    }, /*#__PURE__*/_react["default"].createElement(StyledRadio, {
      type: "radio",
      checked: timeMode === _constants.LIGHT_AND_SHADOW_EFFECT_TIME_MODES.current,
      id: "effect-time-toggle-use-current-time",
      label: intl.formatMessage({
        id: 'effectManager.currentTime'
      }),
      onChange: function onChange() {
        onTimeParametersChanged({
          timeMode: _constants.LIGHT_AND_SHADOW_EFFECT_TIME_MODES.current
        });
      }
    })), /*#__PURE__*/_react["default"].createElement(StyledWrapper, {
      marginBottom: 16
    }, /*#__PURE__*/_react["default"].createElement(StyledRadio, {
      type: "radio",
      checked: timeMode === _constants.LIGHT_AND_SHADOW_EFFECT_TIME_MODES.animation,
      id: "effect-time-toggle-use-animation-time",
      label: 'Animation time',
      onChange: function onChange() {
        onTimeParametersChanged({
          timeMode: _constants.LIGHT_AND_SHADOW_EFFECT_TIME_MODES.animation
        });
      }
    })));
  }; // @ts-expect-error how to properly type?


  return (0, _injector.withState)([_reducers.mapStateLens])((0, _reactIntl.injectIntl)(EffectTimeConfigurator));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lZmZlY3RzL2VmZmVjdC10aW1lLWNvbmZpZ3VyYXRvci50c3giXSwibmFtZXMiOlsiREFZX01JTElTRUNPTkRTIiwiU3R5bGVkV3JhcHBlciIsInN0eWxlZCIsImRpdiIsInByb3BzIiwibWFyZ2luQm90dG9tIiwiaGlkZGVuIiwiU2xpZGVyV3JhcHBlciIsIlN0eWxlZEJ1dHRvbiIsIkJ1dHRvbiIsInRoZW1lIiwiZWZmZWN0UGFuZWxUZXh0U2Vjb25kYXJ5MiIsImlucHV0QmdkIiwiZWZmZWN0UGFuZWxUZXh0TWFpbiIsImlucHV0QmdkSG92ZXIiLCJTdHlsZWRSYWRpbyIsIkNoZWNrYm94IiwiZm9udEZhbWlseSIsImlucHV0Rm9udFNpemUiLCJhY3RpdmVDb2xvciIsIlN0eWxlZEVmZmVjdFRpbWVDb25maWd1cmF0b3IiLCJTdHlsZWREYXRlUGlja2VyIiwiV2l0aEljb25XcmFwcGVyIiwid2lkdGgiLCJTdHlsZWRFeHRyYUljb24iLCJUZXh0QmxvY2siLCJnZXRUaW1lc3RhbXAiLCJkYXRlU3RyIiwidGltZVN0ciIsInRpbWV6b25lIiwidGltZXN0YW1wIiwiY3VyciIsIm1vbWVudCIsInR6IiwiaXNWYWxpZCIsInV0YyIsInZhbHVlT2YiLCJnZXREYXlSYXRpbyIsImRhdGUiLCJob3VycyIsIm1pbnV0ZXMiLCJFZmZlY3RUaW1lQ29uZmlndXJhdG9yRmFjdG9yeSIsImRlcHMiLCJUaW1lem9uZVNlbGVjdG9yRmFjdG9yeSIsIkVmZmVjdFRpbWVTbGlkZXJGYWN0b3J5IiwiRWZmZWN0VGltZVNlbGVjdG9yRmFjdG9yeSIsIlRpbWV6b25lU2VsZWN0b3IiLCJFZmZlY3RUaW1lU2xpZGVyIiwiRWZmZWN0VGltZVNlbGVjdG9yIiwiRWZmZWN0VGltZUNvbmZpZ3VyYXRvciIsIl90aW1lem9uZSIsInRpbWVNb2RlIiwib25UaW1lUGFyYW1ldGVyc0NoYW5nZWQiLCJvbkNoYW5nZSIsIm1hcFN0YXRlIiwiaW50bCIsIm5hbWVzIiwiaW5jbHVkZXMiLCJERUZBVUxUX1RJTUVaT05FIiwiY3VycmVudE1vbWVudCIsImRheVByb2dyZXNzIiwiRGF0ZSIsInNldEZ1bGxZZWFyIiwieWVhciIsIm1vbnRoIiwic2V0SG91cnMiLCJ0b0RhdGUiLCJmb3JtYXQiLCJkYXRlUGlja2VyRGF0ZSIsImZ1bGxEYXRlIiwiZm9ybWF0dGVkVGltZSIsImZvcm1hdHRlZERhdGUiLCJkYXlUaW1lUHJvZ3Jlc3MiLCJ0aW1lU2xpZGVyQ29uZmlnIiwidGltZXMiLCJTdW5DYWxjIiwiZ2V0VGltZXMiLCJsYXRpdHVkZSIsImxvbmdpdHVkZSIsImRhd24iLCJzdW5yaXNlIiwic3Vuc2V0IiwiZHVzayIsInN1bnJpc2VUaW1lIiwic3Vuc2V0VGltZSIsIm9uVGltZVNsaWRlckNoYW5nZSIsInZhbHVlIiwiTWF0aCIsImZsb29yIiwibmV3Rm9ybWF0dGVkVGltZSIsIm5ld1RpbWVzdGFtcCIsInNldERhdGUiLCJuZXdEYXRlIiwibmV3Rm9ybWF0dGVkRGF0ZSIsInNldFRpbWUiLCJuZXdUaW1lIiwic2V0VGltZXpvbmUiLCJuZXdUaW1lem9uZSIsInNldEN1cnJlbnREYXRlVGltZSIsImZvcm1hdFNob3J0V2Vla2RheSIsImxvY2FsZSIsImdldERheSIsImRpc2FibGVEYXRlVGltZVBpY2siLCJMSUdIVF9BTkRfU0hBRE9XX0VGRkVDVF9USU1FX01PREVTIiwicGljayIsImZvcm1hdE1lc3NhZ2UiLCJpZCIsImN1cnJlbnQiLCJhbmltYXRpb24iLCJtYXBTdGF0ZUxlbnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOztBQUtBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsSUFBTUEsZUFBZSxHQUFHLE9BQU8sRUFBUCxHQUFZLEVBQVosR0FBaUIsRUFBekM7O0FBY0EsSUFBTUMsYUFBYSxHQUFHQyw2QkFBT0MsR0FBVix3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QUFBN0Isb0JBQ0UsZ0NBQUMsV0FBRDtBQUNFLE1BQUEsSUFBSSxFQUFDLE9BRFA7QUFFRSxNQUFBLE9BQU8sRUFBRXhELFFBQVEsS0FBS29ELDhDQUFtQ0ssU0FGM0Q7QUFHRSxNQUFBLEVBQUUseUNBSEo7QUFJRSxNQUFBLEtBQUssRUFBRSxnQkFKVDtBQUtFLE1BQUEsUUFBUSxFQUFFLG9CQUFNO0FBQ2R4RCxRQUFBQSx1QkFBdUIsQ0FBQztBQUFDRCxVQUFBQSxRQUFRLEVBQUVvRCw4Q0FBbUNLO0FBQTlDLFNBQUQsQ0FBdkI7QUFDRDtBQVBILE1BREYsQ0ExRkYsQ0FERjtBQXdHRCxHQXBORCxDQUR1QyxDQXVOdkM7OztBQUNBLFNBQU8seUJBQVUsQ0FBQ0Msc0JBQUQsQ0FBVixFQUEwQiwyQkFBVzVELHNCQUFYLENBQTFCLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge3VzZUNhbGxiYWNrLCB1c2VNZW1vfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge2luamVjdEludGwsIEludGxTaGFwZX0gZnJvbSAncmVhY3QtaW50bCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LXRpbWV6b25lJztcbmltcG9ydCBTdW5DYWxjIGZyb20gJ3N1bmNhbGMnO1xuXG5pbXBvcnQge01hcFN0YXRlfSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcbmltcG9ydCB7Rm9ybWF0dGVkTWVzc2FnZX0gZnJvbSAnQGtlcGxlci5nbC9sb2NhbGl6YXRpb24nO1xuaW1wb3J0IHtjbGFtcH0gZnJvbSAnQGtlcGxlci5nbC91dGlscyc7XG5pbXBvcnQge1xuICBMSUdIVF9BTkRfU0hBRE9XX0VGRkVDVF9USU1FX01PREVTLFxuICBMaWdodEFuZFNoYWRvd0VmZmVjdFRpbWVNb2RlLFxuICBERUZBVUxUX1RJTUVaT05FXG59IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcbmltcG9ydCB7bWFwU3RhdGVMZW5zfSBmcm9tICdAa2VwbGVyLmdsL3JlZHVjZXJzJztcblxuaW1wb3J0IHt3aXRoU3RhdGV9IGZyb20gJy4uL2luamVjdG9yJztcbmltcG9ydCB7U3R5bGVkRGF0ZVBpY2tlciBhcyBEYXRlUGlja2VyLCBUb29sdGlwfSBmcm9tICcuLi9jb21tb24vc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IENoZWNrYm94IGZyb20gJy4uL2NvbW1vbi9jaGVja2JveCc7XG5pbXBvcnQgQnV0dG9uIGZyb20gJy4uL2NvbW1vbi9kYXRhLXRhYmxlL2J1dHRvbic7XG5pbXBvcnQge0xvY2F0aW9uTWFya2VyLCBDYWxlbmRhciwgQ2xvY2ssIEdsb2JlfSBmcm9tICcuLi9jb21tb24vaWNvbnMnO1xuaW1wb3J0IFRpbWV6b25lU2VsZWN0b3JGYWN0b3J5IGZyb20gJy4vdGltZXpvbmUtc2VsZWN0b3InO1xuaW1wb3J0IEVmZmVjdFRpbWVTbGlkZXJGYWN0b3J5IGZyb20gJy4vZWZmZWN0LXRpbWUtc2xpZGVyJztcbmltcG9ydCBFZmZlY3RUaW1lU2VsZWN0b3JGYWN0b3J5IGZyb20gJy4vZWZmZWN0LXRpbWUtc2VsZWN0b3InO1xuXG5jb25zdCBEQVlfTUlMSVNFQ09ORFMgPSAxMDAwICogNjAgKiA2MCAqIDI0O1xuXG5leHBvcnQgdHlwZSBFZmZlY3RUaW1lQ29uZmlndXJhdG9yUHJvcHMgPSB7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICB0aW1lem9uZTogc3RyaW5nO1xuICB0aW1lTW9kZTogTGlnaHRBbmRTaGFkb3dFZmZlY3RUaW1lTW9kZTtcbiAgb25DaGFuZ2U6IChwYXJhbWV0ZXJzOiB7XG4gICAgdGltZXN0YW1wPzogbnVtYmVyIHwgbnVsbDtcbiAgICB0aW1lem9uZT86IHN0cmluZztcbiAgICB0aW1lTW9kZT86IExpZ2h0QW5kU2hhZG93RWZmZWN0VGltZU1vZGU7XG4gIH0pID0+IHZvaWQ7XG59O1xuXG50eXBlIFN0eWxlZFdyYXBwZXJQcm9wcyA9IHtkaXNhYmxlZD86IGJvb2xlYW47IG1hcmdpbkJvdHRvbT86IG51bWJlcn07XG5jb25zdCBTdHlsZWRXcmFwcGVyID0gc3R5bGVkLmRpdjxTdHlsZWRXcmFwcGVyUHJvcHM+YFxuICBkaXNwbGF5OiBmbGV4O1xuICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIG1hcmdpbi1ib3R0b206ICR7cHJvcHMgPT4gcHJvcHMubWFyZ2luQm90dG9tID8/IDl9cHg7XG4gICR7cHJvcHMgPT4gKHByb3BzLmhpZGRlbiA/ICdkaXNwbGF5OiBub25lOycgOiAnJyl9XG5gO1xuXG50eXBlIFNsaWRlcldyYXBwZXJQcm9wcyA9IHtkaXNhYmxlZD86IGJvb2xlYW59O1xuY29uc3QgU2xpZGVyV3JhcHBlciA9IHN0eWxlZC5kaXY8U2xpZGVyV3JhcHBlclByb3BzPmBcbiAgbWFyZ2luLXRvcDogMTNweDtcbiAgbWFyZ2luLWJvdHRvbTogMTJweDtcbiAgJHtwcm9wcyA9PiAocHJvcHMuaGlkZGVuID8gJ2Rpc3BsYXk6IG5vbmU7JyA6ICcnKX1cbmA7XG5cbmNvbnN0IFN0eWxlZEJ1dHRvbiA9IHN0eWxlZChCdXR0b24pYFxuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5lZmZlY3RQYW5lbFRleHRTZWNvbmRhcnkyfTtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5pbnB1dEJnZH07XG4gIGhlaWdodDogMzJweDtcbiAgd2lkdGg6IDMycHg7XG4gIHBhZGRpbmc6IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgOmhvdmVyIHtcbiAgICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5lZmZlY3RQYW5lbFRleHRNYWlufTtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmlucHV0QmdkSG92ZXJ9O1xuICB9XG5gO1xuXG5jb25zdCBTdHlsZWRSYWRpbyA9IHN0eWxlZChDaGVja2JveClgXG4gIC5rZy1jaGVja2JveF9fbGFiZWwge1xuICAgIGZvbnQtZmFtaWx5OiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmZvbnRGYW1pbHl9O1xuICAgIGZvbnQtc2l6ZTogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5pbnB1dEZvbnRTaXplfTtcbiAgfVxuICAua2ctY2hlY2tib3hfX2xhYmVsOmJlZm9yZSB7XG4gICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7XG4gICAgYm9yZGVyLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmVmZmVjdFBhbmVsVGV4dFNlY29uZGFyeTJ9O1xuICB9XG4gIGlucHV0OmNoZWNrZWQgKyAua2ctY2hlY2tib3hfX2xhYmVsOmJlZm9yZSB7XG4gICAgYm9yZGVyLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmFjdGl2ZUNvbG9yfTtcbiAgfVxuICAua2ctY2hlY2tib3hfX2xhYmVsOmFmdGVyIHtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmFjdGl2ZUNvbG9yfTtcbiAgfVxuYDtcblxuY29uc3QgU3R5bGVkRWZmZWN0VGltZUNvbmZpZ3VyYXRvciA9IHN0eWxlZC5kaXZgXG4gIG1hcmdpbi1ib3R0b206IDhweDtcbiAgbWFyZ2luLXRvcDogM3B4O1xuYDtcblxuY29uc3QgU3R5bGVkRGF0ZVBpY2tlciA9IHN0eWxlZC5kaXZgXG4gIC5yZWFjdC1kYXRlLXBpY2tlci0tb3BlbiAucmVhY3QtZGF0ZS1waWNrZXJfX3dyYXBwZXIgLnJlYWN0LWRhdGUtcGlja2VyX19pbnB1dEdyb3VwIHtcbiAgICBib3JkZXI6IDFweCBzb2xpZCAke3Byb3BzID0+IHByb3BzLnRoZW1lLmFjdGl2ZUNvbG9yfTtcbiAgICBib3JkZXItcmFkaXVzOiA0cHggNHB4IDBweCAwcHggIWltcG9ydGFudDtcbiAgfVxuICAucmVhY3QtY2FsZW5kYXJfX25hdmlnYXRpb25fX3ByZXYyLWJ1dHRvbixcbiAgLnJlYWN0LWNhbGVuZGFyX19uYXZpZ2F0aW9uX19uZXh0Mi1idXR0b24ge1xuICAgIGRpc3BsYXk6IG5vbmU7XG4gIH1cbiAgLnJlYWN0LWNhbGVuZGFyX19uYXZpZ2F0aW9uX19sYWJlbCB7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIHRvcDogMjBweDtcbiAgfVxuICAucmVhY3QtY2FsZW5kYXJfX25hdmlnYXRpb25fX2Fycm93IHtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgdG9wOiAxOHB4O1xuICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgfVxuICAucmVhY3QtY2FsZW5kYXJfX25hdmlnYXRpb25fX3ByZXYtYnV0dG9uIHtcbiAgICByaWdodDogMzZweDtcbiAgfVxuICAucmVhY3QtY2FsZW5kYXJfX25hdmlnYXRpb25fX25leHQtYnV0dG9uIHtcbiAgICByaWdodDogMTJweDtcbiAgfVxuYDtcblxudHlwZSBXaXRoSWNvbldyYXBwZXJQcm9wcyA9IHt3aWR0aD86IHN0cmluZ307XG5jb25zdCBXaXRoSWNvbldyYXBwZXIgPSBzdHlsZWQuZGl2PFdpdGhJY29uV3JhcHBlclByb3BzPmBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAke3Byb3BzID0+IChwcm9wcy53aWR0aCA/ICd3aWR0aDogJyArIHByb3BzLndpZHRoIDogJycpfVxuYDtcblxuY29uc3QgU3R5bGVkRXh0cmFJY29uID0gc3R5bGVkLmRpdmBcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB0b3A6IDBweDtcbiAgbGVmdDogOHB4O1xuICB3aWR0aDogMHB4O1xuICBoZWlnaHQ6IDMycHg7XG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmVmZmVjdFBhbmVsVGV4dFNlY29uZGFyeTJ9O1xuICBwb2ludGVyLWV2ZW50czogbm9uZTtcbmA7XG5cbnR5cGUgVGV4dEJsb2NrUHJvcHMgPSB7XG4gIHdpZHRoPzogc3RyaW5nO1xufTtcbmNvbnN0IFRleHRCbG9jayA9IHN0eWxlZC5kaXY8VGV4dEJsb2NrUHJvcHM+YFxuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5lZmZlY3RQYW5lbFRleHRTZWNvbmRhcnkyfTtcbiAgd2lkdGg6ICR7cHJvcHMgPT4gcHJvcHMud2lkdGh9O1xuICBmb250LXNpemU6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuaW5wdXRGb250U2l6ZX07XG5gO1xuXG4vKipcbiAqIENvbnZlcnRzIGRhdGUsIHRpbWUgYW5kIHRpbWV6b25lIGludG8gYSBVVEMgdGltZXN0YW1wLlxuICogQHBhcmFtIGRhdGVTdHIgRGF0ZSBzdHJpbmcgaW4gWVlZWS1NTS1ERCBmb3JtYXQuXG4gKiBAcGFyYW0gdGltZVN0ciBUaW1lIHN0cmluZyBpbiBISDpNTSBmb3JtYXQuXG4gKiBAcGFyYW0gdGltZXpvbmUgVGltZXpvbmUgbmFtZS5cbiAqIEByZXR1cm5zIFRpbWVzdGFtcCBvciBudWxsIGlmIGNhc2Ugb2YgYmFkIGlucHV0cy5cbiAqL1xuY29uc3QgZ2V0VGltZXN0YW1wID0gKGRhdGVTdHI6IHN0cmluZywgdGltZVN0cjogc3RyaW5nLCB0aW1lem9uZTogc3RyaW5nKTogbnVtYmVyIHwgbnVsbCA9PiB7XG4gIGxldCB0aW1lc3RhbXA6IG51bWJlciB8IG51bGwgPSBudWxsO1xuICBjb25zdCBjdXJyID0gbW9tZW50LnR6KGAke2RhdGVTdHJ9VCR7dGltZVN0cn06MDBgLCB0aW1lem9uZSk7XG4gIGlmIChjdXJyLmlzVmFsaWQoKSkge1xuICAgIHRpbWVzdGFtcCA9IGN1cnIudXRjKCkudmFsdWVPZigpO1xuICB9XG4gIHJldHVybiB0aW1lc3RhbXA7XG59O1xuXG4vKipcbiAqIENvbnZlcnRzIHRpbWUgb2YgdGhlIGRheSBpbnRvIFswLCAxXSByYW5nZVxuICogQHBhcmFtIGRhdGVcbiAqIEByZXR1cm5zXG4gKi9cbmNvbnN0IGdldERheVJhdGlvID0gKGRhdGU6IG1vbWVudC5Nb21lbnQpID0+IHtcbiAgcmV0dXJuICgoZGF0ZS5ob3VycygpICogNjAgKyBkYXRlLm1pbnV0ZXMoKSkgKiA2MCAqIDEwMDApIC8gREFZX01JTElTRUNPTkRTO1xufTtcblxuRWZmZWN0VGltZUNvbmZpZ3VyYXRvckZhY3RvcnkuZGVwcyA9IFtcbiAgVGltZXpvbmVTZWxlY3RvckZhY3RvcnksXG4gIEVmZmVjdFRpbWVTbGlkZXJGYWN0b3J5LFxuICBFZmZlY3RUaW1lU2VsZWN0b3JGYWN0b3J5XG5dO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBFZmZlY3RUaW1lQ29uZmlndXJhdG9yRmFjdG9yeShcbiAgVGltZXpvbmVTZWxlY3RvcjogUmV0dXJuVHlwZTx0eXBlb2YgVGltZXpvbmVTZWxlY3RvckZhY3Rvcnk+LFxuICBFZmZlY3RUaW1lU2xpZGVyOiBSZXR1cm5UeXBlPHR5cGVvZiBFZmZlY3RUaW1lU2xpZGVyRmFjdG9yeT4sXG4gIEVmZmVjdFRpbWVTZWxlY3RvcjogUmV0dXJuVHlwZTx0eXBlb2YgRWZmZWN0VGltZVNlbGVjdG9yRmFjdG9yeT5cbik6IFJlYWN0LkZDPEVmZmVjdFRpbWVDb25maWd1cmF0b3JQcm9wcz4ge1xuICBjb25zdCBFZmZlY3RUaW1lQ29uZmlndXJhdG9yID0gKHtcbiAgICB0aW1lc3RhbXAsXG4gICAgdGltZXpvbmU6IF90aW1lem9uZSxcbiAgICB0aW1lTW9kZSxcbiAgICBvbkNoYW5nZTogb25UaW1lUGFyYW1ldGVyc0NoYW5nZWQsXG4gICAgbWFwU3RhdGUsXG4gICAgaW50bFxuICB9OiBFZmZlY3RUaW1lQ29uZmlndXJhdG9yUHJvcHMgJiB7aW50bDogSW50bFNoYXBlOyBtYXBTdGF0ZTogTWFwU3RhdGV9KSA9PiB7XG4gICAgY29uc3QgdGltZXpvbmUgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiBtb21lbnQudHoubmFtZXMoKS5pbmNsdWRlcyhfdGltZXpvbmUpID8gX3RpbWV6b25lIDogREVGQVVMVF9USU1FWk9ORTtcbiAgICB9LCBbX3RpbWV6b25lXSk7XG5cbiAgICBjb25zdCBbXG4gICAgICBkYXRlUGlja2VyRGF0ZSxcbiAgICAgIGZ1bGxEYXRlLFxuICAgICAgZm9ybWF0dGVkVGltZSxcbiAgICAgIGZvcm1hdHRlZERhdGUsXG4gICAgICBkYXlUaW1lUHJvZ3Jlc3NcbiAgICBdID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50TW9tZW50ID0gbW9tZW50LnR6KHRpbWVzdGFtcCwgdGltZXpvbmUpO1xuXG4gICAgICAvLyBTbGlkZXIgdmFsdWUgZnJvbSAwIHRvIDFcbiAgICAgIGNvbnN0IGRheVByb2dyZXNzID0gZ2V0RGF5UmF0aW8oY3VycmVudE1vbWVudCk7XG5cbiAgICAgIC8vIERhdGUgcGlja2VyIGFsd2F5cyByZW5kZXJzIERhdGUgaW4gbG9jYWwgdGltZXpvbmVcbiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgZGF0ZS5zZXRGdWxsWWVhcihjdXJyZW50TW9tZW50LnllYXIoKSwgY3VycmVudE1vbWVudC5tb250aCgpLCBjdXJyZW50TW9tZW50LmRhdGUoKSk7XG4gICAgICBkYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuXG4gICAgICByZXR1cm4gW1xuICAgICAgICBkYXRlLFxuICAgICAgICBjdXJyZW50TW9tZW50LnRvRGF0ZSgpLFxuICAgICAgICBjdXJyZW50TW9tZW50LmZvcm1hdCgnSEg6bW0nKSxcbiAgICAgICAgY3VycmVudE1vbWVudC5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgZGF5UHJvZ3Jlc3NcbiAgICAgIF07XG4gICAgfSwgW3RpbWVzdGFtcCwgdGltZXpvbmVdKTtcblxuICAgIGNvbnN0IHRpbWVTbGlkZXJDb25maWcgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIGNvbnN0IHRpbWVzID0gU3VuQ2FsYy5nZXRUaW1lcyhmdWxsRGF0ZSwgbWFwU3RhdGUubGF0aXR1ZGUsIG1hcFN0YXRlLmxvbmdpdHVkZSk7XG4gICAgICBjb25zdCB7ZGF3biwgc3VucmlzZSwgc3Vuc2V0LCBkdXNrfSA9IHRpbWVzO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBkYXduOiBnZXREYXlSYXRpbyhtb21lbnQudHooZGF3bi52YWx1ZU9mKCksIHRpbWV6b25lKSksXG4gICAgICAgIHN1bnJpc2U6IGdldERheVJhdGlvKG1vbWVudC50eihzdW5yaXNlLnZhbHVlT2YoKSwgdGltZXpvbmUpKSxcbiAgICAgICAgc3Vuc2V0OiBnZXREYXlSYXRpbyhtb21lbnQudHooc3Vuc2V0LnZhbHVlT2YoKSwgdGltZXpvbmUpKSxcbiAgICAgICAgZHVzazogZ2V0RGF5UmF0aW8obW9tZW50LnR6KGR1c2sudmFsdWVPZigpLCB0aW1lem9uZSkpLFxuICAgICAgICBzdW5yaXNlVGltZTogbW9tZW50LnR6KHN1bnJpc2UudmFsdWVPZigpLCB0aW1lem9uZSkuZm9ybWF0KCdoaDptbSBBJyksXG4gICAgICAgIHN1bnNldFRpbWU6IG1vbWVudC50eihzdW5zZXQudmFsdWVPZigpLCB0aW1lem9uZSkuZm9ybWF0KCdoaDptbSBBJylcbiAgICAgIH07XG4gICAgfSwgW2Z1bGxEYXRlLCB0aW1lem9uZSwgbWFwU3RhdGUubGF0aXR1ZGUsIG1hcFN0YXRlLmxvbmdpdHVkZV0pO1xuXG4gICAgY29uc3Qgb25UaW1lU2xpZGVyQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgICB2YWx1ZSA9PiB7XG4gICAgICAgIGNvbnN0IGhvdXJzID0gY2xhbXAoWzAsIDIzXSwgTWF0aC5mbG9vcih2YWx1ZVsxXSAqIDI0KSk7XG4gICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBjbGFtcChbMCwgNTldLCBNYXRoLmZsb29yKCh2YWx1ZVsxXSAqIDI0IC0gaG91cnMpICogNjApKTtcblxuICAgICAgICBjb25zdCBuZXdGb3JtYXR0ZWRUaW1lID0gYCR7aG91cnMgPCAxMCA/ICcwJyArIGhvdXJzIDogaG91cnN9OiR7XG4gICAgICAgICAgbWludXRlcyA8IDEwID8gJzAnICsgbWludXRlcyA6IG1pbnV0ZXNcbiAgICAgICAgfWA7XG4gICAgICAgIGNvbnN0IG5ld1RpbWVzdGFtcCA9IGdldFRpbWVzdGFtcChmb3JtYXR0ZWREYXRlLCBuZXdGb3JtYXR0ZWRUaW1lLCB0aW1lem9uZSk7XG4gICAgICAgIG9uVGltZVBhcmFtZXRlcnNDaGFuZ2VkKHt0aW1lc3RhbXA6IG5ld1RpbWVzdGFtcH0pO1xuICAgICAgfSxcbiAgICAgIFtmb3JtYXR0ZWREYXRlLCB0aW1lem9uZSwgb25UaW1lUGFyYW1ldGVyc0NoYW5nZWRdXG4gICAgKTtcblxuICAgIGNvbnN0IHNldERhdGUgPSB1c2VDYWxsYmFjayhcbiAgICAgIG5ld0RhdGUgPT4ge1xuICAgICAgICBpZiAoIW5ld0RhdGUpIHJldHVybjtcblxuICAgICAgICBjb25zdCBuZXdGb3JtYXR0ZWREYXRlID0gbW9tZW50KG5ld0RhdGUpLmZvcm1hdCgnWVlZWS1NTS1ERCcpO1xuICAgICAgICBjb25zdCBuZXdUaW1lc3RhbXAgPSBnZXRUaW1lc3RhbXAobmV3Rm9ybWF0dGVkRGF0ZSwgZm9ybWF0dGVkVGltZSwgdGltZXpvbmUpO1xuICAgICAgICBvblRpbWVQYXJhbWV0ZXJzQ2hhbmdlZCh7dGltZXN0YW1wOiBuZXdUaW1lc3RhbXB9KTtcbiAgICAgIH0sXG4gICAgICBbZm9ybWF0dGVkVGltZSwgdGltZXpvbmUsIG9uVGltZVBhcmFtZXRlcnNDaGFuZ2VkXVxuICAgICk7XG5cbiAgICBjb25zdCBzZXRUaW1lID0gdXNlQ2FsbGJhY2soXG4gICAgICBuZXdUaW1lID0+IHtcbiAgICAgICAgaWYgKCFuZXdUaW1lKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgbmV3VGltZXN0YW1wID0gZ2V0VGltZXN0YW1wKGZvcm1hdHRlZERhdGUsIG5ld1RpbWUsIHRpbWV6b25lKTtcbiAgICAgICAgb25UaW1lUGFyYW1ldGVyc0NoYW5nZWQoe3RpbWVzdGFtcDogbmV3VGltZXN0YW1wfSk7XG4gICAgICB9LFxuICAgICAgW2Zvcm1hdHRlZERhdGUsIHRpbWV6b25lLCBvblRpbWVQYXJhbWV0ZXJzQ2hhbmdlZF1cbiAgICApO1xuXG4gICAgY29uc3Qgc2V0VGltZXpvbmUgPSB1c2VDYWxsYmFjayhcbiAgICAgIG5ld1RpbWV6b25lID0+IHtcbiAgICAgICAgaWYgKCFuZXdUaW1lem9uZSkgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IG5ld1RpbWVzdGFtcCA9IGdldFRpbWVzdGFtcChmb3JtYXR0ZWREYXRlLCBmb3JtYXR0ZWRUaW1lLCBuZXdUaW1lem9uZSk7XG4gICAgICAgIC8vIGRhdGUgYW5kIHRpbWUgYXJlIGFkanVzdGVkIHRvIGhhdmUgdGhlIHNhbWUgdmFsdWUgYnV0IGluIHRoZSBuZXcgdGltZXpvbmVcbiAgICAgICAgb25UaW1lUGFyYW1ldGVyc0NoYW5nZWQoe3RpbWVzdGFtcDogbmV3VGltZXN0YW1wLCB0aW1lem9uZTogbmV3VGltZXpvbmV9KTtcbiAgICAgIH0sXG4gICAgICBbZm9ybWF0dGVkRGF0ZSwgZm9ybWF0dGVkVGltZSwgb25UaW1lUGFyYW1ldGVyc0NoYW5nZWRdXG4gICAgKTtcblxuICAgIGNvbnN0IHNldEN1cnJlbnREYXRlVGltZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIG9uVGltZVBhcmFtZXRlcnNDaGFuZ2VkKHt0aW1lc3RhbXA6IG5ldyBEYXRlKCkudmFsdWVPZigpfSk7XG4gICAgfSwgW29uVGltZVBhcmFtZXRlcnNDaGFuZ2VkXSk7XG5cbiAgICBjb25zdCBmb3JtYXRTaG9ydFdlZWtkYXkgPSB1c2VDYWxsYmFjaygobG9jYWxlLCBkYXRlKSA9PiB7XG4gICAgICByZXR1cm4gWydTJywgJ00nLCAnVCcsICdXJywgJ1QnLCAnRicsICdTJ11bZGF0ZS5nZXREYXkoKV07XG4gICAgfSwgW10pO1xuXG4gICAgY29uc3QgZGlzYWJsZURhdGVUaW1lUGljayA9IHRpbWVNb2RlICE9PSBMSUdIVF9BTkRfU0hBRE9XX0VGRkVDVF9USU1FX01PREVTLnBpY2s7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFN0eWxlZEVmZmVjdFRpbWVDb25maWd1cmF0b3I+XG4gICAgICAgIDxTdHlsZWRXcmFwcGVyIG1hcmdpbkJvdHRvbT17MTZ9PlxuICAgICAgICAgIDxTdHlsZWRSYWRpb1xuICAgICAgICAgICAgdHlwZT1cInJhZGlvXCJcbiAgICAgICAgICAgIGNoZWNrZWQ9e3RpbWVNb2RlID09PSBMSUdIVF9BTkRfU0hBRE9XX0VGRkVDVF9USU1FX01PREVTLnBpY2t9XG4gICAgICAgICAgICBpZD17YGVmZmVjdC10aW1lLXRvZ2dsZS11c2UtcGljay10aW1lYH1cbiAgICAgICAgICAgIGxhYmVsPXtpbnRsLmZvcm1hdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICBpZDogJ2VmZmVjdE1hbmFnZXIucGlja0RhdGVUaW1lJ1xuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICBvbkNoYW5nZT17KCkgPT4ge1xuICAgICAgICAgICAgICBvblRpbWVQYXJhbWV0ZXJzQ2hhbmdlZCh7dGltZU1vZGU6IExJR0hUX0FORF9TSEFET1dfRUZGRUNUX1RJTUVfTU9ERVMucGlja30pO1xuICAgICAgICAgICAgfX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L1N0eWxlZFdyYXBwZXI+XG5cbiAgICAgICAgPFNsaWRlcldyYXBwZXIgaGlkZGVuPXtkaXNhYmxlRGF0ZVRpbWVQaWNrfT5cbiAgICAgICAgICA8RWZmZWN0VGltZVNsaWRlclxuICAgICAgICAgICAgdmFsdWU9e2RheVRpbWVQcm9ncmVzc31cbiAgICAgICAgICAgIG9uQ2hhbmdlPXtvblRpbWVTbGlkZXJDaGFuZ2V9XG4gICAgICAgICAgICBjb25maWc9e3RpbWVTbGlkZXJDb25maWd9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9TbGlkZXJXcmFwcGVyPlxuXG4gICAgICAgIDxTdHlsZWRXcmFwcGVyIGhpZGRlbj17ZGlzYWJsZURhdGVUaW1lUGlja30gbWFyZ2luQm90dG9tPXsyfT5cbiAgICAgICAgICA8VGV4dEJsb2NrIHdpZHRoPVwiMzJweFwiPjwvVGV4dEJsb2NrPlxuICAgICAgICAgIDxUZXh0QmxvY2sgd2lkdGg9XCIxMTBweFwiPlxuICAgICAgICAgICAgPEZvcm1hdHRlZE1lc3NhZ2UgaWQ9eydlZmZlY3RNYW5hZ2VyLmRhdGUnfSAvPlxuICAgICAgICAgIDwvVGV4dEJsb2NrPlxuICAgICAgICAgIDxUZXh0QmxvY2sgd2lkdGg9XCIxMTBweFwiPlxuICAgICAgICAgICAgPEZvcm1hdHRlZE1lc3NhZ2UgaWQ9eydlZmZlY3RNYW5hZ2VyLnRpbWUnfSAvPlxuICAgICAgICAgIDwvVGV4dEJsb2NrPlxuICAgICAgICA8L1N0eWxlZFdyYXBwZXI+XG5cbiAgICAgICAgPFN0eWxlZFdyYXBwZXIgaGlkZGVuPXtkaXNhYmxlRGF0ZVRpbWVQaWNrfSBtYXJnaW5Cb3R0b209ezE2fT5cbiAgICAgICAgICA8U3R5bGVkQnV0dG9uIG9uQ2xpY2s9e3NldEN1cnJlbnREYXRlVGltZX0gZGF0YS1mb3I9XCJwaWNrLXRpbWUtYnV0dG9uXCIgZGF0YS10aXA+XG4gICAgICAgICAgICA8TG9jYXRpb25NYXJrZXIgaGVpZ2h0PVwiMTZweFwiIC8+XG4gICAgICAgICAgICA8VG9vbHRpcCBpZD1cInBpY2stdGltZS1idXR0b25cIiBlZmZlY3Q9XCJzb2xpZFwiIHBsYWNlPVwidG9wXCIgZGVsYXlTaG93PXs1MDB9PlxuICAgICAgICAgICAgICA8Rm9ybWF0dGVkTWVzc2FnZSBpZD17J2VmZmVjdE1hbmFnZXIucGlja0N1cnJyZW50VGltZSd9IC8+XG4gICAgICAgICAgICA8L1Rvb2x0aXA+XG4gICAgICAgICAgPC9TdHlsZWRCdXR0b24+XG4gICAgICAgICAgPFdpdGhJY29uV3JhcHBlcj5cbiAgICAgICAgICAgIDxTdHlsZWREYXRlUGlja2VyPlxuICAgICAgICAgICAgICA8RGF0ZVBpY2tlclxuICAgICAgICAgICAgICAgIHZhbHVlPXtkYXRlUGlja2VyRGF0ZX1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17c2V0RGF0ZX1cbiAgICAgICAgICAgICAgICBtaW5EZXRhaWw9eydtb250aCd9XG4gICAgICAgICAgICAgICAgZm9ybWF0U2hvcnRXZWVrZGF5PXtmb3JtYXRTaG9ydFdlZWtkYXl9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L1N0eWxlZERhdGVQaWNrZXI+XG4gICAgICAgICAgICA8U3R5bGVkRXh0cmFJY29uPlxuICAgICAgICAgICAgICA8Q2FsZW5kYXIgd2lkdGg9XCIxNnB4XCIgaGVpZ2h0PVwiMzJweFwiIC8+XG4gICAgICAgICAgICA8L1N0eWxlZEV4dHJhSWNvbj5cbiAgICAgICAgICA8L1dpdGhJY29uV3JhcHBlcj5cbiAgICAgICAgICA8V2l0aEljb25XcmFwcGVyPlxuICAgICAgICAgICAgPEVmZmVjdFRpbWVTZWxlY3RvciB2YWx1ZT17Zm9ybWF0dGVkVGltZX0gb25DaGFuZ2U9e3NldFRpbWV9IC8+XG4gICAgICAgICAgICA8U3R5bGVkRXh0cmFJY29uPlxuICAgICAgICAgICAgICA8Q2xvY2sgd2lkdGg9XCIxNnB4XCIgaGVpZ2h0PVwiMzJweFwiIC8+XG4gICAgICAgICAgICA8L1N0eWxlZEV4dHJhSWNvbj5cbiAgICAgICAgICA8L1dpdGhJY29uV3JhcHBlcj5cbiAgICAgICAgPC9TdHlsZWRXcmFwcGVyPlxuXG4gICAgICAgIDxTdHlsZWRXcmFwcGVyIGhpZGRlbj17ZGlzYWJsZURhdGVUaW1lUGlja30gbWFyZ2luQm90dG9tPXsyfT5cbiAgICAgICAgICA8VGV4dEJsb2NrPlxuICAgICAgICAgICAgPEZvcm1hdHRlZE1lc3NhZ2UgaWQ9eydlZmZlY3RNYW5hZ2VyLnRpbWV6b25lJ30gLz5cbiAgICAgICAgICA8L1RleHRCbG9jaz5cbiAgICAgICAgPC9TdHlsZWRXcmFwcGVyPlxuXG4gICAgICAgIDxTdHlsZWRXcmFwcGVyIGhpZGRlbj17ZGlzYWJsZURhdGVUaW1lUGlja30gbWFyZ2luQm90dG9tPXsyNH0+XG4gICAgICAgICAgPFdpdGhJY29uV3JhcHBlciB3aWR0aD17JzEwMCUnfT5cbiAgICAgICAgICAgIDxUaW1lem9uZVNlbGVjdG9yIHNlbGVjdGVkPXt0aW1lem9uZX0gb25TZWxlY3Q9e3NldFRpbWV6b25lfSAvPlxuICAgICAgICAgICAgPFN0eWxlZEV4dHJhSWNvbj5cbiAgICAgICAgICAgICAgPEdsb2JlIHdpZHRoPVwiMTZweFwiIGhlaWdodD1cIjMycHhcIiAvPlxuICAgICAgICAgICAgPC9TdHlsZWRFeHRyYUljb24+XG4gICAgICAgICAgPC9XaXRoSWNvbldyYXBwZXI+XG4gICAgICAgIDwvU3R5bGVkV3JhcHBlcj5cblxuICAgICAgICA8U3R5bGVkV3JhcHBlciBtYXJnaW5Cb3R0b209ezE2fT5cbiAgICAgICAgICA8U3R5bGVkUmFkaW9cbiAgICAgICAgICAgIHR5cGU9XCJyYWRpb1wiXG4gICAgICAgICAgICBjaGVja2VkPXt0aW1lTW9kZSA9PT0gTElHSFRfQU5EX1NIQURPV19FRkZFQ1RfVElNRV9NT0RFUy5jdXJyZW50fVxuICAgICAgICAgICAgaWQ9e2BlZmZlY3QtdGltZS10b2dnbGUtdXNlLWN1cnJlbnQtdGltZWB9XG4gICAgICAgICAgICBsYWJlbD17aW50bC5mb3JtYXRNZXNzYWdlKHtcbiAgICAgICAgICAgICAgaWQ6ICdlZmZlY3RNYW5hZ2VyLmN1cnJlbnRUaW1lJ1xuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICBvbkNoYW5nZT17KCkgPT4ge1xuICAgICAgICAgICAgICBvblRpbWVQYXJhbWV0ZXJzQ2hhbmdlZCh7dGltZU1vZGU6IExJR0hUX0FORF9TSEFET1dfRUZGRUNUX1RJTUVfTU9ERVMuY3VycmVudH0pO1xuICAgICAgICAgICAgfX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L1N0eWxlZFdyYXBwZXI+XG5cbiAgICAgICAgPFN0eWxlZFdyYXBwZXIgbWFyZ2luQm90dG9tPXsxNn0+XG4gICAgICAgICAgPFN0eWxlZFJhZGlvXG4gICAgICAgICAgICB0eXBlPVwicmFkaW9cIlxuICAgICAgICAgICAgY2hlY2tlZD17dGltZU1vZGUgPT09IExJR0hUX0FORF9TSEFET1dfRUZGRUNUX1RJTUVfTU9ERVMuYW5pbWF0aW9ufVxuICAgICAgICAgICAgaWQ9e2BlZmZlY3QtdGltZS10b2dnbGUtdXNlLWFuaW1hdGlvbi10aW1lYH1cbiAgICAgICAgICAgIGxhYmVsPXsnQW5pbWF0aW9uIHRpbWUnfVxuICAgICAgICAgICAgb25DaGFuZ2U9eygpID0+IHtcbiAgICAgICAgICAgICAgb25UaW1lUGFyYW1ldGVyc0NoYW5nZWQoe3RpbWVNb2RlOiBMSUdIVF9BTkRfU0hBRE9XX0VGRkVDVF9USU1FX01PREVTLmFuaW1hdGlvbn0pO1xuICAgICAgICAgICAgfX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L1N0eWxlZFdyYXBwZXI+XG4gICAgICA8L1N0eWxlZEVmZmVjdFRpbWVDb25maWd1cmF0b3I+XG4gICAgKTtcbiAgfTtcblxuICAvLyBAdHMtZXhwZWN0LWVycm9yIGhvdyB0byBwcm9wZXJseSB0eXBlP1xuICByZXR1cm4gd2l0aFN0YXRlKFttYXBTdGF0ZUxlbnNdKShpbmplY3RJbnRsKEVmZmVjdFRpbWVDb25maWd1cmF0b3IpKTtcbn1cbiJdfQ==