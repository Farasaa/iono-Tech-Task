{"version":3,"file":"header.js","names":["utils","structure","field","length","format","data","cb","buffer","clean","offset","forEach","value","str","i","charCodeAt"],"sources":["../../../../src/encoders/tar/header.js"],"sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport * as utils from './utils';\n/*\nstruct posix_header {             // byte offset\n\tchar name[100];               //   0\n\tchar mode[8];                 // 100\n\tchar uid[8];                  // 108\n\tchar gid[8];                  // 116\n\tchar size[12];                // 124\n\tchar mtime[12];               // 136\n\tchar chksum[8];               // 148\n\tchar typeflag;                // 156\n\tchar linkname[100];           // 157\n\tchar magic[6];                // 257\n\tchar version[2];              // 263\n\tchar uname[32];               // 265\n\tchar gname[32];               // 297\n\tchar devmajor[8];             // 329\n\tchar devminor[8];             // 337\n\tchar prefix[155];             // 345\n                                  // 500\n};\n*/\n\nexport const structure = [\n  {\n    field: 'fileName',\n    length: 100\n  },\n  {\n    field: 'fileMode',\n    length: 8\n  },\n  {\n    field: 'uid',\n    length: 8\n  },\n  {\n    field: 'gid',\n    length: 8\n  },\n  {\n    field: 'fileSize',\n    length: 12\n  },\n  {\n    field: 'mtime',\n    length: 12\n  },\n  {\n    field: 'checksum',\n    length: 8\n  },\n  {\n    field: 'type',\n    length: 1\n  },\n  {\n    field: 'linkName',\n    length: 100\n  },\n  {\n    field: 'ustar',\n    length: 8\n  },\n  {\n    field: 'owner',\n    length: 32\n  },\n  {\n    field: 'group',\n    length: 32\n  },\n  {\n    field: 'majorNumber',\n    length: 8\n  },\n  {\n    field: 'minorNumber',\n    length: 8\n  },\n  {\n    field: 'filenamePrefix',\n    length: 155\n  },\n  {\n    field: 'padding',\n    length: 12\n  }\n];\n\nexport function format(data, cb) {\n  const buffer = utils.clean(512);\n  let offset = 0;\n\n  structure.forEach(value => {\n    const str = data[value.field] || '';\n    let i;\n    let length;\n\n    for (i = 0, length = str.length; i < length; i += 1) {\n      buffer[offset] = str.charCodeAt(i);\n      offset += 1;\n    }\n\n    // space it out with nulls\n    offset += value.length - i;\n  });\n\n  if (typeof cb === 'function') {\n    return cb(buffer, offset);\n  }\n  return buffer;\n}\n"],"mappings":"AAmBA,OAAO,KAAKA,KAAZ,MAAuB,SAAvB;AAuBA,OAAO,MAAMC,SAAS,GAAG,CACvB;EACEC,KAAK,EAAE,UADT;EAEEC,MAAM,EAAE;AAFV,CADuB,EAKvB;EACED,KAAK,EAAE,UADT;EAEEC,MAAM,EAAE;AAFV,CALuB,EASvB;EACED,KAAK,EAAE,KADT;EAEEC,MAAM,EAAE;AAFV,CATuB,EAavB;EACED,KAAK,EAAE,KADT;EAEEC,MAAM,EAAE;AAFV,CAbuB,EAiBvB;EACED,KAAK,EAAE,UADT;EAEEC,MAAM,EAAE;AAFV,CAjBuB,EAqBvB;EACED,KAAK,EAAE,OADT;EAEEC,MAAM,EAAE;AAFV,CArBuB,EAyBvB;EACED,KAAK,EAAE,UADT;EAEEC,MAAM,EAAE;AAFV,CAzBuB,EA6BvB;EACED,KAAK,EAAE,MADT;EAEEC,MAAM,EAAE;AAFV,CA7BuB,EAiCvB;EACED,KAAK,EAAE,UADT;EAEEC,MAAM,EAAE;AAFV,CAjCuB,EAqCvB;EACED,KAAK,EAAE,OADT;EAEEC,MAAM,EAAE;AAFV,CArCuB,EAyCvB;EACED,KAAK,EAAE,OADT;EAEEC,MAAM,EAAE;AAFV,CAzCuB,EA6CvB;EACED,KAAK,EAAE,OADT;EAEEC,MAAM,EAAE;AAFV,CA7CuB,EAiDvB;EACED,KAAK,EAAE,aADT;EAEEC,MAAM,EAAE;AAFV,CAjDuB,EAqDvB;EACED,KAAK,EAAE,aADT;EAEEC,MAAM,EAAE;AAFV,CArDuB,EAyDvB;EACED,KAAK,EAAE,gBADT;EAEEC,MAAM,EAAE;AAFV,CAzDuB,EA6DvB;EACED,KAAK,EAAE,SADT;EAEEC,MAAM,EAAE;AAFV,CA7DuB,CAAlB;AAmEP,OAAO,SAASC,MAAT,CAAgBC,IAAhB,EAAsBC,EAAtB,EAA0B;EAC/B,MAAMC,MAAM,GAAGP,KAAK,CAACQ,KAAN,CAAY,GAAZ,CAAf;EACA,IAAIC,MAAM,GAAG,CAAb;EAEAR,SAAS,CAACS,OAAV,CAAkBC,KAAK,IAAI;IACzB,MAAMC,GAAG,GAAGP,IAAI,CAACM,KAAK,CAACT,KAAP,CAAJ,IAAqB,EAAjC;IACA,IAAIW,CAAJ;IACA,IAAIV,MAAJ;;IAEA,KAAKU,CAAC,GAAG,CAAJ,EAAOV,MAAM,GAAGS,GAAG,CAACT,MAAzB,EAAiCU,CAAC,GAAGV,MAArC,EAA6CU,CAAC,IAAI,CAAlD,EAAqD;MACnDN,MAAM,CAACE,MAAD,CAAN,GAAiBG,GAAG,CAACE,UAAJ,CAAeD,CAAf,CAAjB;MACAJ,MAAM,IAAI,CAAV;IACD;;IAGDA,MAAM,IAAIE,KAAK,CAACR,MAAN,GAAeU,CAAzB;EACD,CAZD;;EAcA,IAAI,OAAOP,EAAP,KAAc,UAAlB,EAA8B;IAC5B,OAAOA,EAAE,CAACC,MAAD,EAASE,MAAT,CAAT;EACD;;EACD,OAAOF,MAAP;AACD"}