{"version":3,"file":"deck-animation.js","names":["noop","DeckAnimation","id","cameraKeyframe","undefined","getLayers","_","layerKeyframes","onLayersUpdate","onCameraUpdate","setKeyframes","draw","timeline","set","CameraKeyframes","unattachedKeyframes","push","length","reduce","acc","value","DeckLayerKeyframes","attachKeyframes","animation","getFrame","Object","values","layers","map","layer","frame","clone","updateTriggers","Animation"],"sources":["../../../src/animations/deck-animation.js"],"sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {CameraKeyframes, DeckLayerKeyframes} from '../keyframes';\nimport Animation from './animation';\n\nfunction noop() {}\n\nexport default class DeckAnimation extends Animation {\n  cameraKeyframe;\n  layerKeyframes = {};\n\n  constructor({\n    id = 'deck',\n    cameraKeyframe = undefined,\n    getLayers = _ => [],\n    layerKeyframes = [],\n    onLayersUpdate = noop,\n    onCameraUpdate = noop\n  }) {\n    super({id});\n    this.layerKeyframes = {};\n    this.onLayersUpdate = onLayersUpdate;\n    this.onCameraUpdate = onCameraUpdate;\n    this.getLayers = getLayers;\n    this.setKeyframes({cameraKeyframe, layerKeyframes});\n    this.draw();\n  }\n\n  setOnLayersUpdate(onLayersUpdate) {\n    this.onLayersUpdate = onLayersUpdate;\n  }\n\n  setOnCameraUpdate(onCameraUpdate) {\n    this.onCameraUpdate = onCameraUpdate;\n  }\n\n  setGetLayers(getLayers) {\n    this.getLayers = getLayers;\n    this.draw();\n  }\n\n  setKeyframes({layerKeyframes = [], cameraKeyframe = undefined, timeline = undefined}) {\n    if (this.cameraKeyframe && cameraKeyframe) {\n      this.cameraKeyframe.set(cameraKeyframe);\n    } else if (cameraKeyframe) {\n      this.cameraKeyframe = new CameraKeyframes(cameraKeyframe);\n      this.unattachedKeyframes.push(this.cameraKeyframe);\n    }\n\n    if (layerKeyframes && layerKeyframes.length > 0) {\n      this.layerKeyframes = layerKeyframes.reduce((acc, value) => {\n        if (acc[value.id]) {\n          acc[value.id].set(value);\n        } else {\n          acc[value.id] = new DeckLayerKeyframes(value);\n          this.unattachedKeyframes.push(acc[value.id]);\n        }\n        return acc;\n      }, this.layerKeyframes);\n    }\n\n    if (timeline) {\n      this.attachKeyframes(timeline);\n    }\n  }\n\n  getKeyframes() {\n    return {\n      cameraKeyframe: this.cameraKeyframe,\n      layerKeyframes: this.layerKeyframes\n    };\n  }\n\n  animator(animation) {\n    if (animation.cameraKeyframe) {\n      animation.onCameraUpdate(animation.cameraKeyframe.getFrame());\n    }\n\n    if (Object.values(animation.layerKeyframes).length > 0) {\n      animation.onLayersUpdate(this.getLayers(animation));\n    }\n  }\n\n  applyLayerKeyframes(layers) {\n    return layers.map(layer => {\n      if (this.layerKeyframes[layer.id]) {\n        const frame = this.layerKeyframes[layer.id].getFrame();\n        return layer.clone({\n          ...frame,\n          updateTriggers: frame\n        });\n      }\n      return layer;\n    });\n  }\n}\n"],"mappings":"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"}