"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _reselect = require("reselect");

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _lodash = _interopRequireDefault(require("lodash.get"));

var _constants = require("@kepler.gl/constants");

var _newFilterPanel = _interopRequireDefault(require("../../filters/filter-panels/new-filter-panel"));

var _timeRangeFilterPanel = _interopRequireDefault(require("../../filters/filter-panels/time-range-filter-panel"));

var _singleSelectFilterPanel = _interopRequireDefault(require("../../filters/filter-panels/single-select-filter-panel"));

var _multiSelectFilterPanel = _interopRequireDefault(require("../../filters/filter-panels/multi-select-filter-panel"));

var _rangeFilterPanel = _interopRequireDefault(require("../../filters/filter-panels/range-filter-panel"));

var _polygonFilterPanel = _interopRequireDefault(require("../../filters/filter-panels/polygon-filter-panel"));

var _templateObject;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var StyledFilterPanel = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  margin-bottom: 12px;\n  border-radius: 1px;\n"])));

FilterPanelFactory.deps = [_newFilterPanel["default"], _timeRangeFilterPanel["default"], _singleSelectFilterPanel["default"], _multiSelectFilterPanel["default"], _rangeFilterPanel["default"], _polygonFilterPanel["default"]];

function FilterPanelFactory(NewFilterPanel, TimeRangeFilterPanel, SingleSelectFilterPanel, MultiSelectFilterPanel, RangeFilterPanel, PolygonFilterPanel) {
  var _FilterPanelComponent;

  var FilterPanelComponents = (_FilterPanelComponent = {
    "default": NewFilterPanel
  }, (0, _defineProperty2["default"])(_FilterPanelComponent, _constants.FILTER_TYPES.timeRange, TimeRangeFilterPanel), (0, _defineProperty2["default"])(_FilterPanelComponent, _constants.FILTER_TYPES.select, SingleSelectFilterPanel), (0, _defineProperty2["default"])(_FilterPanelComponent, _constants.FILTER_TYPES.multiSelect, MultiSelectFilterPanel), (0, _defineProperty2["default"])(_FilterPanelComponent, _constants.FILTER_TYPES.range, RangeFilterPanel), (0, _defineProperty2["default"])(_FilterPanelComponent, _constants.FILTER_TYPES.polygon, PolygonFilterPanel), _FilterPanelComponent);
  return /*#__PURE__*/function (_Component) {
    (0, _inherits2["default"])(FilterPanel, _Component);

    var _super = _createSuper(FilterPanel);

    function FilterPanel() {
      var _this;

      (0, _classCallCheck2["default"])(this, FilterPanel);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = _super.call.apply(_super, [this].concat(args));
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "fieldsSelector", function (props) {
        var datasetId = props.filter.dataId[0];

        if (!datasetId) {
          return [];
        }

        return (0, _lodash["default"])(props, ['datasets', datasetId, 'fields'], []);
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "filterSelector", function (props) {
        return props.filters;
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "nameSelector", function (props) {
        return props.filter.name;
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "dataIdSelector", function (props) {
        return props.filter.dataId[0];
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "availableFieldsSelector", (0, _reselect.createSelector)(_this.fieldsSelector, _this.filterSelector, _this.nameSelector, _this.dataIdSelector, function (fields, filters, name, dataId) {
        return fields.filter(function (f) {
          return f.type && f.type !== _constants.ALL_FIELD_TYPES.geojson && (name.includes(f.name) || !filters.find(function (d) {
            return d.name.includes(f.name) && d.dataId.includes(dataId);
          }));
        });
      }));
      return _this;
    }

    (0, _createClass2["default"])(FilterPanel, [{
      key: "render",
      value: function render() {
        var filter = this.props.filter;
        var type = filter.type;
        var FilterFilterComponent = type && FilterPanelComponents[type] || FilterPanelComponents["default"];
        var allAvailableFields = this.availableFieldsSelector(this.props);
        return /*#__PURE__*/_react["default"].createElement(StyledFilterPanel, {
          className: "filter-panel"
        }, /*#__PURE__*/_react["default"].createElement(FilterFilterComponent, (0, _extends2["default"])({
          allAvailableFields: allAvailableFields
        }, this.props)));
      }
    }]);
    return FilterPanel;
  }(_react.Component);
}

var _default = FilterPanelFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zaWRlLXBhbmVsL2ZpbHRlci1wYW5lbC9maWx0ZXItcGFuZWwudHN4Il0sIm5hbWVzIjpbIlN0eWxlZEZpbHRlclBhbmVsIiwic3R5bGVkIiwiZGl2IiwiRmlsdGVyUGFuZWxGYWN0b3J5IiwiZGVwcyIsIk5ld0ZpbHRlclBhbmVsRmFjdG9yeSIsIlRpbWVSYW5nZUZpbHRlclBhbmVsRmFjdG9yeSIsIlNpbmdsZVNlbGVjdEZpbHRlclBhbmVsRmFjdG9yeSIsIk11bHRpU2VsZWN0RmlsdGVyUGFuZWxGYWN0b3J5IiwiUmFuZ2VGaWx0ZXJQYW5lbEZhY3RvcnkiLCJQb2x5Z29uRmlsdGVyUGFuZWxGYWN0b3J5IiwiTmV3RmlsdGVyUGFuZWwiLCJUaW1lUmFuZ2VGaWx0ZXJQYW5lbCIsIlNpbmdsZVNlbGVjdEZpbHRlclBhbmVsIiwiTXVsdGlTZWxlY3RGaWx0ZXJQYW5lbCIsIlJhbmdlRmlsdGVyUGFuZWwiLCJQb2x5Z29uRmlsdGVyUGFuZWwiLCJGaWx0ZXJQYW5lbENvbXBvbmVudHMiLCJGSUxURVJfVFlQRVMiLCJ0aW1lUmFuZ2UiLCJzZWxlY3QiLCJtdWx0aVNlbGVjdCIsInJhbmdlIiwicG9seWdvbiIsInByb3BzIiwiZGF0YXNldElkIiwiZmlsdGVyIiwiZGF0YUlkIiwiZmlsdGVycyIsIm5hbWUiLCJmaWVsZHNTZWxlY3RvciIsImZpbHRlclNlbGVjdG9yIiwibmFtZVNlbGVjdG9yIiwiZGF0YUlkU2VsZWN0b3IiLCJmaWVsZHMiLCJmIiwidHlwZSIsIkFMTF9GSUVMRF9UWVBFUyIsImdlb2pzb24iLCJpbmNsdWRlcyIsImZpbmQiLCJkIiwiRmlsdGVyRmlsdGVyQ29tcG9uZW50IiwiYWxsQXZhaWxhYmxlRmllbGRzIiwiYXZhaWxhYmxlRmllbGRzU2VsZWN0b3IiLCJDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7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QUFFQSw0QkFDRSxnQ0FBQyxpQkFBRDtBQUFtQixVQUFBLFNBQVMsRUFBQztBQUE3Qix3QkFDRSxnQ0FBQyxxQkFBRDtBQUF1QixVQUFBLGtCQUFrQixFQUFFbUI7QUFBM0MsV0FBbUUsS0FBS25CLEtBQXhFLEVBREYsQ0FERjtBQUtEO0FBM0NIO0FBQUE7QUFBQSxJQUFpQ3FCLGdCQUFqQztBQTZDRDs7ZUFFYzFDLGtCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IFJlYWN0LCB7Q29tcG9uZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge2NyZWF0ZVNlbGVjdG9yfSBmcm9tICdyZXNlbGVjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBnZXQgZnJvbSAnbG9kYXNoLmdldCc7XG5pbXBvcnQge0FMTF9GSUVMRF9UWVBFUywgRklMVEVSX1RZUEVTfSBmcm9tICdAa2VwbGVyLmdsL2NvbnN0YW50cyc7XG5cbmltcG9ydCBOZXdGaWx0ZXJQYW5lbEZhY3RvcnkgZnJvbSAnLi4vLi4vZmlsdGVycy9maWx0ZXItcGFuZWxzL25ldy1maWx0ZXItcGFuZWwnO1xuaW1wb3J0IFRpbWVSYW5nZUZpbHRlclBhbmVsRmFjdG9yeSBmcm9tICcuLi8uLi9maWx0ZXJzL2ZpbHRlci1wYW5lbHMvdGltZS1yYW5nZS1maWx0ZXItcGFuZWwnO1xuaW1wb3J0IFNpbmdsZVNlbGVjdEZpbHRlclBhbmVsRmFjdG9yeSBmcm9tICcuLi8uLi9maWx0ZXJzL2ZpbHRlci1wYW5lbHMvc2luZ2xlLXNlbGVjdC1maWx0ZXItcGFuZWwnO1xuaW1wb3J0IE11bHRpU2VsZWN0RmlsdGVyUGFuZWxGYWN0b3J5IGZyb20gJy4uLy4uL2ZpbHRlcnMvZmlsdGVyLXBhbmVscy9tdWx0aS1zZWxlY3QtZmlsdGVyLXBhbmVsJztcbmltcG9ydCBSYW5nZUZpbHRlclBhbmVsRmFjdG9yeSBmcm9tICcuLi8uLi9maWx0ZXJzL2ZpbHRlci1wYW5lbHMvcmFuZ2UtZmlsdGVyLXBhbmVsJztcbmltcG9ydCBQb2x5Z29uRmlsdGVyUGFuZWxGYWN0b3J5IGZyb20gJy4uLy4uL2ZpbHRlcnMvZmlsdGVyLXBhbmVscy9wb2x5Z29uLWZpbHRlci1wYW5lbCc7XG5pbXBvcnQge0ZpZWxkLCBGaWx0ZXJ9IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuaW1wb3J0IHtGaWx0ZXJQYW5lbFByb3BzfSBmcm9tICcuLi8uLi9maWx0ZXJzL2ZpbHRlci1wYW5lbHMvdHlwZXMnO1xuaW1wb3J0IHtMYXllcn0gZnJvbSAnQGtlcGxlci5nbC9sYXllcnMnO1xuXG5jb25zdCBTdHlsZWRGaWx0ZXJQYW5lbCA9IHN0eWxlZC5kaXZgXG4gIG1hcmdpbi1ib3R0b206IDEycHg7XG4gIGJvcmRlci1yYWRpdXM6IDFweDtcbmA7XG5cbmludGVyZmFjZSBGaWx0ZXJQYW5lbFByb3BzSW1wbCBleHRlbmRzIE9taXQ8RmlsdGVyUGFuZWxQcm9wcywgJ2FsbEF2YWlsYWJsZUZpZWxkcyc+IHtcbiAgZmlsdGVyczogRmlsdGVyW107XG4gIGxheWVyczogUmVhZG9ubHlBcnJheTxMYXllcj47XG4gIGlzQW55RmlsdGVyQW5pbWF0aW5nOiBib29sZWFuO1xuICBlbmxhcmdlRmlsdGVyOiAoKSA9PiB2b2lkO1xuICB0b2dnbGVBbmltYXRpb246ICgpID0+IHZvaWQ7XG4gIHRvZ2dsZUZpbHRlckZlYXR1cmU6ICgpID0+IHZvaWQ7XG59XG5cbkZpbHRlclBhbmVsRmFjdG9yeS5kZXBzID0gW1xuICBOZXdGaWx0ZXJQYW5lbEZhY3RvcnksXG4gIFRpbWVSYW5nZUZpbHRlclBhbmVsRmFjdG9yeSxcbiAgU2luZ2xlU2VsZWN0RmlsdGVyUGFuZWxGYWN0b3J5LFxuICBNdWx0aVNlbGVjdEZpbHRlclBhbmVsRmFjdG9yeSxcbiAgUmFuZ2VGaWx0ZXJQYW5lbEZhY3RvcnksXG4gIFBvbHlnb25GaWx0ZXJQYW5lbEZhY3Rvcnlcbl07XG5cbmZ1bmN0aW9uIEZpbHRlclBhbmVsRmFjdG9yeShcbiAgTmV3RmlsdGVyUGFuZWw6IFJldHVyblR5cGU8dHlwZW9mIE5ld0ZpbHRlclBhbmVsRmFjdG9yeT4sXG4gIFRpbWVSYW5nZUZpbHRlclBhbmVsOiBSZXR1cm5UeXBlPHR5cGVvZiBUaW1lUmFuZ2VGaWx0ZXJQYW5lbEZhY3Rvcnk+LFxuICBTaW5nbGVTZWxlY3RGaWx0ZXJQYW5lbDogUmV0dXJuVHlwZTx0eXBlb2YgU2luZ2xlU2VsZWN0RmlsdGVyUGFuZWxGYWN0b3J5PixcbiAgTXVsdGlTZWxlY3RGaWx0ZXJQYW5lbDogUmV0dXJuVHlwZTx0eXBlb2YgTXVsdGlTZWxlY3RGaWx0ZXJQYW5lbEZhY3Rvcnk+LFxuICBSYW5nZUZpbHRlclBhbmVsOiBSZXR1cm5UeXBlPHR5cGVvZiBSYW5nZUZpbHRlclBhbmVsRmFjdG9yeT4sXG4gIFBvbHlnb25GaWx0ZXJQYW5lbDogUmV0dXJuVHlwZTx0eXBlb2YgUG9seWdvbkZpbHRlclBhbmVsRmFjdG9yeT5cbik6IFJlYWN0LkNvbXBvbmVudFR5cGU8RmlsdGVyUGFuZWxQcm9wc0ltcGw+IHtcbiAgY29uc3QgRmlsdGVyUGFuZWxDb21wb25lbnRzID0ge1xuICAgIGRlZmF1bHQ6IE5ld0ZpbHRlclBhbmVsLFxuICAgIFtGSUxURVJfVFlQRVMudGltZVJhbmdlXTogVGltZVJhbmdlRmlsdGVyUGFuZWwsXG4gICAgW0ZJTFRFUl9UWVBFUy5zZWxlY3RdOiBTaW5nbGVTZWxlY3RGaWx0ZXJQYW5lbCxcbiAgICBbRklMVEVSX1RZUEVTLm11bHRpU2VsZWN0XTogTXVsdGlTZWxlY3RGaWx0ZXJQYW5lbCxcbiAgICBbRklMVEVSX1RZUEVTLnJhbmdlXTogUmFuZ2VGaWx0ZXJQYW5lbCxcbiAgICBbRklMVEVSX1RZUEVTLnBvbHlnb25dOiBQb2x5Z29uRmlsdGVyUGFuZWxcbiAgfTtcblxuICByZXR1cm4gY2xhc3MgRmlsdGVyUGFuZWwgZXh0ZW5kcyBDb21wb25lbnQ8RmlsdGVyUGFuZWxQcm9wc0ltcGw+IHtcbiAgICAvKiBzZWxlY3RvcnMgKi9cbiAgICBmaWVsZHNTZWxlY3RvciA9IChwcm9wczogRmlsdGVyUGFuZWxQcm9wc0ltcGwpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFzZXRJZCA9IHByb3BzLmZpbHRlci5kYXRhSWRbMF07XG4gICAgICBpZiAoIWRhdGFzZXRJZCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2V0KHByb3BzLCBbJ2RhdGFzZXRzJywgZGF0YXNldElkLCAnZmllbGRzJ10sIFtdKTtcbiAgICB9O1xuXG4gICAgZmlsdGVyU2VsZWN0b3IgPSAocHJvcHM6IEZpbHRlclBhbmVsUHJvcHNJbXBsKSA9PiBwcm9wcy5maWx0ZXJzO1xuICAgIG5hbWVTZWxlY3RvciA9IChwcm9wczogRmlsdGVyUGFuZWxQcm9wc0ltcGwpID0+IHByb3BzLmZpbHRlci5uYW1lO1xuICAgIGRhdGFJZFNlbGVjdG9yID0gKHByb3BzOiBGaWx0ZXJQYW5lbFByb3BzSW1wbCkgPT4gcHJvcHMuZmlsdGVyLmRhdGFJZFswXTtcblxuICAgIC8vIG9ubHkgc2hvdyBjdXJyZW50IGZpZWxkIGFuZCBmaWVsZCB0aGF0J3Mgbm90IGFscmVhZHkgYmVlbiB1c2VkIGFzIGEgZmlsdGVyXG4gICAgYXZhaWxhYmxlRmllbGRzU2VsZWN0b3IgPSBjcmVhdGVTZWxlY3RvcihcbiAgICAgIHRoaXMuZmllbGRzU2VsZWN0b3IsXG4gICAgICB0aGlzLmZpbHRlclNlbGVjdG9yLFxuICAgICAgdGhpcy5uYW1lU2VsZWN0b3IsXG4gICAgICB0aGlzLmRhdGFJZFNlbGVjdG9yLFxuICAgICAgKGZpZWxkcywgZmlsdGVycywgbmFtZSwgZGF0YUlkKSA9PlxuICAgICAgICBmaWVsZHMuZmlsdGVyKFxuICAgICAgICAgIChmOiBGaWVsZCkgPT5cbiAgICAgICAgICAgIGYudHlwZSAmJlxuICAgICAgICAgICAgZi50eXBlICE9PSBBTExfRklFTERfVFlQRVMuZ2VvanNvbiAmJlxuICAgICAgICAgICAgKG5hbWUuaW5jbHVkZXMoZi5uYW1lKSB8fFxuICAgICAgICAgICAgICAhZmlsdGVycy5maW5kKGQgPT4gZC5uYW1lLmluY2x1ZGVzKGYubmFtZSkgJiYgZC5kYXRhSWQuaW5jbHVkZXMoZGF0YUlkKSkpXG4gICAgICAgIClcbiAgICApO1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgY29uc3Qge2ZpbHRlcn0gPSB0aGlzLnByb3BzO1xuXG4gICAgICBjb25zdCB7dHlwZX0gPSBmaWx0ZXI7XG4gICAgICBjb25zdCBGaWx0ZXJGaWx0ZXJDb21wb25lbnQgPVxuICAgICAgICAodHlwZSAmJiBGaWx0ZXJQYW5lbENvbXBvbmVudHNbdHlwZV0pIHx8IEZpbHRlclBhbmVsQ29tcG9uZW50cy5kZWZhdWx0O1xuICAgICAgY29uc3QgYWxsQXZhaWxhYmxlRmllbGRzID0gdGhpcy5hdmFpbGFibGVGaWVsZHNTZWxlY3Rvcih0aGlzLnByb3BzKTtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFN0eWxlZEZpbHRlclBhbmVsIGNsYXNzTmFtZT1cImZpbHRlci1wYW5lbFwiPlxuICAgICAgICAgIDxGaWx0ZXJGaWx0ZXJDb21wb25lbnQgYWxsQXZhaWxhYmxlRmllbGRzPXthbGxBdmFpbGFibGVGaWVsZHN9IHsuLi50aGlzLnByb3BzfSAvPlxuICAgICAgICA8L1N0eWxlZEZpbHRlclBhbmVsPlxuICAgICAgKTtcbiAgICB9XG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IEZpbHRlclBhbmVsRmFjdG9yeTtcbiJdfQ==