"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getSelectedFeature = getSelectedFeature;
exports["default"] = MapPopoverFactory;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _mapPopoverContent = _interopRequireDefault(require("./map-popover-content"));

var _icons = require("../common/icons");

var _reactIntl = require("react-intl");

var _localization = require("@kepler.gl/localization");

var _headless = _interopRequireDefault(require("@tippyjs/react/headless"));

var _ = require("../");

var _layers = require("@kepler.gl/layers");

var _utils = require("@kepler.gl/utils");

var _constants = require("@kepler.gl/constants");

var _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var SELECTABLE_LAYERS = [_constants.LAYER_TYPES.hexagonId, _constants.LAYER_TYPES.geojson];
var MAX_WIDTH = 500;
var MAX_HEIGHT = 600;

var StyledMapPopover = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  flex-direction: column;\n  max-width: ", "px;\n  max-height: ", "px;\n  padding: 14px;\n  & > * + * {\n    margin-top: 6px;\n  }\n  ", ";\n  font-family: ", ";\n  font-size: 11px;\n  font-weight: 500;\n  background-color: ", ";\n  color: ", ";\n  z-index: 1000;\n  overflow-x: auto;\n  box-shadow: ", ";\n\n  :hover {\n    background-color: ", ";\n  }\n\n  .primary-label {\n    color: ", ";\n    font-size: 10px;\n  }\n\n  .map-popover__layer-info,\n  .coordingate-hover-info {\n    & > * + * {\n      margin-top: 7px;\n    }\n  }\n\n  table {\n    width: auto;\n    display: grid;\n    border-collapse: collapse;\n    row-gap: 5px;\n    column-gap: 5px;\n  }\n\n  .coordingate-hover-info > table {\n    grid-template-columns: auto auto auto;\n  }\n  .map-popover__layer-info > table {\n    grid-template-columns: auto auto;\n  }\n\n  tbody,\n  tr {\n    display: contents;\n  }\n\n  td {\n    border-color: transparent;\n    color: ", ";\n  }\n\n  td.row__value {\n    text-align: right;\n    font-weight: 500;\n    color: ", ";\n  }\n"])), MAX_WIDTH, MAX_HEIGHT, function (props) {
  return props.theme.scrollBar;
}, function (props) {
  return props.theme.fontFamily;
}, function (props) {
  return props.theme.panelBackground;
}, function (props) {
  return props.theme.textColor;
}, function (props) {
  return props.theme.panelBoxShadow;
}, function (props) {
  return "".concat(props.theme.panelBackground, "dd");
}, function (props) {
  return props.theme.notificationColors.success;
}, function (props) {
  return props.theme.textColor;
}, function (props) {
  return props.theme.textColorHl;
});

var PinnedButtons = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  align-self: center;\n  align-items: center;\n  justify-items: center;\n  & > * + * {\n    margin-left: 10px;\n  }\n"])));

var PopoverContent = _styledComponents["default"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  flex-direction: column;\n  & > * + * {\n    margin-top: 12px;\n  }\n"])));

var StyledIcon = _styledComponents["default"].div(_templateObject4 || (_templateObject4 = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n\n  :hover {\n    cursor: pointer;\n    color: ", ";\n  }\n"])), function (props) {
  return props.theme.activeColor;
}, function (props) {
  return props.theme.linkBtnColor;
});

var StyledSelectGeometry = _styledComponents["default"].div(_templateObject5 || (_templateObject5 = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  align-items: center;\n  color: ", ";\n  svg {\n    margin-right: 6px;\n  }\n\n  :hover {\n    cursor: pointer;\n    color: ", ";\n  }\n"])), function (props) {
  return props.theme.textColorHl;
}, function (props) {
  return props.theme.linkBtnColor;
});

MapPopoverFactory.deps = [_mapPopoverContent["default"]];

function createVirtualReference(container, x, y) {
  var size = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
  var bounds = container && container.getBoundingClientRect ? container.getBoundingClientRect() : {};
  var left = (bounds.left || 0) + x - size / 2;
  var top = (bounds.top || 0) + y - size / 2;
  return {
    left: left,
    top: top,
    right: left + size,
    bottom: top + size,
    width: size,
    height: size,
    // These properties are present to meet the DOMRect interface
    y: top,
    x: left,
    toJSON: function toJSON() {
      return this;
    }
  };
}

function getOffsetForPlacement(_ref) {
  var placement = _ref.placement,
      reference = _ref.reference,
      popper = _ref.popper;
  var gap = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 20;

  switch (placement) {
    case 'top-start':
    case 'bottom-start':
      return [gap, gap];

    case 'top-end':
    case 'bottom-end':
      return [-gap, gap];

    default:
      return [0, 0];
  }
}

function getPopperOptions(container) {
  return {
    modifiers: [{
      name: 'preventOverflow',
      options: {
        boundary: container
      }
    }]
  };
}

function getSelectedFeature(layerHoverProp) {
  var _layer$config, _layer$config$columns, _layer$config$columns2, _layerHoverProp$data, _layer$config2, _layer$config2$column, _layer$config2$column2, _layerHoverProp$data2;

  var layer = layerHoverProp === null || layerHoverProp === void 0 ? void 0 : layerHoverProp.layer;
  var fieldIdx;
  var selectedFeature;

  switch (layer === null || layer === void 0 ? void 0 : layer.type) {
    case _constants.LAYER_TYPES.hexagonId:
      fieldIdx = (_layer$config = layer.config) === null || _layer$config === void 0 ? void 0 : (_layer$config$columns = _layer$config.columns) === null || _layer$config$columns === void 0 ? void 0 : (_layer$config$columns2 = _layer$config$columns.hex_id) === null || _layer$config$columns2 === void 0 ? void 0 : _layer$config$columns2.fieldIdx;
      selectedFeature = (0, _utils.idToPolygonGeo)({
        id: layerHoverProp === null || layerHoverProp === void 0 ? void 0 : (_layerHoverProp$data = layerHoverProp.data) === null || _layerHoverProp$data === void 0 ? void 0 : _layerHoverProp$data[fieldIdx]
      }, {
        isClosed: true
      });
      break;

    case _constants.LAYER_TYPES.geojson:
      fieldIdx = (_layer$config2 = layer.config) === null || _layer$config2 === void 0 ? void 0 : (_layer$config2$column = _layer$config2.columns) === null || _layer$config2$column === void 0 ? void 0 : (_layer$config2$column2 = _layer$config2$column.geojson) === null || _layer$config2$column2 === void 0 ? void 0 : _layer$config2$column2.fieldIdx;
      selectedFeature = (0, _layers.parseGeoJsonRawFeature)(layerHoverProp === null || layerHoverProp === void 0 ? void 0 : (_layerHoverProp$data2 = layerHoverProp.data) === null || _layerHoverProp$data2 === void 0 ? void 0 : _layerHoverProp$data2[fieldIdx]);
      break;

    default:
      break;
  }

  return _objectSpread(_objectSpread({}, selectedFeature), {}, {
    // unique id should be assigned to features in the editor
    id: (0, _utils.generateHashId)(8)
  });
}

function MapPopoverFactory(MapPopoverContent) {
  var MapPopover = function MapPopover(_ref2) {
    var x = _ref2.x,
        y = _ref2.y,
        frozen = _ref2.frozen,
        coordinate = _ref2.coordinate,
        layerHoverProp = _ref2.layerHoverProp,
        isBase = _ref2.isBase,
        zoom = _ref2.zoom,
        container = _ref2.container,
        onClose = _ref2.onClose,
        onSetFeatures = _ref2.onSetFeatures,
        setSelectedFeature = _ref2.setSelectedFeature,
        featureCollection = _ref2.featureCollection;

    var _useState = (0, _react.useState)('start'),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        horizontalPlacement = _useState2[0],
        setHorizontalPlacement = _useState2[1];

    var moveLeft = function moveLeft() {
      return setHorizontalPlacement('end');
    };

    var moveRight = function moveRight() {
      return setHorizontalPlacement('start');
    };

    var onSetSelectedFeature = (0, _react.useCallback)(function () {
      var clickContext = {
        mapIndex: 0,
        rightClick: true,
        position: {
          x: x,
          y: y
        }
      };
      var selectedFeature = getSelectedFeature(layerHoverProp);

      if (selectedFeature) {
        setSelectedFeature(selectedFeature, clickContext);
        var updatedFeatures = featureCollection ? [].concat((0, _toConsumableArray2["default"])(featureCollection.features), [selectedFeature]) : [selectedFeature];
        onSetFeatures(updatedFeatures);
      }

      onClose();
    }, [onClose, onSetFeatures, x, y, setSelectedFeature, layerHoverProp, featureCollection]);
    return /*#__PURE__*/_react["default"].createElement(_.RootContext.Consumer, null, function (context) {
      return /*#__PURE__*/_react["default"].createElement(_headless["default"], {
        popperOptions: getPopperOptions(container),
        zIndex: 98
        /* should be below side panel's z-index of 99  */
        ,
        visible: true,
        interactive: true // @ts-ignore
        ,
        getReferenceClientRect: function getReferenceClientRect() {
          return createVirtualReference(container, x, y);
        } // @ts-ignore
        ,
        placement: "bottom-".concat(horizontalPlacement) // @ts-ignore
        ,
        offset: getOffsetForPlacement,
        appendTo: (context === null || context === void 0 ? void 0 : context.current) || document.body,
        render: function render(attrs) {
          var _layerHoverProp$layer, _layerHoverProp$layer2;

          return /*#__PURE__*/_react["default"].createElement(StyledMapPopover, (0, _extends2["default"])({}, attrs, {
            className: "map-popover"
          }), frozen ? /*#__PURE__*/_react["default"].createElement(PinnedButtons, null, horizontalPlacement === 'start' && /*#__PURE__*/_react["default"].createElement(StyledIcon, {
            className: "popover-arrow-left",
            onClick: moveLeft
          }, /*#__PURE__*/_react["default"].createElement(_icons.ArrowLeft, null)), /*#__PURE__*/_react["default"].createElement(StyledIcon, {
            className: "popover-pin",
            onClick: onClose
          }, /*#__PURE__*/_react["default"].createElement(_icons.Pin, {
            height: "16px"
          })), horizontalPlacement === 'end' && /*#__PURE__*/_react["default"].createElement(StyledIcon, {
            className: "popover-arrow-right",
            onClick: moveRight
          }, /*#__PURE__*/_react["default"].createElement(_icons.ArrowRight, null)), isBase && /*#__PURE__*/_react["default"].createElement("div", {
            className: "primary-label"
          }, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
            id: "mapPopover.primary"
          }))) : null, /*#__PURE__*/_react["default"].createElement(PopoverContent, null, /*#__PURE__*/_react["default"].createElement(MapPopoverContent, {
            coordinate: coordinate,
            zoom: zoom,
            layerHoverProp: layerHoverProp
          })), layerHoverProp !== null && layerHoverProp !== void 0 && (_layerHoverProp$layer = layerHoverProp.layer) !== null && _layerHoverProp$layer !== void 0 && _layerHoverProp$layer.type && SELECTABLE_LAYERS.includes(layerHoverProp === null || layerHoverProp === void 0 ? void 0 : (_layerHoverProp$layer2 = layerHoverProp.layer) === null || _layerHoverProp$layer2 === void 0 ? void 0 : _layerHoverProp$layer2.type) && frozen ? /*#__PURE__*/_react["default"].createElement(StyledSelectGeometry, {
            className: "select-geometry",
            onClick: onSetSelectedFeature
          }, /*#__PURE__*/_react["default"].createElement(_icons.CursorPoint, null), "Select Geometry") : null);
        }
      });
    });
  };

  return (0, _reactIntl.injectIntl)(MapPopover);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYXAvbWFwLXBvcG92ZXIudHN4Il0sIm5hbWVzIjpbIlNFTEVDVEFCTEVfTEFZRVJTIiwiTEFZRVJfVFlQRVMiLCJoZXhhZ29uSWQiLCJnZW9qc29uIiwiTUFYX1dJRFRIIiwiTUFYX0hFSUdIVCIsIlN0eWxlZE1hcFBvcG92ZXIiLCJzdHlsZWQiLCJkaXYiLCJwcm9wcyIsInRoZW1lIiwic2Nyb2xsQmFyIiwiZm9udEZhbWlseSIsInBhbmVsQmFja2dyb3VuZCIsInRleHRDb2xvciIsInBhbmVsQm94U2hhZG93Iiwibm90aWZpY2F0aW9uQ29sb3JzIiwic3VjY2VzcyIsInRleHRDb2xvckhsIiwiUGlubmVkQnV0dG9ucyIsIlBvcG92ZXJDb250ZW50IiwiU3R5bGVkSWNvbiIsImFjdGl2ZUNvbG9yIiwibGlua0J0bkNvbG9yIiwiU3R5bGVkU2VsZWN0R2VvbWV0cnkiLCJNYXBQb3BvdmVyRmFjdG9yeSIsImRlcHMiLCJNYXBQb3BvdmVyQ29udGVudEZhY3RvcnkiLCJjcmVhdGVWaXJ0dWFsUmVmZXJlbmNlIiwiY29udGFpbmVyIiwieCIsInkiLCJzaXplIiwiYm91bmRzIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwibGVmdCIsInRvcCIsInJpZ2h0IiwiYm90dG9tIiwid2lkdGgiLCJoZWlnaHQiLCJ0b0pTT04iLCJnZXRPZmZzZXRGb3JQbGFjZW1lbnQiLCJwbGFjZW1lbnQiLCJyZWZlcmVuY2UiLCJwb3BwZXIiLCJnYXAiLCJnZXRQb3BwZXJPcHRpb25zIiwibW9kaWZpZXJzIiwibmFtZSIsIm9wdGlvbnMiLCJib3VuZGFyeSIsImdldFNlbGVjdGVkRmVhdHVyZSIsImxheWVySG92ZXJQcm9wIiwibGF5ZXIiLCJmaWVsZElkeCIsInNlbGVjdGVkRmVhdHVyZSIsInR5cGUiLCJjb25maWciLCJjb2x1bW5zIiwiaGV4X2lkIiwiaWQiLCJkYXRhIiwiaXNDbG9zZWQiLCJNYXBQb3BvdmVyQ29udGVudCIsIk1hcFBvcG92ZXIiLCJmcm96ZW4iLCJjb29yZGluYXRlIiwiaXNCYXNlIiwiem9vbSIsIm9uQ2xvc2UiLCJvblNldEZlYXR1cmVzIiwic2V0U2VsZWN0ZWRGZWF0dXJlIiwiZmVhdHVyZUNvbGxlY3Rpb24iLCJob3Jpem9udGFsUGxhY2VtZW50Iiwic2V0SG9yaXpvbnRhbFBsYWNlbWVudCIsIm1vdmVMZWZ0IiwibW92ZVJpZ2h0Iiwib25TZXRTZWxlY3RlZEZlYXR1cmUiLCJjbGlja0NvbnRleHQiLCJtYXBJbmRleCIsInJpZ2h0Q2xpY2siLCJwb3NpdGlvbiIsInVwZGF0ZWRGZWF0dXJlcyIsImZlYXR1cmVzIiwiY29udGV4dCIsImN1cnJlbnQiLCJkb2N1bWVudCIsImJvZHkiLCJhdHRycyIsImluY2x1ZGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBSUEsSUFBTUEsaUJBQTJCLEdBQUcsQ0FBQ0MsdUJBQVlDLFNBQWIsRUFBd0JELHVCQUFZRSxPQUFwQyxDQUFwQztBQUNBLElBQU1DLFNBQVMsR0FBRyxHQUFsQjtBQUNBLElBQU1DLFVBQVUsR0FBRyxHQUFuQjs7QUFFQSxJQUFNQyxnQkFBZ0IsR0FBR0MsNkJBQU9DLEdBQVYsMG5DQUdQSixTQUhPLEVBSU5DLFVBSk0sRUFTbEIsVUFBQUksS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZQyxTQUFoQjtBQUFBLENBVGEsRUFVTCxVQUFBRixLQUFLO0FBQUEsU0FBSUEsS0FBSyxDQUFDQyxLQUFOLENBQVlFLFVBQWhCO0FBQUEsQ0FWQSxFQWFBLFVBQUFILEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUcsZUFBaEI7QUFBQSxDQWJMLEVBY1gsVUFBQUosS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZSSxTQUFoQjtBQUFBLENBZE0sRUFpQk4sVUFBQUwsS0FBSztBQUFB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QTNCLGFBQTJCQSxjQUEzQixpREFBMkJBLGNBQWMsQ0FBRUMsS0FBM0MsMkRBQTJCLHVCQUF1QkcsSUFBbEQsQ0FEQyxJQUVEUyxNQUZDLGdCQUdDLGdDQUFDLG9CQUFEO0FBQXNCLFlBQUEsU0FBUyxFQUFDLGlCQUFoQztBQUFrRCxZQUFBLE9BQU8sRUFBRVk7QUFBM0QsMEJBQ0UsZ0NBQUMsa0JBQUQsT0FERixvQkFIRCxHQU9HLElBckNOLENBRFc7QUFBQTtBQVpmLFFBRE07QUFBQSxLQURWLENBREY7QUE0REQsR0EvRkQ7O0FBZ0dBLFNBQU8sMkJBQVdiLFVBQVgsQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IFJlYWN0LCB7dXNlU3RhdGUsIHVzZUNhbGxiYWNrfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBNYXBQb3BvdmVyQ29udGVudEZhY3RvcnkgZnJvbSAnLi9tYXAtcG9wb3Zlci1jb250ZW50JztcbmltcG9ydCB7UGluLCBBcnJvd0xlZnQsIEFycm93UmlnaHQsIEN1cnNvclBvaW50fSBmcm9tICcuLi9jb21tb24vaWNvbnMnO1xuaW1wb3J0IHtpbmplY3RJbnRsLCBJbnRsU2hhcGV9IGZyb20gJ3JlYWN0LWludGwnO1xuaW1wb3J0IHtGb3JtYXR0ZWRNZXNzYWdlfSBmcm9tICdAa2VwbGVyLmdsL2xvY2FsaXphdGlvbic7XG5pbXBvcnQgVGlwcHkgZnJvbSAnQHRpcHB5anMvcmVhY3QvaGVhZGxlc3MnO1xuaW1wb3J0IHtSb290Q29udGV4dH0gZnJvbSAnLi4vJztcbmltcG9ydCB7cGFyc2VHZW9Kc29uUmF3RmVhdHVyZX0gZnJvbSAnQGtlcGxlci5nbC9sYXllcnMnO1xuaW1wb3J0IHtpZFRvUG9seWdvbkdlbywgZ2VuZXJhdGVIYXNoSWR9IGZyb20gJ0BrZXBsZXIuZ2wvdXRpbHMnO1xuaW1wb3J0IHtMQVlFUl9UWVBFU30gZnJvbSAnQGtlcGxlci5nbC9jb25zdGFudHMnO1xuaW1wb3J0IHtMYXllckhvdmVyUHJvcH0gZnJvbSAnQGtlcGxlci5nbC9yZWR1Y2Vycyc7XG5pbXBvcnQge0ZlYXR1cmUsIEZlYXR1cmVTZWxlY3Rpb25Db250ZXh0fSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcblxuY29uc3QgU0VMRUNUQUJMRV9MQVlFUlM6IHN0cmluZ1tdID0gW0xBWUVSX1RZUEVTLmhleGFnb25JZCwgTEFZRVJfVFlQRVMuZ2VvanNvbl07XG5jb25zdCBNQVhfV0lEVEggPSA1MDA7XG5jb25zdCBNQVhfSEVJR0hUID0gNjAwO1xuXG5jb25zdCBTdHlsZWRNYXBQb3BvdmVyID0gc3R5bGVkLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgbWF4LXdpZHRoOiAke01BWF9XSURUSH1weDtcbiAgbWF4LWhlaWdodDogJHtNQVhfSEVJR0hUfXB4O1xuICBwYWRkaW5nOiAxNHB4O1xuICAmID4gKiArICoge1xuICAgIG1hcmdpbi10b3A6IDZweDtcbiAgfVxuICAke3Byb3BzID0+IHByb3BzLnRoZW1lLnNjcm9sbEJhcn07XG4gIGZvbnQtZmFtaWx5OiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmZvbnRGYW1pbHl9O1xuICBmb250LXNpemU6IDExcHg7XG4gIGZvbnQtd2VpZ2h0OiA1MDA7XG4gIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUucGFuZWxCYWNrZ3JvdW5kfTtcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudGV4dENvbG9yfTtcbiAgei1pbmRleDogMTAwMDtcbiAgb3ZlcmZsb3cteDogYXV0bztcbiAgYm94LXNoYWRvdzogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5wYW5lbEJveFNoYWRvd307XG5cbiAgOmhvdmVyIHtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzID0+IGAke3Byb3BzLnRoZW1lLnBhbmVsQmFja2dyb3VuZH1kZGB9O1xuICB9XG5cbiAgLnByaW1hcnktbGFiZWwge1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLm5vdGlmaWNhdGlvbkNvbG9ycy5zdWNjZXNzfTtcbiAgICBmb250LXNpemU6IDEwcHg7XG4gIH1cblxuICAubWFwLXBvcG92ZXJfX2xheWVyLWluZm8sXG4gIC5jb29yZGluZ2F0ZS1ob3Zlci1pbmZvIHtcbiAgICAmID4gKiArICoge1xuICAgICAgbWFyZ2luLXRvcDogN3B4O1xuICAgIH1cbiAgfVxuXG4gIHRhYmxlIHtcbiAgICB3aWR0aDogYXV0bztcbiAgICBkaXNwbGF5OiBncmlkO1xuICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7XG4gICAgcm93LWdhcDogNXB4O1xuICAgIGNvbHVtbi1nYXA6IDVweDtcbiAgfVxuXG4gIC5jb29yZGluZ2F0ZS1ob3Zlci1pbmZvID4gdGFibGUge1xuICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogYXV0byBhdXRvIGF1dG87XG4gIH1cbiAgLm1hcC1wb3BvdmVyX19sYXllci1pbmZvID4gdGFibGUge1xuICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogYXV0byBhdXRvO1xuICB9XG5cbiAgdGJvZHksXG4gIHRyIHtcbiAgICBkaXNwbGF5OiBjb250ZW50cztcbiAgfVxuXG4gIHRkIHtcbiAgICBib3JkZXItY29sb3I6IHRyYW5zcGFyZW50O1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRleHRDb2xvcn07XG4gIH1cblxuICB0ZC5yb3dfX3ZhbHVlIHtcbiAgICB0ZXh0LWFsaWduOiByaWdodDtcbiAgICBmb250LXdlaWdodDogNTAwO1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRleHRDb2xvckhsfTtcbiAgfVxuYDtcblxuY29uc3QgUGlubmVkQnV0dG9ucyA9IHN0eWxlZC5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLXNlbGY6IGNlbnRlcjtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAganVzdGlmeS1pdGVtczogY2VudGVyO1xuICAmID4gKiArICoge1xuICAgIG1hcmdpbi1sZWZ0OiAxMHB4O1xuICB9XG5gO1xuXG5jb25zdCBQb3BvdmVyQ29udGVudCA9IHN0eWxlZC5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICYgPiAqICsgKiB7XG4gICAgbWFyZ2luLXRvcDogMTJweDtcbiAgfVxuYDtcblxuY29uc3QgU3R5bGVkSWNvbiA9IHN0eWxlZC5kaXZgXG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmFjdGl2ZUNvbG9yfTtcblxuICA6aG92ZXIge1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5saW5rQnRuQ29sb3J9O1xuICB9XG5gO1xuXG5jb25zdCBTdHlsZWRTZWxlY3RHZW9tZXRyeSA9IHN0eWxlZC5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRleHRDb2xvckhsfTtcbiAgc3ZnIHtcbiAgICBtYXJnaW4tcmlnaHQ6IDZweDtcbiAgfVxuXG4gIDpob3ZlciB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmxpbmtCdG5Db2xvcn07XG4gIH1cbmA7XG5cbk1hcFBvcG92ZXJGYWN0b3J5LmRlcHMgPSBbTWFwUG9wb3ZlckNvbnRlbnRGYWN0b3J5XTtcblxuZnVuY3Rpb24gY3JlYXRlVmlydHVhbFJlZmVyZW5jZShjb250YWluZXIsIHgsIHksIHNpemUgPSAwKSB7XG4gIGNvbnN0IGJvdW5kcyA9XG4gICAgY29udGFpbmVyICYmIGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QgPyBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiB7fTtcbiAgY29uc3QgbGVmdCA9IChib3VuZHMubGVmdCB8fCAwKSArIHggLSBzaXplIC8gMjtcbiAgY29uc3QgdG9wID0gKGJvdW5kcy50b3AgfHwgMCkgKyB5IC0gc2l6ZSAvIDI7XG4gIHJldHVybiB7XG4gICAgbGVmdCxcbiAgICB0b3AsXG4gICAgcmlnaHQ6IGxlZnQgKyBzaXplLFxuICAgIGJvdHRvbTogdG9wICsgc2l6ZSxcbiAgICB3aWR0aDogc2l6ZSxcbiAgICBoZWlnaHQ6IHNpemUsXG4gICAgLy8gVGhlc2UgcHJvcGVydGllcyBhcmUgcHJlc2VudCB0byBtZWV0IHRoZSBET01SZWN0IGludGVyZmFjZVxuICAgIHk6IHRvcCxcbiAgICB4OiBsZWZ0LFxuICAgIHRvSlNPTigpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gZ2V0T2Zmc2V0Rm9yUGxhY2VtZW50KHtwbGFjZW1lbnQsIHJlZmVyZW5jZSwgcG9wcGVyfSwgZ2FwID0gMjApIHtcbiAgc3dpdGNoIChwbGFjZW1lbnQpIHtcbiAgICBjYXNlICd0b3Atc3RhcnQnOlxuICAgIGNhc2UgJ2JvdHRvbS1zdGFydCc6XG4gICAgICByZXR1cm4gW2dhcCwgZ2FwXTtcbiAgICBjYXNlICd0b3AtZW5kJzpcbiAgICBjYXNlICdib3R0b20tZW5kJzpcbiAgICAgIHJldHVybiBbLWdhcCwgZ2FwXTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIFswLCAwXTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRQb3BwZXJPcHRpb25zKGNvbnRhaW5lcikge1xuICByZXR1cm4ge1xuICAgIG1vZGlmaWVyczogW1xuICAgICAge1xuICAgICAgICBuYW1lOiAncHJldmVudE92ZXJmbG93JyxcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGJvdW5kYXJ5OiBjb250YWluZXJcbiAgICAgICAgfVxuICAgICAgfVxuICAgIF1cbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlbGVjdGVkRmVhdHVyZShsYXllckhvdmVyUHJvcDogTGF5ZXJIb3ZlclByb3AgfCBudWxsKTogRmVhdHVyZSB8IG51bGwge1xuICBjb25zdCBsYXllciA9IGxheWVySG92ZXJQcm9wPy5sYXllcjtcbiAgbGV0IGZpZWxkSWR4O1xuICBsZXQgc2VsZWN0ZWRGZWF0dXJlO1xuICBzd2l0Y2ggKGxheWVyPy50eXBlKSB7XG4gICAgY2FzZSBMQVlFUl9UWVBFUy5oZXhhZ29uSWQ6XG4gICAgICBmaWVsZElkeCA9IGxheWVyLmNvbmZpZz8uY29sdW1ucz8uaGV4X2lkPy5maWVsZElkeDtcbiAgICAgIHNlbGVjdGVkRmVhdHVyZSA9IGlkVG9Qb2x5Z29uR2VvKHtpZDogbGF5ZXJIb3ZlclByb3A/LmRhdGE/LltmaWVsZElkeF19LCB7aXNDbG9zZWQ6IHRydWV9KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgTEFZRVJfVFlQRVMuZ2VvanNvbjpcbiAgICAgIGZpZWxkSWR4ID0gbGF5ZXIuY29uZmlnPy5jb2x1bW5zPy5nZW9qc29uPy5maWVsZElkeDtcbiAgICAgIHNlbGVjdGVkRmVhdHVyZSA9IHBhcnNlR2VvSnNvblJhd0ZlYXR1cmUobGF5ZXJIb3ZlclByb3A/LmRhdGE/LltmaWVsZElkeF0pO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGJyZWFrO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5zZWxlY3RlZEZlYXR1cmUsXG4gICAgLy8gdW5pcXVlIGlkIHNob3VsZCBiZSBhc3NpZ25lZCB0byBmZWF0dXJlcyBpbiB0aGUgZWRpdG9yXG4gICAgaWQ6IGdlbmVyYXRlSGFzaElkKDgpXG4gIH07XG59XG5cbmV4cG9ydCB0eXBlIE1hcFBvcG92ZXJQcm9wcyA9IHtcbiAgeDogbnVtYmVyO1xuICB5OiBudW1iZXI7XG4gIGZyb3plbj86IGJvb2xlYW47XG4gIGNvb3JkaW5hdGU6IFtudW1iZXIsIG51bWJlcl0gfCBib29sZWFuO1xuICBsYXllckhvdmVyUHJvcDogTGF5ZXJIb3ZlclByb3AgfCBudWxsO1xuICBpc0Jhc2U/OiBib29sZWFuO1xuICB6b29tOiBudW1iZXI7XG4gIGNvbnRhaW5lcj86IEhUTUxFbGVtZW50IHwgbnVsbDtcbiAgb25DbG9zZTogKCkgPT4gdm9pZDtcbiAgb25TZXRGZWF0dXJlczogKGZlYXR1cmVzOiBGZWF0dXJlW10pID0+IGFueTtcbiAgc2V0U2VsZWN0ZWRGZWF0dXJlOiAoZmVhdHVyZTogRmVhdHVyZSB8IG51bGwsIGNsaWNrQ29udGV4dD86IEZlYXR1cmVTZWxlY3Rpb25Db250ZXh0KSA9PiBhbnk7XG4gIGZlYXR1cmVDb2xsZWN0aW9uPzoge1xuICAgIHR5cGU6IHN0cmluZztcbiAgICBmZWF0dXJlczogRmVhdHVyZVtdO1xuICB9O1xufTtcblxudHlwZSBJbnRsUHJvcHMgPSB7XG4gIGludGw6IEludGxTaGFwZTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIE1hcFBvcG92ZXJGYWN0b3J5KFxuICBNYXBQb3BvdmVyQ29udGVudDogUmV0dXJuVHlwZTx0eXBlb2YgTWFwUG9wb3ZlckNvbnRlbnRGYWN0b3J5PlxuKSB7XG4gIGNvbnN0IE1hcFBvcG92ZXI6IFJlYWN0LkZDPE1hcFBvcG92ZXJQcm9wcyAmIEludGxQcm9wcz4gPSAoe1xuICAgIHgsXG4gICAgeSxcbiAgICBmcm96ZW4sXG4gICAgY29vcmRpbmF0ZSxcbiAgICBsYXllckhvdmVyUHJvcCxcbiAgICBpc0Jhc2UsXG4gICAgem9vbSxcbiAgICBjb250YWluZXIsXG4gICAgb25DbG9zZSxcbiAgICBvblNldEZlYXR1cmVzLFxuICAgIHNldFNlbGVjdGVkRmVhdHVyZSxcbiAgICBmZWF0dXJlQ29sbGVjdGlvblxuICB9KSA9PiB7XG4gICAgY29uc3QgW2hvcml6b250YWxQbGFjZW1lbnQsIHNldEhvcml6b250YWxQbGFjZW1lbnRdID0gdXNlU3RhdGUoJ3N0YXJ0Jyk7XG4gICAgY29uc3QgbW92ZUxlZnQgPSAoKSA9PiBzZXRIb3Jpem9udGFsUGxhY2VtZW50KCdlbmQnKTtcbiAgICBjb25zdCBtb3ZlUmlnaHQgPSAoKSA9PiBzZXRIb3Jpem9udGFsUGxhY2VtZW50KCdzdGFydCcpO1xuXG4gICAgY29uc3Qgb25TZXRTZWxlY3RlZEZlYXR1cmUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBjb25zdCBjbGlja0NvbnRleHQgPSB7XG4gICAgICAgIG1hcEluZGV4OiAwLFxuICAgICAgICByaWdodENsaWNrOiB0cnVlLFxuICAgICAgICBwb3NpdGlvbjoge3gsIHl9XG4gICAgICB9O1xuICAgICAgY29uc3Qgc2VsZWN0ZWRGZWF0dXJlID0gZ2V0U2VsZWN0ZWRGZWF0dXJlKGxheWVySG92ZXJQcm9wKTtcbiAgICAgIGlmIChzZWxlY3RlZEZlYXR1cmUpIHtcbiAgICAgICAgc2V0U2VsZWN0ZWRGZWF0dXJlKHNlbGVjdGVkRmVhdHVyZSwgY2xpY2tDb250ZXh0KTtcbiAgICAgICAgY29uc3QgdXBkYXRlZEZlYXR1cmVzID0gZmVhdHVyZUNvbGxlY3Rpb25cbiAgICAgICAgICA/IFsuLi5mZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlcywgc2VsZWN0ZWRGZWF0dXJlXVxuICAgICAgICAgIDogW3NlbGVjdGVkRmVhdHVyZV07XG4gICAgICAgIG9uU2V0RmVhdHVyZXModXBkYXRlZEZlYXR1cmVzKTtcbiAgICAgIH1cbiAgICAgIG9uQ2xvc2UoKTtcbiAgICB9LCBbb25DbG9zZSwgb25TZXRGZWF0dXJlcywgeCwgeSwgc2V0U2VsZWN0ZWRGZWF0dXJlLCBsYXllckhvdmVyUHJvcCwgZmVhdHVyZUNvbGxlY3Rpb25dKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8Um9vdENvbnRleHQuQ29uc3VtZXI+XG4gICAgICAgIHtjb250ZXh0ID0+IChcbiAgICAgICAgICA8VGlwcHlcbiAgICAgICAgICAgIHBvcHBlck9wdGlvbnM9e2dldFBvcHBlck9wdGlvbnMoY29udGFpbmVyKX1cbiAgICAgICAgICAgIHpJbmRleD17OTh9IC8qIHNob3VsZCBiZSBiZWxvdyBzaWRlIHBhbmVsJ3Mgei1pbmRleCBvZiA5OSAgKi9cbiAgICAgICAgICAgIHZpc2libGU9e3RydWV9XG4gICAgICAgICAgICBpbnRlcmFjdGl2ZT17dHJ1ZX1cbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGdldFJlZmVyZW5jZUNsaWVudFJlY3Q9eygpID0+IGNyZWF0ZVZpcnR1YWxSZWZlcmVuY2UoY29udGFpbmVyLCB4LCB5KX1cbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHBsYWNlbWVudD17YGJvdHRvbS0ke2hvcml6b250YWxQbGFjZW1lbnR9YH1cbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIG9mZnNldD17Z2V0T2Zmc2V0Rm9yUGxhY2VtZW50fVxuICAgICAgICAgICAgYXBwZW5kVG89e2NvbnRleHQ/LmN1cnJlbnQgfHwgZG9jdW1lbnQuYm9keX1cbiAgICAgICAgICAgIHJlbmRlcj17YXR0cnMgPT4gKFxuICAgICAgICAgICAgICA8U3R5bGVkTWFwUG9wb3ZlciB7Li4uYXR0cnN9IGNsYXNzTmFtZT1cIm1hcC1wb3BvdmVyXCI+XG4gICAgICAgICAgICAgICAge2Zyb3plbiA/IChcbiAgICAgICAgICAgICAgICAgIDxQaW5uZWRCdXR0b25zPlxuICAgICAgICAgICAgICAgICAgICB7aG9yaXpvbnRhbFBsYWNlbWVudCA9PT0gJ3N0YXJ0JyAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgPFN0eWxlZEljb24gY2xhc3NOYW1lPVwicG9wb3Zlci1hcnJvdy1sZWZ0XCIgb25DbGljaz17bW92ZUxlZnR9PlxuICAgICAgICAgICAgICAgICAgICAgICAgPEFycm93TGVmdCAvPlxuICAgICAgICAgICAgICAgICAgICAgIDwvU3R5bGVkSWNvbj5cbiAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAgPFN0eWxlZEljb24gY2xhc3NOYW1lPVwicG9wb3Zlci1waW5cIiBvbkNsaWNrPXtvbkNsb3NlfT5cbiAgICAgICAgICAgICAgICAgICAgICA8UGluIGhlaWdodD1cIjE2cHhcIiAvPlxuICAgICAgICAgICAgICAgICAgICA8L1N0eWxlZEljb24+XG4gICAgICAgICAgICAgICAgICAgIHtob3Jpem9udGFsUGxhY2VtZW50ID09PSAnZW5kJyAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgPFN0eWxlZEljb24gY2xhc3NOYW1lPVwicG9wb3Zlci1hcnJvdy1yaWdodFwiIG9uQ2xpY2s9e21vdmVSaWdodH0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8QXJyb3dSaWdodCAvPlxuICAgICAgICAgICAgICAgICAgICAgIDwvU3R5bGVkSWNvbj5cbiAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAge2lzQmFzZSAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJwcmltYXJ5LWxhYmVsXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Rm9ybWF0dGVkTWVzc2FnZSBpZD1cIm1hcFBvcG92ZXIucHJpbWFyeVwiIC8+XG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICA8L1Bpbm5lZEJ1dHRvbnM+XG4gICAgICAgICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAgICAgICAgPFBvcG92ZXJDb250ZW50PlxuICAgICAgICAgICAgICAgICAgPE1hcFBvcG92ZXJDb250ZW50XG4gICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGU9e2Nvb3JkaW5hdGV9XG4gICAgICAgICAgICAgICAgICAgIHpvb209e3pvb219XG4gICAgICAgICAgICAgICAgICAgIGxheWVySG92ZXJQcm9wPXtsYXllckhvdmVyUHJvcH1cbiAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Qb3BvdmVyQ29udGVudD5cbiAgICAgICAgICAgICAgICB7bGF5ZXJIb3ZlclByb3A/LmxheWVyPy50eXBlICYmXG4gICAgICAgICAgICAgICAgU0VMRUNUQUJMRV9MQVlFUlMuaW5jbHVkZXMobGF5ZXJIb3ZlclByb3A/LmxheWVyPy50eXBlKSAmJlxuICAgICAgICAgICAgICAgIGZyb3plbiA/IChcbiAgICAgICAgICAgICAgICAgIDxTdHlsZWRTZWxlY3RHZW9tZXRyeSBjbGFzc05hbWU9XCJzZWxlY3QtZ2VvbWV0cnlcIiBvbkNsaWNrPXtvblNldFNlbGVjdGVkRmVhdHVyZX0+XG4gICAgICAgICAgICAgICAgICAgIDxDdXJzb3JQb2ludCAvPlxuICAgICAgICAgICAgICAgICAgICBTZWxlY3QgR2VvbWV0cnlcbiAgICAgICAgICAgICAgICAgIDwvU3R5bGVkU2VsZWN0R2VvbWV0cnk+XG4gICAgICAgICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAgICAgIDwvU3R5bGVkTWFwUG9wb3Zlcj5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgLz5cbiAgICAgICAgKX1cbiAgICAgIDwvUm9vdENvbnRleHQuQ29uc3VtZXI+XG4gICAgKTtcbiAgfTtcbiAgcmV0dXJuIGluamVjdEludGwoTWFwUG9wb3Zlcik7XG59XG4iXX0=