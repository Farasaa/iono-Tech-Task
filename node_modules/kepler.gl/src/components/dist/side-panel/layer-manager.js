"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.LayerBlendingSelector = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _reactIntl = require("react-intl");

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _localization = require("@kepler.gl/localization");

var _layerList = _interopRequireDefault(require("./layer-panel/layer-list"));

var _datasetLayerGroup = _interopRequireDefault(require("./layer-panel/dataset-layer-group"));

var _panelViewListToggle = _interopRequireDefault(require("./panel-view-list-toggle"));

var _panelTitle = _interopRequireDefault(require("./panel-title"));

var _datasetSection = _interopRequireDefault(require("./layer-panel/dataset-section"));

var _addLayerButton = _interopRequireDefault(require("./layer-panel/add-layer-button"));

var _itemSelector = _interopRequireDefault(require("../common/item-selector/item-selector"));

var _styledComponents2 = require("../common/styled-components");

var _infoHelper = _interopRequireDefault(require("../common/info-helper"));

var _constants = require("@kepler.gl/constants");

var _templateObject, _templateObject2;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var LayerBlendingSelector = /*#__PURE__*/_react["default"].memo(function (_ref) {
  var layerBlending = _ref.layerBlending,
      updateLayerBlending = _ref.updateLayerBlending,
      intl = _ref.intl;
  var labeledLayerBlendings = Object.keys(_constants.LAYER_BLENDINGS).reduce(function (acc, current) {
    return _objectSpread(_objectSpread({}, acc), {}, (0, _defineProperty2["default"])({}, intl.formatMessage({
      id: _constants.LAYER_BLENDINGS[current].label
    }), current));
  }, {});
  var onChange = (0, _react.useCallback)(function (blending) {
    return updateLayerBlending(labeledLayerBlendings[blending]);
  }, [updateLayerBlending, labeledLayerBlendings]);
  return /*#__PURE__*/_react["default"].createElement(_styledComponents2.SidePanelSection, null, /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelLabel, null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
    id: "layerBlending.title"
  })), /*#__PURE__*/_react["default"].createElement(_itemSelector["default"], {
    selectedItems: intl.formatMessage({
      id: _constants.LAYER_BLENDINGS[layerBlending].label
    }),
    options: Object.keys(labeledLayerBlendings),
    multiSelect: false,
    searchable: false,
    onChange: onChange
  }));
});

exports.LayerBlendingSelector = LayerBlendingSelector;
LayerBlendingSelector.displayName = 'LayerBlendingSelector';

var InfoHelperWrapper = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  float: right;\n"])));

var OverlayBlendingSelectorTitleRow = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n"])));

var OverlayBlendingSelector = /*#__PURE__*/_react["default"].memo(function (_ref2) {
  var overlayBlending = _ref2.overlayBlending,
      updateOverlayBlending = _ref2.updateOverlayBlending,
      intl = _ref2.intl,
      infoHelper = _ref2.infoHelper;
  var labeledOverlayBlendings = Object.keys(_constants.OVERLAY_BLENDINGS).reduce(function (acc, current) {
    return _objectSpread(_objectSpread({}, acc), {}, (0, _defineProperty2["default"])({}, intl.formatMessage({
      id: _constants.OVERLAY_BLENDINGS[current].label
    }), current));
  }, {});
  var onChange = (0, _react.useCallback)(function (blending) {
    return updateOverlayBlending(labeledOverlayBlendings[blending]);
  }, [updateOverlayBlending, labeledOverlayBlendings]);
  return /*#__PURE__*/_react["default"].createElement(_styledComponents2.SidePanelSection, null, /*#__PURE__*/_react["default"].createElement(OverlayBlendingSelectorTitleRow, null, /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelLabel, null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
    id: "overlayBlending.title"
  })), /*#__PURE__*/_react["default"].createElement(InfoHelperWrapper, null, infoHelper)), /*#__PURE__*/_react["default"].createElement(_itemSelector["default"], {
    selectedItems: intl.formatMessage({
      id: _constants.OVERLAY_BLENDINGS[overlayBlending].label
    }),
    options: Object.keys(labeledOverlayBlendings),
    multiSelect: false,
    searchable: false,
    onChange: onChange
  }));
});

OverlayBlendingSelector.displayName = 'OverlayBlendingSelector';
LayerManagerFactory.deps = [_layerList["default"], _datasetLayerGroup["default"], _panelViewListToggle["default"], _panelTitle["default"], _datasetSection["default"], _addLayerButton["default"], _infoHelper["default"]];

function LayerManagerFactory(LayerList, DatasetLayerGroup, PanelViewListToggle, PanelTitle, DatasetSection, AddLayerButton, InfoHelper) {
  var LayerManager = /*#__PURE__*/function (_Component) {
    (0, _inherits2["default"])(LayerManager, _Component);

    var _super = _createSuper(LayerManager);

    function LayerManager() {
      var _this;

      (0, _classCallCheck2["default"])(this, LayerManager);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = _super.call.apply(_super, [this].concat(args));
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_addLayer", function (dataset) {
        var visStateActions = _this.props.visStateActions;
        visStateActions.addLayer(undefined, dataset);
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_togglePanelListView", function (listView) {
        var uiStateActions = _this.props.uiStateActions;
        uiStateActions.togglePanelListView({
          panelId: 'layer',
          listView: listView
        });
      });
      return _this;
    }

    (0, _createClass2["default"])(LayerManager, [{
      key: "render",
      value: function render() {
        var _this$props = this.props,
            layers = _this$props.layers,
            datasets = _this$props.datasets,
            intl = _this$props.intl,
            layerOrder = _this$props.layerOrder,
            showAddDataModal = _this$props.showAddDataModal,
            updateTableColor = _this$props.updateTableColor,
            showDatasetTable = _this$props.showDatasetTable,
            removeDataset = _this$props.removeDataset,
            uiStateActions = _this$props.uiStateActions,
            visStateActions = _this$props.visStateActions,
            panelListView = _this$props.panelListView,
            panelMetadata = _this$props.panelMetadata;
        var isSortByDatasetMode = panelListView === _constants.PANEL_VIEW_TOGGLES.byDataset;
        return /*#__PURE__*/_react["default"].createElement("div", {
          className: "layer-manager"
        }, /*#__PURE__*/_react["default"].createElement(_styledComponents2.SidePanelSection, null, /*#__PURE__*/_react["default"].createElement(PanelViewListToggle, {
          togglePanelListView: this._togglePanelListView,
          mode: panelListView
        })), /*#__PURE__*/_react["default"].createElement(DatasetSection, {
          datasets: datasets,
          showDatasetTable: showDatasetTable,
          updateTableColor: updateTableColor,
          removeDataset: removeDataset,
          showDeleteDataset: true,
          showDatasetList: !isSortByDatasetMode,
          showAddDataModal: showAddDataModal
        }), /*#__PURE__*/_react["default"].createElement(_styledComponents2.SidePanelDivider, null), /*#__PURE__*/_react["default"].createElement(_styledComponents2.SidePanelSection, null, /*#__PURE__*/_react["default"].createElement(PanelTitle, {
          className: "layer-manager-title",
          title: intl.formatMessage({
            id: panelMetadata.label
          })
        }, /*#__PURE__*/_react["default"].createElement(AddLayerButton, {
          datasets: datasets,
          onAdd: this._addLayer
        }))), /*#__PURE__*/_react["default"].createElement(_styledComponents2.SidePanelSection, null, isSortByDatasetMode ? /*#__PURE__*/_react["default"].createElement(DatasetLayerGroup, {
          datasets: datasets,
          showDatasetTable: showDatasetTable,
          layers: layers,
          updateTableColor: updateTableColor,
          removeDataset: removeDataset,
          layerOrder: layerOrder,
          layerClasses: this.props.layerClasses,
          uiStateActions: uiStateActions,
          visStateActions: visStateActions,
          showDeleteDataset: true
        }) :
        /*#__PURE__*/
        // TODO replace ignore
        // @ts-ignore
        _react["default"].createElement(LayerList, {
          layers: layers,
          datasets: datasets,
          layerOrder: layerOrder,
          uiStateActions: uiStateActions,
          visStateActions: visStateActions,
          layerClasses: this.props.layerClasses
        })), /*#__PURE__*/_react["default"].createElement(LayerBlendingSelector, {
          layerBlending: this.props.layerBlending,
          updateLayerBlending: visStateActions.updateLayerBlending,
          intl: intl
        }), /*#__PURE__*/_react["default"].createElement(OverlayBlendingSelector, {
          overlayBlending: this.props.overlayBlending,
          updateOverlayBlending: visStateActions.updateOverlayBlending,
          intl: intl,
          infoHelper: /*#__PURE__*/_react["default"].createElement(InfoHelper, {
            id: "overlayBlending-description",
            description: 'overlayBlending.description'
          })
        }));
      }
    }]);
    return LayerManager;
  }(_react.Component);

  return (0, _reactIntl.injectIntl)(LayerManager);
}

var _default = LayerManagerFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zaWRlLXBhbmVsL2xheWVyLW1hbmFnZXIudHN4Il0sIm5hbWVzIjpbIkxheWVyQmxlbmRpbmdTZWxlY3RvciIsIlJlYWN0IiwibWVtbyIsImxheWVyQmxlbmRpbmciLCJ1cGRhdGVMYXllckJsZW5kaW5nIiwiaW50bCIsImxhYmVsZWRMYXllckJsZW5kaW5ncyIsIk9iamVjdCIsImtleXMiLCJMQVlFUl9CTEVORElOR1MiLCJyZWR1Y2UiLCJhY2MiLCJjdXJyZW50IiwiZm9ybWF0TWVzc2FnZSIsImlkIiwibGFiZWwiLCJvbkNoYW5nZSIsImJsZW5kaW5nIiwiZGlzcGxheU5hbWUiLCJJbmZvSGVscGVyV3JhcHBlciIsInN0eWxlZCIsImRpdiIsIk92ZXJsYXlCbGVuZGluZ1NlbGVjdG9yVGl0bGVSb3ciLCJPdmVybGF5QmxlbmRpbmdTZWxlY3RvciIsIm92ZXJsYXlCbGVuZGluZyIsInVwZGF0ZU92ZXJsYXlCbGVuZGluZyIsImluZm9IZWxwZXIiLCJsYWJlbGVkT3ZlcmxheUJsZW5kaW5ncyIsIk9WRVJMQVlfQkxFTkRJTkdTIiwiTGF5ZXJNYW5hZ2VyRmFjdG9yeSIsImRlcHMiLCJMYXllckxpc3RGYWN0b3J5IiwiRGF0YXNldExheWVyR3JvdXBGYWN0b3J5IiwiUGFuZWxWaWV3TGlzdFRvZ2dsZUZhY3RvcnkiLCJQYW5lbFRpdGxlRmFjdG9yeSIsIkRhdGFzZXRTZWN0aW9uRmFjdG9yeSIsIkFkZExheWVyQnV0dG9uRmFjdG9yeSIsIkluZm9IZWxwZXJGYWN0b3J5IiwiTGF5ZXJMaXN0IiwiRGF0YXNldExheWVyR3JvdXAiLCJQYW5lbFZpZXdMaXN0VG9nZ2xlIiwiUGFuZWxUaXRsZSIsIkRhdGFzZXRTZWN0aW9uIiwiQWRkTGF5ZXJCdXR0b24iLCJJbmZvSGVscGVyIiwiTGF5ZXJNYW5hZ2VyIiwiZGF0YXNldCIsInZpc1N0YXRlQWN0aW9ucyIsInByb3BzIiwiYWRkTGF5ZXIiLCJ1bmRlZmluZWQiLCJsaXN0VmlldyIsInVpU3RhdGVBY3Rpb25zIiwidG9nZ2xlUGFuZWxMaXN0VmlldyIsInBhbmVsSWQiLCJsYXllcnMiLCJkYXRhc2V0cyIsImxheWVyT3JkZXIiLCJzaG93QWRkRGF0YU1vZGFsIiwidXBkYXRlVGFibGVDb2xvciIsInNob3dEYXRhc2V0VGFibGUiLCJyZW1vdmVEYXRhc2V0IiwicGFuZWxMaXN0VmlldyIsInBhbmVsTWV0YWRhdGEiLCJpc1NvcnRCeURhdGFzZXRNb2RlIiwiUEFORUxfVklFV19UT0dHTEVTIiwiYnlEYXRhc2V0IiwiX3RvZ2dsZVBhbmVsTGlzdFZpZXciLCJfYWRkTGF5ZXIiLCJsYXllckNsYXNzZXMiLCJDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUVBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUVBOzs7Ozs7Ozs7Ozs7QUFtQ08sSUFBTUEscUJBQXFCLGdCQUFHQyxrQkFBTUMsSUFBTixDQUNuQyxnQkFBNEU7QUFBQSxNQUExRUMsYUFBMEUsUUFBMUVBLGFBQTBFO0FBQUEsTUFBM0RDLG1CQUEyRCxRQUEzREEsbUJBQTJEO0FBQUEsTUFBdENDLElBQXNDLFFBQXRDQSxJQUFzQztBQUMxRSxNQUFNQyxxQkFBcUIsR0FBR0MsTUFBTSxDQUFDQyxJQUFQLENBQVlDLDBCQUFaLEVBQTZCQyxNQUE3QixDQUM1QixVQUFDQyxHQUFELEVBQU1DLE9BQU47QUFBQSwyQ0FDS0QsR0FETCw0Q0FFR04sSUFBSSxDQUFDUSxhQUFMLENBQW1CO0FBQUNDLE1BQUFBLEVBQUUsRUFBRUwsMkJBQWdCRyxPQUFoQixFQUF5Qkc7QUFBOUIsS0FBbkIsQ0FGSCxFQUU4REgsT0FGOUQ7QUFBQSxHQUQ0QixFQUs1QixFQUw0QixDQUE5QjtBQVFBLE1BQU1JLFFBQVEsR0FBRyx3QkFBWSxVQUFBQyxRQUFRO0FBQUEsV0FBSWIsbUJBQW1CLENBQUNFLHFCQUFxQixDQUFDVyxRQUFE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VUFBQSxjQUFjLEVBQUVqQixjQVJsQjtBQVNFLFVBQUEsZUFBZSxFQUFFTCxlQVRuQjtBQVVFLFVBQUEsaUJBQWlCO0FBVm5CLFVBRGtCO0FBQUE7QUFjbEI7QUFDQTtBQUNBLHdDQUFDLFNBQUQ7QUFDRSxVQUFBLE1BQU0sRUFBRVEsTUFEVjtBQUVFLFVBQUEsUUFBUSxFQUFFQyxRQUZaO0FBR0UsVUFBQSxVQUFVLEVBQUVDLFVBSGQ7QUFJRSxVQUFBLGNBQWMsRUFBRUwsY0FKbEI7QUFLRSxVQUFBLGVBQWUsRUFBRUwsZUFMbkI7QUFNRSxVQUFBLFlBQVksRUFBRSxLQUFLQyxLQUFMLENBQVdxQjtBQU4zQixVQWpCSixDQXpCRixlQW9ERSxnQ0FBQyxxQkFBRDtBQUNFLFVBQUEsYUFBYSxFQUFFLEtBQUtyQixLQUFMLENBQVc3QyxhQUQ1QjtBQUVFLFVBQUEsbUJBQW1CLEVBQUU0QyxlQUFlLENBQUMzQyxtQkFGdkM7QUFHRSxVQUFBLElBQUksRUFBRUM7QUFIUixVQXBERixlQXlERSxnQ0FBQyx1QkFBRDtBQUNFLFVBQUEsZUFBZSxFQUFFLEtBQUsyQyxLQUFMLENBQVd4QixlQUQ5QjtBQUVFLFVBQUEscUJBQXFCLEVBQUV1QixlQUFlLENBQUN0QixxQkFGekM7QUFHRSxVQUFBLElBQUksRUFBRXBCLElBSFI7QUFJRSxVQUFBLFVBQVUsZUFDUixnQ0FBQyxVQUFEO0FBQ0UsWUFBQSxFQUFFLCtCQURKO0FBRUUsWUFBQSxXQUFXLEVBQUU7QUFGZjtBQUxKLFVBekRGLENBREY7QUF1RUQ7QUFyR0g7QUFBQTtBQUFBLElBQzJCaUUsZ0JBRDNCOztBQXVHQSxTQUFPLDJCQUFXekIsWUFBWCxDQUFQO0FBQ0Q7O2VBRWNoQixtQiIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge0NvbXBvbmVudCwgdXNlQ2FsbGJhY2t9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHtpbmplY3RJbnRsLCBXcmFwcGVkQ29tcG9uZW50UHJvcHN9IGZyb20gJ3JlYWN0LWludGwnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQge0Zvcm1hdHRlZE1lc3NhZ2V9IGZyb20gJ0BrZXBsZXIuZ2wvbG9jYWxpemF0aW9uJztcblxuaW1wb3J0IExheWVyTGlzdEZhY3RvcnkgZnJvbSAnLi9sYXllci1wYW5lbC9sYXllci1saXN0JztcbmltcG9ydCBEYXRhc2V0TGF5ZXJHcm91cEZhY3RvcnkgZnJvbSAnLi9sYXllci1wYW5lbC9kYXRhc2V0LWxheWVyLWdyb3VwJztcbmltcG9ydCBQYW5lbFZpZXdMaXN0VG9nZ2xlRmFjdG9yeSBmcm9tICcuL3BhbmVsLXZpZXctbGlzdC10b2dnbGUnO1xuaW1wb3J0IFBhbmVsVGl0bGVGYWN0b3J5IGZyb20gJy4vcGFuZWwtdGl0bGUnO1xuaW1wb3J0IERhdGFzZXRTZWN0aW9uRmFjdG9yeSBmcm9tICcuL2xheWVyLXBhbmVsL2RhdGFzZXQtc2VjdGlvbic7XG5pbXBvcnQgQWRkTGF5ZXJCdXR0b25GYWN0b3J5IGZyb20gJy4vbGF5ZXItcGFuZWwvYWRkLWxheWVyLWJ1dHRvbic7XG5cbmltcG9ydCBJdGVtU2VsZWN0b3IgZnJvbSAnLi4vY29tbW9uL2l0ZW0tc2VsZWN0b3IvaXRlbS1zZWxlY3Rvcic7XG5pbXBvcnQge1BhbmVsTGFiZWwsIFNpZGVQYW5lbERpdmlkZXIsIFNpZGVQYW5lbFNlY3Rpb259IGZyb20gJy4uL2NvbW1vbi9zdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgSW5mb0hlbHBlckZhY3RvcnkgZnJvbSAnLi4vY29tbW9uL2luZm8taGVscGVyJztcblxuaW1wb3J0IHtMQVlFUl9CTEVORElOR1MsIE9WRVJMQVlfQkxFTkRJTkdTLCBQQU5FTF9WSUVXX1RPR0dMRVN9IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcbmltcG9ydCB7TGF5ZXIsIExheWVyQ2xhc3Nlc1R5cGV9IGZyb20gJ0BrZXBsZXIuZ2wvbGF5ZXJzJztcbmltcG9ydCB7VUlTdGF0ZUFjdGlvbnMsIFZpc1N0YXRlQWN0aW9ucywgQWN0aW9uSGFuZGxlcn0gZnJvbSAnQGtlcGxlci5nbC9hY3Rpb25zJztcbmltcG9ydCB7U2lkZVBhbmVsSXRlbX0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHtQYW5lbExpc3RWaWV3fSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcbmltcG9ydCB7RGF0YXNldHN9IGZyb20gJ0BrZXBsZXIuZ2wvdGFibGUnO1xuXG50eXBlIExheWVyQmxlbmRpbmdTZWxlY3RvclByb3BzID0ge1xuICBsYXllckJsZW5kaW5nOiBzdHJpbmc7XG4gIHVwZGF0ZUxheWVyQmxlbmRpbmc6IEFjdGlvbkhhbmRsZXI8dHlwZW9mIFZpc1N0YXRlQWN0aW9ucy51cGRhdGVMYXllckJsZW5kaW5nPjtcbn0gJiBXcmFwcGVkQ29tcG9uZW50UHJvcHM7XG5cbnR5cGUgT3ZlcmxheUJsZW5kaW5nU2VsZWN0b3JQcm9wcyA9IHtcbiAgb3ZlcmxheUJsZW5kaW5nOiBzdHJpbmc7XG4gIHVwZGF0ZU92ZXJsYXlCbGVuZGluZzogQWN0aW9uSGFuZGxlcjx0eXBlb2YgVmlzU3RhdGVBY3Rpb25zLnVwZGF0ZU92ZXJsYXlCbGVuZGluZz47XG4gIGluZm9IZWxwZXI6IFJlYWN0LlJlYWN0Tm9kZTtcbn0gJiBXcmFwcGVkQ29tcG9uZW50UHJvcHM7XG5cbnR5cGUgTGF5ZXJNYW5hZ2VyUHJvcHMgPSB7XG4gIGRhdGFzZXRzOiBEYXRhc2V0cztcbiAgbGF5ZXJzOiBMYXllcltdO1xuICBsYXllck9yZGVyOiBzdHJpbmdbXTtcbiAgbGF5ZXJDbGFzc2VzOiBMYXllckNsYXNzZXNUeXBlO1xuICBsYXllckJsZW5kaW5nOiBzdHJpbmc7XG4gIG92ZXJsYXlCbGVuZGluZzogc3RyaW5nO1xuICB1aVN0YXRlQWN0aW9uczogdHlwZW9mIFVJU3RhdGVBY3Rpb25zO1xuICB2aXNTdGF0ZUFjdGlvbnM6IHR5cGVvZiBWaXNTdGF0ZUFjdGlvbnM7XG4gIHNob3dBZGREYXRhTW9kYWw6ICgpID0+IHZvaWQ7XG4gIHJlbW92ZURhdGFzZXQ6IEFjdGlvbkhhbmRsZXI8dHlwZW9mIFVJU3RhdGVBY3Rpb25zLm9wZW5EZWxldGVNb2RhbD47XG4gIHNob3dEYXRhc2V0VGFibGU6IEFjdGlvbkhhbmRsZXI8dHlwZW9mIFZpc1N0YXRlQWN0aW9ucy5zaG93RGF0YXNldFRhYmxlPjtcbiAgdXBkYXRlVGFibGVDb2xvcjogQWN0aW9uSGFuZGxlcjx0eXBlb2YgVmlzU3RhdGVBY3Rpb25zLnVwZGF0ZVRhYmxlQ29sb3I+O1xuICBwYW5lbExpc3RWaWV3OiBQYW5lbExpc3RWaWV3O1xuICBwYW5lbE1ldGFkYXRhOiBTaWRlUGFuZWxJdGVtO1xufSAmIFdyYXBwZWRDb21wb25lbnRQcm9wcztcblxuZXhwb3J0IGNvbnN0IExheWVyQmxlbmRpbmdTZWxlY3RvciA9IFJlYWN0Lm1lbW8oXG4gICh7bGF5ZXJCbGVuZGluZywgdXBkYXRlTGF5ZXJCbGVuZGluZywgaW50bH06IExheWVyQmxlbmRpbmdTZWxlY3RvclByb3BzKSA9PiB7XG4gICAgY29uc3QgbGFiZWxlZExheWVyQmxlbmRpbmdzID0gT2JqZWN0LmtleXMoTEFZRVJfQkxFTkRJTkdTKS5yZWR1Y2UoXG4gICAgICAoYWNjLCBjdXJyZW50KSA9PiAoe1xuICAgICAgICAuLi5hY2MsXG4gICAgICAgIFtpbnRsLmZvcm1hdE1lc3NhZ2Uoe2lkOiBMQVlFUl9CTEVORElOR1NbY3VycmVudF0ubGFiZWx9KV06IGN1cnJlbnRcbiAgICAgIH0pLFxuICAgICAge31cbiAgICApO1xuXG4gICAgY29uc3Qgb25DaGFuZ2UgPSB1c2VDYWxsYmFjayhibGVuZGluZyA9PiB1cGRhdGVMYXllckJsZW5kaW5nKGxhYmVsZWRMYXllckJsZW5kaW5nc1tibGVuZGluZ10pLCBbXG4gICAgICB1cGRhdGVMYXllckJsZW5kaW5nLFxuICAgICAgbGFiZWxlZExheWVyQmxlbmRpbmdzXG4gICAgXSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFNpZGVQYW5lbFNlY3Rpb24+XG4gICAgICAgIDxQYW5lbExhYmVsPlxuICAgICAgICAgIDxGb3JtYXR0ZWRNZXNzYWdlIGlkPVwibGF5ZXJCbGVuZGluZy50aXRsZVwiIC8+XG4gICAgICAgIDwvUGFuZWxMYWJlbD5cbiAgICAgICAgPEl0ZW1TZWxlY3RvclxuICAgICAgICAgIHNlbGVjdGVkSXRlbXM9e2ludGwuZm9ybWF0TWVzc2FnZSh7aWQ6IExBWUVSX0JMRU5ESU5HU1tsYXllckJsZW5kaW5nXS5sYWJlbH0pfVxuICAgICAgICAgIG9wdGlvbnM9e09iamVjdC5rZXlzKGxhYmVsZWRMYXllckJsZW5kaW5ncyl9XG4gICAgICAgICAgbXVsdGlTZWxlY3Q9e2ZhbHNlfVxuICAgICAgICAgIHNlYXJjaGFibGU9e2ZhbHNlfVxuICAgICAgICAgIG9uQ2hhbmdlPXtvbkNoYW5nZX1cbiAgICAgICAgLz5cbiAgICAgIDwvU2lkZVBhbmVsU2VjdGlvbj5cbiAgICApO1xuICB9XG4pO1xuTGF5ZXJCbGVuZGluZ1NlbGVjdG9yLmRpc3BsYXlOYW1lID0gJ0xheWVyQmxlbmRpbmdTZWxlY3Rvcic7XG5cbmNvbnN0IEluZm9IZWxwZXJXcmFwcGVyID0gc3R5bGVkLmRpdmBcbiAgZmxvYXQ6IHJpZ2h0O1xuYDtcblxuY29uc3QgT3ZlcmxheUJsZW5kaW5nU2VsZWN0b3JUaXRsZVJvdyA9IHN0eWxlZC5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiByb3c7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG5gO1xuXG5jb25zdCBPdmVybGF5QmxlbmRpbmdTZWxlY3RvciA9IFJlYWN0Lm1lbW8oXG4gICh7b3ZlcmxheUJsZW5kaW5nLCB1cGRhdGVPdmVybGF5QmxlbmRpbmcsIGludGwsIGluZm9IZWxwZXJ9OiBPdmVybGF5QmxlbmRpbmdTZWxlY3RvclByb3BzKSA9PiB7XG4gICAgY29uc3QgbGFiZWxlZE92ZXJsYXlCbGVuZGluZ3MgPSBPYmplY3Qua2V5cyhPVkVSTEFZX0JMRU5ESU5HUykucmVkdWNlKFxuICAgICAgKGFjYywgY3VycmVudCkgPT4gKHtcbiAgICAgICAgLi4uYWNjLFxuICAgICAgICBbaW50bC5mb3JtYXRNZXNzYWdlKHtpZDogT1ZFUkxBWV9CTEVORElOR1NbY3VycmVudF0ubGFiZWx9KV06IGN1cnJlbnRcbiAgICAgIH0pLFxuICAgICAge31cbiAgICApO1xuXG4gICAgY29uc3Qgb25DaGFuZ2UgPSB1c2VDYWxsYmFjayhcbiAgICAgIGJsZW5kaW5nID0+IHVwZGF0ZU92ZXJsYXlCbGVuZGluZyhsYWJlbGVkT3ZlcmxheUJsZW5kaW5nc1tibGVuZGluZ10pLFxuICAgICAgW3VwZGF0ZU92ZXJsYXlCbGVuZGluZywgbGFiZWxlZE92ZXJsYXlCbGVuZGluZ3NdXG4gICAgKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U2lkZVBhbmVsU2VjdGlvbj5cbiAgICAgICAgPE92ZXJsYXlCbGVuZGluZ1NlbGVjdG9yVGl0bGVSb3c+XG4gICAgICAgICAgPFBhbmVsTGFiZWw+XG4gICAgICAgICAgICA8Rm9ybWF0dGVkTWVzc2FnZSBpZD1cIm92ZXJsYXlCbGVuZGluZy50aXRsZVwiIC8+XG4gICAgICAgICAgPC9QYW5lbExhYmVsPlxuICAgICAgICAgIDxJbmZvSGVscGVyV3JhcHBlcj57aW5mb0hlbHBlcn08L0luZm9IZWxwZXJXcmFwcGVyPlxuICAgICAgICA8L092ZXJsYXlCbGVuZGluZ1NlbGVjdG9yVGl0bGVSb3c+XG4gICAgICAgIDxJdGVtU2VsZWN0b3JcbiAgICAgICAgICBzZWxlY3RlZEl0ZW1zPXtpbnRsLmZvcm1hdE1lc3NhZ2Uoe2lkOiBPVkVSTEFZX0JMRU5ESU5HU1tvdmVybGF5QmxlbmRpbmddLmxhYmVsfSl9XG4gICAgICAgICAgb3B0aW9ucz17T2JqZWN0LmtleXMobGFiZWxlZE92ZXJsYXlCbGVuZGluZ3MpfVxuICAgICAgICAgIG11bHRpU2VsZWN0PXtmYWxzZX1cbiAgICAgICAgICBzZWFyY2hhYmxlPXtmYWxzZX1cbiAgICAgICAgICBvbkNoYW5nZT17b25DaGFuZ2V9XG4gICAgICAgIC8+XG4gICAgICA8L1NpZGVQYW5lbFNlY3Rpb24+XG4gICAgKTtcbiAgfVxuKTtcbk92ZXJsYXlCbGVuZGluZ1NlbGVjdG9yLmRpc3BsYXlOYW1lID0gJ092ZXJsYXlCbGVuZGluZ1NlbGVjdG9yJztcblxuTGF5ZXJNYW5hZ2VyRmFjdG9yeS5kZXBzID0gW1xuICBMYXllckxpc3RGYWN0b3J5LFxuICBEYXRhc2V0TGF5ZXJHcm91cEZhY3RvcnksXG4gIFBhbmVsVmlld0xpc3RUb2dnbGVGYWN0b3J5LFxuICBQYW5lbFRpdGxlRmFjdG9yeSxcbiAgRGF0YXNldFNlY3Rpb25GYWN0b3J5LFxuICBBZGRMYXllckJ1dHRvbkZhY3RvcnksXG4gIEluZm9IZWxwZXJGYWN0b3J5XG5dO1xuXG5mdW5jdGlvbiBMYXllck1hbmFnZXJGYWN0b3J5KFxuICBMYXllckxpc3Q6IFJldHVyblR5cGU8dHlwZW9mIExheWVyTGlzdEZhY3Rvcnk+LFxuICBEYXRhc2V0TGF5ZXJHcm91cDogUmV0dXJuVHlwZTx0eXBlb2YgRGF0YXNldExheWVyR3JvdXBGYWN0b3J5PixcbiAgUGFuZWxWaWV3TGlzdFRvZ2dsZTogUmV0dXJuVHlwZTx0eXBlb2YgUGFuZWxWaWV3TGlzdFRvZ2dsZUZhY3Rvcnk+LFxuICBQYW5lbFRpdGxlOiBSZXR1cm5UeXBlPHR5cGVvZiBQYW5lbFRpdGxlRmFjdG9yeT4sXG4gIERhdGFzZXRTZWN0aW9uOiBSZXR1cm5UeXBlPHR5cGVvZiBEYXRhc2V0U2VjdGlvbkZhY3Rvcnk+LFxuICBBZGRMYXllckJ1dHRvbjogUmV0dXJuVHlwZTx0eXBlb2YgQWRkTGF5ZXJCdXR0b25GYWN0b3J5PixcbiAgSW5mb0hlbHBlcjogUmV0dXJuVHlwZTx0eXBlb2YgSW5mb0hlbHBlckZhY3Rvcnk+XG4pIHtcbiAgY2xhc3MgTGF5ZXJNYW5hZ2VyIGV4dGVuZHMgQ29tcG9uZW50PExheWVyTWFuYWdlclByb3BzPiB7XG4gICAgX2FkZExheWVyID0gKGRhdGFzZXQ6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3Qge3Zpc1N0YXRlQWN0aW9uc30gPSB0aGlzLnByb3BzO1xuICAgICAgdmlzU3RhdGVBY3Rpb25zLmFkZExheWVyKHVuZGVmaW5lZCwgZGF0YXNldCk7XG4gICAgfTtcblxuICAgIF90b2dnbGVQYW5lbExpc3RWaWV3ID0gKGxpc3RWaWV3OiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IHt1aVN0YXRlQWN0aW9uc30gPSB0aGlzLnByb3BzO1xuICAgICAgdWlTdGF0ZUFjdGlvbnMudG9nZ2xlUGFuZWxMaXN0Vmlldyh7cGFuZWxJZDogJ2xheWVyJywgbGlzdFZpZXd9KTtcbiAgICB9O1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBsYXllcnMsXG4gICAgICAgIGRhdGFzZXRzLFxuICAgICAgICBpbnRsLFxuICAgICAgICBsYXllck9yZGVyLFxuICAgICAgICBzaG93QWRkRGF0YU1vZGFsLFxuICAgICAgICB1cGRhdGVUYWJsZUNvbG9yLFxuICAgICAgICBzaG93RGF0YXNldFRhYmxlLFxuICAgICAgICByZW1vdmVEYXRhc2V0LFxuICAgICAgICB1aVN0YXRlQWN0aW9ucyxcbiAgICAgICAgdmlzU3RhdGVBY3Rpb25zLFxuICAgICAgICBwYW5lbExpc3RWaWV3LFxuICAgICAgICBwYW5lbE1ldGFkYXRhXG4gICAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgICAgY29uc3QgaXNTb3J0QnlEYXRhc2V0TW9kZSA9IHBhbmVsTGlzdFZpZXcgPT09IFBBTkVMX1ZJRVdfVE9HR0xFUy5ieURhdGFzZXQ7XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGF5ZXItbWFuYWdlclwiPlxuICAgICAgICAgIDxTaWRlUGFuZWxTZWN0aW9uPlxuICAgICAgICAgICAgPFBhbmVsVmlld0xpc3RUb2dnbGVcbiAgICAgICAgICAgICAgdG9nZ2xlUGFuZWxMaXN0Vmlldz17dGhpcy5fdG9nZ2xlUGFuZWxMaXN0Vmlld31cbiAgICAgICAgICAgICAgbW9kZT17cGFuZWxMaXN0Vmlld31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9TaWRlUGFuZWxTZWN0aW9uPlxuICAgICAgICAgIDxEYXRhc2V0U2VjdGlvblxuICAgICAgICAgICAgZGF0YXNldHM9e2RhdGFzZXRzfVxuICAgICAgICAgICAgc2hvd0RhdGFzZXRUYWJsZT17c2hvd0RhdGFzZXRUYWJsZX1cbiAgICAgICAgICAgIHVwZGF0ZVRhYmxlQ29sb3I9e3VwZGF0ZVRhYmxlQ29sb3J9XG4gICAgICAgICAgICByZW1vdmVEYXRhc2V0PXtyZW1vdmVEYXRhc2V0fVxuICAgICAgICAgICAgc2hvd0RlbGV0ZURhdGFzZXRcbiAgICAgICAgICAgIHNob3dEYXRhc2V0TGlzdD17IWlzU29ydEJ5RGF0YXNldE1vZGV9XG4gICAgICAgICAgICBzaG93QWRkRGF0YU1vZGFsPXtzaG93QWRkRGF0YU1vZGFsfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPFNpZGVQYW5lbERpdmlkZXIgLz5cbiAgICAgICAgICA8U2lkZVBhbmVsU2VjdGlvbj5cbiAgICAgICAgICAgIDxQYW5lbFRpdGxlXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cImxheWVyLW1hbmFnZXItdGl0bGVcIlxuICAgICAgICAgICAgICB0aXRsZT17aW50bC5mb3JtYXRNZXNzYWdlKHtpZDogcGFuZWxNZXRhZGF0YS5sYWJlbH0pfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8QWRkTGF5ZXJCdXR0b24gZGF0YXNldHM9e2RhdGFzZXRzfSBvbkFkZD17dGhpcy5fYWRkTGF5ZXJ9IC8+XG4gICAgICAgICAgICA8L1BhbmVsVGl0bGU+XG4gICAgICAgICAgPC9TaWRlUGFuZWxTZWN0aW9uPlxuICAgICAgICAgIDxTaWRlUGFuZWxTZWN0aW9uPlxuICAgICAgICAgICAge2lzU29ydEJ5RGF0YXNldE1vZGUgPyAoXG4gICAgICAgICAgICAgIDxEYXRhc2V0TGF5ZXJHcm91cFxuICAgICAgICAgICAgICAgIGRhdGFzZXRzPXtkYXRhc2V0c31cbiAgICAgICAgICAgICAgICBzaG93RGF0YXNldFRhYmxlPXtzaG93RGF0YXNldFRhYmxlfVxuICAgICAgICAgICAgICAgIGxheWVycz17bGF5ZXJzfVxuICAgICAgICAgICAgICAgIHVwZGF0ZVRhYmxlQ29sb3I9e3VwZGF0ZVRhYmxlQ29sb3J9XG4gICAgICAgICAgICAgICAgcmVtb3ZlRGF0YXNldD17cmVtb3ZlRGF0YXNldH1cbiAgICAgICAgICAgICAgICBsYXllck9yZGVyPXtsYXllck9yZGVyfVxuICAgICAgICAgICAgICAgIGxheWVyQ2xhc3Nlcz17dGhpcy5wcm9wcy5sYXllckNsYXNzZXN9XG4gICAgICAgICAgICAgICAgdWlTdGF0ZUFjdGlvbnM9e3VpU3RhdGVBY3Rpb25zfVxuICAgICAgICAgICAgICAgIHZpc1N0YXRlQWN0aW9ucz17dmlzU3RhdGVBY3Rpb25zfVxuICAgICAgICAgICAgICAgIHNob3dEZWxldGVEYXRhc2V0XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAvLyBUT0RPIHJlcGxhY2UgaWdub3JlXG4gICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgPExheWVyTGlzdFxuICAgICAgICAgICAgICAgIGxheWVycz17bGF5ZXJzfVxuICAgICAgICAgICAgICAgIGRhdGFzZXRzPXtkYXRhc2V0c31cbiAgICAgICAgICAgICAgICBsYXllck9yZGVyPXtsYXllck9yZGVyfVxuICAgICAgICAgICAgICAgIHVpU3RhdGVBY3Rpb25zPXt1aVN0YXRlQWN0aW9uc31cbiAgICAgICAgICAgICAgICB2aXNTdGF0ZUFjdGlvbnM9e3Zpc1N0YXRlQWN0aW9uc31cbiAgICAgICAgICAgICAgICBsYXllckNsYXNzZXM9e3RoaXMucHJvcHMubGF5ZXJDbGFzc2VzfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L1NpZGVQYW5lbFNlY3Rpb24+XG4gICAgICAgICAgPExheWVyQmxlbmRpbmdTZWxlY3RvclxuICAgICAgICAgICAgbGF5ZXJCbGVuZGluZz17dGhpcy5wcm9wcy5sYXllckJsZW5kaW5nfVxuICAgICAgICAgICAgdXBkYXRlTGF5ZXJCbGVuZGluZz17dmlzU3RhdGVBY3Rpb25zLnVwZGF0ZUxheWVyQmxlbmRpbmd9XG4gICAgICAgICAgICBpbnRsPXtpbnRsfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPE92ZXJsYXlCbGVuZGluZ1NlbGVjdG9yXG4gICAgICAgICAgICBvdmVybGF5QmxlbmRpbmc9e3RoaXMucHJvcHMub3ZlcmxheUJsZW5kaW5nfVxuICAgICAgICAgICAgdXBkYXRlT3ZlcmxheUJsZW5kaW5nPXt2aXNTdGF0ZUFjdGlvbnMudXBkYXRlT3ZlcmxheUJsZW5kaW5nfVxuICAgICAgICAgICAgaW50bD17aW50bH1cbiAgICAgICAgICAgIGluZm9IZWxwZXI9e1xuICAgICAgICAgICAgICA8SW5mb0hlbHBlclxuICAgICAgICAgICAgICAgIGlkPXtgb3ZlcmxheUJsZW5kaW5nLWRlc2NyaXB0aW9uYH1cbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj17J292ZXJsYXlCbGVuZGluZy5kZXNjcmlwdGlvbid9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaW5qZWN0SW50bChMYXllck1hbmFnZXIpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBMYXllck1hbmFnZXJGYWN0b3J5O1xuIl19