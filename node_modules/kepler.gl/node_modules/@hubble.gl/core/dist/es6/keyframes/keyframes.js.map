{"version":3,"sources":["../../../src/keyframes/keyframes.js"],"names":["KeyFrames","LumaKeyFrames","sanitizeEasings","merge","sanitizeTimings","factorInterpolator","Keyframes","constructor","features","timings","keyframes","easings","_setActiveFeatures","bind","getFrame","length","Error","_easings","_timings","activeFeatures","reduce","feature","_keyframes","setKeyFrames","firstKeyframe","Object","keys","key","undefined","factor","start","getStartData","end","getEndData","frame","forEach","ease"],"mappings":";AAmBA,SAAQA,SAAS,IAAIC,aAArB,QAAyC,iBAAzC;AACA,SAAQC,eAAR,EAAyBC,KAAzB,EAAgCC,eAAhC,EAAiDC,kBAAjD,QAA0E,SAA1E;;AAEA,MAAMC,SAAN,SAAwBL,aAAxB,CAAsC;AAEpCM,EAAAA,WAAW,CAAC;AAACC,IAAAA,QAAD;AAAWC,IAAAA,OAAX;AAAoBC,IAAAA,SAApB;AAA+BC,IAAAA;AAA/B,GAAD,EAA0C;AACnD,UAAM,EAAN;;AADmD,4CADpC,EACoC;;AAEnD,SAAKC,kBAAL,GAA0B,KAAKA,kBAAL,CAAwBC,IAAxB,CAA6B,IAA7B,CAA1B;AACA,SAAKC,QAAL,GAAgB,KAAKA,QAAL,CAAcD,IAAd,CAAmB,IAAnB,CAAhB;;AAEA,QAAIH,SAAS,CAACK,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,YAAM,IAAIC,KAAJ,CAAU,qCAAV,CAAN;AACD;;AAED,UAAMC,QAAQ,GAAGf,eAAe,CAACQ,SAAD,EAAYC,OAAZ,CAAhC;;AAEA,UAAMO,QAAQ,GAAGd,eAAe,CAACM,SAAD,EAAYD,OAAZ,CAAhC;;AAEA,SAAKU,cAAL,GAAsBX,QAAQ,CAACY,MAAT,CAAgB,CAACD,cAAD,EAAiBE,OAAjB,KAA6B;AACjEF,MAAAA,cAAc,CAACE,OAAD,CAAd,GAA0B,KAA1B;AACA,aAAOF,cAAP;AACD,KAHqB,EAGnB,EAHmB,CAAtB;;AAKA,SAAKP,kBAAL,CAAwBF,SAAxB;;AACA,UAAMY,UAAU,GAAGnB,KAAK,CAACe,QAAD,EAAWR,SAAX,EAAsBO,QAAtB,CAAxB;;AACA,SAAKM,YAAL,CAAkBD,UAAlB;AACD;;AAEDV,EAAAA,kBAAkB,CAACF,SAAD,EAAY;AAC5B,UAAMc,aAAa,GAAGd,SAAS,CAAC,CAAD,CAA/B;AACA,SAAKS,cAAL,GAAsBM,MAAM,CAACC,IAAP,CAAYF,aAAZ,EAA2BJ,MAA3B,CAAkC,CAACD,cAAD,EAAiBQ,GAAjB,KAAyB;AAE/E,UAAIH,aAAa,CAACG,GAAD,CAAb,KAAuBC,SAA3B,EAAsC;AACpCT,QAAAA,cAAc,CAACQ,GAAD,CAAd,GAAsB,IAAtB;AACD;;AACD,aAAOR,cAAP;AACD,KANqB,EAMnB,KAAKA,cANc,CAAtB;AAOD;;AAEDL,EAAAA,QAAQ,GAAG;AACT,UAAMe,MAAM,GAAG,KAAKA,MAApB;AACA,UAAMC,KAAK,GAAG,KAAKC,YAAL,EAAd;AACA,UAAMC,GAAG,GAAG,KAAKC,UAAL,EAAZ;AACA,UAAMC,KAAK,GAAG,EAAd;AAEAT,IAAAA,MAAM,CAACC,IAAP,CAAY,KAAKP,cAAjB,EAAiCgB,OAAjC,CAAyCR,GAAG,IAAI;AAC9C,UAAI,KAAKR,cAAL,CAAoBQ,GAApB,CAAJ,EAA8B;AAC5BO,QAAAA,KAAK,CAACP,GAAD,CAAL,GAAatB,kBAAkB,CAACyB,KAAK,CAACH,GAAD,CAAN,EAAaK,GAAG,CAACL,GAAD,CAAhB,EAAuBK,GAAG,CAACI,IAA3B,CAAlB,CAAmDP,MAAnD,CAAb;AACD;AACF,KAJD;AAMA,WAAOK,KAAP;AACD;;AAjDmC;;AAoDtC,eAAe5B,SAAf","sourcesContent":["// Copyright (c) 2020 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {KeyFrames as LumaKeyFrames} from '@luma.gl/engine';\nimport {sanitizeEasings, merge, sanitizeTimings, factorInterpolator} from './utils';\n\nclass Keyframes extends LumaKeyFrames {\n  activeFeatures = {};\n  constructor({features, timings, keyframes, easings}) {\n    super([]);\n    this._setActiveFeatures = this._setActiveFeatures.bind(this);\n    this.getFrame = this.getFrame.bind(this);\n\n    if (keyframes.length === 0) {\n      throw new Error('There must be at least one keyframe');\n    }\n\n    const _easings = sanitizeEasings(keyframes, easings);\n\n    const _timings = sanitizeTimings(keyframes, timings);\n\n    this.activeFeatures = features.reduce((activeFeatures, feature) => {\n      activeFeatures[feature] = false;\n      return activeFeatures;\n    }, {});\n\n    this._setActiveFeatures(keyframes);\n    const _keyframes = merge(_timings, keyframes, _easings);\n    this.setKeyFrames(_keyframes);\n  }\n\n  _setActiveFeatures(keyframes) {\n    const firstKeyframe = keyframes[0];\n    this.activeFeatures = Object.keys(firstKeyframe).reduce((activeFeatures, key) => {\n      // activate only keys that are expected\n      if (firstKeyframe[key] !== undefined) {\n        activeFeatures[key] = true;\n      }\n      return activeFeatures;\n    }, this.activeFeatures);\n  }\n\n  getFrame() {\n    const factor = this.factor;\n    const start = this.getStartData();\n    const end = this.getEndData();\n    const frame = {};\n\n    Object.keys(this.activeFeatures).forEach(key => {\n      if (this.activeFeatures[key]) {\n        frame[key] = factorInterpolator(start[key], end[key], end.ease)(factor);\n      }\n    });\n\n    return frame;\n  }\n}\n\nexport default Keyframes;\n"],"file":"keyframes.js"}