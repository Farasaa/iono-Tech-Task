"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.observeDimensions = observeDimensions;
exports.unobserveDimensions = unobserveDimensions;
exports["default"] = useDimensions;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _lodash = _interopRequireDefault(require("lodash.throttle"));

var _react = require("react");

var _resizeObserverPolyfill = _interopRequireDefault(require("resize-observer-polyfill"));

function _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === "undefined" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

var DEFAULT_THROTTLE_DELAY = 100; // Using a single ResizeObserver for all elements can be 10x
// more performant than using a separate ResizeObserver per element
// https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/z6ienONUb5A/F5-VcUZtBAAJ

var _observerRegistry;

function getObserverRegistry() {
  if (_observerRegistry === undefined) {
    var callbacks = new Map();
    var resizeObserver = new _resizeObserverPolyfill["default"](function (entries, observer) {
      var _iterator = _createForOfIteratorHelper(entries),
          _step;

      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var _callbacks$get;

          var entry = _step.value;
          (_callbacks$get = callbacks.get(entry.target)) === null || _callbacks$get === void 0 ? void 0 : _callbacks$get(entry, observer);
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
    });
    _observerRegistry = {
      subscribe: function subscribe(target, callback) {
        if (target instanceof Element) {
          resizeObserver.observe(target);
          callbacks.set(target, callback);
        }
      },
      unsubscribe: function unsubscribe(target) {
        if (target instanceof Element) {
          resizeObserver.unobserve(target);
          callbacks["delete"](target);
        }
      }
    };
  }

  return _observerRegistry;
}

function observeDimensions(target, handleResize) {
  var throttleDelay = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : DEFAULT_THROTTLE_DELAY;
  var registry = getObserverRegistry();
  var handler = throttleDelay > 0 ? (0, _lodash["default"])(handleResize, throttleDelay) : handleResize;
  registry.subscribe(target, function (entry) {
    return handler(getSize(target, entry));
  });
}

function unobserveDimensions(target) {
  var registry = getObserverRegistry();
  registry.unsubscribe(target);
}

function getSize(node, entry) {
  if (entry.contentRect) {
    var _entry$contentRect = entry.contentRect,
        width = _entry$contentRect.width,
        height = _entry$contentRect.height;
    return {
      width: width,
      height: height
    };
  }

  if (node.getBoundingClientRect) {
    var _node$getBoundingClie = node.getBoundingClientRect(),
        _width = _node$getBoundingClie.width,
        _height = _node$getBoundingClie.height;

    return {
      width: _width,
      height: _height
    };
  }

  return null;
}
/**
 * Usage example:
 * const [ref, dimensions] = useDimensions<HTMLDivElement>();
 *
 * @param throttleDelay
 * @returns
 */


function useDimensions(nodeRef) {
  var throttleDelay = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DEFAULT_THROTTLE_DELAY;
  var ref = nodeRef !== null && nodeRef !== void 0 ? nodeRef : (0, _react.useRef)(null);

  var _useState = (0, _react.useState)(null),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      size = _useState2[0],
      setSize = _useState2[1];

  (0, _react.useEffect)(function () {
    var current = ref.current;

    if (!current) {
      return;
    }

    var didUnobserve = false;
    observeDimensions(current, function (entry) {
      if (didUnobserve) return;
      var newSize = getSize(current, entry);

      if (newSize) {
        // @ts-ignore
        setSize(newSize);
      }
    }, throttleDelay);
    return function () {
      didUnobserve = true;
      unobserveDimensions(current);
    }; // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [throttleDelay, ref === null || ref === void 0 ? void 0 : ref.current]);
  return [ref, size];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vYnNlcnZlLWRpbWVuc2lvbnMudHMiXSwibmFtZXMiOlsiREVGQVVMVF9USFJPVFRMRV9ERUxBWSIsIl9vYnNlcnZlclJlZ2lzdHJ5IiwiZ2V0T2JzZXJ2ZXJSZWdpc3RyeSIsInVuZGVmaW5lZCIsImNhbGxiYWNrcyIsIk1hcCIsInJlc2l6ZU9ic2VydmVyIiwiUmVzaXplT2JzZXJ2ZXIiLCJlbnRyaWVzIiwib2JzZXJ2ZXIiLCJlbnRyeSIsImdldCIsInRhcmdldCIsInN1YnNjcmliZSIsImNhbGxiYWNrIiwiRWxlbWVudCIsIm9ic2VydmUiLCJzZXQiLCJ1bnN1YnNjcmliZSIsInVub2JzZXJ2ZSIsIm9ic2VydmVEaW1lbnNpb25zIiwiaGFuZGxlUmVzaXplIiwidGhyb3R0bGVEZWxheSIsInJlZ2lzdHJ5IiwiaGFuZGxlciIsImdldFNpemUiLCJ1bm9ic2VydmVEaW1lbnNpb25zIiwibm9kZSIsImNvbnRlbnRSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ1c2VEaW1lbnNpb25zIiwibm9kZVJlZiIsInJlZiIsInNpemUiLCJzZXRTaXplIiwiY3VycmVudCIsImRpZFVub2JzZXJ2ZSIsIm5ld1NpemUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFHQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFPQSxJQUFNQSxzQkFBc0IsR0FBRyxHQUEvQixDLENBRUE7QUFDQTtBQUNBOztBQUNBLElBQUlDLGlCQUFKOztBQUVBLFNBQVNDLG1CQUFULEdBQStCO0FBQzdCLE1BQUlELGlCQUFpQixLQUFLRSxTQUExQixFQUFxQztBQUNuQyxRQUFNQyxTQUFTLEdBQUcsSUFBSUMsR0FBSixFQUFsQjtBQUNBLFFBQU1DLGNBQWMsR0FBRyxJQUFJQyxrQ0FBSixDQUFtQixVQUFDQyxPQUFELEVBQVVDLFFBQVYsRUFBdUI7QUFBQSxpREFDM0NELE9BRDJDO0FBQUE7O0FBQUE7QUFDL0QsNERBQTZCO0FBQUE7O0FBQUEs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RWQsUUFBSSxDQUFDQSxPQUFMLEVBQWM7QUFDWjtBQUNEOztBQUVELFFBQUlDLFlBQVksR0FBRyxLQUFuQjtBQUNBbEIsSUFBQUEsaUJBQWlCLENBQ2ZpQixPQURlLEVBRWYsVUFBQTNCLEtBQUssRUFBSTtBQUNQLFVBQUk0QixZQUFKLEVBQWtCO0FBQ2xCLFVBQU1DLE9BQU8sR0FBR2QsT0FBTyxDQUFDWSxPQUFELEVBQVUzQixLQUFWLENBQXZCOztBQUNBLFVBQUk2QixPQUFKLEVBQWE7QUFDWDtBQUNBSCxRQUFBQSxPQUFPLENBQUNHLE9BQUQsQ0FBUDtBQUNEO0FBQ0YsS0FUYyxFQVVmakIsYUFWZSxDQUFqQjtBQVlBLFdBQU8sWUFBTTtBQUNYZ0IsTUFBQUEsWUFBWSxHQUFHLElBQWY7QUFDQVosTUFBQUEsbUJBQW1CLENBQUNXLE9BQUQsQ0FBbkI7QUFDRCxLQUhELENBbkJjLENBdUJkO0FBQ0QsR0F4QkQsRUF3QkcsQ0FBQ2YsYUFBRCxFQUFnQlksR0FBaEIsYUFBZ0JBLEdBQWhCLHVCQUFnQkEsR0FBRyxDQUFFRyxPQUFyQixDQXhCSDtBQTBCQSxTQUFPLENBQUNILEdBQUQsRUFBTUMsSUFBTixDQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG5pbXBvcnQgdGhyb3R0bGUgZnJvbSAnbG9kYXNoLnRocm90dGxlJztcbmltcG9ydCB7dXNlRWZmZWN0LCB1c2VSZWYsIHVzZVN0YXRlLCBSZWZPYmplY3R9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZXNpemVPYnNlcnZlciBmcm9tICdyZXNpemUtb2JzZXJ2ZXItcG9seWZpbGwnO1xuXG5leHBvcnQgaW50ZXJmYWNlIERpbWVuc2lvbnMge1xuICByZWFkb25seSBoZWlnaHQ6IG51bWJlcjtcbiAgcmVhZG9ubHkgd2lkdGg6IG51bWJlcjtcbn1cblxuY29uc3QgREVGQVVMVF9USFJPVFRMRV9ERUxBWSA9IDEwMDtcblxuLy8gVXNpbmcgYSBzaW5nbGUgUmVzaXplT2JzZXJ2ZXIgZm9yIGFsbCBlbGVtZW50cyBjYW4gYmUgMTB4XG4vLyBtb3JlIHBlcmZvcm1hbnQgdGhhbiB1c2luZyBhIHNlcGFyYXRlIFJlc2l6ZU9ic2VydmVyIHBlciBlbGVtZW50XG4vLyBodHRwczovL2dyb3Vwcy5nb29nbGUuY29tL2EvY2hyb21pdW0ub3JnL2ZvcnVtLyMhbXNnL2JsaW5rLWRldi96Nmllbk9OVWI1QS9GNS1WY1VadEJBQUpcbmxldCBfb2JzZXJ2ZXJSZWdpc3RyeTtcblxuZnVuY3Rpb24gZ2V0T2JzZXJ2ZXJSZWdpc3RyeSgpIHtcbiAgaWYgKF9vYnNlcnZlclJlZ2lzdHJ5ID09PSB1bmRlZmluZWQpIHtcbiAgICBjb25zdCBjYWxsYmFja3MgPSBuZXcgTWFwKCk7XG4gICAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGVudHJpZXMsIG9ic2VydmVyKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgICAgY2FsbGJhY2tzLmdldChlbnRyeS50YXJnZXQpPy4oZW50cnksIG9ic2VydmVyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBfb2JzZXJ2ZXJSZWdpc3RyeSA9IHtcbiAgICAgIHN1YnNjcmliZSh0YXJnZXQsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgICAgcmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZSh0YXJnZXQpO1xuICAgICAgICAgIGNhbGxiYWNrcy5zZXQodGFyZ2V0LCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1bnN1YnNjcmliZSh0YXJnZXQpIHtcbiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEVsZW1lbnQpIHtcbiAgICAgICAgICByZXNpemVPYnNlcnZlci51bm9ic2VydmUodGFyZ2V0KTtcbiAgICAgICAgICBjYWxsYmFja3MuZGVsZXRlKHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIHJldHVybiBfb2JzZXJ2ZXJSZWdpc3RyeTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9ic2VydmVEaW1lbnNpb25zKFxuICB0YXJnZXQ6IEVsZW1lbnQsXG4gIGhhbmRsZVJlc2l6ZTogKHNpemU6IERpbWVuc2lvbnMgfCBudWxsKSA9PiB2b2lkLFxuICB0aHJvdHRsZURlbGF5ID0gREVGQVVMVF9USFJPVFRMRV9ERUxBWVxuKSB7XG4gIGNvbnN0IHJlZ2lzdHJ5ID0gZ2V0T2JzZXJ2ZXJSZWdpc3RyeSgpO1xuICBjb25zdCBoYW5kbGVyID0gdGhyb3R0bGVEZWxheSA+IDAgPyB0aHJvdHRsZShoYW5kbGVSZXNpemUsIHRocm90dGxlRGVsYXkpIDogaGFuZGxlUmVzaXplO1xuICByZWdpc3RyeS5zdWJzY3JpYmUodGFyZ2V0LCBlbnRyeSA9PiBoYW5kbGVyKGdldFNpemUodGFyZ2V0LCBlbnRyeSkpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVub2JzZXJ2ZURpbWVuc2lvbnModGFyZ2V0OiBFbGVtZW50KSB7XG4gIGNvbnN0IHJlZ2lzdHJ5ID0gZ2V0T2JzZXJ2ZXJSZWdpc3RyeSgpO1xuICByZWdpc3RyeS51bnN1YnNjcmliZSh0YXJnZXQpO1xufVxuXG5mdW5jdGlvbiBnZXRTaXplKG5vZGUsIGVudHJ5KTogRGltZW5zaW9ucyB8IG51bGwge1xuICBpZiAoZW50cnkuY29udGVudFJlY3QpIHtcbiAgICBjb25zdCB7d2lkdGgsIGhlaWdodH0gPSBlbnRyeS5jb250ZW50UmVjdDtcbiAgICByZXR1cm4ge3dpZHRoLCBoZWlnaHR9O1xuICB9XG4gIGlmIChub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCkge1xuICAgIGNvbnN0IHt3aWR0aCwgaGVpZ2h0fSA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgcmV0dXJuIHt3aWR0aCwgaGVpZ2h0fTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBVc2FnZSBleGFtcGxlOlxuICogY29uc3QgW3JlZiwgZGltZW5zaW9uc10gPSB1c2VEaW1lbnNpb25zPEhUTUxEaXZFbGVtZW50PigpO1xuICpcbiAqIEBwYXJhbSB0aHJvdHRsZURlbGF5XG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiB1c2VEaW1lbnNpb25zPFQgZXh0ZW5kcyBFbGVtZW50PihcbiAgbm9kZVJlZj86IFJlZk9iamVjdDxUPixcbiAgdGhyb3R0bGVEZWxheSA9IERFRkFVTFRfVEhST1RUTEVfREVMQVlcbik6IFtSZWZPYmplY3Q8VD4sIERpbWVuc2lvbnMgfCBudWxsXSB7XG4gIGNvbnN0IHJlZiA9IG5vZGVSZWYgPz8gdXNlUmVmPFQ+KG51bGwpO1xuICBjb25zdCBbc2l6ZSwgc2V0U2l6ZV0gPSB1c2VTdGF0ZShudWxsKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHtjdXJyZW50fSA9IHJlZjtcbiAgICBpZiAoIWN1cnJlbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgZGlkVW5vYnNlcnZlID0gZmFsc2U7XG4gICAgb2JzZXJ2ZURpbWVuc2lvbnMoXG4gICAgICBjdXJyZW50LFxuICAgICAgZW50cnkgPT4ge1xuICAgICAgICBpZiAoZGlkVW5vYnNlcnZlKSByZXR1cm47XG4gICAgICAgIGNvbnN0IG5ld1NpemUgPSBnZXRTaXplKGN1cnJlbnQsIGVudHJ5KTtcbiAgICAgICAgaWYgKG5ld1NpemUpIHtcbiAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgc2V0U2l6ZShuZXdTaXplKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRocm90dGxlRGVsYXlcbiAgICApO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBkaWRVbm9ic2VydmUgPSB0cnVlO1xuICAgICAgdW5vYnNlcnZlRGltZW5zaW9ucyhjdXJyZW50KTtcbiAgICB9O1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgfSwgW3Rocm90dGxlRGVsYXksIHJlZj8uY3VycmVudF0pO1xuXG4gIHJldHVybiBbcmVmLCBzaXplXTtcbn1cbiJdfQ==