"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.NumberFormatConfig = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _utils = require("@kepler.gl/utils");

var _constants = require("@kepler.gl/constants");

var _styledComponents2 = require("../../common/styled-components");

var _optionDropdown = require("./option-dropdown");

var _templateObject, _templateObject2, _templateObject3;

var StyledConfigPanel = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  background-color: ", ";\n  box-shadow: 0 10px 18px 0 rgb(0 0 0 / 36%);\n  flex-grow: 1;\n"])), function (props) {
  return props.theme.headerCellBackground;
});

var StyledConfigPanelContent = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  padding: 20px;\n  min-width: 230px;\n  max-height: 400px;\n  overflow: overlay;\n"])));

var StyledTableConfigGroup = _styledComponents["default"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  margin-bottom: 10px;\n  display: flex;\n  align-items: center;\n\n  input {\n    cursor: pointer !important;\n    width: 184px;\n    height: 22px;\n  }\n"])));

var NumberFormatConfig = function NumberFormatConfig(_ref) {
  var title = _ref.title,
      id = _ref.id,
      defaultFormat = _ref.defaultFormat,
      options = _ref.options,
      columns = _ref.columns,
      setColumnDisplayFormat = _ref.setColumnDisplayFormat,
      onClose = _ref.onClose;

  var _useState = (0, _react.useState)(false),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      showFormatter = _useState2[0],
      setShowFormatter = _useState2[1];

  var _useState3 = (0, _react.useState)(defaultFormat),
      _useState4 = (0, _slicedToArray2["default"])(_useState3, 2),
      format = _useState4[0],
      setFormat = _useState4[1];

  var onSetDisplayFormat = (0, _react.useCallback)(function (option) {
    setFormat(option.label);
    var formats = columns.reduce(function (prev, col) {
      prev[col.name] = option.format;
      return prev;
    }, {});
    setColumnDisplayFormat(formats);
    onClose();
  }, [columns, setColumnDisplayFormat, onClose]);
  return /*#__PURE__*/_react["default"].createElement(StyledTableConfigGroup, null, /*#__PURE__*/_react["default"].createElement(_styledComponents2.InputLight, {
    id: id,
    type: "text",
    value: title,
    "data-tip": format,
    readOnly: true,
    onClick: function onClick() {
      return setShowFormatter(true);
    }
  }), /*#__PURE__*/_react["default"].createElement(_optionDropdown.FormatterDropdown, {
    left: -185,
    top: 10,
    isOpened: showFormatter,
    displayFormat: format,
    setDisplayFormat: onSetDisplayFormat,
    onClose: function onClose() {
      return setShowFormatter(false);
    },
    formatLabels: options
  }));
};

exports.NumberFormatConfig = NumberFormatConfig;

function DataTableConfigFactory() {
  var getColumnsByFieldType = function getColumnsByFieldType(columns, colMeta, fieldType) {
    var result = [];
    columns.forEach(function (colName) {
      var _colMeta$colName;

      if (((_colMeta$colName = colMeta[colName]) === null || _colMeta$colName === void 0 ? void 0 : _colMeta$colName.type) === fieldType) {
        result.push(colMeta[colName]);
      }
    });
    return result;
  };

  var DataTableConfig = function DataTableConfig(_ref2) {
    var columns = _ref2.columns,
        colMeta = _ref2.colMeta,
        setColumnDisplayFormat = _ref2.setColumnDisplayFormat,
        onClose = _ref2.onClose;
    var formatConfigs = [{
      title: '# Set Integer Number Format',
      id: 'input-iteger-format',
      displayType: _constants.ALL_FIELD_TYPES.integer
    }, {
      title: '# Set Float Number Format',
      id: 'input-float-format',
      displayType: _constants.ALL_FIELD_TYPES.real
    }, {
      title: '# Set Timestamp Format',
      id: 'input-datetime-format',
      displayType: _constants.ALL_FIELD_TYPES.timestamp
    }, {
      title: '# Set Date Format',
      id: 'input-date-format',
      displayType: _constants.ALL_FIELD_TYPES.date
    }, {
      title: '# Set Boolean Format',
      id: 'input-bool-format',
      displayType: _constants.ALL_FIELD_TYPES["boolean"]
    }];
    return /*#__PURE__*/_react["default"].createElement(StyledConfigPanel, null, /*#__PURE__*/_react["default"].createElement(StyledConfigPanelContent, null, formatConfigs.map(function (config, index) {
      return /*#__PURE__*/_react["default"].createElement(NumberFormatConfig, {
        title: "".concat(config.title),
        key: index,
        id: config.id,
        defaultFormat: 'None',
        colMeta: colMeta,
        options: (0, _utils.getFieldFormatLabels)("".concat(config.displayType)),
        columns: getColumnsByFieldType(columns, colMeta, "".concat(config.displayType)),
        setColumnDisplayFormat: setColumnDisplayFormat,
        onClose: onClose
      });
    })));
  };

  return DataTableConfig;
}

var _default = DataTableConfigFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb24vZGF0YS10YWJsZS9kaXNwbGF5LWZvcm1hdC50c3giXSwibmFtZXMiOlsiU3R5bGVkQ29uZmlnUGFuZWwiLCJzdHlsZWQiLCJkaXYiLCJwcm9wcyIsInRoZW1lIiwiaGVhZGVyQ2VsbEJhY2tncm91bmQiLCJTdHlsZWRDb25maWdQYW5lbENvbnRlbnQiLCJTdHlsZWRUYWJsZUNvbmZpZ0dyb3VwIiwiTnVtYmVyRm9ybWF0Q29uZmlnIiwidGl0bGUiLCJpZCIsImRlZmF1bHRGb3JtYXQiLCJvcHRpb25zIiwiY29sdW1ucyIsInNldENvbHVtbkRpc3BsYXlGb3JtYXQiLCJvbkNsb3NlIiwic2hvd0Zvcm1hdHRlciIsInNldFNob3dGb3JtYXR0ZXIiLCJmb3JtYXQiLCJzZXRGb3JtYXQiLCJvblNldERpc3BsYXlGb3JtYXQiLCJvcHRpb24iLCJsYWJlbCIsImZvcm1hdHMiLCJyZWR1Y2UiLCJwcmV2IiwiY29sIiwibmFtZSIsIkRhdGFUYWJsZUNvbmZpZ0ZhY3RvcnkiLCJnZXRDb2x1bW5zQnlGaWVsZFR5cGUiLCJjb2xNZXRhIiwiZmllbGRUeXBlIiwicmVzdWx0IiwiZm9yRWFjaCIsImNvbE5hbWUiLCJ0eXBlIiwicHVzaCIsIkRhdGFUYWJsZUNvbmZpZyIsImZvcm1hdENvbmZpZ3MiLCJkaXNwbGF5VHlwZSIsIkFMTF9GSUVMRF9UWVBFUyIsImludGVnZXIiLCJyZWFsIiwidGltZXN0YW1wIiwiZGF0ZSIsIm1hcCIsImNvbmZpZyIsImluZGV4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFHQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFHQTs7QUFDQTs7OztBQUVBLElBQU1BLGlCQUFpQixHQUFHQyw2QkFBT0MsR0FBVixvTEFDRCxVQUFBQyxLQUFLO0FBQUEsU0FBSUEsS0FBSyxDQUFDQyxLQUFOLENBQVlDLG9CQUFoQjtBQUFBLENBREosQ0FBdkI7O0FBS0EsSUFBTUMsd0JBQXdCLEdBQUdMLDZCQUFPQyxHQUFW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LEVBQUVvQixPQUxYO0FBTUUsUUFBQSxPQUFPLEVBQUUsMkNBQXdCZ0IsTUFBTSxDQUFDUCxXQUEvQixFQU5YO0FBT0UsUUFBQSxPQUFPLEVBQUVWLHFCQUFxQixDQUFDaEIsT0FBRCxFQUFVaUIsT0FBVixZQUFzQmdCLE1BQU0sQ0FBQ1AsV0FBN0IsRUFQaEM7QUFRRSxRQUFBLHNCQUFzQixFQUFFekIsc0JBUjFCO0FBU0UsUUFBQSxPQUFPLEVBQUVDO0FBVFgsUUFEaUI7QUFBQSxLQUFsQixDQURILENBREYsQ0FERjtBQW1CRCxHQWhERDs7QUFpREEsU0FBT3NCLGVBQVA7QUFDRDs7ZUFFY1Qsc0IiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG5pbXBvcnQgUmVhY3QsIHt1c2VDYWxsYmFjaywgdXNlU3RhdGV9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuXG5pbXBvcnQge2dldEZpZWxkRm9ybWF0TGFiZWxzfSBmcm9tICdAa2VwbGVyLmdsL3V0aWxzJztcbmltcG9ydCB7QUxMX0ZJRUxEX1RZUEVTLCBUb29sdGlwRm9ybWF0fSBmcm9tICdAa2VwbGVyLmdsL2NvbnN0YW50cyc7XG5pbXBvcnQge0NvbE1ldGEsIENvbE1ldGFQcm9wc30gZnJvbSAnQGtlcGxlci5nbC90eXBlcyc7XG5cbmltcG9ydCB7SW5wdXRMaWdodH0gZnJvbSAnLi4vLi4vY29tbW9uL3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCB7Rm9ybWF0dGVyRHJvcGRvd259IGZyb20gJy4vb3B0aW9uLWRyb3Bkb3duJztcblxuY29uc3QgU3R5bGVkQ29uZmlnUGFuZWwgPSBzdHlsZWQuZGl2YFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmhlYWRlckNlbGxCYWNrZ3JvdW5kfTtcbiAgYm94LXNoYWRvdzogMCAxMHB4IDE4cHggMCByZ2IoMCAwIDAgLyAzNiUpO1xuICBmbGV4LWdyb3c6IDE7XG5gO1xuY29uc3QgU3R5bGVkQ29uZmlnUGFuZWxDb250ZW50ID0gc3R5bGVkLmRpdmBcbiAgcGFkZGluZzogMjBweDtcbiAgbWluLXdpZHRoOiAyMzBweDtcbiAgbWF4LWhlaWdodDogNDAwcHg7XG4gIG92ZXJmbG93OiBvdmVybGF5O1xuYDtcblxuY29uc3QgU3R5bGVkVGFibGVDb25maWdHcm91cCA9IHN0eWxlZC5kaXZgXG4gIG1hcmdpbi1ib3R0b206IDEwcHg7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG5cbiAgaW5wdXQge1xuICAgIGN1cnNvcjogcG9pbnRlciAhaW1wb3J0YW50O1xuICAgIHdpZHRoOiAxODRweDtcbiAgICBoZWlnaHQ6IDIycHg7XG4gIH1cbmA7XG5cbmV4cG9ydCB0eXBlIERhdGFUYWJsZUNvbmZpZ1Byb3BzID0ge1xuICB0aXRsZTogc3RyaW5nO1xuICBpZDogc3RyaW5nO1xuICBkZWZhdWx0Rm9ybWF0OiBzdHJpbmc7XG4gIG9wdGlvbnM6IFRvb2x0aXBGb3JtYXRbXTtcbiAgY29sdW1uczoge25hbWU6IHN0cmluZ31bXTtcbiAgY29sTWV0YTogQ29sTWV0YTtcbiAgc2V0Q29sdW1uRGlzcGxheUZvcm1hdDogKGZvcm1hdHM6IHtba2V5OiBzdHJpbmddOiBzdHJpbmd9KSA9PiB2b2lkO1xuICBvbkNsb3NlOiAoKSA9PiB2b2lkO1xufTtcblxuZXhwb3J0IGNvbnN0IE51bWJlckZvcm1hdENvbmZpZzogUmVhY3QuRkM8RGF0YVRhYmxlQ29uZmlnUHJvcHM+ID0gKHtcbiAgdGl0bGUsXG4gIGlkLFxuICBkZWZhdWx0Rm9ybWF0LFxuICBvcHRpb25zLFxuICBjb2x1bW5zLFxuICBzZXRDb2x1bW5EaXNwbGF5Rm9ybWF0LFxuICBvbkNsb3NlXG59OiBEYXRhVGFibGVDb25maWdQcm9wcykgPT4ge1xuICBjb25zdCBbc2hvd0Zvcm1hdHRlciwgc2V0U2hvd0Zvcm1hdHRlcl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtmb3JtYXQsIHNldEZvcm1hdF0gPSB1c2VTdGF0ZShkZWZhdWx0Rm9ybWF0KTtcblxuICBjb25zdCBvblNldERpc3BsYXlGb3JtYXQgPSB1c2VDYWxsYmFjayhcbiAgICAob3B0aW9uOiBUb29sdGlwRm9ybWF0KSA9PiB7XG4gICAgICBzZXRGb3JtYXQob3B0aW9uLmxhYmVsKTtcbiAgICAgIGNvbnN0IGZvcm1hdHM6IHtba2V5OiBzdHJpbmddOiBzdHJpbmd9ID0gY29sdW1ucy5yZWR1Y2UoKHByZXYsIGNvbCkgPT4ge1xuICAgICAgICBwcmV2W2NvbC5uYW1lXSA9IG9wdGlvbi5mb3JtYXQ7XG4gICAgICAgIHJldHVybiBwcmV2O1xuICAgICAgfSwge30pO1xuICAgICAgc2V0Q29sdW1uRGlzcGxheUZvcm1hdChmb3JtYXRzKTtcbiAgICAgIG9uQ2xvc2UoKTtcbiAgICB9LFxuICAgIFtjb2x1bW5zLCBzZXRDb2x1bW5EaXNwbGF5Rm9ybWF0LCBvbkNsb3NlXVxuICApO1xuXG4gIHJldHVybiAoXG4gICAgPFN0eWxlZFRhYmxlQ29uZmlnR3JvdXA+XG4gICAgICA8SW5wdXRMaWdodFxuICAgICAgICBpZD17aWR9XG4gICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgdmFsdWU9e3RpdGxlfVxuICAgICAgICBkYXRhLXRpcD17Zm9ybWF0fVxuICAgICAgICByZWFkT25seVxuICAgICAgICBvbkNsaWNrPXsoKSA9PiBzZXRTaG93Rm9ybWF0dGVyKHRydWUpfVxuICAgICAgLz5cbiAgICAgIDxGb3JtYXR0ZXJEcm9wZG93blxuICAgICAgICBsZWZ0PXstMTg1fVxuICAgICAgICB0b3A9ezEwfVxuICAgICAgICBpc09wZW5lZD17c2hvd0Zvcm1hdHRlcn1cbiAgICAgICAgZGlzcGxheUZvcm1hdD17Zm9ybWF0fVxuICAgICAgICBzZXREaXNwbGF5Rm9ybWF0PXtvblNldERpc3BsYXlGb3JtYXR9XG4gICAgICAgIG9uQ2xvc2U9eygpID0+IHNldFNob3dGb3JtYXR0ZXIoZmFsc2UpfVxuICAgICAgICBmb3JtYXRMYWJlbHM9e29wdGlvbnN9XG4gICAgICAvPlxuICAgIDwvU3R5bGVkVGFibGVDb25maWdHcm91cD5cbiAgKTtcbn07XG5cbmZ1bmN0aW9uIERhdGFUYWJsZUNvbmZpZ0ZhY3RvcnkoKSB7XG4gIGNvbnN0IGdldENvbHVtbnNCeUZpZWxkVHlwZSA9IChjb2x1bW5zOiBzdHJpbmdbXSwgY29sTWV0YTogQ29sTWV0YSwgZmllbGRUeXBlOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCByZXN1bHQ6IENvbE1ldGFQcm9wc1tdID0gW107XG4gICAgY29sdW1ucy5mb3JFYWNoKGNvbE5hbWUgPT4ge1xuICAgICAgaWYgKGNvbE1ldGFbY29sTmFtZV0/LnR5cGUgPT09IGZpZWxkVHlwZSkge1xuICAgICAgICByZXN1bHQucHVzaChjb2xNZXRhW2NvbE5hbWVdKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGNvbnN0IERhdGFUYWJsZUNvbmZpZyA9ICh7Y29sdW1ucywgY29sTWV0YSwgc2V0Q29sdW1uRGlzcGxheUZvcm1hdCwgb25DbG9zZX0pID0+IHtcbiAgICBjb25zdCBmb3JtYXRDb25maWdzID0gW1xuICAgICAge1xuICAgICAgICB0aXRsZTogJyMgU2V0IEludGVnZXIgTnVtYmVyIEZvcm1hdCcsXG4gICAgICAgIGlkOiAnaW5wdXQtaXRlZ2VyLWZvcm1hdCcsXG4gICAgICAgIGRpc3BsYXlUeXBlOiBBTExfRklFTERfVFlQRVMuaW50ZWdlclxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdGl0bGU6ICcjIFNldCBGbG9hdCBOdW1iZXIgRm9ybWF0JyxcbiAgICAgICAgaWQ6ICdpbnB1dC1mbG9hdC1mb3JtYXQnLFxuICAgICAgICBkaXNwbGF5VHlwZTogQUxMX0ZJRUxEX1RZUEVTLnJlYWxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRpdGxlOiAnIyBTZXQgVGltZXN0YW1wIEZvcm1hdCcsXG4gICAgICAgIGlkOiAnaW5wdXQtZGF0ZXRpbWUtZm9ybWF0JyxcbiAgICAgICAgZGlzcGxheVR5cGU6IEFMTF9GSUVMRF9UWVBFUy50aW1lc3RhbXBcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRpdGxlOiAnIyBTZXQgRGF0ZSBGb3JtYXQnLFxuICAgICAgICBpZDogJ2lucHV0LWRhdGUtZm9ybWF0JyxcbiAgICAgICAgZGlzcGxheVR5cGU6IEFMTF9GSUVMRF9UWVBFUy5kYXRlXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogJyMgU2V0IEJvb2xlYW4gRm9ybWF0JyxcbiAgICAgICAgaWQ6ICdpbnB1dC1ib29sLWZvcm1hdCcsXG4gICAgICAgIGRpc3BsYXlUeXBlOiBBTExfRklFTERfVFlQRVMuYm9vbGVhblxuICAgICAgfVxuICAgIF07XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFN0eWxlZENvbmZpZ1BhbmVsPlxuICAgICAgICA8U3R5bGVkQ29uZmlnUGFuZWxDb250ZW50PlxuICAgICAgICAgIHtmb3JtYXRDb25maWdzLm1hcCgoY29uZmlnLCBpbmRleCkgPT4gKFxuICAgICAgICAgICAgPE51bWJlckZvcm1hdENvbmZpZ1xuICAgICAgICAgICAgICB0aXRsZT17YCR7Y29uZmlnLnRpdGxlfWB9XG4gICAgICAgICAgICAgIGtleT17aW5kZXh9XG4gICAgICAgICAgICAgIGlkPXtjb25maWcuaWR9XG4gICAgICAgICAgICAgIGRlZmF1bHRGb3JtYXQ9eydOb25lJ31cbiAgICAgICAgICAgICAgY29sTWV0YT17Y29sTWV0YX1cbiAgICAgICAgICAgICAgb3B0aW9ucz17Z2V0RmllbGRGb3JtYXRMYWJlbHMoYCR7Y29uZmlnLmRpc3BsYXlUeXBlfWApfVxuICAgICAgICAgICAgICBjb2x1bW5zPXtnZXRDb2x1bW5zQnlGaWVsZFR5cGUoY29sdW1ucywgY29sTWV0YSwgYCR7Y29uZmlnLmRpc3BsYXlUeXBlfWApfVxuICAgICAgICAgICAgICBzZXRDb2x1bW5EaXNwbGF5Rm9ybWF0PXtzZXRDb2x1bW5EaXNwbGF5Rm9ybWF0fVxuICAgICAgICAgICAgICBvbkNsb3NlPXtvbkNsb3NlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApKX1cbiAgICAgICAgPC9TdHlsZWRDb25maWdQYW5lbENvbnRlbnQ+XG4gICAgICA8L1N0eWxlZENvbmZpZ1BhbmVsPlxuICAgICk7XG4gIH07XG4gIHJldHVybiBEYXRhVGFibGVDb25maWc7XG59XG5cbmV4cG9ydCBkZWZhdWx0IERhdGFUYWJsZUNvbmZpZ0ZhY3Rvcnk7XG4iXX0=