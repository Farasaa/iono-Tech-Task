"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _react = _interopRequireDefault(require("react"));

var _react2 = require("@testing-library/react");

var _loadStorageMap = _interopRequireDefault(require("./load-storage-map"));

var _componentJestUtils = require("test/helpers/component-jest-utils");

var _useCloudListProvider = require("../hooks/use-cloud-list-provider");

var _constants = require("@kepler.gl/constants");

// SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
// @ts-nocheck
var LoadStorageMap = (0, _loadStorageMap["default"])();
var DEFAULT_MAPS = [{
  id: '1234',
  title: 'first map',
  description: 'description 1',
  loadParams: {
    id: '1234'
  }
}, {
  id: '5678',
  title: 'second map',
  description: 'description 2',
  loadParams: {
    id: '5678'
  }
}];
var DEFAULT_PROVIDER = {
  name: 'test provider',
  icon: jest.fn(),
  getManagementUrl: jest.fn().mockImplementation(function () {
    return 'provider.url';
  }),
  listMaps: jest.fn().mockResolvedValue([])
};
var DEFAULT_PROPS = {
  onLoadCloudMap: jest.fn()
};
jest.mock('../hooks/use-cloud-list-provider', function () {
  return {
    useCloudListProvider: jest.fn().mockImplementation(function () {
      return {
        provider: null,
        setProvider: jest.fn(),
        cloudProviders: []
      };
    })
  };
});
describe('LoadStorageMap', function () {
  afterEach(function () {
    jest.clearAllMocks();
  });
  test('renders provider select and no cloud components when provider is set to null', function () {
    var _renderWithTheme = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)),
        getByTestId = _renderWithTheme.getByTestId;

    expect(getByTestId(_constants.dataTestIds.providerSelect)).toBeInTheDocument();
  });
  test('renders empty map list because fetchmaps return empty array', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
    var _renderWithTheme2, getByText;

    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
              return {
                provider: DEFAULT_PROVIDER,
                setProvider: jest.fn(),
                cloudProviders: []
              };
            });

            _renderWithTheme2 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)), getByText = _renderWithTheme2.getByText;
            expect(DEFAULT_PROVIDER.listMaps).toHaveBeenCalled(); // first show loading icon

            expect(getByText('modal.loadingDialog.loading')).toBeInTheDocument(); // show empty maps

            _context.next = 6;
            return (0, _react2.waitFor)(function () {
              expect(getByText('modal.loadStorageMap.noSavedMaps')).toBeInTheDocument();
            });

          case 6:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  })));
  test('renders map list because', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
    var mapProvider, _renderWithTheme3, getByText;

    return _regenerator["default"].wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            mapProvider = {
              name: 'test provider',
              icon: jest.fn(),
              getManagementUrl: jest.fn().mockImplementation(function () {
                return 'provider.url';
              }),
              listMaps: jest.fn().mockResolvedValue(DEFAULT_MAPS)
            };

            _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
              return {
                provider: mapProvider,
                setProvider: jest.fn(),
                cloudProviders: []
              };
            });

            _renderWithTheme3 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)), getByText = _renderWithTheme3.getByText;
            expect(mapProvider.listMaps).toHaveBeenCalled(); // first show loading icon

            expect(getByText('modal.loadingDialog.loading')).toBeInTheDocument(); // show empty maps

            _context2.next = 7;
            return (0, _react2.waitFor)(function () {
              DEFAULT_MAPS.forEach(function (map) {
                expect(getByText(map.title)).toBeInTheDocument();
                expect(getByText(map.description)).toBeInTheDocument();
              });
            });

          case 7:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  })));
  test('trigger onLoadCLoudMap when clicking on a map', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
    var mapProvider, _renderWithTheme4, getByText;

    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            mapProvider = {
              name: 'test provider',
              icon: jest.fn(),
              getManagementUrl: jest.fn().mockImplementation(function () {
                return 'provider.url';
              }),
              listMaps: jest.fn().mockResolvedValue(DEFAULT_MAPS)
            };

            _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
              return {
                provider: mapProvider,
                setProvider: jest.fn(),
                cloudProviders: []
              };
            });

            _renderWithTheme4 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)), getByText = _renderWithTheme4.getByText;
            expect(mapProvider.listMaps).toHaveBeenCalled(); // first show loading icon

            expect(getByText('modal.loadingDialog.loading')).toBeInTheDocument(); // click on a map

            _context3.next = 7;
            return (0, _react2.waitFor)(function () {
              var map = DEFAULT_MAPS[0]; // if the component doesn't exist this will throw an exception

              var mapTitleComponent = getByText(map.title);

              _react2.fireEvent.click(mapTitleComponent);

              expect(DEFAULT_PROPS.onLoadCloudMap).toHaveBeenCalled();
            });

          case 7:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  })));
  test('renders errors because fetchmaps rejects', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4() {
    var rejectableProvider, _renderWithTheme5, getByText;

    return _regenerator["default"].wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            rejectableProvider = {
              name: 'test provider',
              icon: jest.fn(),
              getManagementUrl: jest.fn().mockImplementation(function () {
                return 'provider.url';
              }),
              listMaps: jest.fn().mockRejectedValue(new Error('timeout'))
            };

            _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
              return {
                provider: rejectableProvider,
                setProvider: jest.fn(),
                cloudProviders: []
              };
            });

            _renderWithTheme5 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)), getByText = _renderWithTheme5.getByText;
            expect(rejectableProvider.listMaps).toHaveBeenCalled(); // first show loading icon

            expect(getByText('modal.loadingDialog.loading')).toBeInTheDocument(); // show empty maps

            _context4.next = 7;
            return (0, _react2.waitFor)(function () {
              expect(getByText('Error while fetching maps: timeout')).toBeInTheDocument();
            });

          case 7:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4);
  })));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RhbHMvbG9hZC1zdG9yYWdlLW1hcC5zcGVjLnRzeCJdLCJuYW1lcyI6WyJMb2FkU3RvcmFnZU1hcCIsIkRFRkFVTFRfTUFQUyIsImlkIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImxvYWRQYXJhbXMiLCJERUZBVUxUX1BST1ZJREVSIiwibmFtZSIsImljb24iLCJqZXN0IiwiZm4iLCJnZXRNYW5hZ2VtZW50VXJsIiwibW9ja0ltcGxlbWVudGF0aW9uIiwibGlzdE1hcHMiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsIkRFRkFVTFRfUFJPUFMiLCJvbkxvYWRDbG91ZE1hcCIsIm1vY2siLCJ1c2VDbG91ZExpc3RQcm92aWRlciIsInByb3ZpZGVyIiwic2V0UHJvdmlkZXIiLCJjbG91ZFByb3ZpZGVycyIsImRlc2NyaWJlIiwiYWZ0ZXJFYWNoIiwiY2xlYXJBbGxNb2NrcyIsInRlc3QiLCJnZXRCeVRlc3RJZCIsImV4cGVjdCIsImRhdGFUZXN0SWRzIiwicHJvdmlkZXJTZWxlY3QiLCJ0b0JlSW5UaGVEb2N1bWVudCIsImdldEJ5VGV4dCIsInRvSGF2ZUJlZW5DYWxsZWQiLCJtYXBQcm92aWRlciIsImZvckVhY2giLCJtYXAiLCJtYXBUaXRsZUNvbXBvbmVudCIsImZpcmVFdmVudCIsImNsaWNrIiwicmVqZWN0YWJsZVByb3ZpZGVyIiwibW9ja1JlamVjdGVkVmFsdWUiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFJQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFUQTtBQUNBO0FBRUE7QUFRQSxJQUFNQSxjQUFjLEdBQUcsaUNBQXZCO0FBRUEsSUFBTUMsWUFBWSxHQUFHLENBQ25CO0FBQ0VDLEVBQUFBLEVBQUUsRUFBRSxNQUROO0FBRUVDLEVBQUFBLEtBQUssRUFBRSxXQUZUO0FBR0VDLEVBQUFBLFdBQVcsRUFBRSxlQUhmO0FBSUVDLEVBQUFBLFVBQVUsRUFBRTtBQUNWSCxJQUFBQSxFQUFFLEVBQUU7QUFETTtB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LENBQVYsQ0FBTixDQUFpREQsaUJBQWpELEdBakIrQyxDQW1CL0M7O0FBbkIrQztBQUFBLG1CQW9CekMscUJBQVEsWUFBTTtBQUNsQkgsY0FBQUEsTUFBTSxDQUFDSSxTQUFTLENBQUMsb0NBQUQsQ0FBVixDQUFOLENBQXdERCxpQkFBeEQ7QUFDRCxhQUZLLENBcEJ5Qzs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxHQUE3QyxHQUFKO0FBd0JELENBOUdPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG4vLyBAdHMtbm9jaGVja1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7ZmlyZUV2ZW50LCB3YWl0Rm9yfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcbmltcG9ydCBMb2FkU3RvcmFnZU1hcEZhY3RvcnkgZnJvbSAnLi9sb2FkLXN0b3JhZ2UtbWFwJztcbmltcG9ydCB7cmVuZGVyV2l0aFRoZW1lfSBmcm9tICd0ZXN0L2hlbHBlcnMvY29tcG9uZW50LWplc3QtdXRpbHMnO1xuaW1wb3J0IHt1c2VDbG91ZExpc3RQcm92aWRlcn0gZnJvbSAnLi4vaG9va3MvdXNlLWNsb3VkLWxpc3QtcHJvdmlkZXInO1xuaW1wb3J0IHtkYXRhVGVzdElkc30gZnJvbSAnQGtlcGxlci5nbC9jb25zdGFudHMnO1xuXG5jb25zdCBMb2FkU3RvcmFnZU1hcCA9IExvYWRTdG9yYWdlTWFwRmFjdG9yeSgpO1xuXG5jb25zdCBERUZBVUxUX01BUFMgPSBbXG4gIHtcbiAgICBpZDogJzEyMzQnLFxuICAgIHRpdGxlOiAnZmlyc3QgbWFwJyxcbiAgICBkZXNjcmlwdGlvbjogJ2Rlc2NyaXB0aW9uIDEnLFxuICAgIGxvYWRQYXJhbXM6IHtcbiAgICAgIGlkOiAnMTIzNCdcbiAgICB9XG4gIH0sXG4gIHtcbiAgICBpZDogJzU2NzgnLFxuICAgIHRpdGxlOiAnc2Vjb25kIG1hcCcsXG4gICAgZGVzY3JpcHRpb246ICdkZXNjcmlwdGlvbiAyJyxcbiAgICBsb2FkUGFyYW1zOiB7XG4gICAgICBpZDogJzU2NzgnXG4gICAgfVxuICB9XG5dO1xuXG5jb25zdCBERUZBVUxUX1BST1ZJREVSID0ge1xuICBuYW1lOiAndGVzdCBwcm92aWRlcicsXG4gIGljb246IGplc3QuZm4oKSxcbiAgZ2V0TWFuYWdlbWVudFVybDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAncHJvdmlkZXIudXJsJyksXG4gIGxpc3RNYXBzOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW10pXG59O1xuXG5jb25zdCBERUZBVUxUX1BST1BTID0ge1xuICBvbkxvYWRDbG91ZE1hcDogamVzdC5mbigpXG59O1xuXG5qZXN0Lm1vY2soJy4uL2hvb2tzL3VzZS1jbG91ZC1saXN0LXByb3ZpZGVyJywgKCkgPT4gKHtcbiAgdXNlQ2xvdWRMaXN0UHJvdmlkZXI6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBwcm92aWRlcjogbnVsbCxcbiAgICBzZXRQcm92aWRlcjogamVzdC5mbigpLFxuICAgIGNsb3VkUHJvdmlkZXJzOiBbXVxuICB9KSlcbn0pKTtcblxuZGVzY3JpYmUoJ0xvYWRTdG9yYWdlTWFwJywgKCkgPT4ge1xuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICB0ZXN0KCdyZW5kZXJzIHByb3ZpZGVyIHNlbGVjdCBhbmQgbm8gY2xvdWQgY29tcG9uZW50cyB3aGVuIHByb3ZpZGVyIGlzIHNldCB0byBudWxsJywgKCkgPT4ge1xuICAgIGNvbnN0IHtnZXRCeVRlc3RJZH0gPSByZW5kZXJXaXRoVGhlbWUoPExvYWRTdG9yYWdlTWFwIHsuLi5ERUZBVUxUX1BST1BTfSAvPik7XG4gICAgZXhwZWN0KGdldEJ5VGVzdElkKGRhdGFUZXN0SWRzLnByb3ZpZGVyU2VsZWN0KSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVuZGVycyBlbXB0eSBtYXAgbGlzdCBiZWNhdXNlIGZldGNobWFwcyByZXR1cm4gZW1wdHkgYXJyYXknLCBhc3luYyAoKSA9PiB7XG4gICAgdXNlQ2xvdWRMaXN0UHJvdmlkZXIubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICBwcm92aWRlcjogREVGQVVMVF9QUk9WSURFUixcbiAgICAgIHNldFByb3ZpZGVyOiBqZXN0LmZuKCksXG4gICAgICBjbG91ZFByb3ZpZGVyczogW11cbiAgICB9KSk7XG5cbiAgICBjb25zdCB7Z2V0QnlUZXh0fSA9IHJlbmRlcldpdGhUaGVtZSg8TG9hZFN0b3JhZ2VNYXAgey4uLkRFRkFVTFRfUFJPUFN9IC8+KTtcbiAgICBleHBlY3QoREVGQVVMVF9QUk9WSURFUi5saXN0TWFwcykudG9IYXZlQmVlbkNhbGxlZCgpO1xuXG4gICAgLy8gZmlyc3Qgc2hvdyBsb2FkaW5nIGljb25cbiAgICBleHBlY3QoZ2V0QnlUZXh0KCdtb2RhbC5sb2FkaW5nRGlhbG9nLmxvYWRpbmcnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcblxuICAgIC8vIHNob3cgZW1wdHkgbWFwc1xuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KGdldEJ5VGV4dCgnbW9kYWwubG9hZFN0b3JhZ2VNYXAubm9TYXZlZE1hcHMnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgncmVuZGVycyBtYXAgbGlzdCBiZWNhdXNlJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1hcFByb3ZpZGVyID0ge1xuICAgICAgbmFtZTogJ3Rlc3QgcHJvdmlkZXInLFxuICAgICAgaWNvbjogamVzdC5mbigpLFxuICAgICAgZ2V0TWFuYWdlbWVudFVybDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAncHJvdmlkZXIudXJsJyksXG4gICAgICBsaXN0TWFwczogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKERFRkFVTFRfTUFQUylcbiAgICB9O1xuICAgIHVzZUNsb3VkTGlzdFByb3ZpZGVyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgcHJvdmlkZXI6IG1hcFByb3ZpZGVyLFxuICAgICAgc2V0UHJvdmlkZXI6IGplc3QuZm4oKSxcbiAgICAgIGNsb3VkUHJvdmlkZXJzOiBbXVxuICAgIH0pKTtcblxuICAgIGNvbnN0IHtnZXRCeVRleHR9ID0gcmVuZGVyV2l0aFRoZW1lKDxMb2FkU3RvcmFnZU1hcCB7Li4uREVGQVVMVF9QUk9QU30gLz4pO1xuICAgIGV4cGVjdChtYXBQcm92aWRlci5saXN0TWFwcykudG9IYXZlQmVlbkNhbGxlZCgpO1xuXG4gICAgLy8gZmlyc3Qgc2hvdyBsb2FkaW5nIGljb25cbiAgICBleHBlY3QoZ2V0QnlUZXh0KCdtb2RhbC5sb2FkaW5nRGlhbG9nLmxvYWRpbmcnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcblxuICAgIC8vIHNob3cgZW1wdHkgbWFwc1xuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgREVGQVVMVF9NQVBTLmZvckVhY2gobWFwID0+IHtcbiAgICAgICAgZXhwZWN0KGdldEJ5VGV4dChtYXAudGl0bGUpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgICBleHBlY3QoZ2V0QnlUZXh0KG1hcC5kZXNjcmlwdGlvbikpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgndHJpZ2dlciBvbkxvYWRDTG91ZE1hcCB3aGVuIGNsaWNraW5nIG9uIGEgbWFwJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1hcFByb3ZpZGVyID0ge1xuICAgICAgbmFtZTogJ3Rlc3QgcHJvdmlkZXInLFxuICAgICAgaWNvbjogamVzdC5mbigpLFxuICAgICAgZ2V0TWFuYWdlbWVudFVybDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAncHJvdmlkZXIudXJsJyksXG4gICAgICBsaXN0TWFwczogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKERFRkFVTFRfTUFQUylcbiAgICB9O1xuICAgIHVzZUNsb3VkTGlzdFByb3ZpZGVyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgcHJvdmlkZXI6IG1hcFByb3ZpZGVyLFxuICAgICAgc2V0UHJvdmlkZXI6IGplc3QuZm4oKSxcbiAgICAgIGNsb3VkUHJvdmlkZXJzOiBbXVxuICAgIH0pKTtcblxuICAgIGNvbnN0IHtnZXRCeVRleHR9ID0gcmVuZGVyV2l0aFRoZW1lKDxMb2FkU3RvcmFnZU1hcCB7Li4uREVGQVVMVF9QUk9QU30gLz4pO1xuICAgIGV4cGVjdChtYXBQcm92aWRlci5saXN0TWFwcykudG9IYXZlQmVlbkNhbGxlZCgpO1xuXG4gICAgLy8gZmlyc3Qgc2hvdyBsb2FkaW5nIGljb25cbiAgICBleHBlY3QoZ2V0QnlUZXh0KCdtb2RhbC5sb2FkaW5nRGlhbG9nLmxvYWRpbmcnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcblxuICAgIC8vIGNsaWNrIG9uIGEgbWFwXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICBjb25zdCBtYXAgPSBERUZBVUxUX01BUFNbMF07XG4gICAgICAvLyBpZiB0aGUgY29tcG9uZW50IGRvZXNuJ3QgZXhpc3QgdGhpcyB3aWxsIHRocm93IGFuIGV4Y2VwdGlvblxuICAgICAgY29uc3QgbWFwVGl0bGVDb21wb25lbnQgPSBnZXRCeVRleHQobWFwLnRpdGxlKTtcbiAgICAgIGZpcmVFdmVudC5jbGljayhtYXBUaXRsZUNvbXBvbmVudCk7XG4gICAgICBleHBlY3QoREVGQVVMVF9QUk9QUy5vbkxvYWRDbG91ZE1hcCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdyZW5kZXJzIGVycm9ycyBiZWNhdXNlIGZldGNobWFwcyByZWplY3RzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlamVjdGFibGVQcm92aWRlciA9IHtcbiAgICAgIG5hbWU6ICd0ZXN0IHByb3ZpZGVyJyxcbiAgICAgIGljb246IGplc3QuZm4oKSxcbiAgICAgIGdldE1hbmFnZW1lbnRVcmw6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gJ3Byb3ZpZGVyLnVybCcpLFxuICAgICAgbGlzdE1hcHM6IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ3RpbWVvdXQnKSlcbiAgICB9O1xuICAgIHVzZUNsb3VkTGlzdFByb3ZpZGVyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgcHJvdmlkZXI6IHJlamVjdGFibGVQcm92aWRlcixcbiAgICAgIHNldFByb3ZpZGVyOiBqZXN0LmZuKCksXG4gICAgICBjbG91ZFByb3ZpZGVyczogW11cbiAgICB9KSk7XG5cbiAgICBjb25zdCB7Z2V0QnlUZXh0fSA9IHJlbmRlcldpdGhUaGVtZSg8TG9hZFN0b3JhZ2VNYXAgey4uLkRFRkFVTFRfUFJPUFN9IC8+KTtcbiAgICBleHBlY3QocmVqZWN0YWJsZVByb3ZpZGVyLmxpc3RNYXBzKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG5cbiAgICAvLyBmaXJzdCBzaG93IGxvYWRpbmcgaWNvblxuICAgIGV4cGVjdChnZXRCeVRleHQoJ21vZGFsLmxvYWRpbmdEaWFsb2cubG9hZGluZycpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuXG4gICAgLy8gc2hvdyBlbXB0eSBtYXBzXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICBleHBlY3QoZ2V0QnlUZXh0KCdFcnJvciB3aGlsZSBmZXRjaGluZyBtYXBzOiB0aW1lb3V0JykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=