"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ModifyModeExtended = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _editModes = require("@nebula.gl/edit-modes");

var _constants = require("@kepler.gl/constants");

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var RIGHT_BUTTON = 2;
/**
 * Show helper only when the point is close enough to the line.
 */

var ModifyModeExtended = /*#__PURE__*/function (_ModifyMode) {
  (0, _inherits2["default"])(ModifyModeExtended, _ModifyMode);

  var _super = _createSuper(ModifyModeExtended);

  function ModifyModeExtended() {
    (0, _classCallCheck2["default"])(this, ModifyModeExtended);
    return _super.apply(this, arguments);
  }

  (0, _createClass2["default"])(ModifyModeExtended, [{
    key: "getNearestPoint",
    value: // @ts-expect-error expect to return no point when object is too far
    function getNearestPoint(line, inPoint, viewport) {
      var p = (0, _get2["default"])((0, _getPrototypeOf2["default"])(ModifyModeExtended.prototype), "getNearestPoint", this).call(this, line, inPoint, viewport);

      if (p && viewport) {
        var p1 = viewport.project(p.geometry.coordinates);
        var p2 = viewport.project(inPoint.geometry.coordinates);
        var d = Math.sqrt(Math.pow(p1[0] - p2[0], 2) + Math.pow(p1[1] - p2[1], 2));

        if (d > _constants.EDITOR_LAYER_PICKING_RADIUS) {
          return;
        }
      }

      return p;
    }
  }, {
    key: "handleClick",
    value: function handleClick(event, props) {
      var _event$sourceEvent;

      // prevent insertion of points for right click
      if ((event === null || event === void 0 ? void 0 : (_event$sourceEvent = event.sourceEvent) === null || _event$sourceEvent === void 0 ? void 0 : _event$sourceEvent.button) === RIGHT_BUTTON) {
        return;
      }

      (0, _get2["default"])((0, _getPrototypeOf2["default"])(ModifyModeExtended.prototype), "handleClick", this).call(this, event, props);
    }
  }]);
  return ModifyModeExtended;
}(_editModes.ModifyMode);

exports.ModifyModeExtended = ModifyModeExtended;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lZGl0b3ItbGF5ZXIvbW9kaWZ5LW1vZGUtZXh0ZW5kZWQudHMiXSwibmFtZXMiOlsiUklHSFRfQlVUVE9OIiwiTW9kaWZ5TW9kZUV4dGVuZGVkIiwibGluZSIsImluUG9pbnQiLCJ2aWV3cG9ydCIsInAiLCJwMSIsInByb2plY3QiLCJnZW9tZXRyeSIsImNvb3JkaW5hdGVzIiwicDIiLCJkIiwiTWF0aCIsInNxcnQiLCJFRElUT1JfTEFZRVJfUElDS0lOR19SQURJVVMiLCJldmVudCIsInByb3BzIiwic291cmNlRXZlbnQiLCJidXR0b24iLCJNb2RpZnlNb2RlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFHQTs7QUFTQTs7Ozs7O0FBRUEsSUFBTUEsWUFBWSxHQUFHLENBQXJCO0FBRUE7QUFDQTtBQUNBOztJQUNhQyxrQjs7Ozs7Ozs7Ozs7O1dBQ1g7QUFDQSw2QkFDRUMsSUFERixFQUVFQyxPQUZGLEVBR0VDLFFBSEYsRUFJRTtBQUNBLFVBQU1DLENBQUMsNkhBQXlCSCxJQUF6QixFQUErQkMsT0FBL0IsRUFBd0NDLFFBQXhDLENBQVA7O0FBQ0EsVUFBSUMsQ0FBQyxJQUFJRCxRQUFULEVBQW1CO0FBQ2pCLFlBQU1FLEVBQUUsR0FBR0YsUUFBUSxDQUFDRyxPQUFULENBQWlCRixDQUFDLENBQUNHLFFBQUYsQ0FBV0MsV0FBNUIsQ0FBWDtBQUNBLFlBQU1DLEVBQUUsR0FBR04sUUFBUSxDQUFDRyxPQUFULENBQWlCSixPQUFPLENBQUNLLFFBQVIsQ0FBaUJDLFdBQWxDLENBQVg7QUFDQSxZQUFNRSxDQUFDLEdBQUdDLElBQUksQ0FBQ0MsSUFBTCxDQUFVLFNBQUNQLEVBQUUsQ0FBQyxDQUFELENBQUYsR0FBUUksRUFBRSxDQUFDLENBQUQsQ0FBWCxFQUFtQixDQUFuQixhQUF3QkosRUFBRSxDQUFDLENBQUQsQ0FBRixHQUFRSSxFQUFFLENBQUMsQ0FBRCxDQUFsQyxFQUEwQyxDQUExQyxDQUFWLENBQVY7O0FBQ0EsWUFBSUMsQ0FBQyxHQUFHRyxzQ0FBUixFQUFxQztBQUNuQztBQUNEO0FBQ0Y7O0FBQ0QsYUFBT1QsQ0FBUDtBQUNEOzs7V0FFRCxxQkFBWVUsS0FBWixFQUFtQkMsS0FBbkIsRUFBMEI7QUFBQTs7QUFDeEI7QUFDQSxVQUFJLENBQUFELEtBQUssU0FBTCxJQUFBQSxLQUFLLFdBQUwsa0NBQUFBLEtBQUssQ0FBRUUsV0FBUCwwRUFBb0JDLE1BQXBCLE1BQStCbEIsWUFBbkMsRUFBaUQ7QUFDL0M7QUFDRDs7QUFDRCw0SEFBa0JlLEtBQWxCLEVBQXlCQyxLQUF6QjtBQUNEOzs7RUF6QnFDRyxxQiIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCB7XG4gIE1vZGlmeU1vZGUsXG4gIEZlYXR1cmVPZixcbiAgTGluZVN0cmluZyxcbiAgUG9pbnQsXG4gIFZpZXdwb3J0IGFzIE5lYnVsYVZpZXdwb3J0XG59IGZyb20gJ0BuZWJ1bGEuZ2wvZWRpdC1tb2Rlcyc7XG5pbXBvcnQge1ZpZXdwb3J0fSBmcm9tICdAZGVjay5nbC9jb3JlJztcblxuaW1wb3J0IHtFRElUT1JfTEFZRVJfUElDS0lOR19SQURJVVN9IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcblxuY29uc3QgUklHSFRfQlVUVE9OID0gMjtcblxuLyoqXG4gKiBTaG93IGhlbHBlciBvbmx5IHdoZW4gdGhlIHBvaW50IGlzIGNsb3NlIGVub3VnaCB0byB0aGUgbGluZS5cbiAqL1xuZXhwb3J0IGNsYXNzIE1vZGlmeU1vZGVFeHRlbmRlZCBleHRlbmRzIE1vZGlmeU1vZGUge1xuICAvLyBAdHMtZXhwZWN0LWVycm9yIGV4cGVjdCB0byByZXR1cm4gbm8gcG9pbnQgd2hlbiBvYmplY3QgaXMgdG9vIGZhclxuICBnZXROZWFyZXN0UG9pbnQoXG4gICAgbGluZTogRmVhdHVyZU9mPExpbmVTdHJpbmc+LFxuICAgIGluUG9pbnQ6IEZlYXR1cmVPZjxQb2ludD4sXG4gICAgdmlld3BvcnQ6IFZpZXdwb3J0IHwgbnVsbCB8IHVuZGVmaW5lZFxuICApIHtcbiAgICBjb25zdCBwID0gc3VwZXIuZ2V0TmVhcmVzdFBvaW50KGxpbmUsIGluUG9pbnQsIHZpZXdwb3J0IGFzIE5lYnVsYVZpZXdwb3J0IHwgbnVsbCB8IHVuZGVmaW5lZCk7XG4gICAgaWYgKHAgJiYgdmlld3BvcnQpIHtcbiAgICAgIGNvbnN0IHAxID0gdmlld3BvcnQucHJvamVjdChwLmdlb21ldHJ5LmNvb3JkaW5hdGVzKTtcbiAgICAgIGNvbnN0IHAyID0gdmlld3BvcnQucHJvamVjdChpblBvaW50Lmdlb21ldHJ5LmNvb3JkaW5hdGVzKTtcbiAgICAgIGNvbnN0IGQgPSBNYXRoLnNxcnQoKHAxWzBdIC0gcDJbMF0pICoqIDIgKyAocDFbMV0gLSBwMlsxXSkgKiogMik7XG4gICAgICBpZiAoZCA+IEVESVRPUl9MQVlFUl9QSUNLSU5HX1JBRElVUykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwO1xuICB9XG5cbiAgaGFuZGxlQ2xpY2soZXZlbnQsIHByb3BzKSB7XG4gICAgLy8gcHJldmVudCBpbnNlcnRpb24gb2YgcG9pbnRzIGZvciByaWdodCBjbGlja1xuICAgIGlmIChldmVudD8uc291cmNlRXZlbnQ/LmJ1dHRvbiA9PT0gUklHSFRfQlVUVE9OKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN1cGVyLmhhbmRsZUNsaWNrKGV2ZW50LCBwcm9wcyk7XG4gIH1cbn1cbiJdfQ==