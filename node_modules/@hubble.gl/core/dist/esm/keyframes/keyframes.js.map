{"version":3,"file":"keyframes.js","names":["KeyFrames","LumaKeyFrames","linear","sanitizeEasings","merge","sanitizeTimings","factorInterpolator","sanitizeInterpolators","Keyframes","constructor","features","timings","keyframes","easings","interpolators","_setActiveFeatures","bind","getFrame","set","activeFeatures","reduce","feature","length","Error","_interpolators","_easings","_timings","_keyframes","setKeyFrames","factor","start","getStartData","end","getEndData","frame","Object","keys","forEach","key","ease","firstKeyframe","undefined"],"sources":["../../../src/keyframes/keyframes.js"],"sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {KeyFrames as LumaKeyFrames} from '@luma.gl/engine';\nimport {linear} from './easings';\nimport {\n  sanitizeEasings,\n  merge,\n  sanitizeTimings,\n  factorInterpolator,\n  sanitizeInterpolators\n} from './utils';\n\nclass Keyframes extends LumaKeyFrames {\n  activeFeatures = {};\n  animationHandle;\n  timings;\n  keyframes;\n  easings;\n  interpolators;\n\n  constructor({features, timings, keyframes, easings = linear, interpolators = 'linear'}) {\n    super([]);\n    this._setActiveFeatures = this._setActiveFeatures.bind(this);\n    this.getFrame = this.getFrame.bind(this);\n    this.set = this.set.bind(this);\n\n    this.activeFeatures = features.reduce((activeFeatures, feature) => {\n      activeFeatures[feature] = false;\n      return activeFeatures;\n    }, {});\n\n    this.set({timings, keyframes, easings, interpolators});\n  }\n\n  set({timings, keyframes, easings = linear, interpolators = 'linear'}) {\n    if (keyframes.length === 0) {\n      throw new Error('There must be at least one keyframe');\n    }\n\n    const _interpolators = sanitizeInterpolators(keyframes, interpolators);\n\n    const _easings = sanitizeEasings(keyframes, easings);\n\n    const _timings = sanitizeTimings(keyframes, timings);\n\n    this._setActiveFeatures(keyframes);\n    const _keyframes = merge(_timings, keyframes, _easings, _interpolators);\n    this.keyframes = keyframes;\n    this.timings = timings;\n    this.easings = easings;\n    this.interpolators = interpolators;\n    this.setKeyFrames(_keyframes);\n  }\n\n  getFrame() {\n    const factor = this.factor;\n    const start = this.getStartData();\n    const end = this.getEndData();\n    const frame = {};\n\n    Object.keys(this.activeFeatures).forEach(key => {\n      if (this.activeFeatures[key]) {\n        frame[key] = factorInterpolator(start[key], end[key], end.ease)(factor);\n      }\n    });\n\n    return frame;\n  }\n\n  _setActiveFeatures(keyframes) {\n    const firstKeyframe = keyframes[0];\n    this.activeFeatures = Object.keys(firstKeyframe).reduce((activeFeatures, key) => {\n      // activate only keys that are expected\n      if (firstKeyframe[key] !== undefined) {\n        activeFeatures[key] = true;\n      }\n      return activeFeatures;\n    }, this.activeFeatures);\n  }\n}\n\nexport default Keyframes;\n"],"mappings":"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"}