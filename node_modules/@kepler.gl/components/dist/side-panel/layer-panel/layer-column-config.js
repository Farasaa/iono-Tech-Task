"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _localization = require("@kepler.gl/localization");

var _utils = require("@kepler.gl/utils");

var _columnSelector = _interopRequireDefault(require("./column-selector"));

var _styledComponents2 = require("../../common/styled-components");

var _templateObject;

var TopRow = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  justify-content: space-between;\n"])));
/**
 * only provide suggested field pairs if there is a match,
 * otherwise the user can select a suggested field pair that will create invalid columns and a hard crash
 */


function getValidFieldPairsSuggestionsForColumn(enhancedFieldPairs, columnPairs, columnKey) {
  if (enhancedFieldPairs && columnPairs !== null && columnPairs !== void 0 && columnPairs[columnKey]) {
    var columnPair = columnPairs[columnKey];
    var matchingFieldPairs = enhancedFieldPairs.filter(function (_ref) {
      var pair = _ref.pair;
      return (0, _utils.toArray)(columnPair.fieldPairKey).some(function (fieldPairKey) {
        return pair.hasOwnProperty(fieldPairKey);
      });
    });
    return matchingFieldPairs.length > 0 ? matchingFieldPairs : null;
  } else {
    return null;
  }
}

LayerColumnConfigFactory.deps = [_columnSelector["default"]];

function LayerColumnConfigFactory(ColumnSelector) {
  var LayerColumnConfig = function LayerColumnConfig(_ref2) {
    var columnPairs = _ref2.columnPairs,
        fieldPairs = _ref2.fieldPairs,
        columns = _ref2.columns,
        columnLabels = _ref2.columnLabels,
        fields = _ref2.fields,
        updateLayerConfig = _ref2.updateLayerConfig,
        assignColumn = _ref2.assignColumn,
        assignColumnPairs = _ref2.assignColumnPairs;
    var enhancedFieldPairs = (0, _react.useMemo)(function () {
      return columnPairs && fieldPairs ? fieldPairs.map(function (fp) {
        return {
          name: fp.defaultName,
          type: 'point',
          pair: fp.pair
        };
      }) : null;
    }, [columnPairs, fieldPairs]);
    var onUpdateColumn = (0, _react.useCallback)(function (key, value) {
      var assignedColumns = value && value.pair && columnPairs ? assignColumnPairs(key, value.pair) : assignColumn(key, value);
      updateLayerConfig({
        columns: assignedColumns
      });
    }, [updateLayerConfig, columnPairs, assignColumnPairs, assignColumn]);

    if (!Object.keys(columns).length) {
      // don't render if columns is empty
      return /*#__PURE__*/_react["default"].createElement("div", null);
    }

    return /*#__PURE__*/_react["default"].createElement("div", null, /*#__PURE__*/_react["default"].createElement(_styledComponents2.SidePanelSection, null, /*#__PURE__*/_react["default"].createElement("div", {
      className: "layer-config__column"
    }, /*#__PURE__*/_react["default"].createElement(TopRow, null, /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelLabel, null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
      id: 'columns.title'
    })), /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelLabel, null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
      id: "layer.required"
    }))), Object.keys(columns).map(function (key) {
      return /*#__PURE__*/_react["default"].createElement(ColumnSelector, {
        column: columns[key],
        columns: columns,
        label: columnLabels && columnLabels[key] || key,
        key: key,
        allFields: fields,
        fieldPairs: getValidFieldPairsSuggestionsForColumn(enhancedFieldPairs, columnPairs, key),
        onSelect: function onSelect(val) {
          return onUpdateColumn(key, val);
        }
      });
    }))));
  };

  return LayerColumnConfig;
}

var _default = LayerColumnConfigFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zaWRlLXBhbmVsL2xheWVyLXBhbmVsL2xheWVyLWNvbHVtbi1jb25maWcudHN4Il0sIm5hbWVzIjpbIlRvcFJvdyIsInN0eWxlZCIsImRpdiIsImdldFZhbGlkRmllbGRQYWlyc1N1Z2dlc3Rpb25zRm9yQ29sdW1uIiwiZW5oYW5jZWRGaWVsZFBhaXJzIiwiY29sdW1uUGFpcnMiLCJjb2x1bW5LZXkiLCJjb2x1bW5QYWlyIiwibWF0Y2hpbmdGaWVsZFBhaXJzIiwiZmlsdGVyIiwicGFpciIsImZpZWxkUGFpcktleSIsInNvbWUiLCJoYXNPd25Qcm9wZXJ0eSIsImxlbmd0aCIsIkxheWVyQ29sdW1uQ29uZmlnRmFjdG9yeSIsImRlcHMiLCJDb2x1bW5TZWxlY3RvckZhY3RvcnkiLCJDb2x1bW5TZWxlY3RvciIsIkxheWVyQ29sdW1uQ29uZmlnIiwiZmllbGRQYWlycyIsImNvbHVtbnMiLCJjb2x1bW5MYWJlbHMiLCJmaWVsZHMiLCJ1cGRhdGVMYXllckNvbmZpZyIsImFzc2lnbkNvbHVtbiIsImFzc2lnbkNvbHVtblBhaXJzIiwibWFwIiwiZnAiLCJuYW1lIiwiZGVmYXVsdE5hbWUiLCJ0eXBlIiwib25VcGRhdGVDb2x1bW4iLCJrZXkiLCJ2YWx1ZSIsImFzc2lnbmVkQ29sdW1ucyIsIk9iamVjdCIsImtleXMiLCJ2YWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFHQTs7QUFDQTs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7OztBQW1CQSxJQUFNQSxNQUFNLEdBQUdDLDZCQUFPQyxHQUFWLDZJQUFaO0FBS0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBLFNBQVNDLHNDQUFULENBQ0VDLGtCQURGLEVBRUVDLFdBRkYsRUFHRUMsU0FIRixFQUk4QjtBQUM1QixNQUFJRixrQkFBa0IsSUFBSUMsV0FBSixhQUFJQSxXQUFKLGVBQUlBLFdBQVcsQ0FBR0MsU0FBSCxDQUFyQyxFQUFvRDtBQUNsRCxRQUFNQyxVQUFVLEdBQUdGLFdBQVcs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LEdBQUQsQ0FEakI7QUFFRSxRQUFBLE9BQU8sRUFBRVosT0FGWDtBQUdFLFFBQUEsS0FBSyxFQUFHQyxZQUFZLElBQUlBLFlBQVksQ0FBQ1csR0FBRCxDQUE3QixJQUF1Q0EsR0FIaEQ7QUFJRSxRQUFBLEdBQUcsRUFBRUEsR0FKUDtBQUtFLFFBQUEsU0FBUyxFQUFFVixNQUxiO0FBTUUsUUFBQSxVQUFVLEVBQUVwQixzQ0FBc0MsQ0FDaERDLGtCQURnRCxFQUVoREMsV0FGZ0QsRUFHaEQ0QixHQUhnRCxDQU5wRDtBQVdFLFFBQUEsUUFBUSxFQUFFLGtCQUFBSyxHQUFHO0FBQUEsaUJBQUlOLGNBQWMsQ0FBQ0MsR0FBRCxFQUFNSyxHQUFOLENBQWxCO0FBQUE7QUFYZixRQUQyQjtBQUFBLEtBQTVCLENBVEgsQ0FERixDQURGLENBREY7QUErQkQsR0F0RUQ7O0FBd0VBLFNBQU9uQixpQkFBUDtBQUNEOztlQUVjSix3QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge3VzZUNhbGxiYWNrLCB1c2VNZW1vfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcblxuaW1wb3J0IHtDb2x1bW5QYWlycywgTGF5ZXJDb2x1bW5zLCBMYXllckJhc2VDb25maWd9IGZyb20gJ0BrZXBsZXIuZ2wvbGF5ZXJzJztcbmltcG9ydCB7Rm9ybWF0dGVkTWVzc2FnZX0gZnJvbSAnQGtlcGxlci5nbC9sb2NhbGl6YXRpb24nO1xuaW1wb3J0IHtGaWVsZFBhaXIsIEZpZWxkfSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcbmltcG9ydCB7dG9BcnJheX0gZnJvbSAnQGtlcGxlci5nbC91dGlscyc7XG5cbmltcG9ydCBDb2x1bW5TZWxlY3RvckZhY3RvcnkgZnJvbSAnLi9jb2x1bW4tc2VsZWN0b3InO1xuaW1wb3J0IHtNaW5pbWFsRmllbGR9IGZyb20gJy4uLy4uL2NvbW1vbi9maWVsZC1zZWxlY3Rvcic7XG5pbXBvcnQge1BhbmVsTGFiZWwsIFNpZGVQYW5lbFNlY3Rpb259IGZyb20gJy4uLy4uL2NvbW1vbi9zdHlsZWQtY29tcG9uZW50cyc7XG5cbmV4cG9ydCB0eXBlIExheWVyQ29sdW1uQ29uZmlnUHJvcHM8RmllbGRPcHRpb24gZXh0ZW5kcyBNaW5pbWFsRmllbGQ+ID0ge1xuICBjb2x1bW5zOiBMYXllckNvbHVtbnM7XG4gIGZpZWxkczogRmllbGRPcHRpb25bXTtcbiAgYXNzaWduQ29sdW1uUGFpcnM6IChrZXk6IHN0cmluZywgcGFpcjogc3RyaW5nKSA9PiBMYXllckNvbHVtbnM7XG4gIGFzc2lnbkNvbHVtbjogKGtleTogc3RyaW5nLCBmaWVsZDogRmllbGRPcHRpb24pID0+IExheWVyQ29sdW1ucztcbiAgdXBkYXRlTGF5ZXJDb25maWc6IChuZXdDb25maWc6IFBhcnRpYWw8TGF5ZXJCYXNlQ29uZmlnPikgPT4gdm9pZDtcbiAgY29sdW1uUGFpcnM/OiBDb2x1bW5QYWlycyB8IG51bGw7XG4gIGZpZWxkUGFpcnM/OiBGaWVsZFBhaXJbXTtcbiAgY29sdW1uTGFiZWxzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn07XG5cbmV4cG9ydCB0eXBlIEVuaGFuY2VkRmllbGRQYWlyID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIHR5cGU6ICdwb2ludCc7XG4gIHBhaXI6IEZpZWxkUGFpclsncGFpciddO1xufTtcblxuY29uc3QgVG9wUm93ID0gc3R5bGVkLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuYDtcblxuLyoqXG4gKiBvbmx5IHByb3ZpZGUgc3VnZ2VzdGVkIGZpZWxkIHBhaXJzIGlmIHRoZXJlIGlzIGEgbWF0Y2gsXG4gKiBvdGhlcndpc2UgdGhlIHVzZXIgY2FuIHNlbGVjdCBhIHN1Z2dlc3RlZCBmaWVsZCBwYWlyIHRoYXQgd2lsbCBjcmVhdGUgaW52YWxpZCBjb2x1bW5zIGFuZCBhIGhhcmQgY3Jhc2hcbiAqL1xuZnVuY3Rpb24gZ2V0VmFsaWRGaWVsZFBhaXJzU3VnZ2VzdGlvbnNGb3JDb2x1bW4oXG4gIGVuaGFuY2VkRmllbGRQYWlyczogRW5oYW5jZWRGaWVsZFBhaXJbXSB8IG51bGwsXG4gIGNvbHVtblBhaXJzOiBDb2x1bW5QYWlycyB8IG51bGwgfCB1bmRlZmluZWQsXG4gIGNvbHVtbktleTogc3RyaW5nXG4pOiBFbmhhbmNlZEZpZWxkUGFpcltdIHwgbnVsbCB7XG4gIGlmIChlbmhhbmNlZEZpZWxkUGFpcnMgJiYgY29sdW1uUGFpcnM/Lltjb2x1bW5LZXldKSB7XG4gICAgY29uc3QgY29sdW1uUGFpciA9IGNvbHVtblBhaXJzW2NvbHVtbktleV07XG4gICAgY29uc3QgbWF0Y2hpbmdGaWVsZFBhaXJzID0gZW5oYW5jZWRGaWVsZFBhaXJzLmZpbHRlcigoe3BhaXJ9KSA9PiB7XG4gICAgICByZXR1cm4gdG9BcnJheShjb2x1bW5QYWlyLmZpZWxkUGFpcktleSkuc29tZShmaWVsZFBhaXJLZXkgPT5cbiAgICAgICAgcGFpci5oYXNPd25Qcm9wZXJ0eShmaWVsZFBhaXJLZXkpXG4gICAgICApO1xuICAgIH0pO1xuICAgIHJldHVybiBtYXRjaGluZ0ZpZWxkUGFpcnMubGVuZ3RoID4gMCA/IG1hdGNoaW5nRmllbGRQYWlycyA6IG51bGw7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuTGF5ZXJDb2x1bW5Db25maWdGYWN0b3J5LmRlcHMgPSBbQ29sdW1uU2VsZWN0b3JGYWN0b3J5XTtcblxuZnVuY3Rpb24gTGF5ZXJDb2x1bW5Db25maWdGYWN0b3J5KENvbHVtblNlbGVjdG9yOiBSZXR1cm5UeXBlPHR5cGVvZiBDb2x1bW5TZWxlY3RvckZhY3Rvcnk+KSB7XG4gIGNvbnN0IExheWVyQ29sdW1uQ29uZmlnOiBSZWFjdC5GQzxMYXllckNvbHVtbkNvbmZpZ1Byb3BzPEZpZWxkPj4gPSAoe1xuICAgIGNvbHVtblBhaXJzLFxuICAgIGZpZWxkUGFpcnMsXG4gICAgY29sdW1ucyxcbiAgICBjb2x1bW5MYWJlbHMsXG4gICAgZmllbGRzLFxuICAgIHVwZGF0ZUxheWVyQ29uZmlnLFxuICAgIGFzc2lnbkNvbHVtbixcbiAgICBhc3NpZ25Db2x1bW5QYWlyc1xuICB9KSA9PiB7XG4gICAgY29uc3QgZW5oYW5jZWRGaWVsZFBhaXJzOiBFbmhhbmNlZEZpZWxkUGFpcltdIHwgbnVsbCA9IHVzZU1lbW8oXG4gICAgICAoKSA9PlxuICAgICAgICBjb2x1bW5QYWlycyAmJiBmaWVsZFBhaXJzXG4gICAgICAgICAgPyBmaWVsZFBhaXJzLm1hcChmcCA9PiAoe1xuICAgICAgICAgICAgICBuYW1lOiBmcC5kZWZhdWx0TmFtZSxcbiAgICAgICAgICAgICAgdHlwZTogJ3BvaW50JyxcbiAgICAgICAgICAgICAgcGFpcjogZnAucGFpclxuICAgICAgICAgICAgfSkpXG4gICAgICAgICAgOiBudWxsLFxuICAgICAgW2NvbHVtblBhaXJzLCBmaWVsZFBhaXJzXVxuICAgICk7XG5cbiAgICBjb25zdCBvblVwZGF0ZUNvbHVtbiA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGtleSwgdmFsdWUpID0+IHtcbiAgICAgICAgY29uc3QgYXNzaWduZWRDb2x1bW5zID1cbiAgICAgICAgICB2YWx1ZSAmJiB2YWx1ZS5wYWlyICYmIGNvbHVtblBhaXJzXG4gICAgICAgICAgICA/IGFzc2lnbkNvbHVtblBhaXJzKGtleSwgdmFsdWUucGFpcilcbiAgICAgICAgICAgIDogYXNzaWduQ29sdW1uKGtleSwgdmFsdWUpO1xuXG4gICAgICAgIHVwZGF0ZUxheWVyQ29uZmlnKHtjb2x1bW5zOiBhc3NpZ25lZENvbHVtbnN9KTtcbiAgICAgIH0sXG4gICAgICBbdXBkYXRlTGF5ZXJDb25maWcsIGNvbHVtblBhaXJzLCBhc3NpZ25Db2x1bW5QYWlycywgYXNzaWduQ29sdW1uXVxuICAgICk7XG5cbiAgICBpZiAoIU9iamVjdC5rZXlzKGNvbHVtbnMpLmxlbmd0aCkge1xuICAgICAgLy8gZG9uJ3QgcmVuZGVyIGlmIGNvbHVtbnMgaXMgZW1wdHlcbiAgICAgIHJldHVybiA8ZGl2IC8+O1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2PlxuICAgICAgICA8U2lkZVBhbmVsU2VjdGlvbj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxheWVyLWNvbmZpZ19fY29sdW1uXCI+XG4gICAgICAgICAgICA8VG9wUm93PlxuICAgICAgICAgICAgICA8UGFuZWxMYWJlbD5cbiAgICAgICAgICAgICAgICA8Rm9ybWF0dGVkTWVzc2FnZSBpZD17J2NvbHVtbnMudGl0bGUnfSAvPlxuICAgICAgICAgICAgICA8L1BhbmVsTGFiZWw+XG4gICAgICAgICAgICAgIDxQYW5lbExhYmVsPlxuICAgICAgICAgICAgICAgIDxGb3JtYXR0ZWRNZXNzYWdlIGlkPVwibGF5ZXIucmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgICA8L1BhbmVsTGFiZWw+XG4gICAgICAgICAgICA8L1RvcFJvdz5cbiAgICAgICAgICAgIHtPYmplY3Qua2V5cyhjb2x1bW5zKS5tYXAoa2V5ID0+IChcbiAgICAgICAgICAgICAgPENvbHVtblNlbGVjdG9yXG4gICAgICAgICAgICAgICAgY29sdW1uPXtjb2x1bW5zW2tleV19XG4gICAgICAgICAgICAgICAgY29sdW1ucz17Y29sdW1uc31cbiAgICAgICAgICAgICAgICBsYWJlbD17KGNvbHVtbkxhYmVscyAmJiBjb2x1bW5MYWJlbHNba2V5XSkgfHwga2V5fVxuICAgICAgICAgICAgICAgIGtleT17a2V5fVxuICAgICAgICAgICAgICAgIGFsbEZpZWxkcz17ZmllbGRzfVxuICAgICAgICAgICAgICAgIGZpZWxkUGFpcnM9e2dldFZhbGlkRmllbGRQYWlyc1N1Z2dlc3Rpb25zRm9yQ29sdW1uKFxuICAgICAgICAgICAgICAgICAgZW5oYW5jZWRGaWVsZFBhaXJzLFxuICAgICAgICAgICAgICAgICAgY29sdW1uUGFpcnMsXG4gICAgICAgICAgICAgICAgICBrZXlcbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgIG9uU2VsZWN0PXt2YWwgPT4gb25VcGRhdGVDb2x1bW4oa2V5LCB2YWwpfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvU2lkZVBhbmVsU2VjdGlvbj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH07XG5cbiAgcmV0dXJuIExheWVyQ29sdW1uQ29uZmlnO1xufVxuXG5leHBvcnQgZGVmYXVsdCBMYXllckNvbHVtbkNvbmZpZ0ZhY3Rvcnk7XG4iXX0=