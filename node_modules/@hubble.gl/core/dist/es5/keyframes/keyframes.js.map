{"version":3,"file":"keyframes.js","names":["Keyframes","features","timings","keyframes","easings","linear","interpolators","_setActiveFeatures","bind","getFrame","set","activeFeatures","reduce","feature","length","Error","_interpolators","sanitizeInterpolators","_easings","sanitizeEasings","_timings","sanitizeTimings","_keyframes","merge","setKeyFrames","factor","start","getStartData","end","getEndData","frame","Object","keys","forEach","key","factorInterpolator","ease","firstKeyframe","undefined","LumaKeyFrames"],"sources":["../../../src/keyframes/keyframes.js"],"sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {KeyFrames as LumaKeyFrames} from '@luma.gl/engine';\nimport {linear} from './easings';\nimport {\n  sanitizeEasings,\n  merge,\n  sanitizeTimings,\n  factorInterpolator,\n  sanitizeInterpolators\n} from './utils';\n\nclass Keyframes extends LumaKeyFrames {\n  activeFeatures = {};\n  animationHandle;\n  timings;\n  keyframes;\n  easings;\n  interpolators;\n\n  constructor({features, timings, keyframes, easings = linear, interpolators = 'linear'}) {\n    super([]);\n    this._setActiveFeatures = this._setActiveFeatures.bind(this);\n    this.getFrame = this.getFrame.bind(this);\n    this.set = this.set.bind(this);\n\n    this.activeFeatures = features.reduce((activeFeatures, feature) => {\n      activeFeatures[feature] = false;\n      return activeFeatures;\n    }, {});\n\n    this.set({timings, keyframes, easings, interpolators});\n  }\n\n  set({timings, keyframes, easings = linear, interpolators = 'linear'}) {\n    if (keyframes.length === 0) {\n      throw new Error('There must be at least one keyframe');\n    }\n\n    const _interpolators = sanitizeInterpolators(keyframes, interpolators);\n\n    const _easings = sanitizeEasings(keyframes, easings);\n\n    const _timings = sanitizeTimings(keyframes, timings);\n\n    this._setActiveFeatures(keyframes);\n    const _keyframes = merge(_timings, keyframes, _easings, _interpolators);\n    this.keyframes = keyframes;\n    this.timings = timings;\n    this.easings = easings;\n    this.interpolators = interpolators;\n    this.setKeyFrames(_keyframes);\n  }\n\n  getFrame() {\n    const factor = this.factor;\n    const start = this.getStartData();\n    const end = this.getEndData();\n    const frame = {};\n\n    Object.keys(this.activeFeatures).forEach(key => {\n      if (this.activeFeatures[key]) {\n        frame[key] = factorInterpolator(start[key], end[key], end.ease)(factor);\n      }\n    });\n\n    return frame;\n  }\n\n  _setActiveFeatures(keyframes) {\n    const firstKeyframe = keyframes[0];\n    this.activeFeatures = Object.keys(firstKeyframe).reduce((activeFeatures, key) => {\n      // activate only keys that are expected\n      if (firstKeyframe[key] !== undefined) {\n        activeFeatures[key] = true;\n      }\n      return activeFeatures;\n    }, this.activeFeatures);\n  }\n}\n\nexport default Keyframes;\n"],"mappings":"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"}