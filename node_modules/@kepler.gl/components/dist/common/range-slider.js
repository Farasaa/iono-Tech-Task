"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = RangeSliderFactory;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _reactLifecyclesCompat = require("react-lifecycles-compat");

var _reselect = require("reselect");

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _rangePlot = _interopRequireDefault(require("./range-plot"));

var _slider = _interopRequireDefault(require("./slider/slider"));

var _styledComponents2 = require("./styled-components");

var _utils = require("@kepler.gl/utils");

var _templateObject, _templateObject2, _templateObject3;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var SliderInput = (0, _styledComponents["default"])(_styledComponents2.Input)(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  width: ", "px;\n  margin-left: ", "px;\n  font-size: ", "; // 10px // 12px;\n  padding: ", "; // 4px 6px; // 6px 12px;\n"])), function (props) {
  return props.theme.sliderInputWidth;
}, function (props) {
  return props.flush ? 0 : props.inputSize === 'tiny' ? 12 : 18;
}, function (props) {
  return props.theme.sliderInputFontSize;
}, function (props) {
  return props.theme.sliderInputPadding;
});

var SliderWrapper = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  position: relative;\n  align-items: ", ";\n"])), function (props) {
  return !props.isRanged && props.showInput ? 'center' : 'flex-start';
});

var RangeInputWrapper = _styledComponents["default"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  margin-top: 12px;\n  display: flex;\n  justify-content: space-between;\n"])));

RangeSliderFactory.deps = [_rangePlot["default"]];

function RangeSliderFactory(RangePlot) {
  var RangeSlider = /*#__PURE__*/function (_Component) {
    (0, _inherits2["default"])(RangeSlider, _Component);

    var _super = _createSuper(RangeSlider);

    function RangeSlider() {
      var _this;

      (0, _classCallCheck2["default"])(this, RangeSlider);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = _super.call.apply(_super, [this].concat(args));
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
        value0: 0,
        value1: 1,
        prevValue0: 0,
        prevValue1: 1,
        width: 288
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "sliderContainer", null);
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setSliderContainer", function (element) {
        _this.sliderContainer = element;

        _this._resize();
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "inputValue0", /*#__PURE__*/(0, _react.createRef)());
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "inputValue1", /*#__PURE__*/(0, _react.createRef)());
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "value0Selector", function (props) {
        return props.value0;
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "value1Selector", function (props) {
        return props.value1;
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "filterValueSelector", (0, _reselect.createSelector)(_this.value0Selector, _this.value1Selector, function (value0, value1) {
        return [value0, value1];
      }));
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_roundValToStep", function (val) {
        var _this$props = _this.props,
            range = _this$props.range,
            step = _this$props.step;
        if (!range || !step) return;
        return (0, _utils.roundValToStep)(range[0], step, val);
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_setRangeVal1", function (val) {
        var _this$props2 = _this.props,
            value0 = _this$props2.value0,
            range = _this$props2.range,
            _this$props2$onChange = _this$props2.onChange,
            onChange = _this$props2$onChange === void 0 ? function () {} : _this$props2$onChange;
        if (!range) return;
        var val1 = Number(val);
        onChange([value0, (0, _utils.clamp)([value0, range[1]], _this._roundValToStep(val1))]);
        return true;
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_setRangeVal0", function (val) {
        var _this$props3 = _this.props,
            value1 = _this$props3.value1,
            range = _this$props3.range,
            _this$props3$onChange = _this$props3.onChange,
            onChange = _this$props3$onChange === void 0 ? function () {} : _this$props3$onChange;
        if (!range) return;
        var val0 = Number(val);
        onChange([(0, _utils.clamp)([range[0], value1], _this._roundValToStep(val0)), value1]);
        return true;
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_resize", function () {
        if (_this.sliderContainer) {
          var width = _this.sliderContainer.offsetWidth;

          if (width !== _this.state.width) {
            _this.setState({
              width: width
            });
          }
        }
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_onChangeInput", function (key, e) {
        _this.setState((0, _defineProperty2["default"])({}, key, e.target.value));
      });
      return _this;
    }

    (0, _createClass2["default"])(RangeSlider, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        if (this.sliderContainer instanceof Element) {
          (0, _utils.observeDimensions)(this.sliderContainer, this._resize, 100);
        }
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        if (this.sliderContainer instanceof Element) {
          (0, _utils.unobserveDimensions)(this.sliderContainer);
        }
      }
    }, {
      key: "_renderInput",
      value: function _renderInput(key) {
        var _this2 = this;

        var setRange = key === 'value0' ? this._setRangeVal0 : this._setRangeVal1;
        var ref = key === 'value0' ? this.inputValue0 : this.inputValue1;

        var update = function update(e) {
          if (!setRange(e.target.value)) {
            _this2.setState((0, _defineProperty2["default"])({}, key, _this2.state[key]));
          }
        };

        var onChange = this._onChangeInput.bind(this, key);

        return /*#__PURE__*/_react["default"].createElement(SliderInput, {
          className: "kg-range-slider__input",
          type: "number",
          ref: ref,
          id: "slider-input-".concat(key),
          key: key,
          value: this.state[key],
          onChange: onChange,
          onKeyPress: function onKeyPress(e) {
            if (e.key === 'Enter') {
              update(e);
              ref.current.blur();
            }
          },
          onBlur: update,
          flush: key === 'value0',
          inputSize: this.props.inputSize,
          secondary: this.props.inputTheme === 'secondary'
        });
      } // eslint-disable-next-line complexity

    }, {
      key: "render",
      value: function render() {
        var _this$props4 = this.props,
            isRanged = _this$props4.isRanged,
            showInput = _this$props4.showInput,
            histogram = _this$props4.histogram,
            lineChart = _this$props4.lineChart,
            range = _this$props4.range,
            _this$props4$onChange = _this$props4.onChange,
            onChange = _this$props4$onChange === void 0 ? function () {} : _this$props4$onChange,
            sliderHandleWidth = _this$props4.sliderHandleWidth,
            step = _this$props4.step,
            timezone = _this$props4.timezone,
            timeFormat = _this$props4.timeFormat,
            playbackControlWidth = _this$props4.playbackControlWidth,
            animationWindow = _this$props4.animationWindow,
            filter = _this$props4.filter,
            datasets = _this$props4.datasets;
        var width = this.state.width;
        var plotWidth = Math.max(width - Number(sliderHandleWidth), 0);
        var renderPlot = histogram && histogram.length || lineChart;
        return /*#__PURE__*/_react["default"].createElement("div", {
          className: "kg-range-slider",
          style: {
            width: '100%',
            padding: "0 ".concat(Number(sliderHandleWidth) / 2, "px")
          },
          ref: this.setSliderContainer
        }, Array.isArray(range) && range.every(Number.isFinite) && /*#__PURE__*/_react["default"].createElement(_react["default"].Fragment, null, renderPlot ? /*#__PURE__*/_react["default"].createElement(RangePlot, {
          histogram: histogram,
          lineChart: this.props.lineChart,
          plotType: this.props.plotType,
          isEnlarged: this.props.isEnlarged,
          onBrush: function onBrush(val0, val1) {
            return onChange([val0, val1]);
          },
          marks: this.props.marks,
          animationWindow: animationWindow,
          filter: filter,
          datasets: datasets,
          range: range,
          value: this.props.plotValue || this.filterValueSelector(this.props),
          width: plotWidth,
          isRanged: isRanged,
          step: step,
          timezone: timezone,
          timeFormat: timeFormat,
          playbackControlWidth: playbackControlWidth
        }) : null, /*#__PURE__*/_react["default"].createElement(SliderWrapper, {
          className: "kg-range-slider__slider",
          isRanged: isRanged,
          showInput: showInput
        }, this.props.xAxis ? /*#__PURE__*/_react["default"].createElement("div", {
          style: {
            height: '30px'
          }
        }, /*#__PURE__*/_react["default"].createElement(this.props.xAxis, {
          width: plotWidth,
          timezone: timezone,
          domain: range,
          isEnlarged: this.props.isEnlarged
        })) : null, /*#__PURE__*/_react["default"].createElement(_slider["default"], {
          marks: this.props.marks,
          isRanged: isRanged,
          minValue: range[0],
          maxValue: range[1],
          value0: this.props.value0,
          value1: this.props.value1,
          step: step,
          sliderHandleWidth: sliderHandleWidth,
          onSlider0Change: this._setRangeVal0,
          onSlider1Change: this._setRangeVal1,
          onSliderBarChange: function onSliderBarChange(val0, val1) {
            onChange([val0, val1]);
          },
          enableBarDrag: true
        }), !isRanged && showInput ? this._renderInput('value1') : null), isRanged && showInput ? /*#__PURE__*/_react["default"].createElement(RangeInputWrapper, {
          className: "range-slider__input-group"
        }, this._renderInput('value0'), this._renderInput('value1')) : null));
      }
    }], [{
      key: "getDerivedStateFromProps",
      value: function getDerivedStateFromProps(props, state) {
        var update = null;
        var value0 = props.value0,
            value1 = props.value1;

        if (props.value0 !== state.prevValue0 && !isNaN(value0)) {
          update = _objectSpread(_objectSpread({}, update || {}), {}, {
            value0: value0,
            prevValue0: value0
          });
        }

        if (props.value1 !== state.prevValue1 && !isNaN(value1)) {
          update = _objectSpread(_objectSpread({}, update || {}), {}, {
            value1: value1,
            prevValue1: value1
          });
        }

        return update;
      }
    }]);
    return RangeSlider;
  }(_react.Component);

  (0, _defineProperty2["default"])(RangeSlider, "defaultProps", {
    isEnlarged: false,
    isRanged: true,
    showInput: true,
    sliderHandleWidth: 12,
    inputTheme: '',
    inputSize: 'small',
    onChange: function onChange() {}
  });
  (0, _reactLifecyclesCompat.polyfill)(RangeSlider);
  return RangeSlider;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tb24vcmFuZ2Utc2xpZGVyLnRzeCJdLCJuYW1lcyI6WyJTbGlkZXJJbnB1dCIsIklucHV0IiwicHJvcHMiLCJ0aGVtZSIsInNsaWRlcklucHV0V2lkdGgiLCJmbHVzaCIsImlucHV0U2l6ZSIsInNsaWRlcklucHV0Rm9udFNpemUiLCJzbGlkZXJJbnB1dFBhZGRpbmciLCJTbGlkZXJXcmFwcGVyIiwic3R5bGVkIiwiZGl2IiwiaXNSYW5nZWQiLCJzaG93SW5wdXQiLCJSYW5nZUlucHV0V3JhcHBlciIsIlJhbmdlU2xpZGVyRmFjdG9yeSIsImRlcHMiLCJSYW5nZVBsb3RGYWN0b3J5IiwiUmFuZ2VQbG90IiwiUmFuZ2VTbGlkZXIiLCJ2YWx1ZTAiLCJ2YWx1ZTEiLCJwcmV2VmFsdWUwIiwicHJldlZhbHVlMSIsIndpZHRoIiwiZWxlbWVudCIsInNsaWRlckNvbnRhaW5lciIsIl9yZXNpemUiLCJ2YWx1ZTBTZWxlY3RvciIsInZhbHVlMVNlbGVjdG9yIiwidmFsIiwicmFuZ2UiLCJzdGVwIiwib25DaGFuZ2UiLCJ2YWwxIiwiTnVtYmVyIiwiX3JvdW5kVmFsVG9TdGVwIiwidmFsMCIsIm9mZnNldFdpZHRoIiwic3RhdGUiLCJzZXRTdGF0ZSIsImtleSIsImUiLCJ0YXJnZXQiLCJ2YWx1ZSIsIkVsZW1lbnQiLCJzZXRSYW5nZSIsIl9zZXRSYW5nZVZhbDAiLCJfc2V0UmFuZ2VWYWwxIiwicmVmIiwiaW5wdXRWYWx1ZTAiLCJpbnB1dFZhbHVlMSIsInVwZGF0ZSIsIl9vbkNoYW5nZUlucHV0IiwiYmluZCIsImN1cnJlbnQiLCJibHVyIiwiaW5wdXRUaGVtZSIsImhpc3RvZ3JhbSIsImxpbmVDaGFydCIsInNsaWRlckhhbmRsZVdpZHRoIiwidGltZXpvbmUiLCJ0aW1lRm9ybWF0IiwicGxheWJhY2tDb250cm9sV2lkdGgiLCJhbmltYXRpb25XaW5kb3ciLCJmaWx0ZXIiLCJkYXRhc2V0cyIsInBsb3RXaWR0aCIsIk1hdGgiLCJtYXgiLCJyZW5kZXJQbG90IiwibGVuZ3RoIiwicGFkZGluZyIsInNldFNsaWRlckNvbnRhaW5lciIsIkFycmF5IiwiaXNBcnJheSIsImV2ZXJ5IiwiaXNGaW5pdGUiLCJwbG90VHlwZSIsImlzRW5sYXJnZWQiLCJtYXJrcyIsInBsb3RWYWx1ZSIsImZpbHRlclZhbHVlU2VsZWN0b3IiLCJ4QXhpcyIsImhlaWdodCIsIl9yZW5kZXJJbnB1dCIsImlzTmFOIiwiQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7Ozs7Ozs7Ozs7O0FBU0EsSUFBTUEsV0FBVyxHQUFHLGtDQUFPQyx3QkFBUCxDQUFILG1OQUNOLFVBQUFDLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUMsZ0JBQWhCO0FBQUEsQ0FEQyxFQUVBLFVBQUFGLEtBQUs7QUFBQSxTQUFLQSxLQUFLLENBQUNHLEtBQU4sR0FBYyxDQUFkLEdBQWtCSCxLQUFLLENBQUNJLFNBQU4sS0FBb0IsTUFBcEIsR0FBNkIsRUFBN0IsR0FBa0MsRUFBekQ7QUFBQSxDQUZMLEVBR0YsVUFBQUosS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZSSxtQkFBaEI7QUFBQSxDQUhILEVBSUosVUFBQUwsS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZSyxrQkFBaEI7QUFBQSxDQUpELENBQWpCOztBQVlBLElBQU1DLGFBQWEsR0FBR0MsNkJBQU9DLEdBQVYsMEpBR0YsVUFBQVQsS0FBSztBQUFBLFNBQUssQ0FBQ0EsS0FBSyxDQUFDVSxRQUFQLElBQW1CVixLQUFLLENBQUNXLFNBQXpCLEdBQXFDLFFBQXJDLEdBQWdELFlBQXJEO0FBQUEsQ0FISCxDQUFuQjs7QUFNQSxJQUFNQyxpQkFBaUIsR0FBR0osNkJBQU9DLEdBQVYsb0tBQXZCOztBQWlDQUksa0JBQWtCLENBQUNDLElBQW5CLEdBQTBCLENBQUND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bnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IFJlYWN0LCB7Q29tcG9uZW50LCBDb21wb25lbnRUeXBlLCBjcmVhdGVSZWYsIEVsZW1lbnRUeXBlfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge3BvbHlmaWxsfSBmcm9tICdyZWFjdC1saWZlY3ljbGVzLWNvbXBhdCc7XG5pbXBvcnQge2NyZWF0ZVNlbGVjdG9yfSBmcm9tICdyZXNlbGVjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBSYW5nZVBsb3RGYWN0b3J5IGZyb20gJy4vcmFuZ2UtcGxvdCc7XG5pbXBvcnQgU2xpZGVyIGZyb20gJy4vc2xpZGVyL3NsaWRlcic7XG5pbXBvcnQge0lucHV0fSBmcm9tICcuL3N0eWxlZC1jb21wb25lbnRzJztcblxuaW1wb3J0IHtvYnNlcnZlRGltZW5zaW9ucywgdW5vYnNlcnZlRGltZW5zaW9ucywgcm91bmRWYWxUb1N0ZXAsIGNsYW1wfSBmcm9tICdAa2VwbGVyLmdsL3V0aWxzJztcbmltcG9ydCB7TGluZUNoYXJ0LCBGaWx0ZXJ9IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuaW1wb3J0IHtEYXRhc2V0c30gZnJvbSAnQGtlcGxlci5nbC90YWJsZSc7XG5cbmludGVyZmFjZSBTbGlkZXJJbnB1dFByb3BzIHtcbiAgZmx1c2g/OiBib29sZWFuO1xuICBpbnB1dFNpemU/OiBzdHJpbmc7XG59XG5cbmNvbnN0IFNsaWRlcklucHV0ID0gc3R5bGVkKElucHV0KTxTbGlkZXJJbnB1dFByb3BzPmBcbiAgd2lkdGg6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuc2xpZGVySW5wdXRXaWR0aH1weDtcbiAgbWFyZ2luLWxlZnQ6ICR7cHJvcHMgPT4gKHByb3BzLmZsdXNoID8gMCA6IHByb3BzLmlucHV0U2l6ZSA9PT0gJ3RpbnknID8gMTIgOiAxOCl9cHg7XG4gIGZvbnQtc2l6ZTogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5zbGlkZXJJbnB1dEZvbnRTaXplfTsgLy8gMTBweCAvLyAxMnB4O1xuICBwYWRkaW5nOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnNsaWRlcklucHV0UGFkZGluZ307IC8vIDRweCA2cHg7IC8vIDZweCAxMnB4O1xuYDtcblxuaW50ZXJmYWNlIFNsaWRlcldyYXBwZXJQcm9wcyB7XG4gIGlzUmFuZ2VkPzogYm9vbGVhbjtcbiAgc2hvd0lucHV0PzogYm9vbGVhbjtcbn1cblxuY29uc3QgU2xpZGVyV3JhcHBlciA9IHN0eWxlZC5kaXY8U2xpZGVyV3JhcHBlclByb3BzPmBcbiAgZGlzcGxheTogZmxleDtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBhbGlnbi1pdGVtczogJHtwcm9wcyA9PiAoIXByb3BzLmlzUmFuZ2VkICYmIHByb3BzLnNob3dJbnB1dCA/ICdjZW50ZXInIDogJ2ZsZXgtc3RhcnQnKX07XG5gO1xuXG5jb25zdCBSYW5nZUlucHV0V3JhcHBlciA9IHN0eWxlZC5kaXZgXG4gIG1hcmdpbi10b3A6IDEycHg7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbmA7XG5cbmludGVyZmFjZSBSYW5nZVNsaWRlclByb3BzIHtcbiAgcmFuZ2U/OiBudW1iZXJbXTtcbiAgdmFsdWUwOiBudW1iZXI7XG4gIHZhbHVlMTogbnVtYmVyO1xuICBvbkNoYW5nZT86ICh2YWw6IG51bWJlcltdLCBlPzogRXZlbnQgfCBudWxsKSA9PiB2b2lkOyAvLyBUT0RPXG4gIGhpc3RvZ3JhbT86IGFueVtdO1xuICBpc1JhbmdlZD86IGJvb2xlYW47XG4gIGlzRW5sYXJnZWQ/OiBib29sZWFuO1xuICBzaG93SW5wdXQ/OiBib29sZWFuO1xuICBpbnB1dFRoZW1lPzogc3RyaW5nO1xuICBpbnB1dFNpemU/OiBzdHJpbmc7XG4gIHN0ZXA/OiBudW1iZXI7XG4gIHNsaWRlckhhbmRsZVdpZHRoPzogbnVtYmVyO1xuICB4QXhpcz86IEVsZW1lbnRUeXBlO1xuICB0aW1lem9uZT86IHN0cmluZyB8IG51bGw7XG4gIHRpbWVGb3JtYXQ/OiBzdHJpbmc7XG4gIHBsYXliYWNrQ29udHJvbFdpZHRoPzogbnVtYmVyO1xuICBsaW5lQ2hhcnQ/OiBMaW5lQ2hhcnQ7XG4gIG1hcmtzPzogbnVtYmVyW107XG4gIHBsb3RUeXBlPzogc3RyaW5nO1xuICBwbG90VmFsdWU/OiBudW1iZXJbXTtcblxuICBhbmltYXRpb25XaW5kb3c/OiBzdHJpbmc7XG4gIGZpbHRlcj86IEZpbHRlcjtcbiAgZGF0YXNldHM/OiBEYXRhc2V0cztcbn1cblxuUmFuZ2VTbGlkZXJGYWN0b3J5LmRlcHMgPSBbUmFuZ2VQbG90RmFjdG9yeV07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFJhbmdlU2xpZGVyRmFjdG9yeShcbiAgUmFuZ2VQbG90OiBSZXR1cm5UeXBlPHR5cGVvZiBSYW5nZVBsb3RGYWN0b3J5PlxuKTogQ29tcG9uZW50VHlwZTxSYW5nZVNsaWRlclByb3BzPiB7XG4gIGNsYXNzIFJhbmdlU2xpZGVyIGV4dGVuZHMgQ29tcG9uZW50PFJhbmdlU2xpZGVyUHJvcHM+IHtcbiAgICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgICAgaXNFbmxhcmdlZDogZmFsc2UsXG4gICAgICBpc1JhbmdlZDogdHJ1ZSxcbiAgICAgIHNob3dJbnB1dDogdHJ1ZSxcbiAgICAgIHNsaWRlckhhbmRsZVdpZHRoOiAxMixcbiAgICAgIGlucHV0VGhlbWU6ICcnLFxuICAgICAgaW5wdXRTaXplOiAnc21hbGwnLFxuICAgICAgb25DaGFuZ2U6ICgpID0+IHt9XG4gICAgfTtcblxuICAgIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHMsIHN0YXRlKSB7XG4gICAgICBsZXQgdXBkYXRlOiB7dmFsdWUxPzogYW55OyBwcmV2VmFsdWUxPzogYW55OyB2YWx1ZTA/OiBhbnk7IHByZXZWYWx1ZTA/OiBhbnl9IHwgbnVsbCA9IG51bGw7XG4gICAgICBjb25zdCB7dmFsdWUwLCB2YWx1ZTF9ID0gcHJvcHM7XG4gICAgICBpZiAocHJvcHMudmFsdWUwICE9PSBzdGF0ZS5wcmV2VmFsdWUwICYmICFpc05hTih2YWx1ZTApKSB7XG4gICAgICAgIHVwZGF0ZSA9IHsuLi4odXBkYXRlIHx8IHt9KSwgdmFsdWUwLCBwcmV2VmFsdWUwOiB2YWx1ZTB9O1xuICAgICAgfVxuICAgICAgaWYgKHByb3BzLnZhbHVlMSAhPT0gc3RhdGUucHJldlZhbHVlMSAmJiAhaXNOYU4odmFsdWUxKSkge1xuICAgICAgICB1cGRhdGUgPSB7Li4uKHVwZGF0ZSB8fCB7fSksIHZhbHVlMSwgcHJldlZhbHVlMTogdmFsdWUxfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1cGRhdGU7XG4gICAgfVxuXG4gICAgc3RhdGUgPSB7XG4gICAgICB2YWx1ZTA6IDAsXG4gICAgICB2YWx1ZTE6IDEsXG4gICAgICBwcmV2VmFsdWUwOiAwLFxuICAgICAgcHJldlZhbHVlMTogMSxcbiAgICAgIHdpZHRoOiAyODhcbiAgICB9O1xuXG4gICAgc2xpZGVyQ29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICBpZiAodGhpcy5zbGlkZXJDb250YWluZXIgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgIG9ic2VydmVEaW1lbnNpb25zKHRoaXMuc2xpZGVyQ29udGFpbmVyLCB0aGlzLl9yZXNpemUsIDEwMCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICBpZiAodGhpcy5zbGlkZXJDb250YWluZXIgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgIHVub2JzZXJ2ZURpbWVuc2lvbnModGhpcy5zbGlkZXJDb250YWluZXIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHNldFNsaWRlckNvbnRhaW5lcjogUmVhY3QuTGVnYWN5UmVmPEhUTUxEaXZFbGVtZW50PiA9IGVsZW1lbnQgPT4ge1xuICAgICAgdGhpcy5zbGlkZXJDb250YWluZXIgPSBlbGVtZW50O1xuICAgICAgdGhpcy5fcmVzaXplKCk7XG4gICAgfTtcbiAgICBpbnB1dFZhbHVlMCA9IGNyZWF0ZVJlZjxIVE1MSW5wdXRFbGVtZW50PigpO1xuICAgIGlucHV0VmFsdWUxID0gY3JlYXRlUmVmPEhUTUxJbnB1dEVsZW1lbnQ+KCk7XG4gICAgdmFsdWUwU2VsZWN0b3IgPSBwcm9wcyA9PiBwcm9wcy52YWx1ZTA7XG4gICAgdmFsdWUxU2VsZWN0b3IgPSBwcm9wcyA9PiBwcm9wcy52YWx1ZTE7XG4gICAgZmlsdGVyVmFsdWVTZWxlY3RvciA9IGNyZWF0ZVNlbGVjdG9yKFxuICAgICAgdGhpcy52YWx1ZTBTZWxlY3RvcixcbiAgICAgIHRoaXMudmFsdWUxU2VsZWN0b3IsXG4gICAgICAodmFsdWUwLCB2YWx1ZTEpID0+IFt2YWx1ZTAsIHZhbHVlMV1cbiAgICApO1xuXG4gICAgX3JvdW5kVmFsVG9TdGVwID0gdmFsID0+IHtcbiAgICAgIGNvbnN0IHtyYW5nZSwgc3RlcH0gPSB0aGlzLnByb3BzO1xuICAgICAgaWYgKCFyYW5nZSB8fCAhc3RlcCkgcmV0dXJuO1xuICAgICAgcmV0dXJuIHJvdW5kVmFsVG9TdGVwKHJhbmdlWzBdLCBzdGVwLCB2YWwpO1xuICAgIH07XG5cbiAgICBfc2V0UmFuZ2VWYWwxID0gdmFsID0+IHtcbiAgICAgIGNvbnN0IHt2YWx1ZTAsIHJhbmdlLCBvbkNoYW5nZSA9ICgpID0+IHt9fSA9IHRoaXMucHJvcHM7XG4gICAgICBpZiAoIXJhbmdlKSByZXR1cm47XG4gICAgICBjb25zdCB2YWwxID0gTnVtYmVyKHZhbCk7XG4gICAgICBvbkNoYW5nZShbdmFsdWUwLCBjbGFtcChbdmFsdWUwLCByYW5nZVsxXV0sIHRoaXMuX3JvdW5kVmFsVG9TdGVwKHZhbDEpKV0pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcblxuICAgIF9zZXRSYW5nZVZhbDAgPSB2YWwgPT4ge1xuICAgICAgY29uc3Qge3ZhbHVlMSwgcmFuZ2UsIG9uQ2hhbmdlID0gKCkgPT4ge319ID0gdGhpcy5wcm9wcztcbiAgICAgIGlmICghcmFuZ2UpIHJldHVybjtcbiAgICAgIGNvbnN0IHZhbDAgPSBOdW1iZXIodmFsKTtcbiAgICAgIG9uQ2hhbmdlKFtjbGFtcChbcmFuZ2VbMF0sIHZhbHVlMV0sIHRoaXMuX3JvdW5kVmFsVG9TdGVwKHZhbDApKSwgdmFsdWUxXSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgX3Jlc2l6ZSA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnNsaWRlckNvbnRhaW5lcikge1xuICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuc2xpZGVyQ29udGFpbmVyLm9mZnNldFdpZHRoO1xuICAgICAgICBpZiAod2lkdGggIT09IHRoaXMuc3RhdGUud2lkdGgpIHtcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHt3aWR0aH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIF9vbkNoYW5nZUlucHV0ID0gKGtleSwgZSkgPT4ge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7W2tleV06IGUudGFyZ2V0LnZhbHVlfSk7XG4gICAgfTtcblxuICAgIF9yZW5kZXJJbnB1dChrZXkpIHtcbiAgICAgIGNvbnN0IHNldFJhbmdlID0ga2V5ID09PSAndmFsdWUwJyA/IHRoaXMuX3NldFJhbmdlVmFsMCA6IHRoaXMuX3NldFJhbmdlVmFsMTtcbiAgICAgIGNvbnN0IHJlZiA9IGtleSA9PT0gJ3ZhbHVlMCcgPyB0aGlzLmlucHV0VmFsdWUwIDogdGhpcy5pbnB1dFZhbHVlMTtcbiAgICAgIGNvbnN0IHVwZGF0ZSA9IGUgPT4ge1xuICAgICAgICBpZiAoIXNldFJhbmdlKGUudGFyZ2V0LnZhbHVlKSkge1xuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1trZXldOiB0aGlzLnN0YXRlW2tleV19KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3Qgb25DaGFuZ2UgPSB0aGlzLl9vbkNoYW5nZUlucHV0LmJpbmQodGhpcywga2V5KTtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFNsaWRlcklucHV0XG4gICAgICAgICAgY2xhc3NOYW1lPVwia2ctcmFuZ2Utc2xpZGVyX19pbnB1dFwiXG4gICAgICAgICAgdHlwZT1cIm51bWJlclwiXG4gICAgICAgICAgcmVmPXtyZWZ9XG4gICAgICAgICAgaWQ9e2BzbGlkZXItaW5wdXQtJHtrZXl9YH1cbiAgICAgICAgICBrZXk9e2tleX1cbiAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZVtrZXldfVxuICAgICAgICAgIG9uQ2hhbmdlPXtvbkNoYW5nZX1cbiAgICAgICAgICBvbktleVByZXNzPXtlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgICAgICAgICB1cGRhdGUoZSk7XG4gICAgICAgICAgICAgIChyZWYuY3VycmVudCBhcyBhbnkpLmJsdXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9fVxuICAgICAgICAgIG9uQmx1cj17dXBkYXRlfVxuICAgICAgICAgIGZsdXNoPXtrZXkgPT09ICd2YWx1ZTAnfVxuICAgICAgICAgIGlucHV0U2l6ZT17dGhpcy5wcm9wcy5pbnB1dFNpemV9XG4gICAgICAgICAgc2Vjb25kYXJ5PXt0aGlzLnByb3BzLmlucHV0VGhlbWUgPT09ICdzZWNvbmRhcnknfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGxleGl0eVxuICAgIHJlbmRlcigpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgaXNSYW5nZWQsXG4gICAgICAgIHNob3dJbnB1dCxcbiAgICAgICAgaGlzdG9ncmFtLFxuICAgICAgICBsaW5lQ2hhcnQsXG4gICAgICAgIHJhbmdlLFxuICAgICAgICBvbkNoYW5nZSA9ICgpID0+IHt9LFxuICAgICAgICBzbGlkZXJIYW5kbGVXaWR0aCxcbiAgICAgICAgc3RlcCxcbiAgICAgICAgdGltZXpvbmUsXG4gICAgICAgIHRpbWVGb3JtYXQsXG4gICAgICAgIHBsYXliYWNrQ29udHJvbFdpZHRoLFxuICAgICAgICBhbmltYXRpb25XaW5kb3csXG4gICAgICAgIGZpbHRlcixcbiAgICAgICAgZGF0YXNldHNcbiAgICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgICBjb25zdCB7d2lkdGh9ID0gdGhpcy5zdGF0ZTtcbiAgICAgIGNvbnN0IHBsb3RXaWR0aCA9IE1hdGgubWF4KHdpZHRoIC0gTnVtYmVyKHNsaWRlckhhbmRsZVdpZHRoKSwgMCk7XG4gICAgICBjb25zdCByZW5kZXJQbG90ID0gKGhpc3RvZ3JhbSAmJiBoaXN0b2dyYW0ubGVuZ3RoKSB8fCBsaW5lQ2hhcnQ7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3NOYW1lPVwia2ctcmFuZ2Utc2xpZGVyXCJcbiAgICAgICAgICBzdHlsZT17e3dpZHRoOiAnMTAwJScsIHBhZGRpbmc6IGAwICR7TnVtYmVyKHNsaWRlckhhbmRsZVdpZHRoKSAvIDJ9cHhgfX1cbiAgICAgICAgICByZWY9e3RoaXMuc2V0U2xpZGVyQ29udGFpbmVyfVxuICAgICAgICA+XG4gICAgICAgICAge0FycmF5LmlzQXJyYXkocmFuZ2UpICYmIHJhbmdlLmV2ZXJ5KE51bWJlci5pc0Zpbml0ZSkgJiYgKFxuICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAge3JlbmRlclBsb3QgPyAoXG4gICAgICAgICAgICAgICAgPFJhbmdlUGxvdFxuICAgICAgICAgICAgICAgICAgaGlzdG9ncmFtPXtoaXN0b2dyYW19XG4gICAgICAgICAgICAgICAgICBsaW5lQ2hhcnQ9e3RoaXMucHJvcHMubGluZUNoYXJ0fVxuICAgICAgICAgICAgICAgICAgcGxvdFR5cGU9e3RoaXMucHJvcHMucGxvdFR5cGV9XG4gICAgICAgICAgICAgICAgICBpc0VubGFyZ2VkPXt0aGlzLnByb3BzLmlzRW5sYXJnZWR9XG4gICAgICAgICAgICAgICAgICBvbkJydXNoPXsodmFsMCwgdmFsMSkgPT4gb25DaGFuZ2UoW3ZhbDAsIHZhbDFdKX1cbiAgICAgICAgICAgICAgICAgIG1hcmtzPXt0aGlzLnByb3BzLm1hcmtzfVxuICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uV2luZG93PXthbmltYXRpb25XaW5kb3d9XG4gICAgICAgICAgICAgICAgICBmaWx0ZXI9e2ZpbHRlcn1cbiAgICAgICAgICAgICAgICAgIGRhdGFzZXRzPXtkYXRhc2V0c31cbiAgICAgICAgICAgICAgICAgIHJhbmdlPXtyYW5nZX1cbiAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnByb3BzLnBsb3RWYWx1ZSB8fCB0aGlzLmZpbHRlclZhbHVlU2VsZWN0b3IodGhpcy5wcm9wcyl9XG4gICAgICAgICAgICAgICAgICB3aWR0aD17cGxvdFdpZHRofVxuICAgICAgICAgICAgICAgICAgaXNSYW5nZWQ9e2lzUmFuZ2VkfVxuICAgICAgICAgICAgICAgICAgc3RlcD17c3RlcH1cbiAgICAgICAgICAgICAgICAgIHRpbWV6b25lPXt0aW1lem9uZX1cbiAgICAgICAgICAgICAgICAgIHRpbWVGb3JtYXQ9e3RpbWVGb3JtYXR9XG4gICAgICAgICAgICAgICAgICBwbGF5YmFja0NvbnRyb2xXaWR0aD17cGxheWJhY2tDb250cm9sV2lkdGh9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAgICAgIDxTbGlkZXJXcmFwcGVyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwia2ctcmFuZ2Utc2xpZGVyX19zbGlkZXJcIlxuICAgICAgICAgICAgICAgIGlzUmFuZ2VkPXtpc1JhbmdlZH1cbiAgICAgICAgICAgICAgICBzaG93SW5wdXQ9e3Nob3dJbnB1dH1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHt0aGlzLnByb3BzLnhBeGlzID8gKFxuICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17e2hlaWdodDogJzMwcHgnfX0+XG4gICAgICAgICAgICAgICAgICAgIDx0aGlzLnByb3BzLnhBeGlzXG4gICAgICAgICAgICAgICAgICAgICAgd2lkdGg9e3Bsb3RXaWR0aH1cbiAgICAgICAgICAgICAgICAgICAgICB0aW1lem9uZT17dGltZXpvbmV9XG4gICAgICAgICAgICAgICAgICAgICAgZG9tYWluPXtyYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICBpc0VubGFyZ2VkPXt0aGlzLnByb3BzLmlzRW5sYXJnZWR9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICApIDogbnVsbH1cbiAgICAgICAgICAgICAgICA8U2xpZGVyXG4gICAgICAgICAgICAgICAgICBtYXJrcz17dGhpcy5wcm9wcy5tYXJrc31cbiAgICAgICAgICAgICAgICAgIGlzUmFuZ2VkPXtpc1JhbmdlZH1cbiAgICAgICAgICAgICAgICAgIG1pblZhbHVlPXtyYW5nZVswXX1cbiAgICAgICAgICAgICAgICAgIG1heFZhbHVlPXtyYW5nZVsxXX1cbiAgICAgICAgICAgICAgICAgIHZhbHVlMD17dGhpcy5wcm9wcy52YWx1ZTB9XG4gICAgICAgICAgICAgICAgICB2YWx1ZTE9e3RoaXMucHJvcHMudmFsdWUxfVxuICAgICAgICAgICAgICAgICAgc3RlcD17c3RlcH1cbiAgICAgICAgICAgICAgICAgIHNsaWRlckhhbmRsZVdpZHRoPXtzbGlkZXJIYW5kbGVXaWR0aH1cbiAgICAgICAgICAgICAgICAgIG9uU2xpZGVyMENoYW5nZT17dGhpcy5fc2V0UmFuZ2VWYWwwfVxuICAgICAgICAgICAgICAgICAgb25TbGlkZXIxQ2hhbmdlPXt0aGlzLl9zZXRSYW5nZVZhbDF9XG4gICAgICAgICAgICAgICAgICBvblNsaWRlckJhckNoYW5nZT17KHZhbDAsIHZhbDEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2UoW3ZhbDAsIHZhbDFdKTtcbiAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICBlbmFibGVCYXJEcmFnXG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICB7IWlzUmFuZ2VkICYmIHNob3dJbnB1dCA/IHRoaXMuX3JlbmRlcklucHV0KCd2YWx1ZTEnKSA6IG51bGx9XG4gICAgICAgICAgICAgIDwvU2xpZGVyV3JhcHBlcj5cbiAgICAgICAgICAgICAge2lzUmFuZ2VkICYmIHNob3dJbnB1dCA/IChcbiAgICAgICAgICAgICAgICA8UmFuZ2VJbnB1dFdyYXBwZXIgY2xhc3NOYW1lPVwicmFuZ2Utc2xpZGVyX19pbnB1dC1ncm91cFwiPlxuICAgICAgICAgICAgICAgICAge3RoaXMuX3JlbmRlcklucHV0KCd2YWx1ZTAnKX1cbiAgICAgICAgICAgICAgICAgIHt0aGlzLl9yZW5kZXJJbnB1dCgndmFsdWUxJyl9XG4gICAgICAgICAgICAgICAgPC9SYW5nZUlucHV0V3JhcHBlcj5cbiAgICAgICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAgICA8Lz5cbiAgICAgICAgICApfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcG9seWZpbGwoUmFuZ2VTbGlkZXIpO1xuXG4gIHJldHVybiBSYW5nZVNsaWRlcjtcbn1cbiJdfQ==