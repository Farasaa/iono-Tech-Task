"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.ChickletTag = exports.ChickletButton = void 0;

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _core = require("@dnd-kit/core");

var _sortable = require("@dnd-kit/sortable");

var _modifiers = require("@dnd-kit/modifiers");

var _delete = _interopRequireDefault(require("../icons/delete"));

var _localization = require("@kepler.gl/localization");

var _templateObject, _templateObject2, _templateObject3;

var ChickletButton = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  background: ", ";\n  border-radius: 1px;\n  color: ", ";\n  font-size: 11px;\n  line-height: 20px;\n  margin: 4px 10px 4px 3px;\n  padding: 2px 6px;\n  display: flex;\n  align-items: center;\n  max-width: calc(100% - 8px);\n\n  :hover {\n    color: ", ";\n  }\n"])), function (props) {
  return props.inputTheme === 'light' ? props.theme.chickletBgdLT : props.theme.chickletBgd;
}, function (props) {
  return props.inputTheme === 'light' ? props.theme.textColorLT : props.theme.textColor;
}, function (props) {
  return props.inputTheme === 'light' ? props.theme.textColorHlLT : props.theme.textColorHl;
});

exports.ChickletButton = ChickletButton;
var DND_MODIFIERS = [_modifiers.restrictToParentElement];

var ChickletTag = _styledComponents["default"].span(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  margin-right: 10px;\n  text-overflow: ellipsis;\n  width: 100%;\n  overflow: hidden;\n\n  :hover {\n    overflow: visible;\n  }\n"])));

exports.ChickletTag = ChickletTag;

var Chicklet = function Chicklet(_ref) {
  var disabled = _ref.disabled,
      name = _ref.name,
      remove = _ref.remove,
      inputTheme = _ref.inputTheme;
  return /*#__PURE__*/_react["default"].createElement(ChickletButton, {
    inputTheme: inputTheme
  }, /*#__PURE__*/_react["default"].createElement(ChickletTag, null, name), /*#__PURE__*/_react["default"].createElement(_delete["default"], {
    onClick: disabled ? undefined : remove
  }));
};

var ChickletedInputContainer = _styledComponents["default"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  ", "\n      \n  color: ", ";\n  overflow: hidden;\n"])), function (props) {
  return props.inputTheme === 'secondary' ? props.theme.secondaryChickletedInput : props.inputTheme === 'light' ? props.theme.chickletedInputLT : props.theme.chickletedInput;
}, function (props) {
  return props.hasPlaceholder ? props.theme.selectColorPlaceHolder : props.theme.selectColor;
});

var ChickletedItem = function ChickletedItem(_ref2) {
  var item = _ref2.item,
      removeItem = _ref2.removeItem,
      displayOption = _ref2.displayOption,
      CustomChickletComponent = _ref2.CustomChickletComponent,
      inputTheme = _ref2.inputTheme,
      disabled = _ref2.disabled,
      itemId = _ref2.itemId;

  var _useSortable = (0, _sortable.useSortable)({
    id: itemId
  }),
      attributes = _useSortable.attributes,
      listeners = _useSortable.listeners,
      setNodeRef = _useSortable.setNodeRef,
      transform = _useSortable.transform,
      transition = _useSortable.transition,
      isDragging = _useSortable.isDragging;

  var chickletProps = (0, _react.useMemo)(function () {
    return {
      inputTheme: inputTheme,
      disabled: disabled,
      name: displayOption(item),
      displayOption: displayOption,
      item: item,
      attributes: attributes,
      listeners: listeners,
      setNodeRef: setNodeRef,
      transform: transform,
      transition: transition,
      isDragging: isDragging,
      remove: function remove(e) {
        return removeItem(item, e);
      }
    };
  }, [item, removeItem, displayOption, CustomChickletComponent, inputTheme, disabled, itemId, attributes, listeners, setNodeRef, transform, transition, isDragging]);
  return CustomChickletComponent ? /*#__PURE__*/_react["default"].createElement(CustomChickletComponent, chickletProps) : /*#__PURE__*/_react["default"].createElement(Chicklet, chickletProps);
};

var ChickletedInput = function ChickletedInput(_ref3) {
  var disabled = _ref3.disabled,
      onClick = _ref3.onClick,
      className = _ref3.className,
      _ref3$selectedItems = _ref3.selectedItems,
      selectedItems = _ref3$selectedItems === void 0 ? [] : _ref3$selectedItems,
      _ref3$placeholder = _ref3.placeholder,
      placeholder = _ref3$placeholder === void 0 ? '' : _ref3$placeholder,
      removeItem = _ref3.removeItem,
      _ref3$reorderItems = _ref3.reorderItems,
      reorderItems = _ref3$reorderItems === void 0 ? function (d) {
    return d;
  } : _ref3$reorderItems,
      _ref3$displayOption = _ref3.displayOption,
      displayOption = _ref3$displayOption === void 0 ? function (d) {
    return d;
  } : _ref3$displayOption,
      inputTheme = _ref3.inputTheme,
      CustomChickletComponent = _ref3.CustomChickletComponent;
  var selectedItemIds = (0, _react.useMemo)(function () {
    return selectedItems.map(function (item) {
      return displayOption(item);
    });
  }, [displayOption, selectedItems]);
  var handleDragEnd = (0, _react.useCallback)(function (_ref4) {
    var active = _ref4.active,
        over = _ref4.over;
    if (!over) return;

    if (active.id !== over.id) {
      var oldIndex = selectedItemIds.findIndex(function (itemId) {
        return itemId === active.id;
      });
      var newIndex = selectedItemIds.findIndex(function (itemId) {
        return itemId === over.id;
      });
      reorderItems((0, _sortable.arrayMove)(selectedItems, oldIndex, newIndex));
    }
  }, [selectedItems, displayOption, reorderItems]);
  return /*#__PURE__*/_react["default"].createElement(ChickletedInputContainer, {
    className: "".concat(className, " chickleted-input"),
    onClick: onClick,
    inputTheme: inputTheme,
    hasPlaceholder: !selectedItems || !selectedItems.length
  }, /*#__PURE__*/_react["default"].createElement(_core.DndContext, {
    onDragEnd: handleDragEnd,
    modifiers: DND_MODIFIERS,
    collisionDetection: _core.pointerWithin,
    autoScroll: false
  }, /*#__PURE__*/_react["default"].createElement(_sortable.SortableContext, {
    items: selectedItemIds
  }, selectedItems.length > 0 ? selectedItems.map(function (item, index) {
    return /*#__PURE__*/_react["default"].createElement(ChickletedItem, {
      item: item,
      itemId: displayOption(item),
      removeItem: removeItem,
      displayOption: displayOption,
      CustomChickletComponent: CustomChickletComponent,
      disabled: disabled,
      inputTheme: inputTheme,
      key: "".concat(displayOption(item), "_").concat(index)
    });
  }) : /*#__PURE__*/_react["default"].createElement("span", {
    className: "".concat(className, " chickleted-input__placeholder")
  }, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
    id: placeholder || 'placeholder.enterValue'
  }))), /*#__PURE__*/_react["default"].createElement(_core.DragOverlay, {
    dropAnimation: null
  })));
};

var _default = ChickletedInput;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb24vaXRlbS1zZWxlY3Rvci9jaGlja2xldGVkLWlucHV0LnRzeCJdLCJuYW1lcyI6WyJDaGlja2xldEJ1dHRvbiIsInN0eWxlZCIsImRpdiIsInByb3BzIiwiaW5wdXRUaGVtZSIsInRoZW1lIiwiY2hpY2tsZXRCZ2RMVCIsImNoaWNrbGV0QmdkIiwidGV4dENvbG9yTFQiLCJ0ZXh0Q29sb3IiLCJ0ZXh0Q29sb3JIbExUIiwidGV4dENvbG9ySGwiLCJETkRfTU9ESUZJRVJTIiwicmVzdHJpY3RUb1BhcmVudEVsZW1lbnQiLCJDaGlja2xldFRhZyIsInNwYW4iLCJDaGlja2xldCIsImRpc2FibGVkIiwibmFtZSIsInJlbW92ZSIsInVuZGVmaW5lZCIsIkNoaWNrbGV0ZWRJbnB1dENvbnRhaW5lciIsInNlY29uZGFyeUNoaWNrbGV0ZWRJbnB1dCIsImNoaWNrbGV0ZWRJbnB1dExUIiwiY2hpY2tsZXRlZElucHV0IiwiaGFzUGxhY2Vob2xkZXIiLCJzZWxlY3RDb2xvclBsYWNlSG9sZGVyIiwic2VsZWN0Q29sb3IiLCJDaGlja2xldGVkSXRlbSIsIml0ZW0iLCJyZW1vdmVJdGVtIiwiZGlzcGxheU9wdGlvbiIsIkN1c3RvbUNoaWNrbGV0Q29tcG9uZW50IiwiaXRlbUlkIiwiaWQiLCJhdHRyaWJ1dGVzIiwibGlzdGVuZXJzIiwic2V0Tm9kZVJlZiIsInRyYW5zZm9ybSIsInRyYW5zaXRpb24iLCJpc0RyYWdnaW5nIiwiY2hpY2tsZXRQcm9wcyIsImUiLCJDaGlja2xldGVkSW5wdXQiLCJvbkNsaWNrIiwiY2xhc3NOYW1lIiwic2VsZWN0ZWRJdGVtcyIsInBsYWNlaG9sZGVyIiwicmVvcmRlckl0ZW1zIiwiZCIsInNlbGVjdGVkSXRlbUlkcyIsIm1hcCIsImhhbmRsZURyYWdFbmQiLCJhY3RpdmUiLCJvdmVyIiwib2xkSW5kZXgiLCJmaW5kSW5kZXgiLCJuZXdJbmRleCIsImxlbmd0aCIsInBvaW50ZXJXaXRoaW4iLCJpbmRleCJd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QUFEO0FBQWtCLElBQUEsRUFBRSxFQUFFRSxXQUFXLElBQUk7QUFBckMsSUFERixDQWZKLENBTkYsZUEwQkUsZ0NBQUMsaUJBQUQ7QUFBYSxJQUFBLGFBQWEsRUFBRTtBQUE1QixJQTFCRixDQU5GLENBREY7QUFxQ0QsQ0FqRUQ7O2VBbUVlSixlIiwic291cmNlc0NvbnRlbnQiOlsiLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IFJlYWN0LCB7RWxlbWVudFR5cGUsIE1vdXNlRXZlbnRIYW5kbGVyLCBSZWFjdE5vZGUsIHVzZU1lbW8sIHVzZUNhbGxiYWNrfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHtEbmRDb250ZXh0LCBEcmFnT3ZlcmxheSwgcG9pbnRlcldpdGhpbn0gZnJvbSAnQGRuZC1raXQvY29yZSc7XG5pbXBvcnQge1NvcnRhYmxlQ29udGV4dCwgdXNlU29ydGFibGUsIGFycmF5TW92ZX0gZnJvbSAnQGRuZC1raXQvc29ydGFibGUnO1xuaW1wb3J0IHtyZXN0cmljdFRvUGFyZW50RWxlbWVudH0gZnJvbSAnQGRuZC1raXQvbW9kaWZpZXJzJztcblxuaW1wb3J0IERlbGV0ZSBmcm9tICcuLi9pY29ucy9kZWxldGUnO1xuaW1wb3J0IHtGb3JtYXR0ZWRNZXNzYWdlfSBmcm9tICdAa2VwbGVyLmdsL2xvY2FsaXphdGlvbic7XG5cbmludGVyZmFjZSBDaGlja2xldGVkSW5wdXRQcm9wcyB7XG4gIC8vIHJlcXVpcmVkIHByb3BlcnRpZXNcbiAgb25DbGljazogTW91c2VFdmVudEhhbmRsZXI8SFRNTERpdkVsZW1lbnQ+O1xuICByZW1vdmVJdGVtOiBGdW5jdGlvbjtcblxuICAvLyBvcHRpb25hbCBwcm9wZXJ0aWVzXG4gIHNlbGVjdGVkSXRlbXM/OiBhbnlbXTtcbiAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICBkaXNwbGF5T3B0aW9uPzogRnVuY3Rpb247XG4gIGZvY3VzPzogYm9vbGVhbjtcbiAgZXJyb3I/OiBib29sZWFuO1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbiAgaW5wdXRUaGVtZT86IHN0cmluZztcbiAgQ3VzdG9tQ2hpY2tsZXRDb21wb25lbnQ/OiBFbGVtZW50VHlwZTtcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICByZW9yZGVySXRlbXM/OiAobmV3T3JkZXI6IGFueSkgPT4gdm9pZDtcbn1cblxuaW50ZXJmYWNlIENoaWNrbGV0QnV0dG9uUHJvcHMge1xuICBpbnB1dFRoZW1lPzogc3RyaW5nO1xufVxuXG5leHBvcnQgY29uc3QgQ2hpY2tsZXRCdXR0b24gPSBzdHlsZWQuZGl2PENoaWNrbGV0QnV0dG9uUHJvcHM+YFxuICBiYWNrZ3JvdW5kOiAke3Byb3BzID0+XG4gICAgcHJvcHMuaW5wdXRUaGVtZSA9PT0gJ2xpZ2h0JyA/IHByb3BzLnRoZW1lLmNoaWNrbGV0QmdkTFQgOiBwcm9wcy50aGVtZS5jaGlja2xldEJnZH07XG4gIGJvcmRlci1yYWRpdXM6IDFweDtcbiAgY29sb3I6ICR7cHJvcHMgPT5cbiAgICBwcm9wcy5pbnB1dFRoZW1lID09PSAnbGlnaHQnID8gcHJvcHMudGhlbWUudGV4dENvbG9yTFQgOiBwcm9wcy50aGVtZS50ZXh0Q29sb3J9O1xuICBmb250LXNpemU6IDExcHg7XG4gIGxpbmUtaGVpZ2h0OiAyMHB4O1xuICBtYXJnaW46IDRweCAxMHB4IDRweCAzcHg7XG4gIHBhZGRpbmc6IDJweCA2cHg7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIG1heC13aWR0aDogY2FsYygxMDAlIC0gOHB4KTtcblxuICA6aG92ZXIge1xuICAgIGNvbG9yOiAke3Byb3BzID0+XG4gICAgICBwcm9wcy5pbnB1dFRoZW1lID09PSAnbGlnaHQnID8gcHJvcHMudGhlbWUudGV4dENvbG9ySGxMVCA6IHByb3BzLnRoZW1lLnRleHRDb2xvckhsfTtcbiAgfVxuYDtcblxuY29uc3QgRE5EX01PRElGSUVSUyA9IFtyZXN0cmljdFRvUGFyZW50RWxlbWVudF07XG5leHBvcnQgY29uc3QgQ2hpY2tsZXRUYWcgPSBzdHlsZWQuc3BhbmBcbiAgbWFyZ2luLXJpZ2h0OiAxMHB4O1xuICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcztcbiAgd2lkdGg6IDEwMCU7XG4gIG92ZXJmbG93OiBoaWRkZW47XG5cbiAgOmhvdmVyIHtcbiAgICBvdmVyZmxvdzogdmlzaWJsZTtcbiAgfVxuYDtcblxuaW50ZXJmYWNlIENoaWNrbGV0UHJvcHMge1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG4gIG5hbWU6IFJlYWN0Tm9kZTtcbiAgcmVtb3ZlPzogTW91c2VFdmVudEhhbmRsZXI8U1ZHU1ZHRWxlbWVudD47XG4gIGlucHV0VGhlbWU/OiBzdHJpbmc7XG59XG5cbmNvbnN0IENoaWNrbGV0ID0gKHtkaXNhYmxlZCwgbmFtZSwgcmVtb3ZlLCBpbnB1dFRoZW1lfTogQ2hpY2tsZXRQcm9wcykgPT4gKFxuICA8Q2hpY2tsZXRCdXR0b24gaW5wdXRUaGVtZT17aW5wdXRUaGVtZX0+XG4gICAgPENoaWNrbGV0VGFnPntuYW1lfTwvQ2hpY2tsZXRUYWc+XG4gICAgPERlbGV0ZSBvbkNsaWNrPXtkaXNhYmxlZCA/IHVuZGVmaW5lZCA6IHJlbW92ZX0gLz5cbiAgPC9DaGlja2xldEJ1dHRvbj5cbik7XG5cbmludGVyZmFjZSBDaGlja2xldGVkSW5wdXRDb250YWluZXJQcm9wcyB7XG4gIGlucHV0VGhlbWU/OiBzdHJpbmc7XG4gIGhhc1BsYWNlaG9sZGVyPzogYm9vbGVhbjtcbn1cblxuY29uc3QgQ2hpY2tsZXRlZElucHV0Q29udGFpbmVyID0gc3R5bGVkLmRpdjxDaGlja2xldGVkSW5wdXRDb250YWluZXJQcm9wcz5gXG4gICR7cHJvcHMgPT5cbiAgICBwcm9wcy5pbnB1dFRoZW1lID09PSAnc2Vjb25kYXJ5J1xuICAgICAgPyBwcm9wcy50aGVtZS5zZWNvbmRhcnlDaGlja2xldGVkSW5wdXRcbiAgICAgIDogcHJvcHMuaW5wdXRUaGVtZSA9PT0gJ2xpZ2h0J1xuICAgICAgPyBwcm9wcy50aGVtZS5jaGlja2xldGVkSW5wdXRMVFxuICAgICAgOiBwcm9wcy50aGVtZS5jaGlja2xldGVkSW5wdXR9XG4gICAgICBcbiAgY29sb3I6ICR7cHJvcHMgPT5cbiAgICBwcm9wcy5oYXNQbGFjZWhvbGRlciA/IHByb3BzLnRoZW1lLnNlbGVjdENvbG9yUGxhY2VIb2xkZXIgOiBwcm9wcy50aGVtZS5zZWxlY3RDb2xvcn07XG4gIG92ZXJmbG93OiBoaWRkZW47XG5gO1xuXG5jb25zdCBDaGlja2xldGVkSXRlbSA9ICh7XG4gIGl0ZW0sXG4gIHJlbW92ZUl0ZW0sXG4gIGRpc3BsYXlPcHRpb24sXG4gIEN1c3RvbUNoaWNrbGV0Q29tcG9uZW50LFxuICBpbnB1dFRoZW1lLFxuICBkaXNhYmxlZCxcbiAgaXRlbUlkXG59KSA9PiB7XG4gIGNvbnN0IHthdHRyaWJ1dGVzLCBsaXN0ZW5lcnMsIHNldE5vZGVSZWYsIHRyYW5zZm9ybSwgdHJhbnNpdGlvbiwgaXNEcmFnZ2luZ30gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQ6IGl0ZW1JZFxuICB9KTtcbiAgY29uc3QgY2hpY2tsZXRQcm9wcyA9IHVzZU1lbW8oXG4gICAgKCkgPT4gKHtcbiAgICAgIGlucHV0VGhlbWUsXG4gICAgICBkaXNhYmxlZCxcbiAgICAgIG5hbWU6IGRpc3BsYXlPcHRpb24oaXRlbSksXG4gICAgICBkaXNwbGF5T3B0aW9uLFxuICAgICAgaXRlbSxcbiAgICAgIGF0dHJpYnV0ZXMsXG4gICAgICBsaXN0ZW5lcnMsXG4gICAgICBzZXROb2RlUmVmLFxuICAgICAgdHJhbnNmb3JtLFxuICAgICAgdHJhbnNpdGlvbixcbiAgICAgIGlzRHJhZ2dpbmcsXG4gICAgICByZW1vdmU6IGUgPT4gcmVtb3ZlSXRlbShpdGVtLCBlKVxuICAgIH0pLFxuICAgIFtcbiAgICAgIGl0ZW0sXG4gICAgICByZW1vdmVJdGVtLFxuICAgICAgZGlzcGxheU9wdGlvbixcbiAgICAgIEN1c3RvbUNoaWNrbGV0Q29tcG9uZW50LFxuICAgICAgaW5wdXRUaGVtZSxcbiAgICAgIGRpc2FibGVkLFxuICAgICAgaXRlbUlkLFxuICAgICAgYXR0cmlidXRlcyxcbiAgICAgIGxpc3RlbmVycyxcbiAgICAgIHNldE5vZGVSZWYsXG4gICAgICB0cmFuc2Zvcm0sXG4gICAgICB0cmFuc2l0aW9uLFxuICAgICAgaXNEcmFnZ2luZ1xuICAgIF1cbiAgKTtcbiAgcmV0dXJuIEN1c3RvbUNoaWNrbGV0Q29tcG9uZW50ID8gKFxuICAgIDxDdXN0b21DaGlja2xldENvbXBvbmVudCB7Li4uY2hpY2tsZXRQcm9wc30gLz5cbiAgKSA6IChcbiAgICA8Q2hpY2tsZXQgey4uLmNoaWNrbGV0UHJvcHN9IC8+XG4gICk7XG59O1xuXG5jb25zdCBDaGlja2xldGVkSW5wdXQ6IFJlYWN0LkZDPENoaWNrbGV0ZWRJbnB1dFByb3BzPiA9ICh7XG4gIGRpc2FibGVkLFxuICBvbkNsaWNrLFxuICBjbGFzc05hbWUsXG4gIHNlbGVjdGVkSXRlbXMgPSBbXSxcbiAgcGxhY2Vob2xkZXIgPSAnJyxcbiAgcmVtb3ZlSXRlbSxcbiAgcmVvcmRlckl0ZW1zID0gZCA9PiBkLFxuICBkaXNwbGF5T3B0aW9uID0gZCA9PiBkLFxuICBpbnB1dFRoZW1lLFxuICBDdXN0b21DaGlja2xldENvbXBvbmVudFxufSkgPT4ge1xuICBjb25zdCBzZWxlY3RlZEl0ZW1JZHMgPSB1c2VNZW1vKCgpID0+IHNlbGVjdGVkSXRlbXMubWFwKGl0ZW0gPT4gZGlzcGxheU9wdGlvbihpdGVtKSksIFtcbiAgICBkaXNwbGF5T3B0aW9uLFxuICAgIHNlbGVjdGVkSXRlbXNcbiAgXSk7XG4gIGNvbnN0IGhhbmRsZURyYWdFbmQgPSB1c2VDYWxsYmFjayhcbiAgICAoe2FjdGl2ZSwgb3Zlcn0pID0+IHtcbiAgICAgIGlmICghb3ZlcikgcmV0dXJuO1xuICAgICAgaWYgKGFjdGl2ZS5pZCAhPT0gb3Zlci5pZCkge1xuICAgICAgICBjb25zdCBvbGRJbmRleCA9IHNlbGVjdGVkSXRlbUlkcy5maW5kSW5kZXgoaXRlbUlkID0+IGl0ZW1JZCA9PT0gYWN0aXZlLmlkKTtcbiAgICAgICAgY29uc3QgbmV3SW5kZXggPSBzZWxlY3RlZEl0ZW1JZHMuZmluZEluZGV4KGl0ZW1JZCA9PiBpdGVtSWQgPT09IG92ZXIuaWQpO1xuICAgICAgICByZW9yZGVySXRlbXMoYXJyYXlNb3ZlKHNlbGVjdGVkSXRlbXMsIG9sZEluZGV4LCBuZXdJbmRleCkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgW3NlbGVjdGVkSXRlbXMsIGRpc3BsYXlPcHRpb24sIHJlb3JkZXJJdGVtc11cbiAgKTtcblxuICByZXR1cm4gKFxuICAgIDxDaGlja2xldGVkSW5wdXRDb250YWluZXJcbiAgICAgIGNsYXNzTmFtZT17YCR7Y2xhc3NOYW1lfSBjaGlja2xldGVkLWlucHV0YH1cbiAgICAgIG9uQ2xpY2s9e29uQ2xpY2t9XG4gICAgICBpbnB1dFRoZW1lPXtpbnB1dFRoZW1lfVxuICAgICAgaGFzUGxhY2Vob2xkZXI9eyFzZWxlY3RlZEl0ZW1zIHx8ICFzZWxlY3RlZEl0ZW1zLmxlbmd0aH1cbiAgICA+XG4gICAgICA8RG5kQ29udGV4dFxuICAgICAgICBvbkRyYWdFbmQ9e2hhbmRsZURyYWdFbmR9XG4gICAgICAgIG1vZGlmaWVycz17RE5EX01PRElGSUVSU31cbiAgICAgICAgY29sbGlzaW9uRGV0ZWN0aW9uPXtwb2ludGVyV2l0aGlufVxuICAgICAgICBhdXRvU2Nyb2xsPXtmYWxzZX1cbiAgICAgID5cbiAgICAgICAgPFNvcnRhYmxlQ29udGV4dCBpdGVtcz17c2VsZWN0ZWRJdGVtSWRzfT5cbiAgICAgICAgICB7c2VsZWN0ZWRJdGVtcy5sZW5ndGggPiAwID8gKFxuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiAoXG4gICAgICAgICAgICAgIDxDaGlja2xldGVkSXRlbVxuICAgICAgICAgICAgICAgIGl0ZW09e2l0ZW19XG4gICAgICAgICAgICAgICAgaXRlbUlkPXtkaXNwbGF5T3B0aW9uKGl0ZW0pfVxuICAgICAgICAgICAgICAgIHJlbW92ZUl0ZW09e3JlbW92ZUl0ZW19XG4gICAgICAgICAgICAgICAgZGlzcGxheU9wdGlvbj17ZGlzcGxheU9wdGlvbn1cbiAgICAgICAgICAgICAgICBDdXN0b21DaGlja2xldENvbXBvbmVudD17Q3VzdG9tQ2hpY2tsZXRDb21wb25lbnR9XG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICAgICAgICAgIGlucHV0VGhlbWU9e2lucHV0VGhlbWV9XG4gICAgICAgICAgICAgICAga2V5PXtgJHtkaXNwbGF5T3B0aW9uKGl0ZW0pfV8ke2luZGV4fWB9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApKVxuICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9e2Ake2NsYXNzTmFtZX0gY2hpY2tsZXRlZC1pbnB1dF9fcGxhY2Vob2xkZXJgfT5cbiAgICAgICAgICAgICAgPEZvcm1hdHRlZE1lc3NhZ2UgaWQ9e3BsYWNlaG9sZGVyIHx8ICdwbGFjZWhvbGRlci5lbnRlclZhbHVlJ30gLz5cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICApfVxuICAgICAgICA8L1NvcnRhYmxlQ29udGV4dD5cbiAgICAgICAgPERyYWdPdmVybGF5IGRyb3BBbmltYXRpb249e251bGx9IC8+XG4gICAgICA8L0RuZENvbnRleHQ+XG4gICAgPC9DaGlja2xldGVkSW5wdXRDb250YWluZXI+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBDaGlja2xldGVkSW5wdXQ7XG4iXX0=