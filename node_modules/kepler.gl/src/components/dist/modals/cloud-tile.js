"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.StyledWarning = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _icons = require("../common/icons");

var _styledComponents2 = require("../common/styled-components");

var _useCloudListProvider2 = require("../hooks/use-cloud-list-provider");

var _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6;

var StyledTileWrapper = _styledComponents["default"].div.attrs({
  className: 'provider-tile__wrapper'
})(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: flex-start;\n  border-radius: 2px;\n  border: 1px solid\n    ", ";\n  color: ", ";\n  cursor: pointer;\n  font-weight: 500;\n  width: 120px;\n  height: 168px;\n  background-color: #ffffff;\n  transition: ", ";\n  position: relative;\n  :hover {\n    border: 1px solid ", ";\n    color: ", ";\n  }\n\n  .button {\n    margin-top: 20px;\n  }\n"])), function (props) {
  return props.selected ? props.theme.primaryBtnBgd : props.theme.selectBorderColorLT;
}, function (props) {
  return props.selected ? props.theme.primaryBtnBgd : props.theme.selectBorderColorLT;
}, function (props) {
  return props.theme.transition;
}, function (props) {
  return props.theme.primaryBtnBgd;
}, function (props) {
  return props.theme.primaryBtnBgd;
});

var StyledBox = (0, _styledComponents["default"])(_styledComponents2.CenterVerticalFlexbox)(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  margin-right: 12px;\n  position: relative;\n"])));

var StyledCloudName = _styledComponents["default"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  font-size: 12px;\n  margin-top: 12px;\n  margin-bottom: 4px;\n"])));

var StyledUserName = _styledComponents["default"].div(_templateObject4 || (_templateObject4 = (0, _taggedTemplateLiteral2["default"])(["\n  font-size: 11px;\n  margin-top: 8px;\n  text-align: center;\n  color: ", ";\n  overflow: hidden;\n  width: 100px;\n  text-overflow: ellipsis;\n"])), function (props) {
  return props.theme.primaryBtnActBgd;
});

var LoginButton = function LoginButton(_ref) {
  var onClick = _ref.onClick;
  return /*#__PURE__*/_react["default"].createElement(_styledComponents2.Button, {
    className: "login-button",
    link: true,
    small: true,
    onClick: onClick
  }, /*#__PURE__*/_react["default"].createElement(_icons.Login, null), "Login");
};

var LogoutButton = function LogoutButton(_ref2) {
  var onClick = _ref2.onClick;
  return /*#__PURE__*/_react["default"].createElement(_styledComponents2.Button, {
    className: "logout-button",
    link: true,
    small: true,
    onClick: onClick
  }, /*#__PURE__*/_react["default"].createElement(_icons.Logout, null), "Logout");
};

var NewTag = _styledComponents["default"].div(_templateObject5 || (_templateObject5 = (0, _taggedTemplateLiteral2["default"])(["\n  width: 37px;\n  height: 19px;\n  display: flex;\n  align-content: center;\n  justify-content: center;\n  border-radius: 8px;\n  padding: 4px 8px;\n  background-color: #EDE9F9;\n  color: #8863F8;\n  position: absolute;\n  left: 35%;\n  top: -8px\n  z-index: 500;\n  font-size: 11px;\n  line-height: 10px;\n"])));

var StyledWarning = _styledComponents["default"].span(_templateObject6 || (_templateObject6 = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n  font-weight: ", ";\n"])), function (props) {
  return props.theme.errorColor;
}, function (props) {
  return props.theme.selectFontWeightBold;
});

exports.StyledWarning = StyledWarning;

/**
 * this component display a provider and allows users to select and set the current provider
 * @param provider
 * @param actionName
 * @constructor
 */
var CloudTile = function CloudTile(_ref3) {
  var provider = _ref3.provider,
      actionName = _ref3.actionName;

  var _useState = (0, _react.useState)(null),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      user = _useState2[0],
      setUser = _useState2[1];

  var _useState3 = (0, _react.useState)(null),
      _useState4 = (0, _slicedToArray2["default"])(_useState3, 2),
      error = _useState4[0],
      setError = _useState4[1];

  var _useState5 = (0, _react.useState)(false),
      _useState6 = (0, _slicedToArray2["default"])(_useState5, 2),
      isLoading = _useState6[0],
      setIsLoading = _useState6[1];

  var _useCloudListProvider = (0, _useCloudListProvider2.useCloudListProvider)(),
      currentProvider = _useCloudListProvider.provider,
      setProvider = _useCloudListProvider.setProvider;

  var isSelected = provider === currentProvider;
  (0, _react.useEffect)(function () {
    if (!provider) {
      return;
    }

    setError(null);
    setIsLoading(true);
    setError(null);
    provider.getUser().then(setUser)["catch"](setError)["finally"](function () {
      setError(null);
      setIsLoading(false);
    });
  }, [provider]);
  var onLogin = (0, _react.useCallback)( /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
    var _user;

    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            setError(null);
            setIsLoading(true);
            _context.prev = 2;
            _context.next = 5;
            return provider.login();

          case 5:
            _user = _context.sent;
            setUser(_user);
            setProvider(provider);
            _context.next = 13;
            break;

          case 10:
            _context.prev = 10;
            _context.t0 = _context["catch"](2);
            setError(_context.t0);

          case 13:
            setIsLoading(false);

          case 14:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[2, 10]]);
  })), [provider]);
  var onSelect = (0, _react.useCallback)( /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
    return _regenerator["default"].wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            if (!isLoading) {
              _context2.next = 2;
              break;
            }

            return _context2.abrupt("return");

          case 2:
            if (!user) {
              _context2.next = 5;
              break;
            }

            setProvider(provider);
            return _context2.abrupt("return");

          case 5:
            _context2.prev = 5;
            _context2.next = 8;
            return onLogin();

          case 8:
            setProvider(provider);
            _context2.next = 15;
            break;

          case 11:
            _context2.prev = 11;
            _context2.t0 = _context2["catch"](5);
            setError(_context2.t0);
            setProvider(null);

          case 15:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2, null, [[5, 11]]);
  })), [setProvider, provider, user, isLoading]);
  var onLogout = (0, _react.useCallback)( /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            setIsLoading(true);
            _context3.prev = 1;
            _context3.next = 4;
            return provider.logout();

          case 4:
            _context3.next = 9;
            break;

          case 6:
            _context3.prev = 6;
            _context3.t0 = _context3["catch"](1);
            setError(_context3.t0);

          case 9:
            setIsLoading(false);
            setUser(null);
            setProvider(null);

          case 12:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3, null, [[1, 6]]);
  })), [provider]);
  var displayName = provider.displayName,
      name = provider.name;
  return /*#__PURE__*/_react["default"].createElement(StyledBox, null, provider.isNew ? /*#__PURE__*/_react["default"].createElement(NewTag, null, "New") : null, /*#__PURE__*/_react["default"].createElement("div", null), /*#__PURE__*/_react["default"].createElement(StyledTileWrapper, {
    onClick: onSelect,
    selected: isSelected
  }, /*#__PURE__*/_react["default"].createElement(StyledCloudName, null, displayName || name), provider.icon ? /*#__PURE__*/_react["default"].createElement(provider.icon, {
    height: "64px"
  }) : null, isLoading ? /*#__PURE__*/_react["default"].createElement("div", null, "Loading ...") : /*#__PURE__*/_react["default"].createElement(_react["default"].Fragment, null, user ? /*#__PURE__*/_react["default"].createElement(StyledUserName, null, actionName || user.name) : null), isSelected ? /*#__PURE__*/_react["default"].createElement(_styledComponents2.CheckMark, null) : null), user || error ? /*#__PURE__*/_react["default"].createElement(LogoutButton, {
    onClick: onLogout
  }) : /*#__PURE__*/_react["default"].createElement(LoginButton, {
    onClick: onLogin
  }), error ? /*#__PURE__*/_react["default"].createElement(StyledWarning, null, error.message) : null);
};

var _default = CloudTile;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RhbHMvY2xvdWQtdGlsZS50c3giXSwibmFtZXMiOlsiU3R5bGVkVGlsZVdyYXBwZXIiLCJzdHlsZWQiLCJkaXYiLCJhdHRycyIsImNsYXNzTmFtZSIsInByb3BzIiwic2VsZWN0ZWQiLCJ0aGVtZSIsInByaW1hcnlCdG5CZ2QiLCJzZWxlY3RCb3JkZXJDb2xvckxUIiwidHJhbnNpdGlvbiIsIlN0eWxlZEJveCIsIkNlbnRlclZlcnRpY2FsRmxleGJveCIsIlN0eWxlZENsb3VkTmFtZSIsIlN0eWxlZFVzZXJOYW1lIiwicHJpbWFyeUJ0bkFjdEJnZCIsIkxvZ2luQnV0dG9uIiwib25DbGljayIsIkxvZ291dEJ1dHRvbiIsIk5ld1RhZyIsIlN0eWxlZFdhcm5pbmciLCJzcGFuIiwiZXJyb3JDb2xvciIsInNlbGVjdEZvbnRXZWlnaHRCb2xkIiwiQ2xvdWRUaWxlIiwicHJvdmlkZXIiLCJhY3Rpb25OYW1lIiwidXNlciIsInNldFVzZXIiLCJlcnJvciIsInNldEVycm9yIiwiaXNMb2FkaW5nIiwic2V0SXNMb2FkaW5nIiwiY3VycmVudFByb3ZpZGVyIiwic2V0UHJvdmlkZXIiLCJpc1NlbGVjdGVkIiwiZ2V0VXNlciIsInRoZW4iLCJvbkxvZ2luIiwibG9naW4iLCJvblNlbGVjdCIsIm9uTG9nb3V0IiwibG9nb3V0IiwiZGlzcGxheU5hbWUiLCJuYW1lIiwiaXNOZXciLCJpY29uIiwibWVzc2FnZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7O0FBTUEsSUFBTUEsaUJBQWlCLEdBQUdDLDZCQUFPQyxHQUFQLENBQVdDLEtBQVgsQ0FBaUI7QUFDekNDLEVBQUFBLFNBQVMsRUFBRTtBQUQ4QixDQUFqQixDQUFILHNnQkFTakIsVUFBQUMsS0FBSztBQUFBLFNBQUtBLEtBQUssQ0FBQ0MsUUFBTixHQUFpQkQsS0FBSyxDQUFDRSxLQUFOLENBQVlDLGFBQTdCLEdBQTZDSCxL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LENBQVUsSUFBVjtBQUFlLElBQUEsTUFBTSxFQUFDO0FBQXRCLElBQWhCLEdBQWtELElBRnJELEVBR0dmLFNBQVMsZ0JBQ1IsMkRBRFEsZ0JBR1Isa0VBQUdKLElBQUksZ0JBQUcsZ0NBQUMsY0FBRCxRQUFpQkQsVUFBVSxJQUFJQyxJQUFJLENBQUNpQixJQUFwQyxDQUFILEdBQWdFLElBQXZFLENBTkosRUFRR1QsVUFBVSxnQkFBRyxnQ0FBQyw0QkFBRCxPQUFILEdBQW1CLElBUmhDLENBSEYsRUFhR1IsSUFBSSxJQUFJRSxLQUFSLGdCQUFnQixnQ0FBQyxZQUFEO0FBQWMsSUFBQSxPQUFPLEVBQUVZO0FBQXZCLElBQWhCLGdCQUFzRCxnQ0FBQyxXQUFEO0FBQWEsSUFBQSxPQUFPLEVBQUVIO0FBQXRCLElBYnpELEVBY0dULEtBQUssZ0JBQUcsZ0NBQUMsYUFBRCxRQUFnQkEsS0FBSyxDQUFDa0IsT0FBdEIsQ0FBSCxHQUFvRCxJQWQ1RCxDQURGO0FBa0JELENBdEZEOztlQXdGZXZCLFMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG5pbXBvcnQgUmVhY3QsIHt1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VTdGF0ZX0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQge0xvZ291dCwgTG9naW59IGZyb20gJy4uL2NvbW1vbi9pY29ucyc7XG5pbXBvcnQge0NlbnRlclZlcnRpY2FsRmxleGJveCwgQnV0dG9uLCBDaGVja01hcmt9IGZyb20gJy4uL2NvbW1vbi9zdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQge1Byb3ZpZGVyLCBDbG91ZFVzZXJ9IGZyb20gJ0BrZXBsZXIuZ2wvY2xvdWQtcHJvdmlkZXJzJztcbmltcG9ydCB7dXNlQ2xvdWRMaXN0UHJvdmlkZXJ9IGZyb20gJy4uL2hvb2tzL3VzZS1jbG91ZC1saXN0LXByb3ZpZGVyJztcblxuaW50ZXJmYWNlIFN0eWxlZFRpbGVXcmFwcGVyUHJvcHMge1xuICBzZWxlY3RlZD86IGJvb2xlYW47XG59XG5cbmNvbnN0IFN0eWxlZFRpbGVXcmFwcGVyID0gc3R5bGVkLmRpdi5hdHRycyh7XG4gIGNsYXNzTmFtZTogJ3Byb3ZpZGVyLXRpbGVfX3dyYXBwZXInXG59KTxTdHlsZWRUaWxlV3JhcHBlclByb3BzPmBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAganVzdGlmeS1jb250ZW50OiBmbGV4LXN0YXJ0O1xuICBib3JkZXItcmFkaXVzOiAycHg7XG4gIGJvcmRlcjogMXB4IHNvbGlkXG4gICAgJHtwcm9wcyA9PiAocHJvcHMuc2VsZWN0ZWQgPyBwcm9wcy50aGVtZS5wcmltYXJ5QnRuQmdkIDogcHJvcHMudGhlbWUuc2VsZWN0Qm9yZGVyQ29sb3JMVCl9O1xuICBjb2xvcjogJHtwcm9wcyA9PiAocHJvcHMuc2VsZWN0ZWQgPyBwcm9wcy50aGVtZS5wcmltYXJ5QnRuQmdkIDogcHJvcHMudGhlbWUuc2VsZWN0Qm9yZGVyQ29sb3JMVCl9O1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIGZvbnQtd2VpZ2h0OiA1MDA7XG4gIHdpZHRoOiAxMjBweDtcbiAgaGVpZ2h0OiAxNjhweDtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjtcbiAgdHJhbnNpdGlvbjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS50cmFuc2l0aW9ufTtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICA6aG92ZXIge1xuICAgIGJvcmRlcjogMXB4IHNvbGlkICR7cHJvcHMgPT4gcHJvcHMudGhlbWUucHJpbWFyeUJ0bkJnZH07XG4gICAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUucHJpbWFyeUJ0bkJnZH07XG4gIH1cblxuICAuYnV0dG9uIHtcbiAgICBtYXJnaW4tdG9wOiAyMHB4O1xuICB9XG5gO1xuXG5jb25zdCBTdHlsZWRCb3ggPSBzdHlsZWQoQ2VudGVyVmVydGljYWxGbGV4Ym94KWBcbiAgbWFyZ2luLXJpZ2h0OiAxMnB4O1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG5gO1xuXG5jb25zdCBTdHlsZWRDbG91ZE5hbWUgPSBzdHlsZWQuZGl2YFxuICBmb250LXNpemU6IDEycHg7XG4gIG1hcmdpbi10b3A6IDEycHg7XG4gIG1hcmdpbi1ib3R0b206IDRweDtcbmA7XG5cbmNvbnN0IFN0eWxlZFVzZXJOYW1lID0gc3R5bGVkLmRpdmBcbiAgZm9udC1zaXplOiAxMXB4O1xuICBtYXJnaW4tdG9wOiA4cHg7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUucHJpbWFyeUJ0bkFjdEJnZH07XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIHdpZHRoOiAxMDBweDtcbiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG5gO1xuXG5pbnRlcmZhY2UgT25DbGlja1Byb3BzIHtcbiAgb25DbGljaz86IFJlYWN0Lk1vdXNlRXZlbnRIYW5kbGVyPEhUTUxCdXR0b25FbGVtZW50Pjtcbn1cblxuY29uc3QgTG9naW5CdXR0b24gPSAoe29uQ2xpY2t9OiBPbkNsaWNrUHJvcHMpID0+IChcbiAgPEJ1dHRvbiBjbGFzc05hbWU9XCJsb2dpbi1idXR0b25cIiBsaW5rIHNtYWxsIG9uQ2xpY2s9e29uQ2xpY2t9PlxuICAgIDxMb2dpbiAvPlxuICAgIExvZ2luXG4gIDwvQnV0dG9uPlxuKTtcblxuY29uc3QgTG9nb3V0QnV0dG9uID0gKHtvbkNsaWNrfTogT25DbGlja1Byb3BzKSA9PiAoXG4gIDxCdXR0b24gY2xhc3NOYW1lPVwibG9nb3V0LWJ1dHRvblwiIGxpbmsgc21hbGwgb25DbGljaz17b25DbGlja30+XG4gICAgPExvZ291dCAvPlxuICAgIExvZ291dFxuICA8L0J1dHRvbj5cbik7XG5cbmNvbnN0IE5ld1RhZyA9IHN0eWxlZC5kaXZgXG4gIHdpZHRoOiAzN3B4O1xuICBoZWlnaHQ6IDE5cHg7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWNvbnRlbnQ6IGNlbnRlcjtcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gIGJvcmRlci1yYWRpdXM6IDhweDtcbiAgcGFkZGluZzogNHB4IDhweDtcbiAgYmFja2dyb3VuZC1jb2xvcjogI0VERTlGOTtcbiAgY29sb3I6ICM4ODYzRjg7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgbGVmdDogMzUlO1xuICB0b3A6IC04cHhcbiAgei1pbmRleDogNTAwO1xuICBmb250LXNpemU6IDExcHg7XG4gIGxpbmUtaGVpZ2h0OiAxMHB4O1xuYDtcblxuZXhwb3J0IGNvbnN0IFN0eWxlZFdhcm5pbmcgPSBzdHlsZWQuc3BhbmBcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuZXJyb3JDb2xvcn07XG4gIGZvbnQtd2VpZ2h0OiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnNlbGVjdEZvbnRXZWlnaHRCb2xkfTtcbmA7XG5cbmludGVyZmFjZSBDbG91ZFRpbGVQcm9wcyB7XG4gIGFjdGlvbk5hbWU/OiBzdHJpbmcgfCBudWxsO1xuICAvLyBjbG91ZCBwcm92aWRlciBjbGFzc1xuICBwcm92aWRlcjogUHJvdmlkZXI7XG59XG5cbi8qKlxuICogdGhpcyBjb21wb25lbnQgZGlzcGxheSBhIHByb3ZpZGVyIGFuZCBhbGxvd3MgdXNlcnMgdG8gc2VsZWN0IGFuZCBzZXQgdGhlIGN1cnJlbnQgcHJvdmlkZXJcbiAqIEBwYXJhbSBwcm92aWRlclxuICogQHBhcmFtIGFjdGlvbk5hbWVcbiAqIEBjb25zdHJ1Y3RvclxuICovXG5jb25zdCBDbG91ZFRpbGU6IFJlYWN0LkZDPENsb3VkVGlsZVByb3BzPiA9ICh7cHJvdmlkZXIsIGFjdGlvbk5hbWV9KSA9PiB7XG4gIGNvbnN0IFt1c2VyLCBzZXRVc2VyXSA9IHVzZVN0YXRlPENsb3VkVXNlciB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlPEVycm9yIHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IFtpc0xvYWRpbmcsIHNldElzTG9hZGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IHtwcm92aWRlcjogY3VycmVudFByb3ZpZGVyLCBzZXRQcm92aWRlcn0gPSB1c2VDbG91ZExpc3RQcm92aWRlcigpO1xuICBjb25zdCBpc1NlbGVjdGVkID0gcHJvdmlkZXIgPT09IGN1cnJlbnRQcm92aWRlcjtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICghcHJvdmlkZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2V0RXJyb3IobnVsbCk7XG4gICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuICAgIHNldEVycm9yKG51bGwpO1xuICAgIHByb3ZpZGVyXG4gICAgICAuZ2V0VXNlcigpXG4gICAgICAudGhlbihzZXRVc2VyKVxuICAgICAgLmNhdGNoKHNldEVycm9yKVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBzZXRFcnJvcihudWxsKTtcbiAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcbiAgICAgIH0pO1xuICB9LCBbcHJvdmlkZXJdKTtcblxuICBjb25zdCBvbkxvZ2luID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xuICAgIHNldEVycm9yKG51bGwpO1xuICAgIHNldElzTG9hZGluZyh0cnVlKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHByb3ZpZGVyLmxvZ2luKCk7XG4gICAgICBzZXRVc2VyKHVzZXIpO1xuICAgICAgc2V0UHJvdmlkZXIocHJvdmlkZXIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBzZXRFcnJvcihlcnJvciBhcyBFcnJvcik7XG4gICAgfVxuICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gIH0sIFtwcm92aWRlcl0pO1xuXG4gIGNvbnN0IG9uU2VsZWN0ID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xuICAgIGlmIChpc0xvYWRpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIHNldFByb3ZpZGVyKHByb3ZpZGVyKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IG9uTG9naW4oKTtcbiAgICAgIHNldFByb3ZpZGVyKHByb3ZpZGVyKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHNldEVycm9yKGVyciBhcyBFcnJvcik7XG4gICAgICBzZXRQcm92aWRlcihudWxsKTtcbiAgICB9XG4gIH0sIFtzZXRQcm92aWRlciwgcHJvdmlkZXIsIHVzZXIsIGlzTG9hZGluZ10pO1xuXG4gIGNvbnN0IG9uTG9nb3V0ID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xuICAgIHNldElzTG9hZGluZyh0cnVlKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgcHJvdmlkZXIubG9nb3V0KCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHNldEVycm9yKGVycm9yIGFzIEVycm9yKTtcbiAgICB9XG4gICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcbiAgICBzZXRVc2VyKG51bGwpO1xuICAgIHNldFByb3ZpZGVyKG51bGwpO1xuICB9LCBbcHJvdmlkZXJdKTtcblxuICBjb25zdCB7ZGlzcGxheU5hbWUsIG5hbWV9ID0gcHJvdmlkZXI7XG5cbiAgcmV0dXJuIChcbiAgICA8U3R5bGVkQm94PlxuICAgICAge3Byb3ZpZGVyLmlzTmV3ID8gPE5ld1RhZz5OZXc8L05ld1RhZz4gOiBudWxsfVxuICAgICAgPGRpdj48L2Rpdj5cbiAgICAgIDxTdHlsZWRUaWxlV3JhcHBlciBvbkNsaWNrPXtvblNlbGVjdH0gc2VsZWN0ZWQ9e2lzU2VsZWN0ZWR9PlxuICAgICAgICA8U3R5bGVkQ2xvdWROYW1lPntkaXNwbGF5TmFtZSB8fCBuYW1lfTwvU3R5bGVkQ2xvdWROYW1lPlxuICAgICAgICB7cHJvdmlkZXIuaWNvbiA/IDxwcm92aWRlci5pY29uIGhlaWdodD1cIjY0cHhcIiAvPiA6IG51bGx9XG4gICAgICAgIHtpc0xvYWRpbmcgPyAoXG4gICAgICAgICAgPGRpdj5Mb2FkaW5nIC4uLjwvZGl2PlxuICAgICAgICApIDogKFxuICAgICAgICAgIDw+e3VzZXIgPyA8U3R5bGVkVXNlck5hbWU+e2FjdGlvbk5hbWUgfHwgdXNlci5uYW1lfTwvU3R5bGVkVXNlck5hbWU+IDogbnVsbH08Lz5cbiAgICAgICAgKX1cbiAgICAgICAge2lzU2VsZWN0ZWQgPyA8Q2hlY2tNYXJrIC8+IDogbnVsbH1cbiAgICAgIDwvU3R5bGVkVGlsZVdyYXBwZXI+XG4gICAgICB7dXNlciB8fCBlcnJvciA/IDxMb2dvdXRCdXR0b24gb25DbGljaz17b25Mb2dvdXR9IC8+IDogPExvZ2luQnV0dG9uIG9uQ2xpY2s9e29uTG9naW59IC8+fVxuICAgICAge2Vycm9yID8gPFN0eWxlZFdhcm5pbmc+e2Vycm9yLm1lc3NhZ2V9PC9TdHlsZWRXYXJuaW5nPiA6IG51bGx9XG4gICAgPC9TdHlsZWRCb3g+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBDbG91ZFRpbGU7XG4iXX0=