"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PureFeatureActionPanelFactory = PureFeatureActionPanelFactory;
exports["default"] = FeatureActionPanelFactory;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _reactIntl = require("react-intl");

var _actionPanel = _interopRequireWildcard(require("../common/action-panel"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _classnames = _interopRequireDefault(require("classnames"));

var _icons = require("../common/icons");

var _copyToClipboard = _interopRequireDefault(require("copy-to-clipboard"));

var _react2 = require("@floating-ui/react");

var _templateObject;

var LAYOVER_OFFSET = 4;

var StyledActionsLayer = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  position: absolute;\n  .layer-panel-item-disabled {\n    color: ", ";\n  }\n"])), function (props) {
  return props.theme.textColor;
});

var defaultActionIcons = {
  remove: _icons.Trash,
  layer: _icons.Layers,
  copy: _icons.Copy,
  copied: _icons.Checkmark
};
PureFeatureActionPanelFactory.deps = [];

function PureFeatureActionPanelFactory() {
  var FeatureActionPanel = function FeatureActionPanel(_ref) {
    var className = _ref.className,
        datasets = _ref.datasets,
        selectedFeature = _ref.selectedFeature,
        position = _ref.position,
        layers = _ref.layers,
        currentFilter = _ref.currentFilter,
        onToggleLayer = _ref.onToggleLayer,
        onDeleteFeature = _ref.onDeleteFeature,
        _ref$actionIcons = _ref.actionIcons,
        actionIcons = _ref$actionIcons === void 0 ? defaultActionIcons : _ref$actionIcons,
        children = _ref.children,
        onClose = _ref.onClose;

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        copied = _useState2[0],
        setCopied = _useState2[1];

    var _ref2 = currentFilter || {},
        _ref2$layerId = _ref2.layerId,
        layerId = _ref2$layerId === void 0 ? [] : _ref2$layerId;

    var intl = (0, _reactIntl.useIntl)();

    var _useFloating = (0, _react2.useFloating)({
      open: true,
      onOpenChange: function onOpenChange(v) {
        if (!v && onClose) {
          onClose();
        }
      }
    }),
        refs = _useFloating.refs,
        context = _useFloating.context;

    var dismiss = (0, _react2.useDismiss)(context);

    var _useInteractions = (0, _react2.useInteractions)([dismiss]),
        getFloatingProps = _useInteractions.getFloatingProps;

    var copyGeometry = (0, _react.useCallback)(function () {
      if (selectedFeature !== null && selectedFeature !== void 0 && selectedFeature.geometry) (0, _copyToClipboard["default"])(JSON.stringify(selectedFeature.geometry));
      setCopied(true);
    }, [selectedFeature === null || selectedFeature === void 0 ? void 0 : selectedFeature.geometry]);

    if (!position) {
      return null;
    }

    return /*#__PURE__*/_react["default"].createElement(StyledActionsLayer, (0, _extends2["default"])({
      ref: refs.setFloating
    }, getFloatingProps(), {
      className: (0, _classnames["default"])('feature-action-panel', className),
      style: {
        top: "".concat(position.y + LAYOVER_OFFSET, "px"),
        left: "".concat(position.x + LAYOVER_OFFSET, "px")
      }
    }), /*#__PURE__*/_react["default"].createElement(_actionPanel["default"], null, /*#__PURE__*/_react["default"].createElement(_actionPanel.ActionPanelItem, {
      className: "editor-layers-list",
      label: intl.formatMessage({
        id: 'editor.filterLayer',
        defaultMessage: 'Filter layers'
      }),
      Icon: actionIcons.layer
    }, layers.length ? layers.map(function (layer, index) {
      return /*#__PURE__*/_react["default"].createElement(_actionPanel.ActionPanelItem, {
        key: index,
        label: layer.config.label // @ts-ignore
        ,
        color: datasets[layer.config.dataId].color,
        isSelection: true,
        isActive: layerId.includes(layer.id),
        onClick: function onClick() {
          return onToggleLayer(layer);
        },
        className: "layer-panel-item"
      });
    }) : /*#__PURE__*/_react["default"].createElement(_actionPanel.ActionPanelItem, {
      key: 'no-layers',
      label: intl.formatMessage({
        id: 'editor.noLayersToFilter',
        defaultMessage: 'No layers to filter'
      }),
      isSelection: false,
      isActive: false,
      className: "layer-panel-item-disabled"
    })), /*#__PURE__*/_react["default"].createElement(_actionPanel.ActionPanelItem, {
      label: intl.formatMessage({
        id: 'editor.copyGeometry',
        defaultMessage: 'Copy Geometry'
      }),
      className: "delete-panel-item",
      Icon: copied ? actionIcons.copied : actionIcons.copy,
      onClick: copyGeometry
    }), children, /*#__PURE__*/_react["default"].createElement(_actionPanel.ActionPanelItem, {
      label: intl.formatMessage({
        id: 'tooltip.delete',
        defaultMessage: 'Delete'
      }),
      className: "delete-panel-item",
      Icon: actionIcons.remove,
      onClick: onDeleteFeature
    })));
  };

  FeatureActionPanel.displayName = 'FeatureActionPanel';
  FeatureActionPanel.defaultProps = {
    position: null,
    actionIcons: defaultActionIcons
  };
  return FeatureActionPanel;
}

FeatureActionPanelFactory.deps = PureFeatureActionPanelFactory.deps;

function FeatureActionPanelFactory() {
  return PureFeatureActionPanelFactory();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lZGl0b3IvZmVhdHVyZS1hY3Rpb24tcGFuZWwudHN4Il0sIm5hbWVzIjpbIkxBWU9WRVJfT0ZGU0VUIiwiU3R5bGVkQWN0aW9uc0xheWVyIiwic3R5bGVkIiwiZGl2IiwicHJvcHMiLCJ0aGVtZSIsInRleHRDb2xvciIsImRlZmF1bHRBY3Rpb25JY29ucyIsInJlbW92ZSIsIlRyYXNoIiwibGF5ZXIiLCJMYXllcnMiLCJjb3B5IiwiQ29weSIsImNvcGllZCIsIkNoZWNrbWFyayIsIlB1cmVGZWF0dXJlQWN0aW9uUGFuZWxGYWN0b3J5IiwiZGVwcyIsIkZlYXR1cmVBY3Rpb25QYW5lbCIsImNsYXNzTmFtZSIsImRhdGFzZXRzIiwic2VsZWN0ZWRGZWF0dXJlIiwicG9zaXRpb24iLCJsYXllcnMiLCJjdXJyZW50RmlsdGVyIiwib25Ub2dnbGVMYXllciIsIm9uRGVsZXRlRmVhdHVyZSIsImFjdGlvbkljb25zIiwiY2hpbGRyZW4iLCJvbkNsb3NlIiwic2V0Q29waWVkIiwibGF5ZXJJZCIsImludGwiLCJvcGVuIiwib25PcGVuQ2hhbmdlIiwidiIsInJlZnMiLCJjb250ZXh0IiwiZGlzbWlzcyIsImdldEZsb2F0aW5nUHJvcHMiLCJjb3B5R2VvbWV0cnkiLCJnZW9tZXRyeSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZXRGbG9hdGluZyIsInRvcCIsInkiLCJsZWZ0IiwieCIsImZvcm1hdE1lc3NhZ2UiLCJpZCIsImRlZmF1bHRNZXNzYWdlIiwibGVuZ3RoIiwibWFwIiwiaW5kZXgiLCJjb25maWciLCJsYWJlbCIsImRhdGFJZCIsImNvbG9yIiwiaW5jbHVkZXMiLCJkaXNwbGF5TmFtZSIsImRlZmF1bHRQcm9wcyIsIkZlYXR1cmVBY3Rpb25QYW5lbEZhY3RvcnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBTUEsSUFBTUEsY0FBYyxHQUFHLENBQXZCOztBQUVBLElBQU1DLGtCQUFrQixHQUFHQyw2QkFBT0MsR0FBVix1S0FHWCxVQUFBQyxLQUFLO0FBQUEsU0FBSUEsS0FBSyxDQUFDQyxLQUFOLENBQVlDLFNBQWhCO0FBQUEsQ0FITSxDQUF4Qjs7QUFNQSxJQUFNQyxrQkFBa0IsR0FBRztBQUN6QkMsRUFBQUEsTUFBTSxFQUFFQyxZQURpQjtBQUV6QkMsRUFBQUEsS0FBSyxFQUFFQyxhQUZrQjtBQUd6QkMsRUFBQUEsSUFBSSxFQUFFQyxXQUhtQjtBQUl6QkMsRUFBQUEsTUFBTSxFQUFFQztBQUppQixDQUEzQjtBQU1BQyw2QkFBNkIsQ0FBQ0MsSUFBOUIsR0FBcUMsRUFBckM7O0FBcUJPLFNBQVNELDZCQUFULEdBQTRFO0FBQ2pGLE1BQU1FLGtCQUFrQixHQUFHLFNBQXJCQSxrQkFBcUIsT0FZSTtBQUFBLFFBWDdCQyxTQVc2QixRQVg3QkEsU0FXNkI7QUFBQSxRQVY3QkMsUUFVNkIsUUFWN0JBLFFBVTZCO0FBQUEsUUFUN0JDLGVBUzZCLFFBVDdCQSxlQVM2QjtBQUFBLFFBUjdCQyxRQVE2QixRQVI3QkEsUUFRNkI7QUFBQSxRQVA3QkMsTUFPNkIsUUFQN0JBLE1BTzZCO0FBQUEsUUFON0JDLGFBTTZCLFFBTjdCQSxhQU02QjtBQUFBLFFBTDdCQyxhQUs2QixRQUw3QkEsYUFLNkI7QUFBQSxRQUo3QkMsZUFJNkIsUUFKN0JBLGVBSTZCO0FBQUEsZ0NBSDdCQyxXQUc2QjtBQUFBLFFBSDdCQSxXQUc2QixpQ0FIZnBCLGtCQUdlO0FBQUEsUUFGN0JxQixRQUU2QixRQUY3QkEsUUFFNkI7QUFBQSxRQUQ3QkMsT0FDNkIsUUFEN0JBLE9BQzZCOztBQUFBLG9CQUNELHFCQUFTLEtBQVQsQ0FEQztBQUFBO0FBQUEsUUFDdEJmLE1BRHNCO0FBQUEsUUFDZGdCLFNBRGM7O0FBQUEsZ0JBRU5OLGFBQWEsSUFBSSxFQUZYO0FBQUEsOEJBRXRCTyxPQUZzQjtBQUFBLFFBRXRCQSxPQUZzQiw4QkFFWixFQUZZOztBQUc3QixRQUFNQyxJQUFJLEdBQUcseUJBQWI7O0FBSDZCLHVCQUtMLHlCQUFZO0FBQ2xDQyxNQUFBQSxJQUFJLEVBQUUsSUFENEI7QUFFbENDLE1BQUFBLFlBQVksRUFBRSxzQkFBQUMsQ0FBQyxFQUFJO0FBQ2pCLFlBQUksQ0FBQ0EsQ0FBRCxJQUFNTixPQUFWLEVBQW1CO0FBQ2pCQSxVQUFBQSxPQUFPO0FBQ1I7QUFDRjtBQU5pQyxLQUFaLENBTEs7QUFBQSxRQUt0Qk8sSUFMc0IsZ0JBS3RCQSxJQUxzQjtBQUFBLFFBS2hCQyxPQUxnQixnQkFLaEJBLE9BTGdCOztBQWE3QixRQUFNQyxPQUFPLEdBQUcsd0JBQVdELE9BQVgsQ0FBaEI7O0FBYjZCLDJCQWVGLDZCQUFnQixDQUFDQyxPQUFELENBQWhCLENBZkU7QUFBQSxRQWV0QkMsZ0JBZnNCLG9CQWV0QkEsZ0JBZnNCOztBQWlCN0IsUUFBTUMsWUFBWSxHQUFHLHdCQUFZLFlBQU07QUFDckMsVUFBSW5CLGVBQUosYUFBSUEsZUFBSixlQUFJQSxlQUFlLENBQUVvQixRQUFyQixFQUErQixpQ0FBS0MsSUFBSSxDQUFDQyxTQUFMLENBQWV0QixlQUFlLENBQUNvQixRQUEvQixDQUFMO0FBQy9CWCxNQUFBQSxTQUFTLENBQUMsSUFBRCxDQUFUO0FBQ0QsS0FIb0IsRUFHbEIsQ0FBQ1QsZUFBRCxhQUFDQSxlQUFELHVCQUFDQSxlQUFlLENBQUVvQixRQUFsQixDQUhrQixDQUFyQjs7QUFLQSxRQUFJLENBQUNuQixRQUFMLEVBQWU7QUFDYixhQUFPLElBQVA7QUFDRDs7QUFFRCx3QkFDRSxnQ0FBQyxrQkFBRDtBQUNFLE1BQUEsR0FBRyxFQUFFYyxJQUFJLENBQUNRO0FBRFosT0FFTUwsZ0JBQWdCLEVBRnRCO0FBR0UsTUFBQSxTQUFTLEVBQUUsNEJBQVcsc0JBQVgsRUFBbUNwQixTQUFuQyxDQUhiO0FBSUUsTUFBQSxLQUFLLEVBQUU7QUFDTDBCLFFBQUFBLEdBQUcsWUFBS3ZCLFFBQVEsQ0FBQ3dCLENBQVQsR0FBYTlDLGNBQWxCLE9BREU7QUFFTCtDLFFBQUFBLElBQUksWUFBS3pCLFFBQVEsQ0FBQzBCLENBQVQsR0FBYWhELGNBQWxCO0FBRkM7QUFKVCxxQkFTRSxnQ0FBQyx1QkFBRCxxQkFDRSxnQ0FBQyw0QkFBRDtBQUNFLE1BQUEsU0FBUyxFQUFDLG9CQURaO0FBRUUsTUFBQSxLQUFLLEVBQUVnQyxJQUFJLENBQUNpQixhQUFMLENBQW1CO0FBQUNDLFFBQUFBLEVBQUUsRUFBRSxvQkFBTDtBQUEyQkMsUUFBQUEsY0FBYyxFQUFFO0FBQTNDLE9BQW5CLENBRlQ7QUFHRSxNQUFBLElBQUksRUFBRXhCLFdBQVcsQ0FBQ2pCO0FBSHBCLE9BS0dhLE1BQU0sQ0FBQzZCLE1BQVAsR0FDQzdCLE1BQU0sQ0FBQzhCLEdBQVAsQ0FBVyxVQUFDM0MsS0FBRCxFQUFRNEMsS0FBUjtBQUFBLDBCQUNULGdDQUFDLDRCQUFEO0FBQ0UsUUFBQSxHQUFHLEVBQUVBLEtBRFA7QUFFRSxRQUFBLEtBQUssRUFBRTVDLEtBQUssQ0FBQzZDLE1BQU4sQ0FBYUMsS0FGdEIsQ0FHRTtBQUhGO0FBSUUsUUFBQSxLQUFLLEVBQUVwQyxRQUFRLENBQUNWLEtBQUssQ0FBQzZDLE1BQU4sQ0FBYUUsTUFBZCxDQUFSLENBQThCQyxLQUp2QztBQUtFLFFBQUEsV0FBVyxFQUFFLElBTGY7QUFNRSxRQUFBLFFBQVEsRUFBRTNCLE9BQU8sQ0FBQzRCLFFBQVIsQ0FBaUJqRCxLQUFLLENBQUN3QyxFQUF2QixDQU5aO0FBT0UsUUFBQSxPQUFPLEVBQUU7QUFBQSxpQkFBTXpCLGFBQWEsQ0FBQ2YsS0FBRCxDQUFuQjtBQUFBLFNBUFg7QUFRRSxRQUFBLFNBQVMsRUFBQztBQVJaLFFBRFM7QUFBQSxLQUFYLENBREQsZ0JBY0MsZ0NBQUMsNEJBQUQ7QUFDRSxNQUFBLEdBQUcsRUFBRSxXQURQO0FBRUUsTUFBQSxLQUFLLEVBQUVzQixJQUFJLENBQUNpQixhQUFMLENBQW1CO0FBQ3hCQyxRQUFBQSxFQUFFLEVBQUUseUJBRG9CO0FBRXhCQyxRQUFBQSxjQUFjLEVBQUU7QUFGUSxPQUFuQixDQUZUO0FBTUUsTUFBQSxXQUFXLEVBQUUsS0FOZjtBQU9FLE1BQUEsUUFBUSxFQUFFLEtBUFo7QUFRRSxNQUFBLFNBQVMsRUFBQztBQVJaLE1BbkJKLENBREYsZUFnQ0UsZ0NBQUMsNEJBQUQ7QUFDRSxNQUFBLEtBQUssRUFBRW5CLElBQUksQ0FBQ2lCLGFBQUwsQ0FBbUI7QUFBQ0MsUUFBQUEsRUFBRSxFQUFFLHFCQUFMO0FBQTRCQyxRQUFBQSxjQUFjLEVBQUU7QUFBNUMsT0FBbkIsQ0FEVDtBQUVFLE1BQUEsU0FBUyxFQUFDLG1CQUZaO0FBR0UsTUFBQSxJQUFJLEVBQUVyQyxNQUFNLEdBQUdhLFdBQVcsQ0FBQ2IsTUFBZixHQUF3QmEsV0FBVyxDQUFDZixJQUhsRDtBQUlFLE1BQUEsT0FBTyxFQUFFNEI7QUFKWCxNQWhDRixFQXNDR1osUUF0Q0gsZUF1Q0UsZ0NBQUMsNEJBQUQ7QUFDRSxNQUFBLEtBQUssRUFBRUksSUFBSSxDQUFDaUIsYUFBTCxDQUFtQjtBQUFDQyxRQUFBQSxFQUFFLEVBQUUsZ0JBQUw7QUFBdUJDLFFBQUFBLGNBQWMsRUFBRTtBQUF2QyxPQUFuQixDQURUO0FBRUUsTUFBQSxTQUFTLEVBQUMsbUJBRlo7QUFHRSxNQUFBLElBQUksRUFBRXhCLFdBQVcsQ0FBQ25CLE1BSHBCO0FBSUUsTUFBQSxPQUFPLEVBQUVrQjtBQUpYLE1BdkNGLENBVEYsQ0FERjtBQTBERCxHQWhHRDs7QUFrR0FSLEVBQUFBLGtCQUFrQixDQUFDMEMsV0FBbkIsR0FBaUMsb0JBQWpDO0FBQ0ExQyxFQUFBQSxrQkFBa0IsQ0FBQzJDLFlBQW5CLEdBQWtDO0FBQ2hDdkMsSUFBQUEsUUFBUSxFQUFFLElBRHNCO0FBRWhDSyxJQUFBQSxXQUFXLEVBQUVwQjtBQUZtQixHQUFsQztBQUtBLFNBQU9XLGtCQUFQO0FBQ0Q7O0FBRUQ0Qyx5QkFBeUIsQ0FBQzdDLElBQTFCLEdBQWlDRCw2QkFBNkIsQ0FBQ0MsSUFBL0Q7O0FBRWUsU0FBUzZDLHlCQUFULEdBQTZFO0FBQzFGLFNBQU85Qyw2QkFBNkIsRUFBcEM7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge3VzZUNhbGxiYWNrLCB1c2VTdGF0ZSwgQ29tcG9uZW50VHlwZX0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHt1c2VJbnRsfSBmcm9tICdyZWFjdC1pbnRsJztcblxuaW1wb3J0IEFjdGlvblBhbmVsLCB7QWN0aW9uUGFuZWxJdGVtfSBmcm9tICcuLi9jb21tb24vYWN0aW9uLXBhbmVsJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQge1RyYXNoLCBMYXllcnMsIENvcHksIENoZWNrbWFya30gZnJvbSAnLi4vY29tbW9uL2ljb25zJztcbmltcG9ydCBjb3B5IGZyb20gJ2NvcHktdG8tY2xpcGJvYXJkJztcbmltcG9ydCB7dXNlRGlzbWlzcywgdXNlRmxvYXRpbmcsIHVzZUludGVyYWN0aW9uc30gZnJvbSAnQGZsb2F0aW5nLXVpL3JlYWN0JztcbmltcG9ydCB7TGF5ZXJ9IGZyb20gJ0BrZXBsZXIuZ2wvbGF5ZXJzJztcbmltcG9ydCB7RmlsdGVyfSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcbmltcG9ydCB7RmVhdHVyZX0gZnJvbSAnQG5lYnVsYS5nbC9lZGl0LW1vZGVzJztcbmltcG9ydCB7RGF0YXNldHN9IGZyb20gJ0BrZXBsZXIuZ2wvdGFibGUnO1xuXG5jb25zdCBMQVlPVkVSX09GRlNFVCA9IDQ7XG5cbmNvbnN0IFN0eWxlZEFjdGlvbnNMYXllciA9IHN0eWxlZC5kaXZgXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgLmxheWVyLXBhbmVsLWl0ZW0tZGlzYWJsZWQge1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRleHRDb2xvcn07XG4gIH1cbmA7XG5jb25zdCBkZWZhdWx0QWN0aW9uSWNvbnMgPSB7XG4gIHJlbW92ZTogVHJhc2gsXG4gIGxheWVyOiBMYXllcnMsXG4gIGNvcHk6IENvcHksXG4gIGNvcGllZDogQ2hlY2ttYXJrXG59O1xuUHVyZUZlYXR1cmVBY3Rpb25QYW5lbEZhY3RvcnkuZGVwcyA9IFtdO1xuXG5leHBvcnQgaW50ZXJmYWNlIEZlYXR1cmVBY3Rpb25QYW5lbFByb3BzIHtcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICBkYXRhc2V0czogRGF0YXNldHM7XG4gIHNlbGVjdGVkRmVhdHVyZTogRmVhdHVyZSB8IG51bGw7XG4gIHBvc2l0aW9uOiB7XG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcbiAgfSB8IG51bGw7XG4gIGxheWVyczogTGF5ZXJbXTtcbiAgY3VycmVudEZpbHRlcj86IEZpbHRlcjtcbiAgb25Ub2dnbGVMYXllcjogKGxheWVyOiBMYXllcikgPT4gdm9pZDtcbiAgb25EZWxldGVGZWF0dXJlOiAoKSA9PiB2b2lkO1xuICBvbkNsb3NlPzogKCkgPT4gdm9pZDtcbiAgY2hpbGRyZW4/OiBSZWFjdC5SZWFjdE5vZGU7XG4gIGFjdGlvbkljb25zPzoge1xuICAgIFtpZDogc3RyaW5nXTogUmVhY3QuRWxlbWVudFR5cGU7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBQdXJlRmVhdHVyZUFjdGlvblBhbmVsRmFjdG9yeSgpOiBSZWFjdC5GQzxGZWF0dXJlQWN0aW9uUGFuZWxQcm9wcz4ge1xuICBjb25zdCBGZWF0dXJlQWN0aW9uUGFuZWwgPSAoe1xuICAgIGNsYXNzTmFtZSxcbiAgICBkYXRhc2V0cyxcbiAgICBzZWxlY3RlZEZlYXR1cmUsXG4gICAgcG9zaXRpb24sXG4gICAgbGF5ZXJzLFxuICAgIGN1cnJlbnRGaWx0ZXIsXG4gICAgb25Ub2dnbGVMYXllcixcbiAgICBvbkRlbGV0ZUZlYXR1cmUsXG4gICAgYWN0aW9uSWNvbnMgPSBkZWZhdWx0QWN0aW9uSWNvbnMsXG4gICAgY2hpbGRyZW4sXG4gICAgb25DbG9zZVxuICB9OiBGZWF0dXJlQWN0aW9uUGFuZWxQcm9wcykgPT4ge1xuICAgIGNvbnN0IFtjb3BpZWQsIHNldENvcGllZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3Qge2xheWVySWQgPSBbXX0gPSBjdXJyZW50RmlsdGVyIHx8IHt9O1xuICAgIGNvbnN0IGludGwgPSB1c2VJbnRsKCk7XG5cbiAgICBjb25zdCB7cmVmcywgY29udGV4dH0gPSB1c2VGbG9hdGluZyh7XG4gICAgICBvcGVuOiB0cnVlLFxuICAgICAgb25PcGVuQ2hhbmdlOiB2ID0+IHtcbiAgICAgICAgaWYgKCF2ICYmIG9uQ2xvc2UpIHtcbiAgICAgICAgICBvbkNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zdCBkaXNtaXNzID0gdXNlRGlzbWlzcyhjb250ZXh0KTtcblxuICAgIGNvbnN0IHtnZXRGbG9hdGluZ1Byb3BzfSA9IHVzZUludGVyYWN0aW9ucyhbZGlzbWlzc10pO1xuXG4gICAgY29uc3QgY29weUdlb21ldHJ5ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgaWYgKHNlbGVjdGVkRmVhdHVyZT8uZ2VvbWV0cnkpIGNvcHkoSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5KSk7XG4gICAgICBzZXRDb3BpZWQodHJ1ZSk7XG4gICAgfSwgW3NlbGVjdGVkRmVhdHVyZT8uZ2VvbWV0cnldKTtcblxuICAgIGlmICghcG9zaXRpb24pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8U3R5bGVkQWN0aW9uc0xheWVyXG4gICAgICAgIHJlZj17cmVmcy5zZXRGbG9hdGluZ31cbiAgICAgICAgey4uLmdldEZsb2F0aW5nUHJvcHMoKX1cbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc25hbWVzKCdmZWF0dXJlLWFjdGlvbi1wYW5lbCcsIGNsYXNzTmFtZSl9XG4gICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgdG9wOiBgJHtwb3NpdGlvbi55ICsgTEFZT1ZFUl9PRkZTRVR9cHhgLFxuICAgICAgICAgIGxlZnQ6IGAke3Bvc2l0aW9uLnggKyBMQVlPVkVSX09GRlNFVH1weGBcbiAgICAgICAgfX1cbiAgICAgID5cbiAgICAgICAgPEFjdGlvblBhbmVsPlxuICAgICAgICAgIDxBY3Rpb25QYW5lbEl0ZW1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImVkaXRvci1sYXllcnMtbGlzdFwiXG4gICAgICAgICAgICBsYWJlbD17aW50bC5mb3JtYXRNZXNzYWdlKHtpZDogJ2VkaXRvci5maWx0ZXJMYXllcicsIGRlZmF1bHRNZXNzYWdlOiAnRmlsdGVyIGxheWVycyd9KX1cbiAgICAgICAgICAgIEljb249e2FjdGlvbkljb25zLmxheWVyfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtsYXllcnMubGVuZ3RoID8gKFxuICAgICAgICAgICAgICBsYXllcnMubWFwKChsYXllciwgaW5kZXgpID0+IChcbiAgICAgICAgICAgICAgICA8QWN0aW9uUGFuZWxJdGVtXG4gICAgICAgICAgICAgICAgICBrZXk9e2luZGV4fVxuICAgICAgICAgICAgICAgICAgbGFiZWw9e2xheWVyLmNvbmZpZy5sYWJlbH1cbiAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgIGNvbG9yPXtkYXRhc2V0c1tsYXllci5jb25maWcuZGF0YUlkXS5jb2xvcn1cbiAgICAgICAgICAgICAgICAgIGlzU2VsZWN0aW9uPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgaXNBY3RpdmU9e2xheWVySWQuaW5jbHVkZXMobGF5ZXIuaWQpfVxuICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gb25Ub2dnbGVMYXllcihsYXllcil9XG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJsYXllci1wYW5lbC1pdGVtXCJcbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgPEFjdGlvblBhbmVsSXRlbVxuICAgICAgICAgICAgICAgIGtleT17J25vLWxheWVycyd9XG4gICAgICAgICAgICAgICAgbGFiZWw9e2ludGwuZm9ybWF0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICBpZDogJ2VkaXRvci5ub0xheWVyc1RvRmlsdGVyJyxcbiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTm8gbGF5ZXJzIHRvIGZpbHRlcidcbiAgICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgICAgICBpc1NlbGVjdGlvbj17ZmFsc2V9XG4gICAgICAgICAgICAgICAgaXNBY3RpdmU9e2ZhbHNlfVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImxheWVyLXBhbmVsLWl0ZW0tZGlzYWJsZWRcIlxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L0FjdGlvblBhbmVsSXRlbT5cbiAgICAgICAgICA8QWN0aW9uUGFuZWxJdGVtXG4gICAgICAgICAgICBsYWJlbD17aW50bC5mb3JtYXRNZXNzYWdlKHtpZDogJ2VkaXRvci5jb3B5R2VvbWV0cnknLCBkZWZhdWx0TWVzc2FnZTogJ0NvcHkgR2VvbWV0cnknfSl9XG4gICAgICAgICAgICBjbGFzc05hbWU9XCJkZWxldGUtcGFuZWwtaXRlbVwiXG4gICAgICAgICAgICBJY29uPXtjb3BpZWQgPyBhY3Rpb25JY29ucy5jb3BpZWQgOiBhY3Rpb25JY29ucy5jb3B5fVxuICAgICAgICAgICAgb25DbGljaz17Y29weUdlb21ldHJ5fVxuICAgICAgICAgIC8+XG4gICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgIDxBY3Rpb25QYW5lbEl0ZW1cbiAgICAgICAgICAgIGxhYmVsPXtpbnRsLmZvcm1hdE1lc3NhZ2Uoe2lkOiAndG9vbHRpcC5kZWxldGUnLCBkZWZhdWx0TWVzc2FnZTogJ0RlbGV0ZSd9KX1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImRlbGV0ZS1wYW5lbC1pdGVtXCJcbiAgICAgICAgICAgIEljb249e2FjdGlvbkljb25zLnJlbW92ZX1cbiAgICAgICAgICAgIG9uQ2xpY2s9e29uRGVsZXRlRmVhdHVyZX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L0FjdGlvblBhbmVsPlxuICAgICAgPC9TdHlsZWRBY3Rpb25zTGF5ZXI+XG4gICAgKTtcbiAgfTtcblxuICBGZWF0dXJlQWN0aW9uUGFuZWwuZGlzcGxheU5hbWUgPSAnRmVhdHVyZUFjdGlvblBhbmVsJztcbiAgRmVhdHVyZUFjdGlvblBhbmVsLmRlZmF1bHRQcm9wcyA9IHtcbiAgICBwb3NpdGlvbjogbnVsbCxcbiAgICBhY3Rpb25JY29uczogZGVmYXVsdEFjdGlvbkljb25zXG4gIH07XG5cbiAgcmV0dXJuIEZlYXR1cmVBY3Rpb25QYW5lbDtcbn1cblxuRmVhdHVyZUFjdGlvblBhbmVsRmFjdG9yeS5kZXBzID0gUHVyZUZlYXR1cmVBY3Rpb25QYW5lbEZhY3RvcnkuZGVwcztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gRmVhdHVyZUFjdGlvblBhbmVsRmFjdG9yeSgpOiBDb21wb25lbnRUeXBlPEZlYXR1cmVBY3Rpb25QYW5lbFByb3BzPiB7XG4gIHJldHVybiBQdXJlRmVhdHVyZUFjdGlvblBhbmVsRmFjdG9yeSgpO1xufVxuIl19