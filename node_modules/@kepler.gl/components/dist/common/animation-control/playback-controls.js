"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _classnames = _interopRequireDefault(require("classnames"));

var _icons = require("../icons");

var _constants = require("@kepler.gl/constants");

var _animationSpeedSlider = _interopRequireDefault(require("./animation-speed-slider"));

var _windowActionControl = _interopRequireDefault(require("./window-action-control"));

var _animationWindowControl = _interopRequireDefault(require("./animation-window-control"));

var _resetControl = _interopRequireDefault(require("./reset-control"));

var _playControl = _interopRequireDefault(require("./play-control"));

var _speedControl = _interopRequireDefault(require("./speed-control"));

var _templateObject, _DEFAULT_ANIMATE_ITEM;

var DEFAULT_BUTTON_HEIGHT = '20px';

var StyledAnimationControls = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  position: relative;\n  width: ", "px;\n  &.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n  }\n"])), function (props) {
  return props.width;
});

var DEFAULT_ICONS = {
  /* eslint-disable react/display-name */
  reset: function reset(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Reset, {
      height: "18px"
    });
  },
  play: function play(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Play, {
      height: "18px"
    });
  },
  pause: function pause(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Pause, {
      height: "18px"
    });
  },
  "export": function _export(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Save, {
      height: "18px"
    });
  },

  /* eslint-enable react/display-name */
  speed: _icons.Rocket,
  animationFree: _icons.FreeWindow,
  animationIncremental: _icons.AnchorWindow
};

function nop() {}

var DEFAULT_ANIMATE_ITEMS = (_DEFAULT_ANIMATE_ITEM = {}, (0, _defineProperty2["default"])(_DEFAULT_ANIMATE_ITEM, _constants.ANIMATION_WINDOW.free, {
  id: _constants.ANIMATION_WINDOW.free,
  icon: DEFAULT_ICONS.animationFree,
  tooltip: 'tooltip.animationByWindow'
}), (0, _defineProperty2["default"])(_DEFAULT_ANIMATE_ITEM, _constants.ANIMATION_WINDOW.incremental, {
  id: _constants.ANIMATION_WINDOW.incremental,
  icon: DEFAULT_ICONS.animationIncremental,
  tooltip: 'tooltip.animationByIncremental'
}), _DEFAULT_ANIMATE_ITEM);
PlaybackControlsFactory.deps = [// keeping this for backwards compatibility but we can decide to drop it later
_animationSpeedSlider["default"], _windowActionControl["default"], _animationWindowControl["default"], _resetControl["default"], _playControl["default"]];

function PlaybackControlsFactory(AnimationSpeedSlider, WindowActionControl, AnimationWindowControl, ResetControl, PlayControl) {
  var PLAYBACK_CONTROLS_DEFAULT_ACTION_COMPONENTS = [PlayControl, (0, _speedControl["default"])(AnimationSpeedSlider), ResetControl, WindowActionControl, AnimationWindowControl]; // eslint-disable-next-line complexity

  var PlaybackControls = function PlaybackControls(_ref) {
    var isAnimatable = _ref.isAnimatable,
        isAnimating = _ref.isAnimating,
        width = _ref.width,
        speed = _ref.speed,
        animationWindow = _ref.animationWindow,
        setFilterAnimationWindow = _ref.setFilterAnimationWindow,
        updateAnimationSpeed = _ref.updateAnimationSpeed,
        pauseAnimation = _ref.pauseAnimation,
        resetAnimation = _ref.resetAnimation,
        startAnimation = _ref.startAnimation,
        playbackIcons = _ref.playbackIcons,
        animationItems = _ref.animationItems,
        buttonStyle = _ref.buttonStyle,
        buttonHeight = _ref.buttonHeight,
        _ref$playbackActionIt = _ref.playbackActionItems,
        playbackActionItems = _ref$playbackActionIt === void 0 ? [] : _ref$playbackActionIt;

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        isSpeedControlVisible = _useState2[0],
        toggleSpeedControl = _useState2[1];

    var _useState3 = (0, _react.useState)(false),
        _useState4 = (0, _slicedToArray2["default"])(_useState3, 2),
        showAnimationWindowControl = _useState4[0],
        setShowAnimationWindowControl = _useState4[1];

    var toggleAnimationWindowControl = (0, _react.useCallback)(function () {
      setShowAnimationWindowControl(!showAnimationWindowControl);
    }, [showAnimationWindowControl, setShowAnimationWindowControl]);
    var btnStyle = buttonStyle ? (0, _defineProperty2["default"])({}, buttonStyle, true) : {};
    var hideAndShowSpeedControl = (0, _react.useCallback)(function () {
      if (!isSpeedControlVisible) {
        toggleSpeedControl(true);
      } else {
        // TODO: A HACK to allow input onblur get triggered before the input is unmounted
        // A better solution should be invested, see https://github.com/facebook/react/issues/12363
        window.setTimeout(function () {
          return toggleSpeedControl(false);
        }, 200);
      }
    }, [isSpeedControlVisible, toggleSpeedControl]);
    return /*#__PURE__*/_react["default"].createElement(StyledAnimationControls, {
      className: (0, _classnames["default"])('playback-controls', {
        disabled: !isAnimatable
      }),
      width: width
    }, playbackActionItems.map(function (ActionComponent, index) {
      return /*#__PURE__*/_react["default"].createElement(ActionComponent, {
        key: index,
        toggleAnimationWindowControl: toggleAnimationWindowControl,
        showAnimationWindowControl: showAnimationWindowControl,
        btnStyle: btnStyle,
        hideAndShowSpeedControl: hideAndShowSpeedControl,
        animationItems: animationItems,
        animationWindow: animationWindow,
        buttonHeight: buttonHeight,
        setFilterAnimationWindow: setFilterAnimationWindow,
        updateAnimationSpeed: updateAnimationSpeed,
        isAnimating: isAnimating,
        pauseAnimation: pauseAnimation,
        resetAnimation: resetAnimation,
        startAnimation: startAnimation,
        playbackIcons: playbackIcons,
        isSpeedControlVisible: isSpeedControlVisible,
        speed: speed
      });
    }));
  };

  PlaybackControls.defaultProps = {
    playbackIcons: DEFAULT_ICONS,
    animationItems: DEFAULT_ANIMATE_ITEMS,
    buttonStyle: 'secondary',
    buttonHeight: DEFAULT_BUTTON_HEIGHT,
    playbackActionItems: PLAYBACK_CONTROLS_DEFAULT_ACTION_COMPONENTS,
    animationWindow: _constants.ANIMATION_WINDOW.free,
    isAnimatable: true,
    pauseAnimation: nop,
    resetAnimation: nop,
    startAnimation: nop
  };
  return PlaybackControls;
}

var _default = PlaybackControlsFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb24vYW5pbWF0aW9uLWNvbnRyb2wvcGxheWJhY2stY29udHJvbHMudHN4Il0sIm5hbWVzIjpbIkRFRkFVTFRfQlVUVE9OX0hFSUdIVCIsIlN0eWxlZEFuaW1hdGlvbkNvbnRyb2xzIiwic3R5bGVkIiwiZGl2IiwicHJvcHMiLCJ3aWR0aCIsIkRFRkFVTFRfSUNPTlMiLCJyZXNldCIsIl8iLCJwbGF5IiwicGF1c2UiLCJzcGVlZCIsIlJvY2tldCIsImFuaW1hdGlvbkZyZWUiLCJGcmVlV2luZG93IiwiYW5pbWF0aW9uSW5jcmVtZW50YWwiLCJBbmNob3JXaW5kb3ciLCJub3AiLCJERUZBVUxUX0FOSU1BVEVfSVRFTVMiLCJBTklNQVRJT05fV0lORE9XIiwiZnJlZSIsImlkIiwiaWNvbiIsInRvb2x0aXAiLCJpbmNyZW1lbnRhbCIsIlBsYXliYWNrQ29udHJvbHNGYWN0b3J5IiwiZGVwcyIsIkFuaW1hdGlvblNwZWVkU2xpZGVyRmFjdG9yeSIsIldpbmRvd0FjdGlvbkNvbnRyb2xGYWN0b3J5IiwiQW5pbWF0aW9uV2luZG93Q29udHJvbEZhY3RvcnkiLCJSZXNldENvbnRyb2xGYWN0b3J5IiwiUGxheUNvbnRyb2xGYWN0b3J5IiwiQW5pbWF0aW9uU3BlZWRTbGlkZXIiLCJXaW5kb3dBY3Rpb25Db250cm9sIiwiQW5pbWF0aW9uV2luZG93Q29udHJvbCIsIlJlc2V0Q29udHJvbCIsIlBsYXlDb250cm9sIiwiUExBWUJBQ0tfQ09OVFJPTFNfREVGQVVMVF9BQ1RJT05fQ09NUE9ORU5UUyIsIlBsYXliYWNrQ29udHJvbHMiLCJpc0FuaW1hdGFibGUiLCJpc0FuaW1hdGluZyIsImFuaW1hdGlvbldpbmRvdyIsInNldEZpbHRlckFuaW1hdGlvbldpbmRvdyIsInVwZGF0ZUFuaW1hdGlvblNwZWVkIiwicGF1c2VBbmltYXRpb24iLCJyZXNldEFuaW1hdGlvbiIsInN0YXJ0QW5pbWF0aW9uIiwicGxheWJhY2tJY29ucyIsImFuaW1hdGlvbkl0ZW1zIiwiYnV0dG9uU3R5bGUiLCJidXR0b25IZWlnaHQiLCJwbGF5YmFja0FjdGlvbkl0ZW1zIiwiaXNTcGVlZENvbnRyb2xWaXNpYmxlIiwidG9nZ2xlU3BlZWRDb250cm9sIiwic2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2wiLCJzZXRTaG93QW5pbWF0aW9uV2luZG93Q29udHJvbCIsInRvZ2dsZUFuaW1hdGlvbldpbmRvd0NvbnRyb2wiLCJidG5TdHlsZSIsImhpZGVBbmRTaG93U3BlZWRDb250cm9sIiwid2luZG93Iiwic2V0VGltZW91dCIsImRpc2FibGVkIiwibWFwIiwiQWN0aW9uQ29tcG9uZW50IiwiaW5kZXgiLCJkZWZhdWx0UHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxJQUFNQSxxQkFBcUIsR0FBRyxNQUE5Qjs7QUFNQSxJQUFNQyx1QkFBdUIsR0FBR0MsNkJBQU9DLEdBQVYsdU5BR2xCLFVBQUFDLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQVY7QUFBQSxDQUhhLENBQTdCOztBQVVBLElBQU1DLGFBQWEsR0FBRztBQUNwQjtBQUNBQyxFQUFBQSxLQUFLLEVBQUUsZUFBQUMsQ0FBQztBQUFBLHdCQUFJLGdDQUFDLFlBQUQ7QUFBTyxNQUFBLE1BQU0sRUFBQztBQUFkLE1BQUo7QUFBQSxHQUZZO0FBR3BCQyxFQUFBQSxJQUFJLEVBQUUsY0FBQUQsQ0FBQztBQUFBLHdCQUFJLGdDQUFDLFdBQUQ7QUFBTSxNQUFBLE1BQU0sRUFBQztBQUFiLE1BQUo7QUFBQSxHQUhhO0FBSXBCRSxFQUFBQSxLQUFLLEVBQUUsZUFBQUYsQ0FBQztBQUFBLHdCQUFJLGdDQUFDLFlBQUQ7QUFBTyxNQUFBLE1BQU0sRUFBQztBQUFkLE1BQUo7QUFBQSxHQUpZO0FBS3BCLFlBQVEsaUJBQUFBLENBQUM7QUFBQSx3QkFBSSxnQ0FBQyxXQUFEO0FB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RTlCLHFCQUZjO0FBRzlCK0IsSUFBQUEsV0FBVyxFQUFFLFdBSGlCO0FBSTlCQyxJQUFBQSxZQUFZLEVBQUVsRCxxQkFKZ0I7QUFLOUJtRCxJQUFBQSxtQkFBbUIsRUFBRWQsMkNBTFM7QUFNOUJJLElBQUFBLGVBQWUsRUFBRXRCLDRCQUFpQkMsSUFOSjtBQU85Qm1CLElBQUFBLFlBQVksRUFBRSxJQVBnQjtBQVE5QkssSUFBQUEsY0FBYyxFQUFFM0IsR0FSYztBQVM5QjRCLElBQUFBLGNBQWMsRUFBRTVCLEdBVGM7QUFVOUI2QixJQUFBQSxjQUFjLEVBQUU3QjtBQVZjLEdBQWhDO0FBYUEsU0FBT3FCLGdCQUFQO0FBQ0Q7O2VBRWNiLHVCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IFJlYWN0LCB7dXNlU3RhdGUsIHVzZUNhbGxiYWNrfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IHtSZXNldCwgUGxheSwgUGF1c2UsIFNhdmUsIFJvY2tldCwgQW5jaG9yV2luZG93LCBGcmVlV2luZG93fSBmcm9tICcuLi9pY29ucyc7XG5pbXBvcnQge0FOSU1BVElPTl9XSU5ET1d9IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcbmltcG9ydCBBbmltYXRpb25TcGVlZFNsaWRlckZhY3RvcnkgZnJvbSAnLi9hbmltYXRpb24tc3BlZWQtc2xpZGVyJztcbmltcG9ydCBXaW5kb3dBY3Rpb25Db250cm9sRmFjdG9yeSBmcm9tICcuL3dpbmRvdy1hY3Rpb24tY29udHJvbCc7XG5pbXBvcnQgQW5pbWF0aW9uV2luZG93Q29udHJvbEZhY3RvcnksIHtBbmltYXRpb25JdGVtfSBmcm9tICcuL2FuaW1hdGlvbi13aW5kb3ctY29udHJvbCc7XG5pbXBvcnQgUmVzZXRDb250cm9sRmFjdG9yeSBmcm9tICcuL3Jlc2V0LWNvbnRyb2wnO1xuaW1wb3J0IFBsYXlDb250cm9sRmFjdG9yeSBmcm9tICcuL3BsYXktY29udHJvbCc7XG5pbXBvcnQgU3BlZWRDb250cm9sRmFjdG9yeSBmcm9tICcuL3NwZWVkLWNvbnRyb2wnO1xuXG5jb25zdCBERUZBVUxUX0JVVFRPTl9IRUlHSFQgPSAnMjBweCc7XG5cbmludGVyZmFjZSBTdHlsZWRBbmltYXRpb25Db250cm9sc1Byb3BzIHtcbiAgd2lkdGg/OiBudW1iZXI7XG59XG5cbmNvbnN0IFN0eWxlZEFuaW1hdGlvbkNvbnRyb2xzID0gc3R5bGVkLmRpdjxTdHlsZWRBbmltYXRpb25Db250cm9sc1Byb3BzPmBcbiAgZGlzcGxheTogZmxleDtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICB3aWR0aDogJHtwcm9wcyA9PiBwcm9wcy53aWR0aH1weDtcbiAgJi5kaXNhYmxlZCB7XG4gICAgb3BhY2l0eTogMC40O1xuICAgIHBvaW50ZXItZXZlbnRzOiBub25lO1xuICB9XG5gO1xuXG5jb25zdCBERUZBVUxUX0lDT05TID0ge1xuICAvKiBlc2xpbnQtZGlzYWJsZSByZWFjdC9kaXNwbGF5LW5hbWUgKi9cbiAgcmVzZXQ6IF8gPT4gPFJlc2V0IGhlaWdodD1cIjE4cHhcIiAvPixcbiAgcGxheTogXyA9PiA8UGxheSBoZWlnaHQ9XCIxOHB4XCIgLz4sXG4gIHBhdXNlOiBfID0+IDxQYXVzZSBoZWlnaHQ9XCIxOHB4XCIgLz4sXG4gIGV4cG9ydDogXyA9PiA8U2F2ZSBoZWlnaHQ9XCIxOHB4XCIgLz4sXG4gIC8qIGVzbGludC1lbmFibGUgcmVhY3QvZGlzcGxheS1uYW1lICovXG4gIHNwZWVkOiBSb2NrZXQsXG4gIGFuaW1hdGlvbkZyZWU6IEZyZWVXaW5kb3csXG4gIGFuaW1hdGlvbkluY3JlbWVudGFsOiBBbmNob3JXaW5kb3dcbn07XG5cbmZ1bmN0aW9uIG5vcCgpIHt9XG5cbmNvbnN0IERFRkFVTFRfQU5JTUFURV9JVEVNUyA9IHtcbiAgW0FOSU1BVElPTl9XSU5ET1cuZnJlZV06IHtcbiAgICBpZDogQU5JTUFUSU9OX1dJTkRPVy5mcmVlLFxuICAgIGljb246IERFRkFVTFRfSUNPTlMuYW5pbWF0aW9uRnJlZSxcbiAgICB0b29sdGlwOiAndG9vbHRpcC5hbmltYXRpb25CeVdpbmRvdydcbiAgfSxcbiAgW0FOSU1BVElPTl9XSU5ET1cuaW5jcmVtZW50YWxdOiB7XG4gICAgaWQ6IEFOSU1BVElPTl9XSU5ET1cuaW5jcmVtZW50YWwsXG4gICAgaWNvbjogREVGQVVMVF9JQ09OUy5hbmltYXRpb25JbmNyZW1lbnRhbCxcbiAgICB0b29sdGlwOiAndG9vbHRpcC5hbmltYXRpb25CeUluY3JlbWVudGFsJ1xuICB9XG59O1xuaW50ZXJmYWNlIFBsYXliYWNrQ29udHJvbHNQcm9wcyB7XG4gIGlzQW5pbWF0YWJsZT86IGJvb2xlYW47XG4gIGlzQW5pbWF0aW5nPzogYm9vbGVhbjtcbiAgd2lkdGg/OiBudW1iZXI7XG4gIHNwZWVkOiBudW1iZXI7XG4gIGFuaW1hdGlvbldpbmRvdz86IHN0cmluZztcbiAgc2V0RmlsdGVyQW5pbWF0aW9uV2luZG93PzogKGlkOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHVwZGF0ZUFuaW1hdGlvblNwZWVkPzogKHZhbDogbnVtYmVyKSA9PiB2b2lkO1xuICBwYXVzZUFuaW1hdGlvbj86ICgpID0+IHZvaWQ7XG4gIHJlc2V0QW5pbWF0aW9uPzogKCkgPT4gdm9pZDtcbiAgc3RhcnRBbmltYXRpb246ICgpID0+IHZvaWQ7XG4gIHBsYXliYWNrSWNvbnM/OiB0eXBlb2YgREVGQVVMVF9JQ09OUztcbiAgYW5pbWF0aW9uSXRlbXM/OiB7W2tleTogc3RyaW5nXTogQW5pbWF0aW9uSXRlbX07XG4gIGJ1dHRvblN0eWxlPzogc3RyaW5nO1xuICBidXR0b25IZWlnaHQ/OiBzdHJpbmc7XG4gIHBsYXliYWNrQWN0aW9uSXRlbXM/OiBhbnlbXTtcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xufVxuXG5QbGF5YmFja0NvbnRyb2xzRmFjdG9yeS5kZXBzID0gW1xuICAvLyBrZWVwaW5nIHRoaXMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGJ1dCB3ZSBjYW4gZGVjaWRlIHRvIGRyb3AgaXQgbGF0ZXJcbiAgQW5pbWF0aW9uU3BlZWRTbGlkZXJGYWN0b3J5LFxuICBXaW5kb3dBY3Rpb25Db250cm9sRmFjdG9yeSxcbiAgQW5pbWF0aW9uV2luZG93Q29udHJvbEZhY3RvcnksXG4gIFJlc2V0Q29udHJvbEZhY3RvcnksXG4gIFBsYXlDb250cm9sRmFjdG9yeVxuXTtcblxuZnVuY3Rpb24gUGxheWJhY2tDb250cm9sc0ZhY3RvcnkoXG4gIEFuaW1hdGlvblNwZWVkU2xpZGVyOiBSZXR1cm5UeXBlPHR5cGVvZiBBbmltYXRpb25TcGVlZFNsaWRlckZhY3Rvcnk+LFxuICBXaW5kb3dBY3Rpb25Db250cm9sLFxuICBBbmltYXRpb25XaW5kb3dDb250cm9sLFxuICBSZXNldENvbnRyb2wsXG4gIFBsYXlDb250cm9sXG4pIHtcbiAgY29uc3QgUExBWUJBQ0tfQ09OVFJPTFNfREVGQVVMVF9BQ1RJT05fQ09NUE9ORU5UUyA9IFtcbiAgICBQbGF5Q29udHJvbCxcbiAgICBTcGVlZENvbnRyb2xGYWN0b3J5KEFuaW1hdGlvblNwZWVkU2xpZGVyKSxcbiAgICBSZXNldENvbnRyb2wsXG4gICAgV2luZG93QWN0aW9uQ29udHJvbCxcbiAgICBBbmltYXRpb25XaW5kb3dDb250cm9sXG4gIF07XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHlcbiAgY29uc3QgUGxheWJhY2tDb250cm9sczogUmVhY3QuRkM8UGxheWJhY2tDb250cm9sc1Byb3BzPiA9ICh7XG4gICAgaXNBbmltYXRhYmxlLFxuICAgIGlzQW5pbWF0aW5nLFxuICAgIHdpZHRoLFxuICAgIHNwZWVkLFxuICAgIGFuaW1hdGlvbldpbmRvdyxcbiAgICBzZXRGaWx0ZXJBbmltYXRpb25XaW5kb3csXG4gICAgdXBkYXRlQW5pbWF0aW9uU3BlZWQsXG4gICAgcGF1c2VBbmltYXRpb24sXG4gICAgcmVzZXRBbmltYXRpb24sXG4gICAgc3RhcnRBbmltYXRpb24sXG4gICAgcGxheWJhY2tJY29ucyxcbiAgICBhbmltYXRpb25JdGVtcyxcbiAgICBidXR0b25TdHlsZSxcbiAgICBidXR0b25IZWlnaHQsXG4gICAgcGxheWJhY2tBY3Rpb25JdGVtcyA9IFtdXG4gIH0pID0+IHtcbiAgICBjb25zdCBbaXNTcGVlZENvbnRyb2xWaXNpYmxlLCB0b2dnbGVTcGVlZENvbnRyb2xdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtzaG93QW5pbWF0aW9uV2luZG93Q29udHJvbCwgc2V0U2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2xdID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gICAgY29uc3QgdG9nZ2xlQW5pbWF0aW9uV2luZG93Q29udHJvbCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHNldFNob3dBbmltYXRpb25XaW5kb3dDb250cm9sKCFzaG93QW5pbWF0aW9uV2luZG93Q29udHJvbCk7XG4gICAgfSwgW3Nob3dBbmltYXRpb25XaW5kb3dDb250cm9sLCBzZXRTaG93QW5pbWF0aW9uV2luZG93Q29udHJvbF0pO1xuICAgIGNvbnN0IGJ0blN0eWxlID0gYnV0dG9uU3R5bGUgPyB7W2J1dHRvblN0eWxlXTogdHJ1ZX0gOiB7fTtcblxuICAgIGNvbnN0IGhpZGVBbmRTaG93U3BlZWRDb250cm9sID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgaWYgKCFpc1NwZWVkQ29udHJvbFZpc2libGUpIHtcbiAgICAgICAgdG9nZ2xlU3BlZWRDb250cm9sKHRydWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVE9ETzogQSBIQUNLIHRvIGFsbG93IGlucHV0IG9uYmx1ciBnZXQgdHJpZ2dlcmVkIGJlZm9yZSB0aGUgaW5wdXQgaXMgdW5tb3VudGVkXG4gICAgICAgIC8vIEEgYmV0dGVyIHNvbHV0aW9uIHNob3VsZCBiZSBpbnZlc3RlZCwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC9pc3N1ZXMvMTIzNjNcbiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdG9nZ2xlU3BlZWRDb250cm9sKGZhbHNlKSwgMjAwKTtcbiAgICAgIH1cbiAgICB9LCBbaXNTcGVlZENvbnRyb2xWaXNpYmxlLCB0b2dnbGVTcGVlZENvbnRyb2xdKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U3R5bGVkQW5pbWF0aW9uQ29udHJvbHNcbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc25hbWVzKCdwbGF5YmFjay1jb250cm9scycsIHtcbiAgICAgICAgICBkaXNhYmxlZDogIWlzQW5pbWF0YWJsZVxuICAgICAgICB9KX1cbiAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgPlxuICAgICAgICB7LyoqIFdpbmRvdyAqL31cbiAgICAgICAge3BsYXliYWNrQWN0aW9uSXRlbXMubWFwKChBY3Rpb25Db21wb25lbnQsIGluZGV4KSA9PiAoXG4gICAgICAgICAgPEFjdGlvbkNvbXBvbmVudFxuICAgICAgICAgICAga2V5PXtpbmRleH1cbiAgICAgICAgICAgIHRvZ2dsZUFuaW1hdGlvbldpbmRvd0NvbnRyb2w9e3RvZ2dsZUFuaW1hdGlvbldpbmRvd0NvbnRyb2x9XG4gICAgICAgICAgICBzaG93QW5pbWF0aW9uV2luZG93Q29udHJvbD17c2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2x9XG4gICAgICAgICAgICBidG5TdHlsZT17YnRuU3R5bGV9XG4gICAgICAgICAgICBoaWRlQW5kU2hvd1NwZWVkQ29udHJvbD17aGlkZUFuZFNob3dTcGVlZENvbnRyb2x9XG4gICAgICAgICAgICBhbmltYXRpb25JdGVtcz17YW5pbWF0aW9uSXRlbXN9XG4gICAgICAgICAgICBhbmltYXRpb25XaW5kb3c9e2FuaW1hdGlvbldpbmRvd31cbiAgICAgICAgICAgIGJ1dHRvbkhlaWdodD17YnV0dG9uSGVpZ2h0fVxuICAgICAgICAgICAgc2V0RmlsdGVyQW5pbWF0aW9uV2luZG93PXtzZXRGaWx0ZXJBbmltYXRpb25XaW5kb3d9XG4gICAgICAgICAgICB1cGRhdGVBbmltYXRpb25TcGVlZD17dXBkYXRlQW5pbWF0aW9uU3BlZWR9XG4gICAgICAgICAgICBpc0FuaW1hdGluZz17aXNBbmltYXRpbmd9XG4gICAgICAgICAgICBwYXVzZUFuaW1hdGlvbj17cGF1c2VBbmltYXRpb259XG4gICAgICAgICAgICByZXNldEFuaW1hdGlvbj17cmVzZXRBbmltYXRpb259XG4gICAgICAgICAgICBzdGFydEFuaW1hdGlvbj17c3RhcnRBbmltYXRpb259XG4gICAgICAgICAgICBwbGF5YmFja0ljb25zPXtwbGF5YmFja0ljb25zfVxuICAgICAgICAgICAgaXNTcGVlZENvbnRyb2xWaXNpYmxlPXtpc1NwZWVkQ29udHJvbFZpc2libGV9XG4gICAgICAgICAgICBzcGVlZD17c3BlZWR9XG4gICAgICAgICAgLz5cbiAgICAgICAgKSl9XG4gICAgICA8L1N0eWxlZEFuaW1hdGlvbkNvbnRyb2xzPlxuICAgICk7XG4gIH07XG5cbiAgUGxheWJhY2tDb250cm9scy5kZWZhdWx0UHJvcHMgPSB7XG4gICAgcGxheWJhY2tJY29uczogREVGQVVMVF9JQ09OUyxcbiAgICBhbmltYXRpb25JdGVtczogREVGQVVMVF9BTklNQVRFX0lURU1TLFxuICAgIGJ1dHRvblN0eWxlOiAnc2Vjb25kYXJ5JyxcbiAgICBidXR0b25IZWlnaHQ6IERFRkFVTFRfQlVUVE9OX0hFSUdIVCxcbiAgICBwbGF5YmFja0FjdGlvbkl0ZW1zOiBQTEFZQkFDS19DT05UUk9MU19ERUZBVUxUX0FDVElPTl9DT01QT05FTlRTLFxuICAgIGFuaW1hdGlvbldpbmRvdzogQU5JTUFUSU9OX1dJTkRPVy5mcmVlLFxuICAgIGlzQW5pbWF0YWJsZTogdHJ1ZSxcbiAgICBwYXVzZUFuaW1hdGlvbjogbm9wLFxuICAgIHJlc2V0QW5pbWF0aW9uOiBub3AsXG4gICAgc3RhcnRBbmltYXRpb246IG5vcFxuICB9O1xuXG4gIHJldHVybiBQbGF5YmFja0NvbnRyb2xzO1xufVxuXG5leHBvcnQgZGVmYXVsdCBQbGF5YmFja0NvbnRyb2xzRmFjdG9yeTtcbiJdfQ==