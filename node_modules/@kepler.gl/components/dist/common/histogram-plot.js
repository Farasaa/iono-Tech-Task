"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _d3Scale = require("d3-scale");

var _d3Array = require("d3-array");

var _d3Color = require("d3-color");

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _templateObject;

var histogramStyle = {
  highlightW: 0.7,
  unHighlightedW: 0.4
};

var HistogramWrapper = _styledComponents["default"].svg(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  overflow: visible;\n"])));

var BarUnmemoized = _styledComponents["default"].rect(function (_ref) {
  var theme = _ref.theme,
      inRange = _ref.inRange,
      color = _ref.color;
  return "\n  ".concat(inRange ? "fill: ".concat(color !== null && color !== void 0 ? color : theme.histogramFillInRange, ";") : "fill: ".concat(color ? (0, _d3Color.hcl)(color).darker() : theme.histogramFillOutRange, ";"), "\n");
});

var Bar = /*#__PURE__*/_react["default"].memo(BarUnmemoized);

Bar.displayName = 'Bar';

function HistogramPlotFactory() {
  var HistogramPlot = function HistogramPlot(_ref2) {
    var width = _ref2.width,
        height = _ref2.height,
        margin = _ref2.margin,
        isRanged = _ref2.isRanged,
        histogram = _ref2.histogram,
        value = _ref2.value,
        brushComponent = _ref2.brushComponent;

    var undefinedToZero = function undefinedToZero(x) {
      return x ? x : 0;
    };

    var domain = (0, _react.useMemo)(function () {
      return [histogram[0].x0, histogram[histogram.length - 1].x1].map(function (item) {
        return undefinedToZero(item);
      });
    }, [histogram]);
    var dataId = Object.keys(histogram[0]).filter(function (k) {
      return k !== 'x0' && k !== 'x1';
    })[0]; // use 1st for now

    var getValue = (0, _react.useMemo)(function () {
      return function (d) {
        return d[dataId];
      };
    }, [dataId]);
    var x = (0, _react.useMemo)(function () {
      return (0, _d3Scale.scaleLinear)().domain(domain).range([0, width]);
    }, [domain, width]);
    var y = (0, _react.useMemo)(function () {
      return (0, _d3Scale.scaleLinear)().domain([0, Number((0, _d3Array.max)(histogram, getValue))]).range([0, height]);
    }, [histogram, height, getValue]);
    var barWidth = width / histogram.length;
    return /*#__PURE__*/_react["default"].createElement(HistogramWrapper, {
      width: width,
      height: height,
      style: {
        marginTop: "".concat(margin.top, "px")
      }
    }, /*#__PURE__*/_react["default"].createElement("g", {
      className: "histogram-bars"
    }, histogram.map(function (bar) {
      var inRange = undefinedToZero(bar.x1) <= value[1] && undefinedToZero(bar.x0) >= value[0];
      var wRatio = inRange ? histogramStyle.highlightW : histogramStyle.unHighlightedW;
      var startX = x(undefinedToZero(bar.x0)) + barWidth * (1 - wRatio) / 2;

      if (startX > 0 && startX + barWidth * histogramStyle.unHighlightedW <= width) {
        return /*#__PURE__*/_react["default"].createElement(Bar, {
          inRange: inRange,
          key: bar.x0,
          height: y(getValue(bar)),
          width: barWidth * wRatio,
          x: startX,
          rx: 1,
          ry: 1,
          y: height - y(getValue(bar))
        });
      }

      return null;
    })), /*#__PURE__*/_react["default"].createElement("g", {
      transform: "translate(".concat(isRanged ? 0 : barWidth / 2, ", 0)")
    }, brushComponent));
  };

  var EmpptyOrPlot = function EmpptyOrPlot(props) {
    return !props.histogram || !props.histogram.length ? null : /*#__PURE__*/_react["default"].createElement(HistogramPlot, props);
  };

  return EmpptyOrPlot;
}

var _default = HistogramPlotFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tb24vaGlzdG9ncmFtLXBsb3QudHN4Il0sIm5hbWVzIjpbImhpc3RvZ3JhbVN0eWxlIiwiaGlnaGxpZ2h0VyIsInVuSGlnaGxpZ2h0ZWRXIiwiSGlzdG9ncmFtV3JhcHBlciIsInN0eWxlZCIsInN2ZyIsIkJhclVubWVtb2l6ZWQiLCJyZWN0IiwidGhlbWUiLCJpblJhbmdlIiwiY29sb3IiLCJoaXN0b2dyYW1GaWxsSW5SYW5nZSIsImRhcmtlciIsImhpc3RvZ3JhbUZpbGxPdXRSYW5nZSIsIkJhciIsIlJlYWN0IiwibWVtbyIsImRpc3BsYXlOYW1lIiwiSGlzdG9ncmFtUGxvdEZhY3RvcnkiLCJIaXN0b2dyYW1QbG90Iiwid2lkdGgiLCJoZWlnaHQiLCJtYXJnaW4iLCJpc1JhbmdlZCIsImhpc3RvZ3JhbSIsInZhbHVlIiwiYnJ1c2hDb21wb25lbnQiLCJ1bmRlZmluZWRUb1plcm8iLCJ4IiwiZG9tYWluIiwieDAiLCJsZW5ndGgiLCJ4MSIsIm1hcCIsIml0ZW0iLCJkYXRhSWQiLCJPYmplY3QiLCJrZXlzIiwiZmlsdGVyIiwiayIsImdldFZhbHVlIiwiZCIsInJhbmdlIiwieSIsIk51bWJlciIsImJhcldpZHRoIiwibWFyZ2luVG9wIiwidG9wIiwiYmFyIiwid1JhdGlvIiwic3RhcnRYIiwiRW1wcHR5T3JQbG90IiwicHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUdBLElBQU1BLGNBQWMsR0FBRztBQUNyQkMsRUFBQUEsVUFBVSxFQUFFLEdBRFM7QUFFckJDLEVBQUFBLGNBQWMsRUFBRTtBQUZLLENBQXZCOztBQUtBLElBQU1DLGdCQUFnQixHQUFHQyw2QkFBT0MsR0FBViw4R0FBdEI7O0FBT0EsSUFBTUMsYUFBYSxHQUFHRiw2QkFBT0csSUFBUCxDQUNwQjtBQUFBLE1BQUVDLEtBQUYsUUFBRUEsS0FBRjtBQUFBLE1BQVNDLE9BQVQsUUFBU0EsT0FBVDtB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S0FwQkEsQ0FESCxDQURGLGVBd0JFO0FBQUcsTUFBQSxTQUFTLHNCQUFlekIsUUFBUSxHQUFHLENBQUgsR0FBT3NCLFFBQVEsR0FBRyxDQUF6QztBQUFaLE9BQStEbkIsY0FBL0QsQ0F4QkYsQ0FERjtBQTRCRCxHQWxFRDs7QUFvRUEsTUFBTXlCLFlBQVksR0FBRyxTQUFmQSxZQUFlLENBQUFDLEtBQUs7QUFBQSxXQUN4QixDQUFDQSxLQUFLLENBQUM1QixTQUFQLElBQW9CLENBQUM0QixLQUFLLENBQUM1QixTQUFOLENBQWdCTyxNQUFyQyxHQUE4QyxJQUE5QyxnQkFBcUQsZ0NBQUMsYUFBRCxFQUFtQnFCLEtBQW5CLENBRDdCO0FBQUEsR0FBMUI7O0FBR0EsU0FBT0QsWUFBUDtBQUNEOztlQUNjakMsb0IiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG5pbXBvcnQgUmVhY3QsIHtSZWFjdEVsZW1lbnQsIHVzZU1lbW99IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7c2NhbGVMaW5lYXJ9IGZyb20gJ2QzLXNjYWxlJztcbmltcG9ydCB7bWF4fSBmcm9tICdkMy1hcnJheSc7XG5pbXBvcnQge2hjbH0gZnJvbSAnZDMtY29sb3InO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQge0hpc3RvZ3JhbUJpbn0gZnJvbSAnQGtlcGxlci5nbC90eXBlcyc7XG5cbmNvbnN0IGhpc3RvZ3JhbVN0eWxlID0ge1xuICBoaWdobGlnaHRXOiAwLjcsXG4gIHVuSGlnaGxpZ2h0ZWRXOiAwLjRcbn07XG5cbmNvbnN0IEhpc3RvZ3JhbVdyYXBwZXIgPSBzdHlsZWQuc3ZnYFxuICBvdmVyZmxvdzogdmlzaWJsZTtcbmA7XG5cbnR5cGUgQmFyVHlwZSA9IHtcbiAgaW5SYW5nZTogYm9vbGVhbjtcbn07XG5jb25zdCBCYXJVbm1lbW9pemVkID0gc3R5bGVkLnJlY3Q8QmFyVHlwZT4oXG4gICh7dGhlbWUsIGluUmFuZ2UsIGNvbG9yfSkgPT4gYFxuICAke1xuICAgIGluUmFuZ2VcbiAgICAgID8gYGZpbGw6ICR7Y29sb3IgPz8gdGhlbWUuaGlzdG9ncmFtRmlsbEluUmFuZ2V9O2BcbiAgICAgIDogYGZpbGw6ICR7Y29sb3IgPyBoY2woY29sb3IpLmRhcmtlcigpIDogdGhlbWUuaGlzdG9ncmFtRmlsbE91dFJhbmdlfTtgXG4gIH1cbmBcbik7XG5jb25zdCBCYXIgPSBSZWFjdC5tZW1vKEJhclVubWVtb2l6ZWQpO1xuQmFyLmRpc3BsYXlOYW1lID0gJ0Jhcic7XG5cbmludGVyZmFjZSBIaXN0b2dyYW1QbG90UHJvcHMge1xuICB3aWR0aDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbiAgbWFyZ2luOiB7dG9wOiBudW1iZXI7IGJvdHRvbTogbnVtYmVyOyBsZWZ0OiBudW1iZXI7IHJpZ2h0OiBudW1iZXJ9O1xuICBpc1JhbmdlZD86IGJvb2xlYW47XG4gIGhpc3RvZ3JhbTogSGlzdG9ncmFtQmluW107XG4gIHZhbHVlOiBudW1iZXJbXTtcbiAgYnJ1c2hDb21wb25lbnQ/OiBSZWFjdEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIEhpc3RvZ3JhbVBsb3RGYWN0b3J5KCkge1xuICBjb25zdCBIaXN0b2dyYW1QbG90ID0gKHtcbiAgICB3aWR0aCxcbiAgICBoZWlnaHQsXG4gICAgbWFyZ2luLFxuICAgIGlzUmFuZ2VkLFxuICAgIGhpc3RvZ3JhbSxcbiAgICB2YWx1ZSxcbiAgICBicnVzaENvbXBvbmVudFxuICB9OiBIaXN0b2dyYW1QbG90UHJvcHMpID0+IHtcbiAgICBjb25zdCB1bmRlZmluZWRUb1plcm8gPSAoeDogbnVtYmVyIHwgdW5kZWZpbmVkKSA9PiAoeCA/IHggOiAwKTtcbiAgICBjb25zdCBkb21haW4gPSB1c2VNZW1vKFxuICAgICAgKCkgPT5cbiAgICAgICAgW2hpc3RvZ3JhbVswXS54MCwgaGlzdG9ncmFtW2hpc3RvZ3JhbS5sZW5ndGggLSAxXS54MV0ubWFwKGl0ZW0gPT4gdW5kZWZpbmVkVG9aZXJvKGl0ZW0pKSxcbiAgICAgIFtoaXN0b2dyYW1dXG4gICAgKTtcbiAgICBjb25zdCBkYXRhSWQgPSBPYmplY3Qua2V5cyhoaXN0b2dyYW1bMF0pLmZpbHRlcihrID0+IGsgIT09ICd4MCcgJiYgayAhPT0gJ3gxJylbMF07XG5cbiAgICAvLyB1c2UgMXN0IGZvciBub3dcbiAgICBjb25zdCBnZXRWYWx1ZSA9IHVzZU1lbW8oKCkgPT4gZCA9PiBkW2RhdGFJZF0sIFtkYXRhSWRdKTtcblxuICAgIGNvbnN0IHggPSB1c2VNZW1vKFxuICAgICAgKCkgPT5cbiAgICAgICAgc2NhbGVMaW5lYXIoKVxuICAgICAgICAgIC5kb21haW4oZG9tYWluKVxuICAgICAgICAgIC5yYW5nZShbMCwgd2lkdGhdKSxcbiAgICAgIFtkb21haW4sIHdpZHRoXVxuICAgICk7XG5cbiAgICBjb25zdCB5ID0gdXNlTWVtbyhcbiAgICAgICgpID0+XG4gICAgICAgIHNjYWxlTGluZWFyKClcbiAgICAgICAgICAuZG9tYWluKFswLCBOdW1iZXIobWF4KGhpc3RvZ3JhbSwgZ2V0VmFsdWUpKV0pXG4gICAgICAgICAgLnJhbmdlKFswLCBoZWlnaHRdKSxcbiAgICAgIFtoaXN0b2dyYW0sIGhlaWdodCwgZ2V0VmFsdWVdXG4gICAgKTtcblxuICAgIGNvbnN0IGJhcldpZHRoID0gd2lkdGggLyBoaXN0b2dyYW0ubGVuZ3RoO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxIaXN0b2dyYW1XcmFwcGVyIHdpZHRoPXt3aWR0aH0gaGVpZ2h0PXtoZWlnaHR9IHN0eWxlPXt7bWFyZ2luVG9wOiBgJHttYXJnaW4udG9wfXB4YH19PlxuICAgICAgICA8ZyBjbGFzc05hbWU9XCJoaXN0b2dyYW0tYmFyc1wiPlxuICAgICAgICAgIHtoaXN0b2dyYW0ubWFwKGJhciA9PiB7XG4gICAgICAgICAgICBjb25zdCBpblJhbmdlID1cbiAgICAgICAgICAgICAgdW5kZWZpbmVkVG9aZXJvKGJhci54MSkgPD0gdmFsdWVbMV0gJiYgdW5kZWZpbmVkVG9aZXJvKGJhci54MCkgPj0gdmFsdWVbMF07XG4gICAgICAgICAgICBjb25zdCB3UmF0aW8gPSBpblJhbmdlID8gaGlzdG9ncmFtU3R5bGUuaGlnaGxpZ2h0VyA6IGhpc3RvZ3JhbVN0eWxlLnVuSGlnaGxpZ2h0ZWRXO1xuICAgICAgICAgICAgY29uc3Qgc3RhcnRYID0geCh1bmRlZmluZWRUb1plcm8oYmFyLngwKSkgKyAoYmFyV2lkdGggKiAoMSAtIHdSYXRpbykpIC8gMjtcbiAgICAgICAgICAgIGlmIChzdGFydFggPiAwICYmIHN0YXJ0WCArIGJhcldpZHRoICogaGlzdG9ncmFtU3R5bGUudW5IaWdobGlnaHRlZFcgPD0gd2lkdGgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8QmFyXG4gICAgICAgICAgICAgICAgICBpblJhbmdlPXtpblJhbmdlfVxuICAgICAgICAgICAgICAgICAga2V5PXtiYXIueDB9XG4gICAgICAgICAgICAgICAgICBoZWlnaHQ9e3koZ2V0VmFsdWUoYmFyKSl9XG4gICAgICAgICAgICAgICAgICB3aWR0aD17YmFyV2lkdGggKiB3UmF0aW99XG4gICAgICAgICAgICAgICAgICB4PXtzdGFydFh9XG4gICAgICAgICAgICAgICAgICByeD17MX1cbiAgICAgICAgICAgICAgICAgIHJ5PXsxfVxuICAgICAgICAgICAgICAgICAgeT17aGVpZ2h0IC0geShnZXRWYWx1ZShiYXIpKX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfSl9XG4gICAgICAgIDwvZz5cbiAgICAgICAgPGcgdHJhbnNmb3JtPXtgdHJhbnNsYXRlKCR7aXNSYW5nZWQgPyAwIDogYmFyV2lkdGggLyAyfSwgMClgfT57YnJ1c2hDb21wb25lbnR9PC9nPlxuICAgICAgPC9IaXN0b2dyYW1XcmFwcGVyPlxuICAgICk7XG4gIH07XG5cbiAgY29uc3QgRW1wcHR5T3JQbG90ID0gcHJvcHMgPT5cbiAgICAhcHJvcHMuaGlzdG9ncmFtIHx8ICFwcm9wcy5oaXN0b2dyYW0ubGVuZ3RoID8gbnVsbCA6IDxIaXN0b2dyYW1QbG90IHsuLi5wcm9wc30gLz47XG5cbiAgcmV0dXJuIEVtcHB0eU9yUGxvdDtcbn1cbmV4cG9ydCBkZWZhdWx0IEhpc3RvZ3JhbVBsb3RGYWN0b3J5O1xuIl19